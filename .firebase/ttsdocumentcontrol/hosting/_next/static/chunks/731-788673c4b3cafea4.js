"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[731],{7649:function(e,s,t){t.d(s,{AuthProvider:function(){return o},aC:function(){return u}});var r=t(7437),n=t(2265),l=t(2148),a=t(5978),i=t(6855);let d=null,c=(0,n.createContext)({user:null,firebaseUser:null,loading:!0,error:null,refetch:async()=>{},logout:async()=>{}});function o(e){let{children:s}=e,[t,o]=(0,n.useState)(null),[u,m]=(0,n.useState)(null),[E,x]=(0,n.useState)(!0),[h,N]=(0,n.useState)(null),g=async e=>{try{if(N(null),d&&d.firebaseUserId===e.uid&&Date.now()-d.timestamp<3e5){console.log("\uD83D\uDCCB Using cached user data for: ".concat(e.email)),m(d.user);return}console.log("\uD83D\uDD04 Fetching fresh user data for: ".concat(e.email));let r=(0,a.JU)(i.db,"users",e.uid),n=await (0,a.QT)(r);if(n.exists()){var s,t;let r=n.data(),l={id:e.uid,email:e.email||"",role:r.role,sites:r.sites||[],status:r.status||"ACTIVE",createdFromInvitation:r.createdFromInvitation,createdAt:null===(s=r.createdAt)||void 0===s?void 0:s.toDate(),acceptedAt:null===(t=r.acceptedAt)||void 0===t?void 0:t.toDate()};d={user:l,timestamp:Date.now(),firebaseUserId:e.uid},m(l)}else N("ไม่พบข้อมูลผู้ใช้ในระบบ"),m(null)}catch(e){console.error("Error fetching user data:",e),N("เกิดข้อผิดพลาดในการโหลดข้อมูลผู้ใช้"),m(null)}},b=async()=>{t&&(d=null,await g(t))};(0,n.useEffect)(()=>{let e=(0,l.Aj)(i.I,async e=>{(null==e?void 0:e.uid)===(null==t?void 0:t.uid)&&u||(x(!0),o(e),e?await g(e):(m(null),N(null),d=null),x(!1))});return()=>e()},[]);let I=async()=>{try{await (0,l.w7)(i.I),d=null,m(null),o(null),N(null)}catch(e){throw console.error("Logout error:",e),e}};return(0,r.jsx)(c.Provider,{value:{user:u,firebaseUser:t,loading:E,error:h,refetch:b,logout:I},children:s})}function u(){return(0,n.useContext)(c)}},731:function(e,s,t){t.d(s,{AuthGuard:function(){return d}});var r=t(7437),n=t(7649),l=t(9376),a=t(2265);t(453);let i=()=>(0,r.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,r.jsxs)("div",{className:"animate-pulse",children:[(0,r.jsx)("div",{className:"bg-white shadow",children:(0,r.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,r.jsxs)("div",{className:"flex justify-between items-center py-6",children:[(0,r.jsx)("div",{className:"h-8 bg-gray-200 rounded w-32"}),(0,r.jsx)("div",{className:"h-8 bg-gray-200 rounded w-24"})]})})}),(0,r.jsxs)("div",{className:"flex",children:[(0,r.jsx)("div",{className:"w-64 bg-white border-r border-gray-200 min-h-screen",children:(0,r.jsx)("div",{className:"p-4 space-y-3",children:[...Array(6)].map((e,s)=>(0,r.jsx)("div",{className:"h-10 bg-gray-100 rounded"},s))})}),(0,r.jsx)("div",{className:"flex-1 p-8",children:(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)("div",{className:"h-8 bg-gray-200 rounded w-1/3"}),(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[void 0,void 0,void 0].map((e,s)=>(0,r.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow",children:[(0,r.jsx)("div",{className:"h-4 bg-gray-200 rounded mb-2"}),(0,r.jsx)("div",{className:"h-8 bg-gray-200 rounded mb-4"}),(0,r.jsx)("div",{className:"h-4 bg-gray-200 rounded w-2/3"})]},s))})]})})]})]})});function d(e){let{children:s,requiredRoles:t=[],requiredSiteAccess:d=[],fallback:c,redirectTo:o="/login"}=e,{user:u,loading:m,error:E}=(0,n.aC)(),x=(0,l.useRouter)();return((0,a.useEffect)(()=>{m||u||x.push(o)},[u,m,x,o]),m)?(0,r.jsx)(i,{}):E?(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,r.jsx)("div",{className:"text-center max-w-md mx-auto",children:(0,r.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold text-red-800 mb-2",children:"เกิดข้อผิดพลาด"}),(0,r.jsx)("p",{className:"text-red-600 mb-4",children:E}),(0,r.jsx)("button",{onClick:()=>window.location.reload(),className:"bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 transition-colors",children:"ลองใหม่"})]})})}):u?t.length>0&&!t.includes(u.role)?(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,r.jsx)("div",{className:"text-center max-w-md mx-auto",children:(0,r.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-6",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold text-yellow-800 mb-2",children:"ไม่มีสิทธิ์เข้าถึง"}),(0,r.jsx)("p",{className:"text-yellow-700 mb-2",children:"คุณไม่มีสิทธิ์เข้าถึงหน้านี้"}),(0,r.jsxs)("p",{className:"text-sm text-yellow-600 mb-4",children:["ต้องการสิทธิ์: ",t.join(", ")," | สิทธิ์ปัจจุบัน: ",u.role]}),(0,r.jsx)("button",{onClick:()=>x.back(),className:"bg-yellow-600 text-white px-4 py-2 rounded hover:bg-yellow-700 transition-colors",children:"ย้อนกลับ"})]})})}):d.length>0&&"Admin"!==u.role&&!d.some(e=>{var s;return null===(s=u.sites)||void 0===s?void 0:s.includes(e)})?(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,r.jsx)("div",{className:"text-center max-w-md mx-auto",children:(0,r.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold text-red-800 mb-2",children:"ไม่มีสิทธิ์เข้าถึงโครงการ"}),(0,r.jsx)("p",{className:"text-red-600 mb-4",children:"คุณไม่มีสิทธิ์เข้าถึงโครงการที่ต้องการ"}),(0,r.jsx)("button",{onClick:()=>x.back(),className:"bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 transition-colors",children:"ย้อนกลับ"})]})})}):(0,r.jsx)(r.Fragment,{children:s}):c?(0,r.jsx)(r.Fragment,{children:c}):(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold text-gray-800 mb-2",children:"กรุณาเข้าสู่ระบบ"}),(0,r.jsx)("p",{className:"text-gray-600 mb-4",children:"คุณต้องเข้าสู่ระบบเพื่อเข้าถึงหน้านี้"}),(0,r.jsx)("button",{onClick:()=>x.push(o),className:"bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 transition-colors",children:"เข้าสู่ระบบ"})]})})}},453:function(e,s,t){t.d(s,{K$:function(){return r},NK:function(){return d},gf:function(){return a},n$:function(){return i},oU:function(){return l},uc:function(){return n},yh:function(){return c}});let r={ADMIN:"Admin",BIM:"BIM",SITE_ADMIN:"Site Admin",CM:"CM",ME:"ME",SN:"SN",OE:"OE",PE:"PE",PM:"PM",SE:"SE",ADMIN_SITE_2:"Adminsite2"},n=[r.BIM,r.ME,r.SN],l=[r.SITE_ADMIN,r.ADMIN_SITE_2,r.OE,r.PE],a=[r.CM];r.PM,r.SE;let i={PENDING_REVIEW:"PENDING_REVIEW",PENDING_CM_APPROVAL:"PENDING_CM_APPROVAL",REVISION_REQUIRED:"REVISION_REQUIRED",APPROVED:"APPROVED",APPROVED_WITH_COMMENTS:"APPROVED_WITH_COMMENTS",APPROVED_REVISION_REQUIRED:"APPROVED_REVISION_REQUIRED",REJECTED:"REJECTED",PENDING_FINAL_APPROVAL:"PENDING_FINAL_APPROVAL"},d={[i.PENDING_REVIEW]:"รอตรวจสอบ",[i.PENDING_CM_APPROVAL]:"ส่ง CM",[i.REVISION_REQUIRED]:"แก้ไข",[i.APPROVED]:"อนุมัติ",[i.APPROVED_WITH_COMMENTS]:"อนุมัติตามคอมเมนต์ (ไม่แก้ไข)",[i.APPROVED_REVISION_REQUIRED]:"อนุมัติตามคอมเมนต์ (ต้องแก้ไข)",[i.REJECTED]:"ไม่อนุมัติ",[i.PENDING_FINAL_APPROVAL]:"รอ SITE อนุมัติขั้นสุดท้าย"},c={[i.PENDING_REVIEW]:"#0088FE",[i.PENDING_CM_APPROVAL]:"#00C49F",[i.REVISION_REQUIRED]:"#FFBB28",[i.APPROVED]:"#28A745",[i.REJECTED]:"#DC3545",[i.APPROVED_WITH_COMMENTS]:"#20C997",[i.APPROVED_REVISION_REQUIRED]:"#FD7E14"}},6855:function(e,s,t){t.d(s,{I:function(){return i},db:function(){return d}});var r=t(738),n=t(2148),l=t(5978);let a=(0,r.C6)().length>0?(0,r.C6)()[0]:(0,r.ZF)({apiKey:"AIzaSyAsayb-DEOBE0zi0qh-dPBfihClgXrX1sY",authDomain:"ttsdocumentcontrol.firebaseapp.com",projectId:"ttsdocumentcontrol",storageBucket:"ttsdocumentcontrol.firebasestorage.app",messagingSenderId:"48440915675",appId:"1:48440915675:web:f11611895bfb52d4d27efe"}),i=(0,n.v0)(a),d=(0,l.ad)(a)}}]);