"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[313],{1313:function(e,t,r){r.d(t,{Z:function(){return M}});var s=r(7437),a=r(2265),n=r(7649),i=r(7648),l=r(9376),o=r(2381),c=r(2489),d=r(6215),E=r(8736),u=r(875),x=r(2502),R=r(9525),m=r(5805),N=r(1884),A=r(7692),h=r(6855),I=r(5978),g=r(1550);function P(e){var t;let{isOpen:r,onToggle:P}=e,f=(0,l.usePathname)(),_=(0,l.useRouter)(),p=(0,l.useSearchParams)(),{user:D,logout:M}=(0,n.a)(),{showLoader:b}=(0,o.r)(),[v,S]=(0,a.useState)(!1),[O,j]=(0,a.useState)([]);(0,a.useEffect)(()=>{if(!(null==D?void 0:D.id)){j([]);return}let e=(0,I.IO)((0,I.hJ)(h.db,"sites"),(0,I.ar)("members","array-contains",D.id)),t=(0,I.cf)(e,e=>{let t=[];e.forEach(e=>{let r=e.data();t.push({id:e.id,name:r.name,userOverrides:r.userOverrides||{}})}),j(t)},e=>{console.warn("Sidebar: Failed to fetch sites",e)});return()=>t()},[D]);let y=e=>{if(!D)return!1;let[t,r]=e.split("."),s=(g.yB[e]||[]).includes(D.role);return!!O.some(e=>{var s,a,n;return(null===(n=e.userOverrides)||void 0===n?void 0:null===(a=n[D.id])||void 0===a?void 0:null===(s=a[t])||void 0===s?void 0:s[r])===!0})||!!s},{canViewShop:C,canViewGen:T,canViewMat:F,hasRfaAccess:K,hasWorkRequestAccess:V,isAdminAccess:$}=(0,a.useMemo)(()=>{if(!D)return{canViewShop:!1,canViewGen:!1,canViewMat:!1,hasRfaAccess:!1,hasWorkRequestAccess:!1,isAdminAccess:!1};let e=y("RFA.".concat(g.S4.RFA.VIEW_SHOP)),t=y("RFA.".concat(g.S4.RFA.VIEW_GEN)),r=y("RFA.".concat(g.S4.RFA.VIEW_MAT));return{canViewShop:e,canViewGen:t,canViewMat:r,hasRfaAccess:e||t||r,hasWorkRequestAccess:y("WR.".concat(g.S4.WORK_REQUEST.VIEW)),isAdminAccess:"Admin"===D.role}},[D,O]),W=(0,a.useMemo)(()=>(null==D?void 0:D.sites)&&0!==O.length?O.filter(e=>D.sites.includes(e.id)):[],[null==D?void 0:D.sites,O]);(0,a.useEffect)(()=>{(f.includes("/rfa")||f.includes("/dashboard/rfa"))&&S(!0)},[f]);let[w,k]=(0,a.useState)(!1),G=async()=>{try{k(!0),await M(),_.push("/")}catch(e){console.error("Logout error:",e)}finally{k(!1)}},B=e=>f===e||f.startsWith(e+"/");return D?(0,s.jsxs)(s.Fragment,{children:[r&&(0,s.jsx)("div",{className:"lg:hidden fixed inset-0 bg-black bg-opacity-50 z-30",onClick:P}),(0,s.jsxs)("div",{className:"fixed inset-y-0 left-0 z-40 w-64 bg-gradient-to-b from-amber-50 to-orange-50 border-r border-orange-200 transform transition-transform duration-300 ease-in-out ".concat(r?"translate-x-0":"-translate-x-full"," flex flex-col h-screen pt-16"),children:[(0,s.jsxs)("div",{className:"bg-gradient-to-r from-orange-600 to-orange-700 text-white p-4 lg:p-6",children:[(0,s.jsx)("div",{className:"lg:hidden flex justify-end mb-2",children:(0,s.jsx)("button",{onClick:P,className:"p-1 rounded-md hover:bg-white hover:bg-opacity-20",children:(0,s.jsx)(c.Z,{size:20})})}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsxs)("h3",{className:"font-semibold text-lg truncate",children:["Welcome ",null===(t=D.email)||void 0===t?void 0:t.split("@")[0]]}),(0,s.jsxs)("p",{className:"text-orange-100 text-sm",children:["Role: ",D.role]}),W.length>0&&(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-orange-100 text-xs",children:"Site:"}),(0,s.jsx)("div",{className:"pl-2",children:W.map(e=>(0,s.jsxs)("p",{className:"text-orange-100 text-xs truncate",title:e.name,children:["- ",e.name]},e.id))})]})]})]}),(0,s.jsxs)("nav",{className:"flex-1 p-4 space-y-2 overflow-y-auto",children:[(0,s.jsxs)(i.default,{href:"/dashboard",onClick:b,className:"flex items-center px-3 py-2 rounded-lg transition-colors ".concat(B("/dashboard")&&"/dashboard"===f?"bg-blue-100 text-blue-700":"text-gray-700 hover:bg-gray-100"),children:[(0,s.jsx)(d.Z,{className:"w-5 h-5 mr-3"})," Dashboard"]}),K&&(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsxs)("button",{onClick:()=>S(!v),className:"w-full flex items-center justify-between gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition-colors duration-200 ".concat(f.startsWith("/dashboard/rfa")||f.startsWith("/rfa/")?"bg-orange-200 text-orange-900":"text-gray-700 hover:bg-orange-100 hover:text-orange-800"),children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(E.Z,{size:18}),(0,s.jsx)("span",{children:"RFA Documents"})]}),v?(0,s.jsx)(u.Z,{size:16}):(0,s.jsx)(x.Z,{size:16})]}),v&&(0,s.jsxs)("div",{className:"ml-6 space-y-1 border-l-2 border-orange-200 pl-4",children:[C&&(0,s.jsxs)(i.default,{href:"/dashboard/rfa?type=RFA-SHOP",onClick:b,className:"flex items-center gap-3 px-3 py-2 rounded-md text-sm transition-colors duration-200 ".concat("/dashboard/rfa"===f&&"RFA-SHOP"===p.get("type")?"bg-blue-100 text-blue-900 font-medium":"text-gray-600 hover:bg-gray-100 hover:text-gray-800"),children:[(0,s.jsx)("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),(0,s.jsx)("span",{children:"\uD83C\uDFD7️ Shop Drawing"})]}),T&&(0,s.jsxs)(i.default,{href:"/dashboard/rfa?type=RFA-GEN",onClick:b,className:"flex items-center gap-3 px-3 py-2 rounded-md text-sm transition-colors duration-200 ".concat("/dashboard/rfa"===f&&"RFA-GEN"===p.get("type")?"bg-green-100 text-green-900 font-medium":"text-gray-600 hover:bg-gray-100 hover:text-gray-800"),children:[(0,s.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),(0,s.jsx)("span",{children:"\uD83D\uDCCB General"})]}),F&&(0,s.jsxs)(i.default,{href:"/dashboard/rfa?type=RFA-MAT",onClick:b,className:"flex items-center gap-3 px-3 py-2 rounded-md text-sm transition-colors duration-200 ".concat("/dashboard/rfa"===f&&"RFA-MAT"===p.get("type")?"bg-orange-100 text-orange-900 font-medium":"text-gray-600 hover:bg-gray-100 hover:text-gray-800"),children:[(0,s.jsx)("div",{className:"w-2 h-2 bg-orange-500 rounded-full"}),(0,s.jsx)("span",{children:"\uD83E\uDDF1 Material"})]})]})]}),V&&(0,s.jsxs)(i.default,{href:"/dashboard/work-request",onClick:b,className:"flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition-colors duration-200 ".concat(B("/dashboard/work-request")?"bg-orange-200 text-orange-900":"text-gray-700 hover:bg-orange-100 hover:text-orange-800"),children:[(0,s.jsx)(R.Z,{size:18}),(0,s.jsx)("span",{children:"Work Request"})]})]}),$&&(0,s.jsxs)("div",{className:"px-4 py-2",children:[(0,s.jsx)("div",{className:"border-t border-orange-200"}),(0,s.jsxs)("div",{className:"mt-2 space-y-1",children:[(0,s.jsx)("p",{className:"px-3 text-xs font-semibold uppercase text-gray-500 tracking-wider pt-2",children:"Admin"}),(0,s.jsxs)(i.default,{href:"/admin",onClick:b,className:"flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition-colors duration-200 ".concat("/admin"===f?"bg-red-100 text-red-800":"text-gray-700 hover:bg-red-50 hover:text-red-700"),children:[(0,s.jsx)(m.Z,{size:18}),(0,s.jsx)("span",{children:"Invite Users"})]}),(0,s.jsxs)(i.default,{href:"/admin/users",onClick:b,className:"flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition-colors duration-200 ".concat(B("/admin/users")?"bg-red-100 text-red-800":"text-gray-700 hover:bg-red-50 hover:text-red-700"),children:[(0,s.jsx)(N.Z,{size:18}),(0,s.jsx)("span",{children:"Manage Users"})]})]})]}),(0,s.jsx)("div",{className:"p-4 border-t border-orange-200",children:(0,s.jsxs)("button",{onClick:G,disabled:w,className:"w-full flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg text-sm font-medium ".concat(w?"bg-red-400 cursor-not-allowed":"bg-red-500 hover:bg-red-600"," text-white transition-colors duration-200"),children:[(0,s.jsx)(A.Z,{size:16}),(0,s.jsx)("span",{children:w?"กำลังออก...":"ออกจากระบบ"})]})})]})]}):null}var f=e=>(0,s.jsx)(a.Suspense,{fallback:(0,s.jsx)("div",{className:"w-64 bg-gray-100 h-screen"}),children:(0,s.jsx)(P,{...e})}),_=r(8293),p=r(4766),D=r(8420),M=e=>{let{children:t}=e,[r,i]=(0,a.useState)(!0),{user:l,requestNotificationPermission:c}=(0,n.a)(),{isLoading:d}=(0,o.r)(),E=()=>{i(!r)};return(0,s.jsxs)("div",{className:"min-h-screen bg-gray-100",children:[(0,s.jsx)("header",{className:"fixed top-0 left-0 right-0 h-16 bg-white border-b border-gray-200 z-50",children:(0,s.jsxs)("div",{className:"flex items-center justify-between h-full px-4",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsx)("button",{onClick:E,className:"p-2 rounded-md text-gray-600 hover:bg-gray-100 hover:text-gray-900 transition-colors",children:(0,s.jsx)(_.Z,{size:20})}),(0,s.jsx)("h1",{className:"text-xl font-semibold text-gray-900",children:"\uD83C\uDFD7️ ttsdoc v2"})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsx)("button",{onClick:()=>c(),className:"p-2 rounded-md text-gray-600 hover:bg-gray-100 hover:text-blue-600 transition-colors relative",title:"เปิดการแจ้งเตือน",children:(0,s.jsx)(p.Z,{size:18})}),l&&(0,s.jsxs)("span",{className:"hidden sm:block text-sm text-gray-600",children:["\uD83D\uDC4B สวัสดี, ",l.email.split("@")[0]]}),(0,s.jsxs)("div",{className:"hidden md:flex items-center space-x-2 text-gray-600",children:[(0,s.jsx)(D.Z,{size:18}),(0,s.jsx)("span",{className:"text-sm font-medium",children:"T.T.S. Engineering"})]})]})]})}),(0,s.jsxs)("div",{className:"flex",children:[(0,s.jsx)(f,{isOpen:r,onToggle:E}),(0,s.jsxs)("main",{className:"\n              relative flex-1 transition-all duration-300 ease-in-out\n              ".concat(r?"lg:ml-64":"lg:ml-0","\n              overflow-x-hidden\n            "),children:[d&&(0,s.jsx)(o.Y,{}),(0,s.jsx)("div",{className:"h-full overflow-y-auto",children:(0,s.jsx)("div",{className:"pt-16",children:(0,s.jsx)("div",{className:"p-4 sm:p-6 lg:p-8",children:t})})})]})]})]})}},9761:function(e,t,r){var s=r(7437);r(2265),t.Z=e=>{let{className:t}=e;return(0,s.jsx)("div",{className:"\n    inline-block h-8 w-8 animate-spin rounded-full \n    border-4 border-solid border-current border-e-transparent \n    align-[-0.125em] text-gray-400 motion-reduce:animate-[spin_1.5s_linear_infinite]\n    ".concat(t||"","\n  ").trim(),role:"status",children:(0,s.jsx)("span",{className:"!absolute !-m-px !h-px !w-px !overflow-hidden !whitespace-nowrap !border-0 !p-0 ![clip:rect(0,0,0,0)]",children:"Loading..."})})}},1550:function(e,t,r){r.d(t,{S4:function(){return a},l8:function(){return l},yB:function(){return i}});var s=r(453);let a={RFA:{VIEW_SHOP:"view_shop",CREATE_SHOP:"create_shop",VIEW_GEN:"view_gen",CREATE_GEN:"create_gen",VIEW_MAT:"view_mat",CREATE_MAT:"create_mat",APPROVE:"can_approve"},WORK_REQUEST:{VIEW:"view_wr",CREATE:"create_wr",APPROVE:"approve_wr",VERIFY:"verify_wr"}};s.K$.ADMIN,s.K$.PD,s.K$.PM,s.K$.SE,s.K$.FM,s.K$.BIM,s.K$.SITE_ADMIN,s.K$.CM,s.K$.ME,s.K$.SN,s.K$.OE,s.K$.PE;let n=[s.K$.ADMIN,s.K$.PD,s.K$.PM,s.K$.BIM,s.K$.SITE_ADMIN,s.K$.CM,s.K$.ME,s.K$.SN,s.K$.OE,s.K$.PE],i={["RFA.".concat(a.RFA.VIEW_SHOP)]:n,["RFA.".concat(a.RFA.CREATE_SHOP)]:[s.K$.BIM,s.K$.ME,s.K$.SN,s.K$.SITE_ADMIN,s.K$.ADMIN,s.K$.PM,s.K$.PE,s.K$.OE],["RFA.".concat(a.RFA.VIEW_GEN)]:n,["RFA.".concat(a.RFA.CREATE_GEN)]:[s.K$.BIM,s.K$.ME,s.K$.SN,s.K$.SITE_ADMIN,s.K$.ADMIN,s.K$.PM,s.K$.PE,s.K$.OE],["RFA.".concat(a.RFA.VIEW_MAT)]:n,["RFA.".concat(a.RFA.CREATE_MAT)]:[s.K$.SITE_ADMIN,s.K$.ADMIN,s.K$.PM,s.K$.PE,s.K$.OE],["RFA.".concat(a.RFA.APPROVE)]:[s.K$.CM,s.K$.ADMIN,s.K$.SITE_ADMIN,s.K$.PM,s.K$.PE,s.K$.OE],["WR.".concat(a.WORK_REQUEST.VIEW)]:n,["WR.".concat(a.WORK_REQUEST.CREATE)]:[s.K$.PE,s.K$.OE,s.K$.ADMIN],["WR.".concat(a.WORK_REQUEST.APPROVE)]:[s.K$.PM,s.K$.ADMIN],["WR.".concat(a.WORK_REQUEST.VERIFY)]:[s.K$.SITE_ADMIN,s.K$.ADMIN,s.K$.BIM]},l=[{title:"RFA - Shop Drawing",permissions:[{key:"RFA.".concat(a.RFA.VIEW_SHOP),label:"เข้าดู (View)"},{key:"RFA.".concat(a.RFA.CREATE_SHOP),label:"สร้าง (Create)"}]},{title:"RFA - General",permissions:[{key:"RFA.".concat(a.RFA.VIEW_GEN),label:"เข้าดู (View)"},{key:"RFA.".concat(a.RFA.CREATE_GEN),label:"สร้าง (Create)"}]},{title:"RFA - Material",permissions:[{key:"RFA.".concat(a.RFA.VIEW_MAT),label:"เข้าดู (View)"},{key:"RFA.".concat(a.RFA.CREATE_MAT),label:"สร้าง (Create)"}]},{title:"RFA - Approval",permissions:[{key:"RFA.".concat(a.RFA.APPROVE),label:"อนุมัติเอกสาร (Approve)"}]},{title:"Work Request",permissions:[{key:"WR.".concat(a.WORK_REQUEST.VIEW),label:"เข้าดู (View)"},{key:"WR.".concat(a.WORK_REQUEST.CREATE),label:"สร้างใบคำขอ (Create)"},{key:"WR.".concat(a.WORK_REQUEST.APPROVE),label:"อนุมัติใบคำขอ (PM)"},{key:"WR.".concat(a.WORK_REQUEST.VERIFY),label:"ตรวจรับงาน (Site)"}]}]},453:function(e,t,r){r.d(t,{$p:function(){return l},Ge:function(){return c},K$:function(){return s},NK:function(){return d},c9:function(){return i},gf:function(){return n},n$:function(){return o},oU:function(){return a},yh:function(){return E}});let s={ADMIN:"Admin",BIM:"BIM",SITE_ADMIN:"Site Admin",CM:"CM",ME:"ME",SN:"SN",OE:"OE",PE:"PE",PM:"PM",PD:"PD",SE:"SE",FM:"FM",ADMIN_SITE_2:"Adminsite2"};s.BIM,s.ME,s.SN,s.SITE_ADMIN,s.ADMIN,s.PM,s.PE,s.OE;let a=[s.SITE_ADMIN,s.ADMIN_SITE_2,s.OE,s.PE,s.ADMIN],n=[s.CM,s.ADMIN,s.SITE_ADMIN,s.PM,s.PE,s.OE];s.PM,s.ADMIN,s.SE,s.FM;let i=[s.PE,s.OE,s.ADMIN],l=[s.PM,s.ADMIN];s.PD,s.SE,s.FM;let o={PENDING_REVIEW:"PENDING_REVIEW",PENDING_CM_APPROVAL:"PENDING_CM_APPROVAL",REVISION_REQUIRED:"REVISION_REQUIRED",APPROVED:"APPROVED",APPROVED_WITH_COMMENTS:"APPROVED_WITH_COMMENTS",APPROVED_REVISION_REQUIRED:"APPROVED_REVISION_REQUIRED",REJECTED:"REJECTED",PENDING_FINAL_APPROVAL:"PENDING_FINAL_APPROVAL"},c={DRAFT:"DRAFT",REJECTED_BY_PM:"REJECTED_BY_PM",PENDING_BIM:"PENDING_BIM",IN_PROGRESS:"IN_PROGRESS",PENDING_ACCEPTANCE:"PENDING_ACCEPTANCE",REVISION_REQUESTED:"REVISION_REQUESTED",COMPLETED:"COMPLETED"},d={[o.PENDING_REVIEW]:"รอตรวจสอบ",[o.PENDING_CM_APPROVAL]:"รออนุมัติ (CM/Approver)",[o.REVISION_REQUIRED]:"แก้ไข",[o.APPROVED]:"อนุมัติ",[o.APPROVED_WITH_COMMENTS]:"อนุมัติตามคอมเมนต์ (ไม่แก้ไข)",[o.APPROVED_REVISION_REQUIRED]:"อนุมัติตามคอมเมนต์ (ต้องแก้ไข)",[o.REJECTED]:"ไม่อนุมัติ",[o.PENDING_FINAL_APPROVAL]:"รอ SITE อนุมัติขั้นสุดท้าย",[c.DRAFT]:"รออนุมัติ (PM)",[c.REJECTED_BY_PM]:"ไม่อนุมัติ (PM)",[c.PENDING_BIM]:"รอ BIM รับงาน",[c.IN_PROGRESS]:"BIM กำลังดำเนินการ",[c.PENDING_ACCEPTANCE]:"รอตรวจรับ (Site)",[c.REVISION_REQUESTED]:"ขอแก้ไข (WR)",[c.COMPLETED]:"เสร็จสิ้น"},E={[o.PENDING_REVIEW]:"#0088FE",[o.PENDING_CM_APPROVAL]:"#00C49F",[o.REVISION_REQUIRED]:"#FFBB28",[o.APPROVED]:"#28A745",[o.REJECTED]:"#DC3545",[o.APPROVED_WITH_COMMENTS]:"#2f3e3aff",[o.APPROVED_REVISION_REQUIRED]:"#FD7E14",[c.DRAFT]:"#6c757d",[c.REJECTED_BY_PM]:"#DC3545",[c.PENDING_BIM]:"#0088FE",[c.IN_PROGRESS]:"#FFBB28",[c.PENDING_ACCEPTANCE]:"#AF19FF",[c.REVISION_REQUESTED]:"#FD7E14",[c.COMPLETED]:"#28A745"}},2381:function(e,t,r){r.d(t,{LoadingProvider:function(){return c},Y:function(){return o},r:function(){return d}});var s=r(7437),a=r(2265),n=r(9761),i=r(9376);let l=(0,a.createContext)(void 0),o=()=>(0,s.jsx)("div",{className:"absolute inset-0 bg-gray-100 z-30 flex items-center justify-center",children:(0,s.jsx)(n.Z,{className:"w-12 h-12 text-gray-500"})}),c=e=>{let{children:t}=e,[r,n]=(0,a.useState)(!1),o=(0,i.usePathname)(),c=(0,i.useSearchParams)();return(0,a.useEffect)(()=>{n(!1)},[o,c]),(0,s.jsx)(l.Provider,{value:{isLoading:r,showLoader:()=>n(!0),hideLoader:()=>n(!1)},children:t})},d=()=>{let e=(0,a.useContext)(l);if(void 0===e)throw Error("useLoading must be used within a LoadingProvider");return e}}}]);