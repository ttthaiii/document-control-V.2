"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[313],{1313:function(e,s,r){r.d(s,{Z:function(){return D}});var t=r(7437),n=r(2265),a=r(7649),i=r(7648),l=r(9376),o=r(2381),d=r(2489),c=r(6215),x=r(8736),h=r(875),m=r(407),u=r(5685),g=r(9525),f=r(5805),p=r(7692),b=r(453),j=r(6855),v=r(5978);function y(e){var s;let{isOpen:r,onToggle:y}=e,N=(0,l.usePathname)(),w=(0,l.useRouter)(),k=(0,l.useSearchParams)(),{user:C,logout:D}=(0,a.aC)(),{showLoader:z}=(0,o.r)(),[S,Z]=(0,n.useState)(!1),[F,A]=(0,n.useState)([]);(0,n.useEffect)(()=>{if(!(null==C?void 0:C.sites)||0===C.sites.length){A([]);return}let e=(0,v.IO)((0,v.hJ)(j.db,"sites"),(0,v.ar)((0,v.Jm)(),"in",C.sites)),s=(0,v.cf)(e,e=>{let s=[];e.forEach(e=>{s.push({id:e.id,name:e.data().name})}),A(s)},e=>{console.error("Sidebar: Failed to fetch sites with onSnapshot",e)});return()=>s()},[C]);let E=()=>!!C&&[...b.uc,...b.oU,...b.gf,"Admin"].includes(C.role),R=(0,n.useMemo)(()=>(null==C?void 0:C.sites)&&0!==F.length?F.filter(e=>C.sites.includes(e.id)):[],[null==C?void 0:C.sites,F]);(0,n.useEffect)(()=>{(N.includes("/rfa")||N.includes("/dashboard/rfa"))&&Z(!0)},[N]);let[P,L]=(0,n.useState)(!1),_=async()=>{try{L(!0),await D(),w.push("/")}catch(e){console.error("Logout error:",e)}finally{L(!1)}},T=e=>N===e||N.startsWith(e+"/");return C?(0,t.jsxs)(t.Fragment,{children:[r&&(0,t.jsx)("div",{className:"lg:hidden fixed inset-0 bg-black bg-opacity-50 z-30",onClick:y}),(0,t.jsxs)("div",{className:"\n        fixed inset-y-0 left-0 z-40\n        w-64 bg-gradient-to-b from-amber-50 to-orange-50\n        border-r border-orange-200\n        transform transition-transform duration-300 ease-in-out\n        ".concat(r?"translate-x-0":"-translate-x-full","\n        flex flex-col h-screen pt-16\n      "),children:[(0,t.jsxs)("div",{className:"bg-gradient-to-r from-orange-600 to-orange-700 text-white p-4 lg:p-6",children:[(0,t.jsx)("div",{className:"lg:hidden flex justify-end mb-2",children:(0,t.jsx)("button",{onClick:y,className:"p-1 rounded-md hover:bg-white hover:bg-opacity-20",children:(0,t.jsx)(d.Z,{size:20})})}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsxs)("h3",{className:"font-semibold text-lg truncate",children:["Welcome ",null===(s=C.email)||void 0===s?void 0:s.split("@")[0]]}),(0,t.jsxs)("p",{className:"text-orange-100 text-sm",children:["Role: ",C.role]}),R.length>0&&(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-orange-100 text-xs",children:"Site:"}),(0,t.jsx)("div",{className:"pl-2",children:R.map(e=>(0,t.jsxs)("p",{className:"text-orange-100 text-xs truncate",title:e.name,children:["- ",e.name]},e.id))})]})]})]}),(0,t.jsxs)("nav",{className:"flex-1 p-4 space-y-2 overflow-y-auto",children:[(0,t.jsxs)(i.default,{href:"/dashboard",onClick:z,className:"\n              flex items-center px-3 py-2 rounded-lg transition-colors\n              ".concat(T("/dashboard")&&"/dashboard"===N?"bg-blue-100 text-blue-700":"text-gray-700 hover:bg-gray-100","\n            "),children:[(0,t.jsx)(c.Z,{className:"w-5 h-5 mr-3"}),"Dashboard"]}),E()&&(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsxs)("button",{onClick:()=>{Z(!S)},className:"\n                  w-full flex items-center justify-between gap-3 px-3 py-2.5 rounded-lg text-sm font-medium\n                  transition-colors duration-200\n                  ".concat(N.startsWith("/dashboard/rfa")||N.startsWith("/rfa/")?"bg-orange-200 text-orange-900":"text-gray-700 hover:bg-orange-100 hover:text-orange-800","\n                "),children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)(x.Z,{size:18}),(0,t.jsx)("span",{children:"RFA Documents"})]}),S?(0,t.jsx)(h.Z,{size:16}):(0,t.jsx)(m.Z,{size:16})]}),S&&(0,t.jsxs)("div",{className:"ml-6 space-y-1 border-l-2 border-orange-200 pl-4",children:[(0,t.jsxs)(i.default,{href:"/dashboard/rfa?type=RFA-SHOP",onClick:z,className:"\n                      flex items-center gap-3 px-3 py-2 rounded-md text-sm\n                      transition-colors duration-200\n                      ".concat("/dashboard/rfa"===N&&"RFA-SHOP"===k.get("type")?"bg-blue-100 text-blue-900 font-medium":"text-gray-600 hover:bg-gray-100 hover:text-gray-800","\n                    "),children:[(0,t.jsx)("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),(0,t.jsx)("span",{children:"\uD83C\uDFD7️ Shop Drawing"})]}),(0,t.jsxs)(i.default,{href:"/dashboard/rfa?type=RFA-GEN",onClick:z,className:"\n                      flex items-center gap-3 px-3 py-2 rounded-md text-sm\n                      transition-colors duration-200\n                      ".concat("/dashboard/rfa"===N&&"RFA-GEN"===k.get("type")?"bg-green-100 text-green-900 font-medium":"text-gray-600 hover:bg-gray-100 hover:text-gray-800","\n                    "),children:[(0,t.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),(0,t.jsx)("span",{children:"\uD83D\uDCCB General"})]}),(0,t.jsxs)(i.default,{href:"/dashboard/rfa?type=RFA-MAT",onClick:z,className:"\n                      flex items-center gap-3 px-3 py-2 rounded-md text-sm\n                      transition-colors duration-200\n                      ".concat("/dashboard/rfa"===N&&"RFA-MAT"===k.get("type")?"bg-orange-100 text-orange-900 font-medium":"text-gray-600 hover:bg-gray-100 hover:text-gray-800","\n                    "),children:[(0,t.jsx)("div",{className:"w-2 h-2 bg-orange-500 rounded-full"}),(0,t.jsx)("span",{children:"\uD83E\uDDF1 Material"})]})]})]}),E()&&(0,t.jsxs)(i.default,{href:"/rfi",onClick:z,className:"\n                flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium\n                transition-colors duration-200\n                ".concat(T("/rfi")?"bg-orange-200 text-orange-900":"text-gray-700 hover:bg-orange-100 hover:text-orange-800","\n              "),children:[(0,t.jsx)(u.Z,{size:18}),(0,t.jsx)("span",{children:"RFI"})]}),(0,t.jsxs)(i.default,{href:"/dashboard/work-request",onClick:z,className:"\n              flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium\n              transition-colors duration-200\n              ".concat(T("/dashboard/work-request")?"bg-orange-200 text-orange-900":"text-gray-700 hover:bg-orange-100 hover:text-orange-800","\n            "),children:[(0,t.jsx)(g.Z,{size:18}),(0,t.jsx)("span",{children:"Work Request"})]})]}),C&&"Admin"===C.role&&(0,t.jsxs)("div",{className:"px-4 py-2",children:[(0,t.jsx)("div",{className:"border-t border-orange-200"}),(0,t.jsxs)("div",{className:"mt-2 space-y-1",children:[(0,t.jsx)("p",{className:"px-3 text-xs font-semibold uppercase text-gray-500 tracking-wider pt-2",children:"Admin"}),(0,t.jsxs)(i.default,{href:"/admin",onClick:z,className:"\n                  flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium\n                  transition-colors duration-200\n                  ".concat(T("/admin")?"bg-red-100 text-red-800":"text-gray-700 hover:bg-red-50 hover:text-red-700","\n                "),children:[(0,t.jsx)(f.Z,{size:18}),(0,t.jsx)("span",{children:"Invite Users"})]})]})]}),(0,t.jsx)("div",{className:"p-4 border-t border-orange-200",children:(0,t.jsxs)("button",{onClick:_,disabled:P,className:"\n              w-full flex items-center justify-center gap-2 \n              px-4 py-2.5 rounded-lg text-sm font-medium\n              ".concat(P?"bg-red-400 cursor-not-allowed":"bg-red-500 hover:bg-red-600"," \n              text-white transition-colors duration-200\n            "),children:[(0,t.jsx)(p.Z,{size:16}),(0,t.jsx)("span",{children:P?"กำลังออก...":"ออกจากระบบ"})]})})]})]}):null}var N=e=>(0,t.jsx)(n.Suspense,{fallback:(0,t.jsx)("div",{className:"w-64 bg-gray-100 h-screen"}),children:(0,t.jsx)(y,{...e})}),w=r(8293),k=r(4766),C=r(8420),D=e=>{let{children:s}=e,[r,i]=(0,n.useState)(!0),{user:l}=(0,a.aC)(),{isLoading:d}=(0,o.r)(),c=()=>{i(!r)};return(0,t.jsxs)("div",{className:"min-h-screen bg-gray-100",children:[(0,t.jsx)("header",{className:"fixed top-0 left-0 right-0 h-16 bg-white border-b border-gray-200 z-50",children:(0,t.jsxs)("div",{className:"flex items-center justify-between h-full px-4",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,t.jsx)("button",{onClick:c,className:"p-2 rounded-md text-gray-600 hover:bg-gray-100 hover:text-gray-900 transition-colors",children:(0,t.jsx)(w.Z,{size:20})}),(0,t.jsx)("h1",{className:"text-xl font-semibold text-gray-900",children:"\uD83C\uDFD7️ ttsdoc v2"})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,t.jsx)("button",{className:"p-2 rounded-md text-gray-600 hover:bg-gray-100 hover:text-gray-900 transition-colors",children:(0,t.jsx)(k.Z,{size:18})}),l&&(0,t.jsxs)("span",{className:"hidden sm:block text-sm text-gray-600",children:["\uD83D\uDC4B สวัสดี, ",l.email.split("@")[0]]}),(0,t.jsxs)("div",{className:"hidden md:flex items-center space-x-2 text-gray-600",children:[(0,t.jsx)(C.Z,{size:18}),(0,t.jsx)("span",{className:"text-sm font-medium",children:"T.T.S. Engineering"})]})]})]})}),(0,t.jsxs)("div",{className:"flex",children:[(0,t.jsx)(N,{isOpen:r,onToggle:c}),(0,t.jsxs)("main",{className:"\n              relative flex-1 transition-all duration-300 ease-in-out\n              ".concat(r?"lg:ml-64":"lg:ml-0","\n              overflow-x-hidden //  <-- เพิ่มบรรทัดนี้เข้าไป\n            "),children:[d&&(0,t.jsx)(o.Y,{}),(0,t.jsx)("div",{className:"h-full overflow-y-auto",children:(0,t.jsxs)("div",{className:"pt-16",children:[" ",(0,t.jsxs)("div",{className:"p-4 sm:p-6 lg:p-8",children:[" ",s]})]})})]})]})]})}},9761:function(e,s,r){var t=r(7437);r(2265),s.Z=e=>{let{className:s}=e;return(0,t.jsx)("div",{className:"\n    inline-block h-8 w-8 animate-spin rounded-full \n    border-4 border-solid border-current border-e-transparent \n    align-[-0.125em] text-gray-400 motion-reduce:animate-[spin_1.5s_linear_infinite]\n    ".concat(s||"","\n  ").trim(),role:"status",children:(0,t.jsx)("span",{className:"!absolute !-m-px !h-px !w-px !overflow-hidden !whitespace-nowrap !border-0 !p-0 ![clip:rect(0,0,0,0)]",children:"Loading..."})})}},2381:function(e,s,r){r.d(s,{LoadingProvider:function(){return d},Y:function(){return o},r:function(){return c}});var t=r(7437),n=r(2265),a=r(9761),i=r(9376);let l=(0,n.createContext)(void 0),o=()=>(0,t.jsx)("div",{className:"absolute inset-0 bg-gray-100 z-30 flex items-center justify-center",children:(0,t.jsx)(a.Z,{className:"w-12 h-12 text-gray-500"})}),d=e=>{let{children:s}=e,[r,a]=(0,n.useState)(!1),o=(0,i.usePathname)(),d=(0,i.useSearchParams)();return(0,n.useEffect)(()=>{a(!1)},[o,d]),(0,t.jsx)(l.Provider,{value:{isLoading:r,showLoader:()=>a(!0),hideLoader:()=>a(!1)},children:s})},c=()=>{let e=(0,n.useContext)(l);if(void 0===e)throw Error("useLoading must be used within a LoadingProvider");return e}}}]);