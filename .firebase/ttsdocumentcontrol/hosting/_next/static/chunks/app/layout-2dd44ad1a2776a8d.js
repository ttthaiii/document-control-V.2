(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{7866:function(e,t,r){Promise.resolve().then(r.t.bind(r,4811,23)),Promise.resolve().then(r.t.bind(r,2778,23)),Promise.resolve().then(r.bind(r,7649)),Promise.resolve().then(r.bind(r,2381)),Promise.resolve().then(r.bind(r,4001))},9205:function(e,t,r){"use strict";r.d(t,{Z:function(){return d}});var n=r(2265);let i=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),o=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase()),s=e=>{let t=o(e);return t.charAt(0).toUpperCase()+t.slice(1)},a=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim()},l=e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0};var c={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let u=(0,n.forwardRef)((e,t)=>{let{color:r="currentColor",size:i=24,strokeWidth:o=2,absoluteStrokeWidth:s,className:u="",children:d,iconNode:f,...h}=e;return(0,n.createElement)("svg",{ref:t,...c,width:i,height:i,stroke:r,strokeWidth:s?24*Number(o)/Number(i):o,className:a("lucide",u),...!d&&!l(h)&&{"aria-hidden":"true"},...h},[...f.map(e=>{let[t,r]=e;return(0,n.createElement)(t,r)}),...Array.isArray(d)?d:[d]])}),d=(e,t)=>{let r=(0,n.forwardRef)((r,o)=>{let{className:l,...c}=r;return(0,n.createElement)(u,{ref:o,iconNode:t,className:a("lucide-".concat(i(s(e))),"lucide-".concat(e),l),...c})});return r.displayName=s(e),r}},1671:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});let n=(0,r(9205).Z)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},9388:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});let n=(0,r(9205).Z)("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]])},6865:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});let n=(0,r(9205).Z)("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},9761:function(e,t,r){"use strict";var n=r(7437);r(2265),t.Z=e=>{let{className:t}=e;return(0,n.jsx)("div",{className:"\n    inline-block h-8 w-8 animate-spin rounded-full \n    border-4 border-solid border-current border-e-transparent \n    align-[-0.125em] text-gray-400 motion-reduce:animate-[spin_1.5s_linear_infinite]\n    ".concat(t||"","\n  ").trim(),role:"status",children:(0,n.jsx)("span",{className:"!absolute !-m-px !h-px !w-px !overflow-hidden !whitespace-nowrap !border-0 !p-0 ![clip:rect(0,0,0,0)]",children:"Loading..."})})}},7649:function(e,t,r){"use strict";r.d(t,{AuthProvider:function(){return d},a:function(){return f}});var n=r(7437),i=r(2265),o=r(2148),s=r(5978),a=r(7012),l=r(6855);let c=(0,i.createContext)({user:null,firebaseUser:null,loading:!0,error:null,logout:async()=>{},requestNotificationPermission:async()=>{}}),u=()=>/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);function d(e){let{children:t}=e,[r,d]=(0,i.useState)(null),[f,h]=(0,i.useState)(null),[p,m]=(0,i.useState)(!0),[v,w]=(0,i.useState)(null),g=async(e,t)=>{if(l.Fw){if(!u()&&"SAVE"===t){console.log("\uD83D\uDCBB Desktop detected: Notifications are disabled for desktop devices.");return}try{if("SAVE"===t){let t=await Notification.requestPermission();if("granted"===t){let t=await (0,a.LP)(l.Fw,{vapidKey:"BJ13x_HEhi6a7lCuv73CZw78pcmHWQoLdNNZag8EZPcJSD-VNyb2ENgAt_KGnf30p6AzVrE89HckdU4wn4wq9wA"});t&&(await (0,s.r7)((0,s.JU)(l.db,"users",e),{fcmTokens:[t],lastLogin:new Date}),console.log("\uD83D\uDCF1 Mobile Notification Token Updated"))}}else"REMOVE"===t&&await (0,a.pQ)(l.Fw)}catch(e){console.error("FCM Token Error:",e)}}};(0,i.useEffect)(()=>{"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw.js").then(e=>{console.log("✅ PWA Service Worker (sw.js) registered successfully:",e.scope)}).catch(e=>{console.error("❌ PWA Service Worker registration failed:",e)})},[]),(0,i.useEffect)(()=>{if(l.Fw&&u()){let e=(0,a.ps)(l.Fw,e=>{var t,r,n;console.log("\uD83D\uDCE9 Foreground Message Received:",e);let i=(null===(t=e.data)||void 0===t?void 0:t.title)||"การแจ้งเตือนใหม่",o=(null===(r=e.data)||void 0===r?void 0:r.body)||"",s=null===(n=e.data)||void 0===n?void 0:n.url;if("granted"===Notification.permission){let e=new Notification(i,{body:o,icon:"/favicon.ico"});e.onclick=()=>{s&&(window.location.href=s),e.close()}}});return()=>e()}},[]),(0,i.useEffect)(()=>{let e=null,t=(0,o.Aj)(l.I8,async t=>{if(m(!0),d(t),e&&(e(),e=null),t){let r=(0,s.JU)(l.db,"users",t.uid);e=(0,s.cf)(r,e=>{if(e.exists()){var r,n;let i=e.data();if("DISABLED"===i.status){(0,o.w7)(l.I8),h(null),w("บัญชีของคุณถูกระงับการใช้งาน");return}h({id:t.uid,email:t.email||"",role:i.role,sites:i.sites||[],status:i.status||"ACTIVE",createdFromInvitation:i.createdFromInvitation,createdAt:null===(r=i.createdAt)||void 0===r?void 0:r.toDate(),acceptedAt:null===(n=i.acceptedAt)||void 0===n?void 0:n.toDate()})}else h(null);m(!1)},e=>{console.error("Snapshot Error:",e),m(!1)}),g(t.uid,"SAVE")}else h(null),m(!1)});return()=>{t(),e&&e()}},[]);let b=async()=>{try{(null==f?void 0:f.id)&&await g(f.id,"REMOVE"),await (0,o.w7)(l.I8),h(null)}catch(e){throw console.error("Logout error:",e),e}},x=async()=>{if(!u()){alert("ระบบแจ้งเตือนรองรับเฉพาะการใช้งานบนโทรศัพท์มือถือเท่านั้น");return}(null==f?void 0:f.id)&&(await g(f.id,"SAVE"),alert("เปิดรับการแจ้งเตือนเรียบร้อยแล้ว"))};return(0,n.jsx)(c.Provider,{value:{user:f,firebaseUser:r,loading:p,error:v,logout:b,requestNotificationPermission:x},children:t})}function f(){return(0,i.useContext)(c)}},2381:function(e,t,r){"use strict";r.d(t,{LoadingProvider:function(){return c},Y:function(){return l},r:function(){return u}});var n=r(7437),i=r(2265),o=r(9761),s=r(9376);let a=(0,i.createContext)(void 0),l=()=>(0,n.jsx)("div",{className:"absolute inset-0 bg-gray-100 z-30 flex items-center justify-center",children:(0,n.jsx)(o.Z,{className:"w-12 h-12 text-gray-500"})}),c=e=>{let{children:t}=e,[r,o]=(0,i.useState)(!1),l=(0,s.usePathname)(),c=(0,s.useSearchParams)();return(0,i.useEffect)(()=>{o(!1)},[l,c]),(0,n.jsx)(a.Provider,{value:{isLoading:r,showLoader:()=>o(!0),hideLoader:()=>o(!1)},children:t})},u=()=>{let e=(0,i.useContext)(a);if(void 0===e)throw Error("useLoading must be used within a LoadingProvider");return e}},4001:function(e,t,r){"use strict";r.d(t,{NotificationProvider:function(){return f},l:function(){return h}});var n=r(7437),i=r(2265),o=r(1671),s=r(9388),a=r(6865);let l={success:(0,n.jsx)(o.Z,{className:"h-12 w-12 text-green-500"}),error:(0,n.jsx)(s.Z,{className:"h-12 w-12 text-red-500"}),warning:(0,n.jsx)(a.Z,{className:"h-12 w-12 text-yellow-500"})},c={success:"bg-green-600 hover:bg-green-700",error:"bg-red-600 hover:bg-red-700",warning:"bg-yellow-600 hover:bg-yellow-700"};var u=e=>{let{isOpen:t,type:r,title:i,message:o,onClose:s}=e;return t?(0,n.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-60 z-[100] flex items-center justify-center p-4",children:(0,n.jsxs)("div",{className:"relative bg-white rounded-lg shadow-xl w-full max-w-sm mx-auto p-6 text-center",children:[(0,n.jsx)("div",{className:"flex justify-center mb-4",children:l[r]}),(0,n.jsx)("h3",{className:"text-xl font-semibold text-gray-800 mb-2",children:i}),o&&(0,n.jsx)("p",{className:"text-gray-600 text-sm mb-6 whitespace-pre-wrap",children:o}),(0,n.jsx)("button",{onClick:s,className:"w-full px-4 py-2 text-white font-semibold rounded-lg transition-colors ".concat(c[r]),children:"ตกลง"})]})}):null};let d=(0,i.createContext)(void 0),f=e=>{let{children:t}=e,[r,o]=(0,i.useState)({isOpen:!1,type:"success",title:"",message:null}),s=(0,i.useCallback)(function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";o({isOpen:!0,type:e,title:t,message:r})},[]);return(0,n.jsxs)(d.Provider,{value:{showNotification:s},children:[t,(0,n.jsx)(u,{isOpen:r.isOpen,type:r.type,title:r.title,message:r.message,onClose:()=>{o(e=>({...e,isOpen:!1}))}})]})},h=()=>{let e=(0,i.useContext)(d);if(void 0===e)throw Error("useNotification must be used within a NotificationProvider");return e}},6855:function(e,t,r){"use strict";r.d(t,{Fw:function(){return u},I8:function(){return l},db:function(){return c}});var n=r(738),i=r(2148),o=r(5978),s=r(7012);let a=(0,n.C6)().length>0?(0,n.Mq)():(0,n.ZF)({apiKey:"AIzaSyAsayb-DEOBE0zi0qh-dPBfihClgXrX1sY",authDomain:"ttsdocumentcontrol.firebaseapp.com",projectId:"ttsdocumentcontrol",storageBucket:"ttsdocumentcontrol.firebasestorage.app",messagingSenderId:"48440915675",appId:"1:48440915675:web:f11611895bfb52d4d27efe"}),l=(0,i.v0)(a),c=(0,o.ad)(a),u=null;(0,s.Gb)().then(e=>{e&&(u=(0,s.KL)(a))});try{(0,o.ST)(c).then(()=>{console.log("✅ Firestore offline persistence enabled.")}).catch(e=>{"failed-precondition"==e.code?console.warn("Firestore persistence failed: Multiple tabs open."):"unimplemented"==e.code&&console.warn("Firestore persistence is not supported in this browser.")})}catch(e){console.error("An error occurred while enabling Firestore persistence:",e)}},2778:function(){},4811:function(e){e.exports={style:{fontFamily:"'__Inter_f367f3', '__Inter_Fallback_f367f3'",fontStyle:"normal"},className:"__className_f367f3"}}},function(e){e.O(0,[2,609,15,134,971,997,744],function(){return e(e.s=7866)}),_N_E=e.O()}]);