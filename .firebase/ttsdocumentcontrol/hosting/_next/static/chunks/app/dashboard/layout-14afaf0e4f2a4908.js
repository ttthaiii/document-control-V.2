(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[663],{49:function(e,t,n){Promise.resolve().then(n.bind(n,7123))},7123:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return i}});var E=n(7437),r=n(2265),u=n(1313);function i(e){let{children:t}=e;return(0,E.jsx)(r.Suspense,{fallback:(0,E.jsx)("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center",children:(0,E.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}),children:(0,E.jsx)(u.Z,{children:t})})}},7649:function(e,t,n){"use strict";n.d(t,{AuthProvider:function(){return c},aC:function(){return a}});var E=n(7437),r=n(2265),u=n(2148),i=n(5978),o=n(6855);let l=null,s=(0,r.createContext)({user:null,firebaseUser:null,loading:!0,error:null,refetch:async()=>{},logout:async()=>{}});function c(e){let{children:t}=e,[n,c]=(0,r.useState)(null),[a,I]=(0,r.useState)(null),[P,D]=(0,r.useState)(!0),[N,R]=(0,r.useState)(null),_=async e=>{try{if(R(null),l&&l.firebaseUserId===e.uid&&Date.now()-l.timestamp<3e5){console.log("\uD83D\uDCCB Using cached user data for: ".concat(e.email)),I(l.user);return}console.log("\uD83D\uDD04 Fetching fresh user data for: ".concat(e.email));let E=(0,i.JU)(o.db,"users",e.uid),r=await (0,i.QT)(E);if(r.exists()){var t,n;let E=r.data(),u={id:e.uid,email:e.email||"",role:E.role,sites:E.sites||[],status:E.status||"ACTIVE",createdFromInvitation:E.createdFromInvitation,createdAt:null===(t=E.createdAt)||void 0===t?void 0:t.toDate(),acceptedAt:null===(n=E.acceptedAt)||void 0===n?void 0:n.toDate()};l={user:u,timestamp:Date.now(),firebaseUserId:e.uid},I(u)}else R("ไม่พบข้อมูลผู้ใช้ในระบบ"),I(null)}catch(e){console.error("Error fetching user data:",e),R("เกิดข้อผิดพลาดในการโหลดข้อมูลผู้ใช้"),I(null)}},d=async()=>{n&&(l=null,await _(n))};(0,r.useEffect)(()=>{let e=(0,u.Aj)(o.I,async e=>{(null==e?void 0:e.uid)===(null==n?void 0:n.uid)&&a||(D(!0),c(e),e?await _(e):(I(null),R(null),l=null),D(!1))});return()=>e()},[]);let A=async()=>{try{await (0,u.w7)(o.I),l=null,I(null),c(null),R(null)}catch(e){throw console.error("Logout error:",e),e}};return(0,E.jsx)(s.Provider,{value:{user:a,firebaseUser:n,loading:P,error:N,refetch:d,logout:A},children:t})}function a(){return(0,r.useContext)(s)}},453:function(e,t,n){"use strict";n.d(t,{$p:function(){return l},Ge:function(){return c},K$:function(){return E},NK:function(){return a},c9:function(){return o},gf:function(){return i},n$:function(){return s},oU:function(){return u},uc:function(){return r},yh:function(){return I}});let E={ADMIN:"Admin",BIM:"BIM",SITE_ADMIN:"Site Admin",CM:"CM",ME:"ME",SN:"SN",OE:"OE",PE:"PE",PM:"PM",PD:"PD",SE:"SE",ADMIN_SITE_2:"Adminsite2"},r=[E.BIM,E.ME,E.SN],u=[E.SITE_ADMIN,E.ADMIN_SITE_2,E.OE,E.PE],i=[E.CM,E.PD];E.PM,E.SE;let o=[E.PE,E.OE,E.ADMIN],l=[E.PD,E.PM,E.ADMIN],s={PENDING_REVIEW:"PENDING_REVIEW",PENDING_CM_APPROVAL:"PENDING_CM_APPROVAL",REVISION_REQUIRED:"REVISION_REQUIRED",APPROVED:"APPROVED",APPROVED_WITH_COMMENTS:"APPROVED_WITH_COMMENTS",APPROVED_REVISION_REQUIRED:"APPROVED_REVISION_REQUIRED",REJECTED:"REJECTED",PENDING_FINAL_APPROVAL:"PENDING_FINAL_APPROVAL"},c={DRAFT:"DRAFT",REJECTED_BY_PM:"REJECTED_BY_PM",PENDING_BIM:"PENDING_BIM",IN_PROGRESS:"IN_PROGRESS",PENDING_ACCEPTANCE:"PENDING_ACCEPTANCE",REVISION_REQUESTED:"REVISION_REQUESTED",COMPLETED:"COMPLETED"},a={[s.PENDING_REVIEW]:"รอตรวจสอบ",[s.PENDING_CM_APPROVAL]:"ส่ง CM",[s.REVISION_REQUIRED]:"แก้ไข",[s.APPROVED]:"อนุมัติ",[s.APPROVED_WITH_COMMENTS]:"อนุมัติตามคอมเมนต์ (ไม่แก้ไข)",[s.APPROVED_REVISION_REQUIRED]:"อนุมัติตามคอมเมนต์ (ต้องแก้ไข)",[s.REJECTED]:"ไม่อนุมัติ",[s.PENDING_FINAL_APPROVAL]:"รอ SITE อนุมัติขั้นสุดท้าย",[c.DRAFT]:"รออนุมัติ (PM)",[c.REJECTED_BY_PM]:"ไม่อนุมัติ (PM)",[c.PENDING_BIM]:"รอ BIM รับงาน",[c.IN_PROGRESS]:"BIM กำลังดำเนินการ",[c.PENDING_ACCEPTANCE]:"รอตรวจรับ (Site)",[c.REVISION_REQUESTED]:"ขอแก้ไข (WR)",[c.COMPLETED]:"เสร็จสิ้น"},I={[s.PENDING_REVIEW]:"#0088FE",[s.PENDING_CM_APPROVAL]:"#00C49F",[s.REVISION_REQUIRED]:"#FFBB28",[s.APPROVED]:"#28A745",[s.REJECTED]:"#DC3545",[s.APPROVED_WITH_COMMENTS]:"#2f3e3aff",[s.APPROVED_REVISION_REQUIRED]:"#FD7E14",[c.DRAFT]:"#6c757d",[c.REJECTED_BY_PM]:"#DC3545",[c.PENDING_BIM]:"#0088FE",[c.IN_PROGRESS]:"#FFBB28",[c.PENDING_ACCEPTANCE]:"#AF19FF",[c.REVISION_REQUESTED]:"#FD7E14",[c.COMPLETED]:"#28A745"}},6855:function(e,t,n){"use strict";n.d(t,{I:function(){return o},db:function(){return l}});var E=n(738),r=n(2148),u=n(5978);let i=(0,E.C6)().length>0?(0,E.C6)()[0]:(0,E.ZF)({apiKey:"AIzaSyAsayb-DEOBE0zi0qh-dPBfihClgXrX1sY",authDomain:"ttsdocumentcontrol.firebaseapp.com",projectId:"ttsdocumentcontrol",storageBucket:"ttsdocumentcontrol.firebasestorage.app",messagingSenderId:"48440915675",appId:"1:48440915675:web:f11611895bfb52d4d27efe"}),o=(0,r.v0)(i),l=(0,u.ad)(i);try{(0,u.ST)(l).then(()=>{console.log("✅ Firestore offline persistence enabled.")}).catch(e=>{"failed-precondition"==e.code?console.warn("Firestore persistence failed: Multiple tabs open. Persistence will be enabled in one tab only."):"unimplemented"==e.code&&console.warn("Firestore persistence is not supported in this browser.")})}catch(e){console.error("An error occurred while enabling Firestore persistence:",e)}}},function(e){e.O(0,[609,15,783,227,313,971,117,744],function(){return e(e.s=49)}),_N_E=e.O()}]);