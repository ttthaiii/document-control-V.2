(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3],{3638:function(e,s,t){Promise.resolve().then(t.bind(t,8031)),Promise.resolve().then(t.bind(t,731))},8031:function(e,s,t){"use strict";t.d(s,{InviteUserForm:function(){return c}});var r=t(7437),a=t(2265),i=t(9501),n=t(7649),l=t(453);function c(){let{firebaseUser:e}=(0,n.aC)(),[s,t]=(0,a.useState)(!1),[c,d]=(0,a.useState)(null),[o,m]=(0,a.useState)([]),[u,x]=(0,a.useState)(!0),{register:h,handleSubmit:b,reset:p,formState:{errors:g}}=(0,i.cI)({defaultValues:{sites:[]}});(0,a.useEffect)(()=>{(async()=>{if(e)try{let s=await e.getIdToken(),t=await fetch("/api/sites",{headers:{Authorization:"Bearer ".concat(s)}}),r=await t.json();r.success&&m(r.sites)}catch(e){console.error("Failed to fetch sites",e)}finally{x(!1)}})()},[e]);let j=async e=>{t(!0),d(null);try{let s=await fetch("/api/admin/invite",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),t=await s.json();t.success?(d({success:!0,invitationUrl:t.invitationUrl}),p()):d({success:!1,error:t.error||"Failed to create invitation"})}catch(e){d({success:!1,error:"Network error occurred"})}finally{t(!1)}};return(0,r.jsxs)("div",{className:"max-w-md mx-auto bg-white p-6 rounded-lg shadow-lg",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold mb-6 text-center text-gray-800",children:"เชิญผู้ใช้ใหม่"}),(0,r.jsxs)("form",{onSubmit:b(j),className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"อีเมล"}),(0,r.jsx)("input",{type:"email",...h("email",{required:"กรุณาใส่อีเมล"}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"user@company.com"}),g.email&&(0,r.jsx)("p",{className:"text-red-500 text-sm mt-1",children:g.email.message})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ตำแหน่งงาน"}),(0,r.jsxs)("select",{...h("role",{required:"กรุณาเลือกตำแหน่งงาน"}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,r.jsx)("option",{value:"",children:"-- เลือกตำแหน่งงาน --"}),(0,r.jsx)("option",{value:l.K$.BIM,children:"BIM"}),(0,r.jsx)("option",{value:l.K$.SITE_ADMIN,children:"Site Admin"}),(0,r.jsx)("option",{value:l.K$.OE,children:"OE (Owner Engineer)"}),(0,r.jsx)("option",{value:l.K$.PE,children:"PE (Project Engineer)"}),(0,r.jsx)("option",{value:l.K$.CM,children:"CM"}),(0,r.jsx)("option",{value:l.K$.ME,children:"ME (Mechanical/Electrical Engineer)"}),(0,r.jsx)("option",{value:l.K$.SN,children:"SN (Sanitary Engineer)"})]}),g.role&&(0,r.jsx)("p",{className:"text-red-500 text-sm mt-1",children:g.role.message})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"โครงการที่ให้เข้าถึง"}),u?(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Loading sites..."}):(0,r.jsx)("div",{className:"mt-2 p-3 border border-gray-200 rounded-md space-y-2 max-h-40 overflow-y-auto",children:o.map(e=>(0,r.jsxs)("label",{className:"flex items-center",children:[(0,r.jsx)("input",{type:"checkbox",...h("sites",{required:"กรุณาเลือกอย่างน้อย 1 โครงการ"}),value:e.id,className:"h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),(0,r.jsx)("span",{className:"ml-2 text-sm text-gray-700",children:e.name})]},e.id))}),g.sites&&(0,r.jsx)("p",{className:"text-red-500 text-sm mt-1",children:g.sites.message})]}),(0,r.jsx)("button",{type:"submit",disabled:s||u,className:"w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 disabled:bg-blue-300 disabled:cursor-not-allowed transition-colors",children:s?"กำลังสร้างคำเชิญ...":"สร้างคำเชิญ"})]}),c&&(0,r.jsx)("div",{className:"mt-6",children:c.success?(0,r.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-md p-4",children:[(0,r.jsx)("h3",{className:"text-green-800 font-medium mb-2",children:"✅ สร้างคำเชิญสำเร็จ!"}),(0,r.jsx)("p",{className:"text-green-700 text-sm mb-3",children:"ส่ง link นี้ให้ผู้ใช้:"}),(0,r.jsx)("div",{className:"bg-white border rounded p-2",children:(0,r.jsx)("code",{className:"text-xs break-all text-gray-800",children:c.invitationUrl})}),(0,r.jsx)("button",{onClick:()=>navigator.clipboard.writeText(c.invitationUrl),className:"mt-2 text-xs bg-green-600 text-white px-3 py-1 rounded hover:bg-green-700",children:"\uD83D\uDCCB Copy Link"})]}):(0,r.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:[(0,r.jsx)("h3",{className:"text-red-800 font-medium mb-1",children:"❌ เกิดข้อผิดพลาด"}),(0,r.jsx)("p",{className:"text-red-700 text-sm",children:c.error})]})})]})}}},function(e){e.O(0,[609,15,783,501,731,971,117,744],function(){return e(e.s=3638)}),_N_E=e.O()}]);