(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3],{3638:function(e,s,t){Promise.resolve().then(t.bind(t,9602)),Promise.resolve().then(t.bind(t,731))},9205:function(e,s,t){"use strict";t.d(s,{Z:function(){return m}});var r=t(2265);let l=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),a=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,s,t)=>t?t.toUpperCase():s.toLowerCase()),n=e=>{let s=a(e);return s.charAt(0).toUpperCase()+s.slice(1)},i=function(){for(var e=arguments.length,s=Array(e),t=0;t<e;t++)s[t]=arguments[t];return s.filter((e,s,t)=>!!e&&""!==e.trim()&&t.indexOf(e)===s).join(" ").trim()},d=e=>{for(let s in e)if(s.startsWith("aria-")||"role"===s||"title"===s)return!0};var c={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let o=(0,r.forwardRef)((e,s)=>{let{color:t="currentColor",size:l=24,strokeWidth:a=2,absoluteStrokeWidth:n,className:o="",children:m,iconNode:x,...h}=e;return(0,r.createElement)("svg",{ref:s,...c,width:l,height:l,stroke:t,strokeWidth:n?24*Number(a)/Number(l):a,className:i("lucide",o),...!m&&!d(h)&&{"aria-hidden":"true"},...h},[...x.map(e=>{let[s,t]=e;return(0,r.createElement)(s,t)}),...Array.isArray(m)?m:[m]])}),m=(e,s)=>{let t=(0,r.forwardRef)((t,a)=>{let{className:d,...c}=t;return(0,r.createElement)(o,{ref:a,iconNode:s,className:i("lucide-".concat(l(n(e))),"lucide-".concat(e),d),...c})});return t.displayName=n(e),t}},1671:function(e,s,t){"use strict";t.d(s,{Z:function(){return r}});let r=(0,t(9205).Z)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},9388:function(e,s,t){"use strict";t.d(s,{Z:function(){return r}});let r=(0,t(9205).Z)("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]])},2735:function(e,s,t){"use strict";t.d(s,{Z:function(){return r}});let r=(0,t(9205).Z)("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]])},8736:function(e,s,t){"use strict";t.d(s,{Z:function(){return r}});let r=(0,t(9205).Z)("file-text",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]])},7689:function(e,s,t){"use strict";t.d(s,{Z:function(){return r}});let r=(0,t(9205).Z)("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]])},5805:function(e,s,t){"use strict";t.d(s,{Z:function(){return r}});let r=(0,t(9205).Z)("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]])},9602:function(e,s,t){"use strict";t.d(s,{InviteUserForm:function(){return b}});var r=t(7437),l=t(2265),a=t(9501),n=t(7649),i=t(453),d=t(9205);let c=(0,d.Z)("user-plus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);var o=t(5805),m=t(1671);let x=(0,d.Z)("copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);var h=t(8736),u=t(2735),N=t(7689),p=t(9388);function b(){let{firebaseUser:e}=(0,n.a)(),[s,t]=(0,l.useState)("single"),[d,b]=(0,l.useState)(!1),[g,E]=(0,l.useState)(null),[j,y]=(0,l.useState)(null),[f,v]=(0,l.useState)(null),[I,P]=(0,l.useState)([]),[w,R]=(0,l.useState)(null),[D,M]=(0,l.useState)([]),[_,A]=(0,l.useState)(!0),[S,C]=(0,l.useState)([]),{register:k,handleSubmit:O,reset:T,formState:{errors:V}}=(0,a.cI)();(0,l.useEffect)(()=>{(async()=>{if(e)try{let s=await e.getIdToken(),t=await fetch("/api/sites",{headers:{Authorization:"Bearer ".concat(s)}}),r=await t.json();r.success&&M(r.sites)}catch(e){console.error("Failed to fetch sites",e)}finally{A(!1)}})()},[e]);let F=e=>{try{let s=e.split("\n").map(e=>e.trim()).filter(e=>e);if(s.length<2)throw Error("ไฟล์ CSV ว่างเปล่าหรือรูปแบบไม่ถูกต้อง");let t=s[0].replace(/^\uFEFF/,"").split(",").map(e=>e.trim().toLowerCase().replace(/[\r\n"]/g,""));if(!t.includes("email")||!t.includes("role"))throw Error("CSV ต้องมีคอลัมน์ Email และ Role เป็นอย่างน้อย");let r=[];for(let e=1;e<s.length;e++){let l=s[e].split(",").map(e=>e.trim().replace(/^"|"$/g,""));if(l.length<t.length)continue;let a={};t.forEach((e,s)=>{a[e]=l[s]});let n={email:a.email,name:a.name||a.fullname||"",role:a.role||a.position||"",employeeId:a.employeeid||a.id||a.empid||a.employee_id||""};n.email&&r.push(n)}if(0===r.length)throw Error("ไม่พบข้อมูลที่ถูกต้องในไฟล์");P(r)}catch(e){console.error("CSV Parse Error:",e),R(e.message),P([])}},B=async s=>{b(!0),E(null);try{let t=await (null==e?void 0:e.getIdToken()),r=await fetch("/api/admin/invite",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify(s)}),l=await r.json();l.success?(E({success:!0,invitationUrl:l.invitationUrl,warning:l.warning}),T()):E({success:!1,error:l.error})}catch(e){E({success:!1,error:"Network error"})}finally{b(!1)}},G=async()=>{if(0!==I.length&&0!==S.length){b(!0),y(null),R(null);try{let s=await (null==e?void 0:e.getIdToken());console.log("Sending Batch Data:",{users:I,sites:S});let t=await fetch("/api/admin/invite/batch",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(s)},body:JSON.stringify({users:I,sites:S})}),r=await t.json();if(r.success){y(r.summary),P([]),v(null);let e=document.getElementById("csv-upload");e&&(e.value="")}else R(r.error||"เกิดข้อผิดพลาดในการส่งข้อมูล")}catch(e){R("Network error while sending batch request")}finally{b(!1)}}},Z=(e,s)=>{C(t=>s?[...t,e]:t.filter(s=>s!==e))};return(0,r.jsxs)("div",{className:"max-w-2xl mx-auto bg-white p-6 rounded-lg shadow-lg border border-gray-100",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-gray-800",children:"เชิญผู้ใช้ใหม่"}),(0,r.jsxs)("div",{className:"flex bg-gray-100 p-1 rounded-lg",children:[(0,r.jsxs)("button",{onClick:()=>t("single"),className:"px-4 py-2 rounded-md text-sm font-medium transition-colors flex items-center ".concat("single"===s?"bg-white text-blue-600 shadow-sm":"text-gray-500 hover:text-gray-700"),children:[(0,r.jsx)(c,{size:16,className:"mr-2"})," ทีละคน"]}),(0,r.jsxs)("button",{onClick:()=>t("batch"),className:"px-4 py-2 rounded-md text-sm font-medium transition-colors flex items-center ".concat("batch"===s?"bg-white text-blue-600 shadow-sm":"text-gray-500 hover:text-gray-700"),children:[(0,r.jsx)(o.Z,{size:16,className:"mr-2"})," Import CSV"]})]})]}),"single"===s&&(0,r.jsxs)("form",{onSubmit:O(B),className:"space-y-4",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["รหัสพนักงาน ",(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,r.jsx)("input",{type:"text",...k("employeeId",{required:"จำเป็น"}),className:"w-full px-3 py-2 border rounded-md",placeholder:"EMP-001"}),V.employeeId&&(0,r.jsx)("span",{className:"text-xs text-red-500",children:"กรุณากรอกข้อมูล"})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["ชื่อ-นามสกุล ",(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,r.jsx)("input",{type:"text",...k("name",{required:"จำเป็น"}),className:"w-full px-3 py-2 border rounded-md",placeholder:"สมชาย ใจดี"}),V.name&&(0,r.jsx)("span",{className:"text-xs text-red-500",children:"กรุณากรอกข้อมูล"})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["อีเมล ",(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,r.jsx)("input",{type:"email",...k("email",{required:"จำเป็น"}),className:"w-full px-3 py-2 border rounded-md",placeholder:"user@example.com"}),V.email&&(0,r.jsx)("span",{className:"text-xs text-red-500",children:"กรุณากรอกข้อมูล"})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["ตำแหน่ง ",(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,r.jsxs)("select",{...k("role",{required:"จำเป็น"}),className:"w-full p-2 border rounded-md",children:[(0,r.jsx)("option",{value:"",children:"-- เลือก --"}),Object.values(i.K$).map(e=>(0,r.jsx)("option",{value:e,children:e},e))]}),V.role&&(0,r.jsx)("span",{className:"text-xs text-red-500",children:"กรุณาเลือก"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["โครงการ ",(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),_?(0,r.jsx)("p",{className:"text-xs text-gray-500",children:"Loading..."}):(0,r.jsx)("div",{className:"mt-1 p-3 border rounded-md max-h-32 overflow-y-auto grid grid-cols-1 sm:grid-cols-2 gap-2",children:D.map(e=>(0,r.jsxs)("label",{className:"flex items-center text-sm",children:[(0,r.jsx)("input",{type:"checkbox",...k("sites",{required:!0}),value:e.id,className:"mr-2 text-blue-600 rounded"}),e.name]},e.id))}),V.sites&&(0,r.jsx)("span",{className:"text-xs text-red-500",children:"เลือกอย่างน้อย 1 โครงการ"})]}),(0,r.jsx)("button",{type:"submit",disabled:d,className:"w-full bg-blue-600 text-white py-2 rounded-md hover:bg-blue-700 disabled:bg-blue-300",children:d?"กำลังส่ง...":"ส่งคำเชิญ"}),g&&(0,r.jsx)("div",{className:"mt-4 p-4 rounded border ".concat(g.success?"bg-green-50 border-green-200":"bg-red-50 border-red-200"),children:g.success?(0,r.jsxs)("div",{className:"flex items-start",children:[(0,r.jsx)(m.Z,{className:"w-5 h-5 text-green-600 mr-2 mt-0.5"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"font-semibold text-green-800",children:"สำเร็จ!"}),(0,r.jsx)("p",{className:"text-sm text-green-700",children:g.warning||"ส่งอีเมลเรียบร้อยแล้ว"}),(0,r.jsxs)("div",{className:"mt-2 flex gap-2",children:[(0,r.jsx)("input",{readOnly:!0,value:g.invitationUrl,className:"text-xs border rounded px-2 py-1 w-full"}),(0,r.jsx)("button",{onClick:()=>navigator.clipboard.writeText(g.invitationUrl),className:"p-1 bg-gray-200 rounded",children:(0,r.jsx)(x,{size:14})})]})]})]}):(0,r.jsxs)("p",{className:"text-red-700 text-sm",children:["Error: ",g.error]})})]}),"batch"===s&&(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-100",children:[(0,r.jsxs)("h3",{className:"text-sm font-semibold text-blue-800 mb-2 flex items-center",children:[(0,r.jsx)(h.Z,{size:16,className:"mr-2"})," คำแนะนำการเตรียมไฟล์"]}),(0,r.jsxs)("p",{className:"text-xs text-blue-600 mb-3",children:["ไฟล์ CSV ต้องมีหัวตาราง: ",(0,r.jsx)("code",{className:"bg-blue-100 px-1 rounded",children:"Email, Name, EmployeeId, Role"})]}),(0,r.jsxs)("button",{onClick:()=>{let e=new Blob(["\uFEFFEmail,Name,EmployeeId,Role\nuser1@example.com,Somchai Jaidee,EMP001,BIM\nuser2@example.com,Somsri Rakngan,EMP002,Site Admin"],{type:"text/csv;charset=utf-8;"}),s=URL.createObjectURL(e),t=document.createElement("a");t.href=s,t.setAttribute("download","ttsdoc_invite_template.csv"),document.body.appendChild(t),t.click(),document.body.removeChild(t)},className:"text-xs flex items-center text-blue-700 hover:underline",children:[(0,r.jsx)(u.Z,{size:14,className:"mr-1"})," ดาวน์โหลดไฟล์ตัวอย่าง (Template)"]})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["1. เลือกโครงการ (จะถูกเพิ่มให้ทุกคนในไฟล์) ",(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,r.jsx)("div",{className:"p-3 border rounded-md max-h-32 overflow-y-auto grid grid-cols-1 sm:grid-cols-2 gap-2 bg-gray-50",children:D.map(e=>(0,r.jsxs)("label",{className:"flex items-center text-sm",children:[(0,r.jsx)("input",{type:"checkbox",checked:S.includes(e.id),onChange:s=>Z(e.id,s.target.checked),className:"mr-2 text-blue-600 rounded"}),e.name]},e.id))}),0===S.length&&(0,r.jsx)("p",{className:"text-xs text-red-500 mt-1",children:"* กรุณาเลือกอย่างน้อย 1 โครงการ"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"2. อัปโหลดไฟล์ CSV"}),(0,r.jsxs)("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-blue-500 transition-colors",children:[(0,r.jsx)("input",{type:"file",accept:".csv",onChange:e=>{var s;let t=null===(s=e.target.files)||void 0===s?void 0:s[0];if(!t)return;v(t),R(null),y(null);let r=new FileReader;r.onload=e=>{var s;F(null===(s=e.target)||void 0===s?void 0:s.result)},r.readAsText(t)},className:"hidden",id:"csv-upload"}),(0,r.jsxs)("label",{htmlFor:"csv-upload",className:"cursor-pointer flex flex-col items-center",children:[(0,r.jsx)(N.Z,{size:32,className:"text-gray-400 mb-2"}),(0,r.jsx)("span",{className:"text-sm text-gray-600 font-medium",children:"คลิกเพื่อเลือกไฟล์ CSV"}),(0,r.jsx)("span",{className:"text-xs text-gray-400 mt-1",children:"หรือลากไฟล์มาวางที่นี่"})]})]}),f&&(0,r.jsxs)("div",{className:"mt-2 flex items-center justify-between bg-gray-50 p-2 rounded text-sm",children:[(0,r.jsx)("span",{className:"truncate font-medium",children:f.name}),(0,r.jsxs)("span",{className:"text-green-600 text-xs bg-green-100 px-2 py-0.5 rounded-full",children:["พบ ",I.length," รายการ"]})]}),w&&(0,r.jsx)("p",{className:"text-xs text-red-500 mt-2",children:w})]}),I.length>0&&(0,r.jsxs)("div",{className:"border rounded-lg overflow-hidden",children:[(0,r.jsx)("div",{className:"bg-gray-50 px-3 py-2 text-xs font-semibold border-b",children:"ตัวอย่างข้อมูล (5 รายการแรก)"}),(0,r.jsxs)("table",{className:"min-w-full text-xs text-left",children:[(0,r.jsx)("thead",{className:"bg-white border-b",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"px-3 py-2",children:"Email"}),(0,r.jsx)("th",{className:"px-3 py-2",children:"Name"}),(0,r.jsx)("th",{className:"px-3 py-2",children:"ID"}),(0,r.jsx)("th",{className:"px-3 py-2",children:"Role"})]})}),(0,r.jsx)("tbody",{children:I.slice(0,5).map((e,s)=>(0,r.jsxs)("tr",{className:"border-b last:border-0",children:[(0,r.jsx)("td",{className:"px-3 py-2 truncate max-w-[120px]",children:e.email}),(0,r.jsx)("td",{className:"px-3 py-2 truncate max-w-[100px]",children:e.name}),(0,r.jsx)("td",{className:"px-3 py-2",children:e.employeeId}),(0,r.jsx)("td",{className:"px-3 py-2",children:e.role})]},s))})]}),I.length>5&&(0,r.jsxs)("div",{className:"px-3 py-1 text-xs text-gray-500 bg-gray-50 text-center",children:["...และอีก ",I.length-5," รายการ"]})]}),(0,r.jsx)("button",{onClick:G,disabled:d||0===I.length||0===S.length,className:"w-full bg-blue-600 text-white py-2 rounded-md hover:bg-blue-700 disabled:bg-blue-300 disabled:cursor-not-allowed transition-colors",children:d?"กำลังประมวลผล...":"นำเข้าและส่งคำเชิญ ".concat(I.length," รายการ")}),j&&(0,r.jsxs)("div",{className:"mt-4 p-4 bg-gray-50 border rounded-lg",children:[(0,r.jsx)("h4",{className:"font-semibold text-gray-800 mb-2",children:"สรุปผลการนำเข้า"}),(0,r.jsxs)("div",{className:"flex gap-4 text-sm mb-3",children:[(0,r.jsxs)("span",{className:"text-green-600 flex items-center",children:[(0,r.jsx)(m.Z,{size:16,className:"mr-1"})," สำเร็จ: ",j.success]}),(0,r.jsxs)("span",{className:"text-red-600 flex items-center",children:[(0,r.jsx)(p.Z,{size:16,className:"mr-1"})," ล้มเหลว: ",j.failed]})]}),j.details.filter(e=>"error"===e.status).length>0&&(0,r.jsxs)("div",{className:"max-h-32 overflow-y-auto border-t pt-2",children:[(0,r.jsx)("p",{className:"text-xs font-medium text-red-500 mb-1",children:"รายการที่ผิดพลาด:"}),(0,r.jsx)("ul",{className:"space-y-1",children:j.details.filter(e=>"error"===e.status).map((e,s)=>(0,r.jsxs)("li",{className:"text-xs text-gray-600 flex justify-between",children:[(0,r.jsx)("span",{children:e.email}),(0,r.jsx)("span",{className:"text-red-500",children:e.reason})]},s))})]})]})]})]})}},731:function(e,s,t){"use strict";t.d(s,{AuthGuard:function(){return d}});var r=t(7437),l=t(7649),a=t(9376),n=t(2265);t(453);let i=()=>(0,r.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,r.jsxs)("div",{className:"animate-pulse",children:[(0,r.jsx)("div",{className:"bg-white shadow",children:(0,r.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,r.jsxs)("div",{className:"flex justify-between items-center py-6",children:[(0,r.jsx)("div",{className:"h-8 bg-gray-200 rounded w-32"}),(0,r.jsx)("div",{className:"h-8 bg-gray-200 rounded w-24"})]})})}),(0,r.jsxs)("div",{className:"flex",children:[(0,r.jsx)("div",{className:"w-64 bg-white border-r border-gray-200 min-h-screen",children:(0,r.jsx)("div",{className:"p-4 space-y-3",children:[...Array(6)].map((e,s)=>(0,r.jsx)("div",{className:"h-10 bg-gray-100 rounded"},s))})}),(0,r.jsx)("div",{className:"flex-1 p-8",children:(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)("div",{className:"h-8 bg-gray-200 rounded w-1/3"}),(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[void 0,void 0,void 0].map((e,s)=>(0,r.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow",children:[(0,r.jsx)("div",{className:"h-4 bg-gray-200 rounded mb-2"}),(0,r.jsx)("div",{className:"h-8 bg-gray-200 rounded mb-4"}),(0,r.jsx)("div",{className:"h-4 bg-gray-200 rounded w-2/3"})]},s))})]})})]})]})});function d(e){let{children:s,requiredRoles:t=[],requiredSiteAccess:d=[],fallback:c,redirectTo:o="/login"}=e,{user:m,loading:x,error:h}=(0,l.a)(),u=(0,a.useRouter)();return((0,n.useEffect)(()=>{x||m||u.push(o)},[m,x,u,o]),x)?(0,r.jsx)(i,{}):h?(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,r.jsx)("div",{className:"text-center max-w-md mx-auto",children:(0,r.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold text-red-800 mb-2",children:"เกิดข้อผิดพลาด"}),(0,r.jsx)("p",{className:"text-red-600 mb-4",children:h}),(0,r.jsx)("button",{onClick:()=>window.location.reload(),className:"bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 transition-colors",children:"ลองใหม่"})]})})}):m?t.length>0&&!t.includes(m.role)?(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,r.jsx)("div",{className:"text-center max-w-md mx-auto",children:(0,r.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-6",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold text-yellow-800 mb-2",children:"ไม่มีสิทธิ์เข้าถึง"}),(0,r.jsx)("p",{className:"text-yellow-700 mb-2",children:"คุณไม่มีสิทธิ์เข้าถึงหน้านี้"}),(0,r.jsxs)("p",{className:"text-sm text-yellow-600 mb-4",children:["ต้องการสิทธิ์: ",t.join(", ")," | สิทธิ์ปัจจุบัน: ",m.role]}),(0,r.jsx)("button",{onClick:()=>u.back(),className:"bg-yellow-600 text-white px-4 py-2 rounded hover:bg-yellow-700 transition-colors",children:"ย้อนกลับ"})]})})}):d.length>0&&"Admin"!==m.role&&!d.some(e=>{var s;return null===(s=m.sites)||void 0===s?void 0:s.includes(e)})?(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,r.jsx)("div",{className:"text-center max-w-md mx-auto",children:(0,r.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold text-red-800 mb-2",children:"ไม่มีสิทธิ์เข้าถึงโครงการ"}),(0,r.jsx)("p",{className:"text-red-600 mb-4",children:"คุณไม่มีสิทธิ์เข้าถึงโครงการที่ต้องการ"}),(0,r.jsx)("button",{onClick:()=>u.back(),className:"bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 transition-colors",children:"ย้อนกลับ"})]})})}):(0,r.jsx)(r.Fragment,{children:s}):c?(0,r.jsx)(r.Fragment,{children:c}):(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold text-gray-800 mb-2",children:"กรุณาเข้าสู่ระบบ"}),(0,r.jsx)("p",{className:"text-gray-600 mb-4",children:"คุณต้องเข้าสู่ระบบเพื่อเข้าถึงหน้านี้"}),(0,r.jsx)("button",{onClick:()=>u.push(o),className:"bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 transition-colors",children:"เข้าสู่ระบบ"})]})})}},453:function(e,s,t){"use strict";t.d(s,{$p:function(){return i},Ge:function(){return c},K$:function(){return r},NK:function(){return o},c9:function(){return n},gf:function(){return a},n$:function(){return d},oU:function(){return l},yh:function(){return m}});let r={ADMIN:"Admin",BIM:"BIM",SITE_ADMIN:"Site Admin",CM:"CM",ME:"ME",SN:"SN",OE:"OE",PE:"PE",PM:"PM",PD:"PD",SE:"SE",FM:"FM",ADMIN_SITE_2:"Adminsite2"};r.BIM,r.ME,r.SN,r.SITE_ADMIN,r.ADMIN,r.PM,r.PE,r.OE;let l=[r.SITE_ADMIN,r.ADMIN_SITE_2,r.OE,r.PE,r.ADMIN],a=[r.CM,r.ADMIN,r.SITE_ADMIN,r.PM,r.PE,r.OE];r.PM,r.ADMIN,r.SE,r.FM;let n=[r.PE,r.OE,r.ADMIN],i=[r.PM,r.ADMIN];r.PD,r.SE,r.FM;let d={PENDING_REVIEW:"PENDING_REVIEW",PENDING_CM_APPROVAL:"PENDING_CM_APPROVAL",REVISION_REQUIRED:"REVISION_REQUIRED",APPROVED:"APPROVED",APPROVED_WITH_COMMENTS:"APPROVED_WITH_COMMENTS",APPROVED_REVISION_REQUIRED:"APPROVED_REVISION_REQUIRED",REJECTED:"REJECTED",PENDING_FINAL_APPROVAL:"PENDING_FINAL_APPROVAL"},c={DRAFT:"DRAFT",REJECTED_BY_PM:"REJECTED_BY_PM",PENDING_BIM:"PENDING_BIM",IN_PROGRESS:"IN_PROGRESS",PENDING_ACCEPTANCE:"PENDING_ACCEPTANCE",REVISION_REQUESTED:"REVISION_REQUESTED",COMPLETED:"COMPLETED"},o={[d.PENDING_REVIEW]:"รอตรวจสอบ",[d.PENDING_CM_APPROVAL]:"รออนุมัติ (CM/Approver)",[d.REVISION_REQUIRED]:"แก้ไข",[d.APPROVED]:"อนุมัติ",[d.APPROVED_WITH_COMMENTS]:"อนุมัติตามคอมเมนต์ (ไม่แก้ไข)",[d.APPROVED_REVISION_REQUIRED]:"อนุมัติตามคอมเมนต์ (ต้องแก้ไข)",[d.REJECTED]:"ไม่อนุมัติ",[d.PENDING_FINAL_APPROVAL]:"รอ SITE อนุมัติขั้นสุดท้าย",[c.DRAFT]:"รออนุมัติ (PM)",[c.REJECTED_BY_PM]:"ไม่อนุมัติ (PM)",[c.PENDING_BIM]:"รอ BIM รับงาน",[c.IN_PROGRESS]:"BIM กำลังดำเนินการ",[c.PENDING_ACCEPTANCE]:"รอตรวจรับ (Site)",[c.REVISION_REQUESTED]:"ขอแก้ไข (WR)",[c.COMPLETED]:"เสร็จสิ้น"},m={[d.PENDING_REVIEW]:"#0088FE",[d.PENDING_CM_APPROVAL]:"#00C49F",[d.REVISION_REQUIRED]:"#FFBB28",[d.APPROVED]:"#28A745",[d.REJECTED]:"#DC3545",[d.APPROVED_WITH_COMMENTS]:"#2f3e3aff",[d.APPROVED_REVISION_REQUIRED]:"#FD7E14",[c.DRAFT]:"#6c757d",[c.REJECTED_BY_PM]:"#DC3545",[c.PENDING_BIM]:"#0088FE",[c.IN_PROGRESS]:"#FFBB28",[c.PENDING_ACCEPTANCE]:"#AF19FF",[c.REVISION_REQUESTED]:"#FD7E14",[c.COMPLETED]:"#28A745"}}},function(e){e.O(0,[609,15,134,501,649,971,997,744],function(){return e(e.s=3638)}),_N_E=e.O()}]);