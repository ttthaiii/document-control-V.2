(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{1050:function(e,t,n){Promise.resolve().then(n.t.bind(n,4811,23)),Promise.resolve().then(n.t.bind(n,2778,23)),Promise.resolve().then(n.bind(n,7649)),Promise.resolve().then(n.bind(n,2381))},9761:function(e,t,n){"use strict";var r=n(7437);n(2265),t.Z=e=>{let{className:t}=e;return(0,r.jsx)("div",{className:"\n    inline-block h-8 w-8 animate-spin rounded-full \n    border-4 border-solid border-current border-e-transparent \n    align-[-0.125em] text-gray-400 motion-reduce:animate-[spin_1.5s_linear_infinite]\n    ".concat(t||"","\n  ").trim(),role:"status",children:(0,r.jsx)("span",{className:"!absolute !-m-px !h-px !w-px !overflow-hidden !whitespace-nowrap !border-0 !p-0 ![clip:rect(0,0,0,0)]",children:"Loading..."})})}},7649:function(e,t,n){"use strict";n.d(t,{AuthProvider:function(){return c},aC:function(){return d}});var r=n(7437),a=n(2265),o=n(2148),s=n(5978),i=n(6855);let l=null,u=(0,a.createContext)({user:null,firebaseUser:null,loading:!0,error:null,refetch:async()=>{},logout:async()=>{}});function c(e){let{children:t}=e,[n,c]=(0,a.useState)(null),[d,f]=(0,a.useState)(null),[m,h]=(0,a.useState)(!0),[v,b]=(0,a.useState)(null),p=async e=>{try{if(b(null),l&&l.firebaseUserId===e.uid&&Date.now()-l.timestamp<3e5){console.log("\uD83D\uDCCB Using cached user data for: ".concat(e.email)),f(l.user);return}console.log("\uD83D\uDD04 Fetching fresh user data for: ".concat(e.email));let r=(0,s.JU)(i.db,"users",e.uid),a=await (0,s.QT)(r);if(a.exists()){var t,n;let r=a.data(),o={id:e.uid,email:e.email||"",role:r.role,sites:r.sites||[],status:r.status||"ACTIVE",createdFromInvitation:r.createdFromInvitation,createdAt:null===(t=r.createdAt)||void 0===t?void 0:t.toDate(),acceptedAt:null===(n=r.acceptedAt)||void 0===n?void 0:n.toDate()};l={user:o,timestamp:Date.now(),firebaseUserId:e.uid},f(o)}else b("ไม่พบข้อมูลผู้ใช้ในระบบ"),f(null)}catch(e){console.error("Error fetching user data:",e),b("เกิดข้อผิดพลาดในการโหลดข้อมูลผู้ใช้"),f(null)}},g=async()=>{n&&(l=null,await p(n))};(0,a.useEffect)(()=>{let e=(0,o.Aj)(i.I,async e=>{(null==e?void 0:e.uid)===(null==n?void 0:n.uid)&&d||(h(!0),c(e),e?await p(e):(f(null),b(null),l=null),h(!1))});return()=>e()},[]);let w=async()=>{try{await (0,o.w7)(i.I),l=null,f(null),c(null),b(null)}catch(e){throw console.error("Logout error:",e),e}};return(0,r.jsx)(u.Provider,{value:{user:d,firebaseUser:n,loading:m,error:v,refetch:g,logout:w},children:t})}function d(){return(0,a.useContext)(u)}},2381:function(e,t,n){"use strict";n.d(t,{LoadingProvider:function(){return u},Y:function(){return l},r:function(){return c}});var r=n(7437),a=n(2265),o=n(9761),s=n(9376);let i=(0,a.createContext)(void 0),l=()=>(0,r.jsx)("div",{className:"absolute inset-0 bg-gray-100 z-30 flex items-center justify-center",children:(0,r.jsx)(o.Z,{className:"w-12 h-12 text-gray-500"})}),u=e=>{let{children:t}=e,[n,o]=(0,a.useState)(!1),l=(0,s.usePathname)(),u=(0,s.useSearchParams)();return(0,a.useEffect)(()=>{o(!1)},[l,u]),(0,r.jsx)(i.Provider,{value:{isLoading:n,showLoader:()=>o(!0),hideLoader:()=>o(!1)},children:t})},c=()=>{let e=(0,a.useContext)(i);if(void 0===e)throw Error("useLoading must be used within a LoadingProvider");return e}},6855:function(e,t,n){"use strict";n.d(t,{I:function(){return i},db:function(){return l}});var r=n(738),a=n(2148),o=n(5978);let s=(0,r.C6)().length>0?(0,r.C6)()[0]:(0,r.ZF)({apiKey:"AIzaSyAsayb-DEOBE0zi0qh-dPBfihClgXrX1sY",authDomain:"ttsdocumentcontrol.firebaseapp.com",projectId:"ttsdocumentcontrol",storageBucket:"ttsdocumentcontrol.firebasestorage.app",messagingSenderId:"48440915675",appId:"1:48440915675:web:f11611895bfb52d4d27efe"}),i=(0,a.v0)(s),l=(0,o.ad)(s)},2778:function(){},4811:function(e){e.exports={style:{fontFamily:"'__Inter_f367f3', '__Inter_Fallback_f367f3'",fontStyle:"normal"},className:"__className_f367f3"}}},function(e){e.O(0,[2,609,15,783,971,117,744],function(){return e(e.s=1050)}),_N_E=e.O()}]);