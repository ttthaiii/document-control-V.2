"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[313],{1313:function(e,s,r){r.d(s,{Z:function(){return C}});var t=r(7437),a=r(2265),n=r(7649),i=r(7648),l=r(9376),d=r(2381),o=r(2489),c=r(6215),x=r(8736),h=r(875),m=r(2502),u=r(9525),g=r(5805),f=r(7692),p=r(453),b=r(6855),j=r(5978);function v(e){var s;let{isOpen:r,onToggle:v}=e,y=(0,l.usePathname)(),N=(0,l.useRouter)(),w=(0,l.useSearchParams)(),{user:k,logout:C}=(0,n.a)(),{showLoader:D}=(0,d.r)(),[z,S]=(0,a.useState)(!1),[Z,A]=(0,a.useState)([]);(0,a.useEffect)(()=>{if(!(null==k?void 0:k.id)){A([]);return}let e=(0,j.IO)((0,j.hJ)(b.db,"sites"),(0,j.ar)("members","array-contains",k.id)),s=(0,j.cf)(e,e=>{let s=[];e.forEach(e=>{s.push({id:e.id,name:e.data().name})}),A(s)},e=>{console.error("Sidebar: Failed to fetch sites",e)});return()=>s()},[k]);let F=(0,a.useMemo)(()=>(null==k?void 0:k.sites)&&0!==Z.length?Z.filter(e=>k.sites.includes(e.id)):[],[null==k?void 0:k.sites,Z]);(0,a.useEffect)(()=>{(y.includes("/rfa")||y.includes("/dashboard/rfa"))&&S(!0)},[y]);let[E,R]=(0,a.useState)(!1),P=async()=>{try{R(!0),await C(),N.push("/")}catch(e){console.error("Logout error:",e)}finally{R(!1)}},L=e=>y===e||y.startsWith(e+"/");return k?(0,t.jsxs)(t.Fragment,{children:[r&&(0,t.jsx)("div",{className:"lg:hidden fixed inset-0 bg-black bg-opacity-50 z-30",onClick:v}),(0,t.jsxs)("div",{className:"\n        fixed inset-y-0 left-0 z-40\n        w-64 bg-gradient-to-b from-amber-50 to-orange-50\n        border-r border-orange-200\n        transform transition-transform duration-300 ease-in-out\n        ".concat(r?"translate-x-0":"-translate-x-full","\n        flex flex-col h-screen pt-16\n      "),children:[(0,t.jsxs)("div",{className:"bg-gradient-to-r from-orange-600 to-orange-700 text-white p-4 lg:p-6",children:[(0,t.jsx)("div",{className:"lg:hidden flex justify-end mb-2",children:(0,t.jsx)("button",{onClick:v,className:"p-1 rounded-md hover:bg-white hover:bg-opacity-20",children:(0,t.jsx)(o.Z,{size:20})})}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsxs)("h3",{className:"font-semibold text-lg truncate",children:["Welcome ",null===(s=k.email)||void 0===s?void 0:s.split("@")[0]]}),(0,t.jsxs)("p",{className:"text-orange-100 text-sm",children:["Role: ",k.role]}),F.length>0&&(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-orange-100 text-xs",children:"Site:"}),(0,t.jsx)("div",{className:"pl-2",children:F.map(e=>(0,t.jsxs)("p",{className:"text-orange-100 text-xs truncate",title:e.name,children:["- ",e.name]},e.id))})]})]})]}),(0,t.jsxs)("nav",{className:"flex-1 p-4 space-y-2 overflow-y-auto",children:[(0,t.jsxs)(i.default,{href:"/dashboard",onClick:D,className:"\n              flex items-center px-3 py-2 rounded-lg transition-colors\n              ".concat(L("/dashboard")&&"/dashboard"===y?"bg-blue-100 text-blue-700":"text-gray-700 hover:bg-gray-100","\n            "),children:[(0,t.jsx)(c.Z,{className:"w-5 h-5 mr-3"}),"Dashboard"]}),!!k&&[...p.uc,...p.oU,...p.gf,"Admin"].includes(k.role)&&(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsxs)("button",{onClick:()=>{S(!z)},className:"\n                  w-full flex items-center justify-between gap-3 px-3 py-2.5 rounded-lg text-sm font-medium\n                  transition-colors duration-200\n                  ".concat(y.startsWith("/dashboard/rfa")||y.startsWith("/rfa/")?"bg-orange-200 text-orange-900":"text-gray-700 hover:bg-orange-100 hover:text-orange-800","\n                "),children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)(x.Z,{size:18}),(0,t.jsx)("span",{children:"RFA Documents"})]}),z?(0,t.jsx)(h.Z,{size:16}):(0,t.jsx)(m.Z,{size:16})]}),z&&(0,t.jsxs)("div",{className:"ml-6 space-y-1 border-l-2 border-orange-200 pl-4",children:[(0,t.jsxs)(i.default,{href:"/dashboard/rfa?type=RFA-SHOP",onClick:D,className:"\n                      flex items-center gap-3 px-3 py-2 rounded-md text-sm\n                      transition-colors duration-200\n                      ".concat("/dashboard/rfa"===y&&"RFA-SHOP"===w.get("type")?"bg-blue-100 text-blue-900 font-medium":"text-gray-600 hover:bg-gray-100 hover:text-gray-800","\n                    "),children:[(0,t.jsx)("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),(0,t.jsx)("span",{children:"\uD83C\uDFD7️ Shop Drawing"})]}),(0,t.jsxs)(i.default,{href:"/dashboard/rfa?type=RFA-GEN",onClick:D,className:"\n                      flex items-center gap-3 px-3 py-2 rounded-md text-sm\n                      transition-colors duration-200\n                      ".concat("/dashboard/rfa"===y&&"RFA-GEN"===w.get("type")?"bg-green-100 text-green-900 font-medium":"text-gray-600 hover:bg-gray-100 hover:text-gray-800","\n                    "),children:[(0,t.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),(0,t.jsx)("span",{children:"\uD83D\uDCCB General"})]}),(0,t.jsxs)(i.default,{href:"/dashboard/rfa?type=RFA-MAT",onClick:D,className:"\n                      flex items-center gap-3 px-3 py-2 rounded-md text-sm\n                      transition-colors duration-200\n                      ".concat("/dashboard/rfa"===y&&"RFA-MAT"===w.get("type")?"bg-orange-100 text-orange-900 font-medium":"text-gray-600 hover:bg-gray-100 hover:text-gray-800","\n                    "),children:[(0,t.jsx)("div",{className:"w-2 h-2 bg-orange-500 rounded-full"}),(0,t.jsx)("span",{children:"\uD83E\uDDF1 Material"})]})]})]}),(0,t.jsxs)(i.default,{href:"/dashboard/work-request",onClick:D,className:"\n              flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium\n              transition-colors duration-200\n              ".concat(L("/dashboard/work-request")?"bg-orange-200 text-orange-900":"text-gray-700 hover:bg-orange-100 hover:text-orange-800","\n            "),children:[(0,t.jsx)(u.Z,{size:18}),(0,t.jsx)("span",{children:"Work Request"})]})]}),k&&"Admin"===k.role&&(0,t.jsxs)("div",{className:"px-4 py-2",children:[(0,t.jsx)("div",{className:"border-t border-orange-200"}),(0,t.jsxs)("div",{className:"mt-2 space-y-1",children:[(0,t.jsx)("p",{className:"px-3 text-xs font-semibold uppercase text-gray-500 tracking-wider pt-2",children:"Admin"}),(0,t.jsxs)(i.default,{href:"/admin",onClick:D,className:"\n                  flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium\n                  transition-colors duration-200\n                  ".concat(L("/admin")?"bg-red-100 text-red-800":"text-gray-700 hover:bg-red-50 hover:text-red-700","\n                "),children:[(0,t.jsx)(g.Z,{size:18}),(0,t.jsx)("span",{children:"Invite Users"})]})]})]}),(0,t.jsx)("div",{className:"p-4 border-t border-orange-200",children:(0,t.jsxs)("button",{onClick:P,disabled:E,className:"\n              w-full flex items-center justify-center gap-2 \n              px-4 py-2.5 rounded-lg text-sm font-medium\n              ".concat(E?"bg-red-400 cursor-not-allowed":"bg-red-500 hover:bg-red-600"," \n              text-white transition-colors duration-200\n            "),children:[(0,t.jsx)(f.Z,{size:16}),(0,t.jsx)("span",{children:E?"กำลังออก...":"ออกจากระบบ"})]})})]})]}):null}var y=e=>(0,t.jsx)(a.Suspense,{fallback:(0,t.jsx)("div",{className:"w-64 bg-gray-100 h-screen"}),children:(0,t.jsx)(v,{...e})}),N=r(8293),w=r(4766),k=r(8420),C=e=>{let{children:s}=e,[r,i]=(0,a.useState)(!0),{user:l}=(0,n.a)(),{isLoading:o}=(0,d.r)(),c=()=>{i(!r)};return(0,t.jsxs)("div",{className:"min-h-screen bg-gray-100",children:[(0,t.jsx)("header",{className:"fixed top-0 left-0 right-0 h-16 bg-white border-b border-gray-200 z-50",children:(0,t.jsxs)("div",{className:"flex items-center justify-between h-full px-4",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,t.jsx)("button",{onClick:c,className:"p-2 rounded-md text-gray-600 hover:bg-gray-100 hover:text-gray-900 transition-colors",children:(0,t.jsx)(N.Z,{size:20})}),(0,t.jsx)("h1",{className:"text-xl font-semibold text-gray-900",children:"\uD83C\uDFD7️ ttsdoc v2"})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,t.jsx)("button",{className:"p-2 rounded-md text-gray-600 hover:bg-gray-100 hover:text-gray-900 transition-colors",children:(0,t.jsx)(w.Z,{size:18})}),l&&(0,t.jsxs)("span",{className:"hidden sm:block text-sm text-gray-600",children:["\uD83D\uDC4B สวัสดี, ",l.email.split("@")[0]]}),(0,t.jsxs)("div",{className:"hidden md:flex items-center space-x-2 text-gray-600",children:[(0,t.jsx)(k.Z,{size:18}),(0,t.jsx)("span",{className:"text-sm font-medium",children:"T.T.S. Engineering"})]})]})]})}),(0,t.jsxs)("div",{className:"flex",children:[(0,t.jsx)(y,{isOpen:r,onToggle:c}),(0,t.jsxs)("main",{className:"\n              relative flex-1 transition-all duration-300 ease-in-out\n              ".concat(r?"lg:ml-64":"lg:ml-0","\n              overflow-x-hidden //  <-- เพิ่มบรรทัดนี้เข้าไป\n            "),children:[o&&(0,t.jsx)(d.Y,{}),(0,t.jsx)("div",{className:"h-full overflow-y-auto",children:(0,t.jsxs)("div",{className:"pt-16",children:[" ",(0,t.jsxs)("div",{className:"p-4 sm:p-6 lg:p-8",children:[" ",s]})]})})]})]})]})}},9761:function(e,s,r){var t=r(7437);r(2265),s.Z=e=>{let{className:s}=e;return(0,t.jsx)("div",{className:"\n    inline-block h-8 w-8 animate-spin rounded-full \n    border-4 border-solid border-current border-e-transparent \n    align-[-0.125em] text-gray-400 motion-reduce:animate-[spin_1.5s_linear_infinite]\n    ".concat(s||"","\n  ").trim(),role:"status",children:(0,t.jsx)("span",{className:"!absolute !-m-px !h-px !w-px !overflow-hidden !whitespace-nowrap !border-0 !p-0 ![clip:rect(0,0,0,0)]",children:"Loading..."})})}},2381:function(e,s,r){r.d(s,{LoadingProvider:function(){return o},Y:function(){return d},r:function(){return c}});var t=r(7437),a=r(2265),n=r(9761),i=r(9376);let l=(0,a.createContext)(void 0),d=()=>(0,t.jsx)("div",{className:"absolute inset-0 bg-gray-100 z-30 flex items-center justify-center",children:(0,t.jsx)(n.Z,{className:"w-12 h-12 text-gray-500"})}),o=e=>{let{children:s}=e,[r,n]=(0,a.useState)(!1),d=(0,i.usePathname)(),o=(0,i.useSearchParams)();return(0,a.useEffect)(()=>{n(!1)},[d,o]),(0,t.jsx)(l.Provider,{value:{isLoading:r,showLoader:()=>n(!0),hideLoader:()=>n(!1)},children:s})},c=()=>{let e=(0,a.useContext)(l);if(void 0===e)throw Error("useLoading must be used within a LoadingProvider");return e}}}]);