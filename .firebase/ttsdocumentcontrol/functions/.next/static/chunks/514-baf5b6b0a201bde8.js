"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[514],{1313:function(e,t,s){s.d(t,{Z:function(){return y}});var r=s(7437),n=s(2265),a=s(5946),l=s(7648),i=s(9376),o=s(2489),c=s(6215),d=s(8736),x=s(875),u=s(407),m=s(5685),h=s(9525),g=s(7692),f=s(453),b=e=>{var t;let{isOpen:s,onToggle:b}=e,p=(0,i.usePathname)(),j=(0,i.useRouter)(),N=(0,i.useSearchParams)(),{user:y,logout:v}=(0,a.a)(),[E,R]=(0,n.useState)(!1),[D,w]=(0,n.useState)([]),I=()=>!!y&&[...f.uc,...f.oU,...f.gf,"Admin"].includes(y.role);(0,n.useEffect)(()=>{let e=async()=>{if((null==y?void 0:y.sites)&&0!==y.sites.length)try{let e=y.sites.map((e,t)=>({id:e,name:"Site ".concat(t+1)}));w(e)}catch(e){console.error("Error fetching sites:",e)}};y&&e()},[y]),(0,n.useEffect)(()=>{(p.includes("/rfa")||p.includes("/dashboard/rfa"))&&R(!0)},[p]);let A=async()=>{try{await v(),j.push("/")}catch(e){console.error("Logout error:",e)}},P=e=>p===e||p.startsWith(e+"/");return y?(0,r.jsxs)(r.Fragment,{children:[s&&(0,r.jsx)("div",{className:"lg:hidden fixed inset-0 bg-black bg-opacity-50 z-30",onClick:b}),(0,r.jsxs)("div",{className:"\n        fixed inset-y-0 left-0 z-40\n        w-64 bg-gradient-to-b from-amber-50 to-orange-50\n        border-r border-orange-200\n        transform transition-transform duration-300 ease-in-out\n        ".concat(s?"translate-x-0":"-translate-x-full","\n        flex flex-col h-screen pt-16\n      "),children:[(0,r.jsxs)("div",{className:"bg-gradient-to-r from-orange-600 to-orange-700 text-white p-4 lg:p-6",children:[(0,r.jsx)("div",{className:"lg:hidden flex justify-end mb-2",children:(0,r.jsx)("button",{onClick:b,className:"p-1 rounded-md hover:bg-white hover:bg-opacity-20",children:(0,r.jsx)(o.Z,{size:20})})}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsxs)("h3",{className:"font-semibold text-lg truncate",children:["Welcome ",null===(t=y.email)||void 0===t?void 0:t.split("@")[0]]}),(0,r.jsxs)("p",{className:"text-orange-100 text-sm",children:["Role: ",y.role]}),D.length>0&&(0,r.jsxs)("p",{className:"text-orange-100 text-xs truncate",children:["Site: ",D.map(e=>e.name).join(", ")]})]})]}),(0,r.jsxs)("nav",{className:"flex-1 p-4 space-y-2 overflow-y-auto",children:[(0,r.jsxs)(l.default,{href:"/dashboard",className:"\n              flex items-center px-3 py-2 rounded-lg transition-colors\n              ".concat(P("/dashboard")&&"/dashboard"===p?"bg-blue-100 text-blue-700":"text-gray-700 hover:bg-gray-100","\n            "),children:[(0,r.jsx)(c.Z,{className:"w-5 h-5 mr-3"}),"Dashboard"]}),I()&&(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsxs)("button",{onClick:()=>{R(!E)},className:"\n                  w-full flex items-center justify-between gap-3 px-3 py-2.5 rounded-lg text-sm font-medium\n                  transition-colors duration-200\n                  ".concat(p.startsWith("/dashboard/rfa")||p.startsWith("/rfa/")?"bg-orange-200 text-orange-900":"text-gray-700 hover:bg-orange-100 hover:text-orange-800","\n                "),children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)(d.Z,{size:18}),(0,r.jsx)("span",{children:"RFA Documents"})]}),E?(0,r.jsx)(x.Z,{size:16}):(0,r.jsx)(u.Z,{size:16})]}),E&&(0,r.jsxs)("div",{className:"ml-6 space-y-1 border-l-2 border-orange-200 pl-4",children:[(0,r.jsxs)(l.default,{href:"/dashboard/rfa?type=RFA-SHOP",className:"\n                      flex items-center gap-3 px-3 py-2 rounded-md text-sm\n                      transition-colors duration-200\n                      ".concat("/dashboard/rfa"===p&&"RFA-SHOP"===N.get("type")?"bg-blue-100 text-blue-900 font-medium":"text-gray-600 hover:bg-gray-100 hover:text-gray-800","\n                    "),children:[(0,r.jsx)("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),(0,r.jsx)("span",{children:"\uD83C\uDFD7️ Shop Drawing"})]}),(0,r.jsxs)(l.default,{href:"/dashboard/rfa?type=RFA-GEN",className:"\n                      flex items-center gap-3 px-3 py-2 rounded-md text-sm\n                      transition-colors duration-200\n                      ".concat("/dashboard/rfa"===p&&"RFA-GEN"===N.get("type")?"bg-green-100 text-green-900 font-medium":"text-gray-600 hover:bg-gray-100 hover:text-gray-800","\n                    "),children:[(0,r.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),(0,r.jsx)("span",{children:"\uD83D\uDCCB General"})]}),(0,r.jsxs)(l.default,{href:"/dashboard/rfa?type=RFA-MAT",className:"\n                      flex items-center gap-3 px-3 py-2 rounded-md text-sm\n                      transition-colors duration-200\n                      ".concat("/dashboard/rfa"===p&&"RFA-MAT"===N.get("type")?"bg-orange-100 text-orange-900 font-medium":"text-gray-600 hover:bg-gray-100 hover:text-gray-800","\n                    "),children:[(0,r.jsx)("div",{className:"w-2 h-2 bg-orange-500 rounded-full"}),(0,r.jsx)("span",{children:"\uD83E\uDDF1 Material"})]})]})]}),I()&&(0,r.jsxs)(l.default,{href:"/rfi",className:"\n                flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium\n                transition-colors duration-200\n                ".concat(P("/rfi")?"bg-orange-200 text-orange-900":"text-gray-700 hover:bg-orange-100 hover:text-orange-800","\n              "),children:[(0,r.jsx)(m.Z,{size:18}),(0,r.jsx)("span",{children:"RFI"})]}),(0,r.jsxs)(l.default,{href:"/work-request",className:"\n              flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium\n              transition-colors duration-200\n              ".concat(P("/work-request")?"bg-orange-200 text-orange-900":"text-gray-700 hover:bg-orange-100 hover:text-orange-800","\n            "),children:[(0,r.jsx)(h.Z,{size:18}),(0,r.jsx)("span",{children:"Work Request"})]})]}),(0,r.jsx)("div",{className:"p-4 border-t border-orange-200",children:(0,r.jsxs)("button",{onClick:A,className:"   w-full flex items-center justify-center gap-2    px-4 py-2.5 rounded-lg text-sm font-medium   bg-red-500 hover:bg-red-600 text-white   transition-colors duration-200   ",children:[(0,r.jsx)(g.Z,{size:16}),(0,r.jsx)("span",{children:"ออกจากระบบ"})]})})]})]}):null},p=s(8293),j=s(4766),N=s(8420),y=e=>{let{children:t}=e,[s,l]=(0,n.useState)(!0),{user:i}=(0,a.a)(),o=()=>{l(!s)};return(0,r.jsxs)("div",{className:"min-h-screen bg-gray-100",children:[(0,r.jsx)("header",{className:"fixed top-0 left-0 right-0 h-16 bg-white border-b border-gray-200 z-50",children:(0,r.jsxs)("div",{className:"flex items-center justify-between h-full px-4",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,r.jsx)("button",{onClick:o,className:"p-2 rounded-md text-gray-600 hover:bg-gray-100 hover:text-gray-900 transition-colors",children:(0,r.jsx)(p.Z,{size:20})}),(0,r.jsx)("h1",{className:"text-xl font-semibold text-gray-900",children:"\uD83C\uDFD7️ ttsdoc v2"})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,r.jsx)("button",{className:"p-2 rounded-md text-gray-600 hover:bg-gray-100 hover:text-gray-900 transition-colors",children:(0,r.jsx)(j.Z,{size:18})}),i&&(0,r.jsxs)("span",{className:"hidden sm:block text-sm text-gray-600",children:["\uD83D\uDC4B สวัสดี, ",i.email.split("@")[0]]}),(0,r.jsxs)("div",{className:"hidden md:flex items-center space-x-2 text-gray-600",children:[(0,r.jsx)(N.Z,{size:18}),(0,r.jsx)("span",{className:"text-sm font-medium",children:"T.T.S. Engineering"})]})]})]})}),(0,r.jsxs)("div",{className:"flex",children:[(0,r.jsx)(b,{isOpen:s,onToggle:o}),(0,r.jsx)("main",{className:"\n            flex-1 transition-all duration-300 ease-in-out pt-16\n            ".concat(s?"lg:ml-64":"lg:ml-0","\n          "),children:(0,r.jsx)("div",{className:"p-4 sm:p-6 lg:p-8",children:t})})]})]})}},5946:function(e,t,s){s.d(t,{AuthProvider:function(){return o},a:function(){return c}});var r=s(2265),n=s(2148),a=s(5978),l=s(6855);let i=(0,r.createContext)({user:null,firebaseUser:null,loading:!0,error:null,refetch:async()=>{},logout:async()=>{}});function o(e){let{children:t}=e,[s,o]=(0,r.useState)(null),[c,d]=(0,r.useState)(null),[x,u]=(0,r.useState)(!0),[m,h]=(0,r.useState)(null),g=async e=>{try{h(null);let r=await (0,a.QT)((0,a.JU)(l.db,"users",e.uid));if(r.exists()){var t,s;let n=r.data();d({id:e.uid,email:e.email||"",role:n.role,sites:n.sites||[],status:n.status||"ACTIVE",createdFromInvitation:n.createdFromInvitation,createdAt:null===(t=n.createdAt)||void 0===t?void 0:t.toDate(),acceptedAt:null===(s=n.acceptedAt)||void 0===s?void 0:s.toDate()})}else h("ไม่พบข้อมูลผู้ใช้ในระบบ"),d(null)}catch(e){console.error("Error fetching user data:",e),h("เกิดข้อผิดพลาดในการโหลดข้อมูลผู้ใช้"),d(null)}},f=async()=>{s&&await g(s)};(0,r.useEffect)(()=>{let e=(0,n.Aj)(l.I,async e=>{try{u(!0),o(e),e?await g(e):(d(null),h(null))}catch(e){console.error("Auth state change error:",e),h("เกิดข้อผิดพลาดในการตรวจสอบสิทธิ์")}finally{u(!1)}});return()=>e()},[]);let b=async()=>{try{await (0,n.w7)(l.I),d(null),o(null),h(null)}catch(e){throw console.error("Logout error:",e),e}};return r.createElement(i.Provider,{value:{user:c,firebaseUser:s,loading:x,error:m,refetch:f,logout:b}},t)}function c(){return(0,r.useContext)(i)}},731:function(e,t,s){s.d(t,{a1:function(){return i}});var r=s(7437),n=s(5946),a=s(9376),l=s(2265);function i(e){let{children:t,requiredRoles:s=[],requiredSiteAccess:i=[],fallback:o,redirectTo:c="/login"}=e,{user:d,loading:x,error:u}=(0,n.a)(),m=(0,a.useRouter)();return((0,l.useEffect)(()=>{x||d||m.push(c)},[d,x,m,c]),x)?(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-600",children:"กำลังตรวจสอบสิทธิ์..."})]})}):u?(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,r.jsx)("div",{className:"text-center max-w-md mx-auto",children:(0,r.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold text-red-800 mb-2",children:"เกิดข้อผิดพลาด"}),(0,r.jsx)("p",{className:"text-red-600 mb-4",children:u}),(0,r.jsx)("button",{onClick:()=>window.location.reload(),className:"bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 transition-colors",children:"ลองใหม่"})]})})}):d?s.length>0&&!s.includes(d.role)?(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,r.jsx)("div",{className:"text-center max-w-md mx-auto",children:(0,r.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-6",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold text-yellow-800 mb-2",children:"ไม่มีสิทธิ์เข้าถึง"}),(0,r.jsx)("p",{className:"text-yellow-700 mb-2",children:"คุณไม่มีสิทธิ์เข้าถึงหน้านี้"}),(0,r.jsxs)("p",{className:"text-sm text-yellow-600 mb-4",children:["ต้องการสิทธิ์: ",s.join(", ")," | สิทธิ์ปัจจุบัน: ",d.role]}),(0,r.jsx)("button",{onClick:()=>m.back(),className:"bg-yellow-600 text-white px-4 py-2 rounded hover:bg-yellow-700 transition-colors",children:"ย้อนกลับ"})]})})}):i.length>0&&"Admin"!==d.role&&!i.some(e=>{var t;return null===(t=d.sites)||void 0===t?void 0:t.includes(e)})?(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,r.jsx)("div",{className:"text-center max-w-md mx-auto",children:(0,r.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold text-red-800 mb-2",children:"ไม่มีสิทธิ์เข้าถึงโครงการ"}),(0,r.jsx)("p",{className:"text-red-600 mb-4",children:"คุณไม่มีสิทธิ์เข้าถึงโครงการที่ต้องการ"}),(0,r.jsx)("button",{onClick:()=>m.back(),className:"bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 transition-colors",children:"ย้อนกลับ"})]})})}):(0,r.jsx)(r.Fragment,{children:t}):o?(0,r.jsx)(r.Fragment,{children:o}):(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold text-gray-800 mb-2",children:"กรุณาเข้าสู่ระบบ"}),(0,r.jsx)("p",{className:"text-gray-600 mb-4",children:"คุณต้องเข้าสู่ระบบเพื่อเข้าถึงหน้านี้"}),(0,r.jsx)("button",{onClick:()=>m.push(c),className:"bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 transition-colors",children:"เข้าสู่ระบบ"})]})})}},453:function(e,t,s){s.d(t,{NK:function(){return i},gf:function(){return a},n$:function(){return l},oU:function(){return n},uc:function(){return r}});let r=["BIM","ME","SN"],n=["Site Admin","Adminsite2","OE","PE"],a=["CM"],l={PENDING_REVIEW:"PENDING_REVIEW",PENDING_CM_APPROVAL:"PENDING_CM_APPROVAL",REVISION_REQUIRED:"REVISION_REQUIRED",APPROVED:"APPROVED",APPROVED_WITH_COMMENTS:"APPROVED_WITH_COMMENTS",APPROVED_REVISION_REQUIRED:"APPROVED_REVISION_REQUIRED",REJECTED:"REJECTED"},i={[l.PENDING_REVIEW]:"รอตรวจสอบ",[l.PENDING_CM_APPROVAL]:"ส่ง CM",[l.REVISION_REQUIRED]:"แก้ไข",[l.APPROVED]:"อนุมัติ",[l.APPROVED_WITH_COMMENTS]:"อนุมัติตามคอมเมนต์ (ไม่แก้ไข)",[l.APPROVED_REVISION_REQUIRED]:"อนุมัติตามคอมเมนต์ (ต้องแก้ไข)",[l.REJECTED]:"ไม่อนุมัติ"}},6855:function(e,t,s){s.d(t,{I:function(){return i},db:function(){return o}});var r=s(996),n=s(2148),a=s(5978);let l=(0,r.C6)().length>0?(0,r.C6)()[0]:(0,r.ZF)({apiKey:"AIzaSyAsayb-DEOBE0zi0qh-dPBfihClgXrX1sY",authDomain:"ttsdocumentcontrol.firebaseapp.com",projectId:"ttsdocumentcontrol",storageBucket:"ttsdocumentcontrol.firebasestorage.app",messagingSenderId:"48440915675",appId:"1:48440915675:web:f11611895bfb52d4d27efe"}),i=(0,n.v0)(l),o=(0,a.ad)(l)}}]);