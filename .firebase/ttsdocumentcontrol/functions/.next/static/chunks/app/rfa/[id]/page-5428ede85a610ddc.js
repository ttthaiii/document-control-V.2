(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[694],{1422:function(e,t,r){Promise.resolve().then(r.bind(r,3813))},9205:function(e,t,r){"use strict";r.d(t,{Z:function(){return d}});var n=r(2265);let a=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),l=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase()),s=e=>{let t=l(e);return t.charAt(0).toUpperCase()+t.slice(1)},o=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim()},i=e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0};var c={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let u=(0,n.forwardRef)((e,t)=>{let{color:r="currentColor",size:a=24,strokeWidth:l=2,absoluteStrokeWidth:s,className:u="",children:d,iconNode:f,...h}=e;return(0,n.createElement)("svg",{ref:t,...c,width:a,height:a,stroke:r,strokeWidth:s?24*Number(l)/Number(a):l,className:o("lucide",u),...!d&&!i(h)&&{"aria-hidden":"true"},...h},[...f.map(e=>{let[t,r]=e;return(0,n.createElement)(t,r)}),...Array.isArray(d)?d:[d]])}),d=(e,t)=>{let r=(0,n.forwardRef)((r,l)=>{let{className:i,...c}=r;return(0,n.createElement)(u,{ref:l,iconNode:t,className:o("lucide-".concat(a(s(e))),"lucide-".concat(e),i),...c})});return r.displayName=s(e),r}},3813:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return u}});var n=r(7437),a=r(2265),l=r(9376),s=r(5978),o=r(6855);let i=(0,r(9205).Z)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);var c=r(7649);function u(){let e=(0,l.useRouter)(),t=(0,l.useParams)(),r=(0,l.useSearchParams)(),[u,d]=(0,a.useState)(null),{user:f,loading:h}=(0,c.aC)();return(0,a.useEffect)(()=>{if(h)return;let n=t.id;if(!f){let t="/rfa/".concat(n);e.replace("/login?redirect=".concat(encodeURIComponent(t)));return}(async()=>{if(!n){d("ไม่พบ ID ของเอกสารใน URL");return}try{let t=(0,s.JU)(o.db,"rfaDocuments",n),a=await (0,s.QT)(t);if(a.exists()){let t=a.data().rfaType;if(t){let a=new URLSearchParams(r.toString());a.set("type",t),a.set("docId",n),e.replace("/dashboard/rfa?".concat(a.toString()))}else d("ไม่สามารถระบุประเภทของเอกสารได้")}else d("ไม่พบเอกสารที่คุณต้องการ")}catch(e){console.error("Redirect Error:",e),d("เกิดข้อผิดพลาดในการเปิดเอกสาร")}})()},[t.id,e,r,f,h]),(0,n.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,n.jsx)("div",{className:"text-center",children:u?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("h2",{className:"text-xl font-bold text-red-700 mb-2",children:"เกิดข้อผิดพลาด"}),(0,n.jsx)("p",{className:"text-red-600",children:u}),(0,n.jsx)("button",{onClick:()=>e.push("/dashboard"),className:"mt-4 bg-gray-200 px-4 py-2 rounded",children:"กลับสู่ Dashboard"})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(i,{className:"w-12 h-12 animate-spin text-blue-500 mx-auto"}),(0,n.jsx)("p",{className:"mt-4 text-gray-600",children:"กำลังเปิดเอกสาร..."})]})})})}},7649:function(e,t,r){"use strict";r.d(t,{AuthProvider:function(){return u},aC:function(){return d}});var n=r(7437),a=r(2265),l=r(2148),s=r(5978),o=r(6855);let i=null,c=(0,a.createContext)({user:null,firebaseUser:null,loading:!0,error:null,refetch:async()=>{},logout:async()=>{}});function u(e){let{children:t}=e,[r,u]=(0,a.useState)(null),[d,f]=(0,a.useState)(null),[h,m]=(0,a.useState)(!0),[p,g]=(0,a.useState)(null),x=async e=>{try{if(g(null),i&&i.firebaseUserId===e.uid&&Date.now()-i.timestamp<3e5){console.log("\uD83D\uDCCB Using cached user data for: ".concat(e.email)),f(i.user);return}console.log("\uD83D\uDD04 Fetching fresh user data for: ".concat(e.email));let n=(0,s.JU)(o.db,"users",e.uid),a=await (0,s.QT)(n);if(a.exists()){var t,r;let n=a.data(),l={id:e.uid,email:e.email||"",role:n.role,sites:n.sites||[],status:n.status||"ACTIVE",createdFromInvitation:n.createdFromInvitation,createdAt:null===(t=n.createdAt)||void 0===t?void 0:t.toDate(),acceptedAt:null===(r=n.acceptedAt)||void 0===r?void 0:r.toDate()};i={user:l,timestamp:Date.now(),firebaseUserId:e.uid},f(l)}else g("ไม่พบข้อมูลผู้ใช้ในระบบ"),f(null)}catch(e){console.error("Error fetching user data:",e),g("เกิดข้อผิดพลาดในการโหลดข้อมูลผู้ใช้"),f(null)}},b=async()=>{r&&(i=null,await x(r))};(0,a.useEffect)(()=>{let e=(0,l.Aj)(o.I,async e=>{(null==e?void 0:e.uid)===(null==r?void 0:r.uid)&&d||(m(!0),u(e),e?await x(e):(f(null),g(null),i=null),m(!1))});return()=>e()},[]);let v=async()=>{try{await (0,l.w7)(o.I),i=null,f(null),u(null),g(null)}catch(e){throw console.error("Logout error:",e),e}};return(0,n.jsx)(c.Provider,{value:{user:d,firebaseUser:r,loading:h,error:p,refetch:b,logout:v},children:t})}function d(){return(0,a.useContext)(c)}},6855:function(e,t,r){"use strict";r.d(t,{I:function(){return o},db:function(){return i}});var n=r(738),a=r(2148),l=r(5978);let s=(0,n.C6)().length>0?(0,n.C6)()[0]:(0,n.ZF)({apiKey:"AIzaSyAsayb-DEOBE0zi0qh-dPBfihClgXrX1sY",authDomain:"ttsdocumentcontrol.firebaseapp.com",projectId:"ttsdocumentcontrol",storageBucket:"ttsdocumentcontrol.firebasestorage.app",messagingSenderId:"48440915675",appId:"1:48440915675:web:f11611895bfb52d4d27efe"}),o=(0,a.v0)(s),i=(0,l.ad)(s)}},function(e){e.O(0,[609,15,783,971,117,744],function(){return e(e.s=1422)}),_N_E=e.O()}]);