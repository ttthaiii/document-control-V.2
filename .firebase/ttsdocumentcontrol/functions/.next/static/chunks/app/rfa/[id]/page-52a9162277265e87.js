(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[694],{1422:function(e,t,r){Promise.resolve().then(r.bind(r,506))},9205:function(e,t,r){"use strict";r.d(t,{Z:function(){return d}});var n=r(2265);let o=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),i=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase()),a=e=>{let t=i(e);return t.charAt(0).toUpperCase()+t.slice(1)},s=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim()},l=e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0};var c={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let u=(0,n.forwardRef)((e,t)=>{let{color:r="currentColor",size:o=24,strokeWidth:i=2,absoluteStrokeWidth:a,className:u="",children:d,iconNode:f,...h}=e;return(0,n.createElement)("svg",{ref:t,...c,width:o,height:o,stroke:r,strokeWidth:a?24*Number(i)/Number(o):i,className:s("lucide",u),...!d&&!l(h)&&{"aria-hidden":"true"},...h},[...f.map(e=>{let[t,r]=e;return(0,n.createElement)(t,r)}),...Array.isArray(d)?d:[d]])}),d=(e,t)=>{let r=(0,n.forwardRef)((r,i)=>{let{className:l,...c}=r;return(0,n.createElement)(u,{ref:i,iconNode:t,className:s("lucide-".concat(o(a(e))),"lucide-".concat(e),l),...c})});return r.displayName=a(e),r}},1817:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});let n=(0,r(9205).Z)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},506:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return u}});var n=r(7437),o=r(2265),i=r(9376),a=r(5978),s=r(6855),l=r(1817),c=r(7649);function u(){let e=(0,i.useRouter)(),t=(0,i.useParams)(),r=(0,i.useSearchParams)(),[u,d]=(0,o.useState)(null),{user:f,loading:h}=(0,c.a)();return(0,o.useEffect)(()=>{if(h)return;let n=t.id;if(!f){let t="/rfa/".concat(n);e.replace("/login?redirect=".concat(encodeURIComponent(t)));return}(async()=>{if(!n){d("ไม่พบ ID ของเอกสารใน URL");return}try{let t=(0,a.JU)(s.db,"rfaDocuments",n),o=await (0,a.QT)(t);if(o.exists()){let t=o.data().rfaType;if(t){let o=new URLSearchParams(r.toString());o.set("type",t),o.set("docId",n),e.replace("/dashboard/rfa?".concat(o.toString()))}else d("ไม่สามารถระบุประเภทของเอกสารได้")}else d("ไม่พบเอกสารที่คุณต้องการ")}catch(e){console.error("Redirect Error:",e),d("เกิดข้อผิดพลาดในการเปิดเอกสาร")}})()},[t.id,e,r,f,h]),(0,n.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,n.jsx)("div",{className:"text-center",children:u?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("h2",{className:"text-xl font-bold text-red-700 mb-2",children:"เกิดข้อผิดพลาด"}),(0,n.jsx)("p",{className:"text-red-600",children:u}),(0,n.jsx)("button",{onClick:()=>e.push("/dashboard"),className:"mt-4 bg-gray-200 px-4 py-2 rounded",children:"กลับสู่ Dashboard"})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(l.Z,{className:"w-12 h-12 animate-spin text-blue-500 mx-auto"}),(0,n.jsx)("p",{className:"mt-4 text-gray-600",children:"กำลังเปิดเอกสาร..."})]})})})}},7649:function(e,t,r){"use strict";r.d(t,{AuthProvider:function(){return d},a:function(){return f}});var n=r(7437),o=r(2265),i=r(2148),a=r(5978),s=r(7012),l=r(6855);let c=(0,o.createContext)({user:null,firebaseUser:null,loading:!0,error:null,logout:async()=>{},requestNotificationPermission:async()=>{}}),u=()=>/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);function d(e){let{children:t}=e,[r,d]=(0,o.useState)(null),[f,h]=(0,o.useState)(null),[p,m]=(0,o.useState)(!0),[w,g]=(0,o.useState)(null),v=async(e,t)=>{if(l.Fw){if(!u()&&"SAVE"===t){console.log("\uD83D\uDCBB Desktop detected: Notifications are disabled for desktop devices.");return}try{if("SAVE"===t){let t=await Notification.requestPermission();if("granted"===t){let t=await (0,s.LP)(l.Fw,{vapidKey:"BJ13x_HEhi6a7lCuv73CZw78pcmHWQoLdNNZag8EZPcJSD-VNyb2ENgAt_KGnf30p6AzVrE89HckdU4wn4wq9wA"});t&&(await (0,a.r7)((0,a.JU)(l.db,"users",e),{fcmTokens:[t],lastLogin:new Date}),console.log("\uD83D\uDCF1 Mobile Notification Token Updated"))}}else"REMOVE"===t&&await (0,s.pQ)(l.Fw)}catch(e){console.error("FCM Token Error:",e)}}};(0,o.useEffect)(()=>{"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw.js").then(e=>{console.log("✅ PWA Service Worker (sw.js) registered successfully:",e.scope)}).catch(e=>{console.error("❌ PWA Service Worker registration failed:",e)})},[]),(0,o.useEffect)(()=>{if(l.Fw&&u()){let e=(0,s.ps)(l.Fw,e=>{var t,r,n;console.log("\uD83D\uDCE9 Foreground Message Received:",e);let o=(null===(t=e.data)||void 0===t?void 0:t.title)||"การแจ้งเตือนใหม่",i=(null===(r=e.data)||void 0===r?void 0:r.body)||"",a=null===(n=e.data)||void 0===n?void 0:n.url;if("granted"===Notification.permission){let e=new Notification(o,{body:i,icon:"/favicon.ico"});e.onclick=()=>{a&&(window.location.href=a),e.close()}}});return()=>e()}},[]),(0,o.useEffect)(()=>{let e=null,t=(0,i.Aj)(l.I8,async t=>{if(m(!0),d(t),e&&(e(),e=null),t){let r=(0,a.JU)(l.db,"users",t.uid);e=(0,a.cf)(r,e=>{if(e.exists()){var r,n;let o=e.data();if("DISABLED"===o.status){(0,i.w7)(l.I8),h(null),g("บัญชีของคุณถูกระงับการใช้งาน");return}h({id:t.uid,email:t.email||"",role:o.role,sites:o.sites||[],status:o.status||"ACTIVE",createdFromInvitation:o.createdFromInvitation,createdAt:null===(r=o.createdAt)||void 0===r?void 0:r.toDate(),acceptedAt:null===(n=o.acceptedAt)||void 0===n?void 0:n.toDate()})}else h(null);m(!1)},e=>{console.error("Snapshot Error:",e),m(!1)}),v(t.uid,"SAVE")}else h(null),m(!1)});return()=>{t(),e&&e()}},[]);let b=async()=>{try{(null==f?void 0:f.id)&&await v(f.id,"REMOVE"),await (0,i.w7)(l.I8),h(null)}catch(e){throw console.error("Logout error:",e),e}},y=async()=>{if(!u()){alert("ระบบแจ้งเตือนรองรับเฉพาะการใช้งานบนโทรศัพท์มือถือเท่านั้น");return}(null==f?void 0:f.id)&&(await v(f.id,"SAVE"),alert("เปิดรับการแจ้งเตือนเรียบร้อยแล้ว"))};return(0,n.jsx)(c.Provider,{value:{user:f,firebaseUser:r,loading:p,error:w,logout:b,requestNotificationPermission:y},children:t})}function f(){return(0,o.useContext)(c)}},6855:function(e,t,r){"use strict";r.d(t,{Fw:function(){return u},I8:function(){return l},db:function(){return c}});var n=r(738),o=r(2148),i=r(5978),a=r(7012);let s=(0,n.C6)().length>0?(0,n.Mq)():(0,n.ZF)({apiKey:"AIzaSyAsayb-DEOBE0zi0qh-dPBfihClgXrX1sY",authDomain:"ttsdocumentcontrol.firebaseapp.com",projectId:"ttsdocumentcontrol",storageBucket:"ttsdocumentcontrol.firebasestorage.app",messagingSenderId:"48440915675",appId:"1:48440915675:web:f11611895bfb52d4d27efe"}),l=(0,o.v0)(s),c=(0,i.ad)(s),u=null;(0,a.Gb)().then(e=>{e&&(u=(0,a.KL)(s))});try{(0,i.ST)(c).then(()=>{console.log("✅ Firestore offline persistence enabled.")}).catch(e=>{"failed-precondition"==e.code?console.warn("Firestore persistence failed: Multiple tabs open."):"unimplemented"==e.code&&console.warn("Firestore persistence is not supported in this browser.")})}catch(e){console.error("An error occurred while enabling Firestore persistence:",e)}}},function(e){e.O(0,[609,15,134,971,997,744],function(){return e(e.s=1422)}),_N_E=e.O()}]);