(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{93529:function(e,s,t){Promise.resolve().then(t.bind(t,62043))},62043:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return v}});var r=t(57437),a=t(2265),l=t(20731),n=t(47649),i=t(73247),d=t(60044),c=t(62720),o=t(42208),x=t(92735),m=t(48736),u=t(99761),h=t(57576),p=t(6855),g=t(5978),f=t(453);const j=e=>{if(!e)return"N/A";if(e.seconds)return new Date(1e3*e.seconds).toLocaleDateString("th-TH",{year:"numeric",month:"short",day:"numeric"});const s=new Date(e);return isNaN(s.getTime())?"Invalid Date":s.toLocaleDateString("th-TH",{year:"numeric",month:"short",day:"numeric"})},b=()=>{const[e,s]=(0,a.useState)(!1);return(0,a.useEffect)((()=>{const e=()=>s(window.innerWidth<768);return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]),e};function N(){const{user:e,firebaseUser:s}=(0,n.a)(),t=b(),[l,N]=(0,a.useState)([]),[y,v]=(0,a.useState)([]),[w,L]=(0,a.useState)(""),[A,C]=(0,a.useState)("ALL"),[k,E]=(0,a.useState)("ALL"),[S,D]=(0,a.useState)([]),[I,O]=(0,a.useState)(!0),[_,P]=(0,a.useState)(null),[T,R]=(0,a.useState)(null);(0,a.useEffect)((()=>{(async()=>{if(s)try{const e=await s.getIdToken(),[t,r]=await Promise.all([fetch("/api/sites",{headers:{Authorization:"Bearer ".concat(e)}}),fetch("/api/rfa/categories?rfaType=ALL",{headers:{Authorization:"Bearer ".concat(e)}})]);if(!t.ok||!r.ok)throw new Error("Failed to fetch filter data");const a=await t.json(),l=await r.json();N(a.sites||[]);const n=Array.from(new Map(l.categories.map((e=>[e.categoryCode,e]))).values());v(n)}catch(e){P("\u0e44\u0e21\u0e48\u0e2a\u0e32\u0e21\u0e32\u0e23\u0e16\u0e42\u0e2b\u0e25\u0e14\u0e02\u0e49\u0e2d\u0e21\u0e39\u0e25 Filter \u0e44\u0e14\u0e49"),console.error(e)}})()}),[s]),(0,a.useEffect)((()=>{(async()=>{if((null===e||void 0===e?void 0:e.sites)&&0!==e.sites.length){O(!0),P(null);try{let s=(0,g.IO)((0,g.hJ)(p.db,"rfaDocuments"),(0,g.ar)("siteId","in",e.sites),(0,g.ar)("isLatest","==",!0),(0,g.ar)("status","in",[f.n$.APPROVED,f.n$.APPROVED_WITH_COMMENTS,f.n$.APPROVED_REVISION_REQUIRED]),(0,g.Xo)("updatedAt","desc"));"ALL"!==A&&(s=(0,g.IO)(s,(0,g.ar)("siteId","==",A))),"ALL"!==k&&(s=(0,g.IO)(s,(0,g.ar)("categoryId","==",k)));const t=(await(0,g.PL)(s)).docs.map((e=>({id:e.id,...e.data()})));D(t)}catch(s){P(s instanceof Error?s.message:"\u0e44\u0e21\u0e48\u0e2a\u0e32\u0e21\u0e32\u0e23\u0e16\u0e42\u0e2b\u0e25\u0e14\u0e02\u0e49\u0e2d\u0e21\u0e39\u0e25\u0e40\u0e2d\u0e01\u0e2a\u0e32\u0e23\u0e44\u0e14\u0e49"),console.error(s)}finally{O(!1)}}else O(!1)})()}),[e,A,k]);const Z=(0,a.useMemo)((()=>{if(!w)return S;const e=w.toLowerCase();return S.filter((s=>s.title.toLowerCase().includes(e)||s.documentNumber&&s.documentNumber.toLowerCase().includes(e)))}),[w,S]),F=e=>{"application/pdf"===e.contentType||e.fileName.toLowerCase().endsWith(".pdf")?R(e):window.open(e.fileUrl,"_blank")};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow flex flex-col h-full",children:[(0,r.jsxs)("div",{className:"p-4 border-b",children:[(0,r.jsx)("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:"\ud83d\udcda \u0e04\u0e25\u0e31\u0e07\u0e40\u0e2d\u0e01\u0e2a\u0e32\u0e23\u0e2d\u0e19\u0e38\u0e21\u0e31\u0e15\u0e34 (Approved Document Library)"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 items-end",children:[(0,r.jsxs)("div",{className:"relative md:col-span-1",children:[(0,r.jsx)(i.Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 w-4 h-4"}),(0,r.jsx)("input",{type:"text",placeholder:"\u0e04\u0e49\u0e19\u0e2b\u0e32...",className:"w-full h-10 pl-10 pr-4 border rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 outline-none",value:w,onChange:e=>L(e.target.value)})]}),(0,r.jsxs)("div",{className:"relative md:col-span-1",children:[(0,r.jsx)(d.Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 w-4 h-4"}),(0,r.jsxs)("select",{className:"w-full h-10 pl-10 pr-4 border rounded-lg appearance-none truncate bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 outline-none",value:A,onChange:e=>C(e.target.value),children:[(0,r.jsx)("option",{value:"ALL",children:"\u0e17\u0e38\u0e01\u0e42\u0e04\u0e23\u0e07\u0e01\u0e32\u0e23"}),l.map((e=>(0,r.jsx)("option",{value:e.id,children:e.name},e.id)))]})]}),(0,r.jsxs)("div",{className:"relative md:col-span-1",children:[(0,r.jsx)(c.Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 w-4 h-4"}),(0,r.jsxs)("select",{className:"w-full h-10 pl-10 pr-4 border rounded-lg appearance-none bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 outline-none",value:k,onChange:e=>E(e.target.value),children:[(0,r.jsx)("option",{value:"ALL",children:"\u0e17\u0e38\u0e01\u0e2b\u0e21\u0e27\u0e14\u0e07\u0e32\u0e19"}),y.map((e=>(0,r.jsx)("option",{value:e.id,children:e.categoryCode},e.id)))]})]}),(0,r.jsx)("div",{className:"md:col-span-1",children:(0,r.jsx)("button",{onClick:()=>{L(""),C("ALL"),E("ALL")},className:"w-full h-10 px-4 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition-colors font-medium",children:"\u0e23\u0e35\u0e40\u0e0b\u0e47\u0e15"})})]}),_&&(0,r.jsx)("p",{className:"text-red-500 text-sm mt-2",children:_})]}),(0,r.jsx)("div",{className:"p-4 flex-1 min-h-0 overflow-y-auto",children:I?(0,r.jsx)("div",{className:"text-center py-16",children:(0,r.jsx)(u.Z,{})}):0===Z.length?(0,r.jsx)("div",{className:"text-center py-16 border-2 border-dashed rounded-lg",children:(0,r.jsx)("p",{className:"text-gray-500",children:"\u0e44\u0e21\u0e48\u0e1e\u0e1a\u0e40\u0e2d\u0e01\u0e2a\u0e32\u0e23\u0e17\u0e35\u0e48\u0e2d\u0e19\u0e38\u0e21\u0e31\u0e15\u0e34\u0e41\u0e25\u0e49\u0e27"})}):t?(0,r.jsx)("div",{className:"space-y-3",children:Z.map((e=>(0,r.jsxs)("div",{className:"bg-gray-50 border rounded-lg p-4 space-y-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-semibold text-gray-800 truncate",children:e.documentNumber}),(0,r.jsx)("p",{className:"text-sm text-gray-600 line-clamp-2 mt-1",children:e.title})]}),e.files&&e.files.length>0&&(0,r.jsxs)("button",{onClick:()=>F(e.files[0]),className:"w-full flex items-center justify-center text-sm bg-white border border-gray-300 rounded-md p-2 hover:bg-gray-100 transition-colors text-gray-700 font-medium",children:[e.files[0].fileName.toLowerCase().endsWith(".pdf")?(0,r.jsx)(o.Z,{className:"w-4 h-4 mr-2 text-red-500"}):(0,r.jsx)(x.Z,{className:"w-4 h-4 mr-2 text-blue-500"}),(0,r.jsx)("span",{className:"truncate",children:e.files[0].fileName})]}),(0,r.jsxs)("div",{className:"flex justify-between items-center pt-2 border-t text-xs text-gray-500",children:[(0,r.jsx)("span",{className:"px-2 py-1 bg-green-100 text-green-800 rounded font-medium",children:f.NK[e.status]||e.status}),(0,r.jsx)("span",{children:j(e.updatedAt)})]})]},e.id)))}):(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,r.jsx)("thead",{className:"bg-gray-50",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"\u0e40\u0e25\u0e02\u0e17\u0e35\u0e48\u0e40\u0e2d\u0e01\u0e2a\u0e32\u0e23"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"\u0e2b\u0e31\u0e27\u0e02\u0e49\u0e2d\u0e40\u0e23\u0e37\u0e48\u0e2d\u0e07"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"\u0e44\u0e1f\u0e25\u0e4c\u0e41\u0e19\u0e1a"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"\u0e2a\u0e16\u0e32\u0e19\u0e30"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"\u0e27\u0e31\u0e19\u0e17\u0e35\u0e48\u0e2d\u0e19\u0e38\u0e21\u0e31\u0e15\u0e34"})]})}),(0,r.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:Z.map((e=>(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-800",children:e.documentNumber}),(0,r.jsx)("td",{className:"px-6 py-4 text-sm text-gray-700",children:e.title}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:e.files&&e.files.length>0?(0,r.jsxs)("button",{onClick:()=>F(e.files[0]),className:"flex items-center text-blue-600 hover:text-blue-800 hover:underline",title:e.files[0].fileName,children:[(0,r.jsx)(m.Z,{className:"w-4 h-4 mr-2 flex-shrink-0"}),(0,r.jsx)("span",{className:"truncate max-w-[250px]",children:e.files[0].fileName})]}):(0,r.jsx)("span",{className:"text-gray-400",children:"-"})}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:(0,r.jsx)("span",{className:"px-2 py-1 bg-green-100 text-green-800 rounded font-medium",children:f.NK[e.status]||e.status})}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:j(e.updatedAt)})]},e.id)))})]})})})]}),(0,r.jsx)(h.Z,{isOpen:!!T,file:T,onClose:()=>R(null),allowEdit:!1})]})}function y(){return(0,r.jsx)("div",{className:"h-full flex flex-col",children:(0,r.jsx)(N,{})})}function v(){return(0,r.jsx)(l.AuthGuard,{children:(0,r.jsx)(a.Suspense,{fallback:(0,r.jsx)("div",{className:"p-8 text-center",children:"Loading Dashboard..."}),children:(0,r.jsx)(y,{})})})}},20731:function(e,s,t){"use strict";t.d(s,{AuthGuard:function(){return d}});var r=t(57437),a=t(47649),l=t(99376),n=t(2265);t(453);const i=()=>(0,r.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,r.jsxs)("div",{className:"animate-pulse",children:[(0,r.jsx)("div",{className:"bg-white shadow",children:(0,r.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,r.jsxs)("div",{className:"flex justify-between items-center py-6",children:[(0,r.jsx)("div",{className:"h-8 bg-gray-200 rounded w-32"}),(0,r.jsx)("div",{className:"h-8 bg-gray-200 rounded w-24"})]})})}),(0,r.jsxs)("div",{className:"flex",children:[(0,r.jsx)("div",{className:"w-64 bg-white border-r border-gray-200 min-h-screen",children:(0,r.jsx)("div",{className:"p-4 space-y-3",children:[...Array(6)].map(((e,s)=>(0,r.jsx)("div",{className:"h-10 bg-gray-100 rounded"},s)))})}),(0,r.jsx)("div",{className:"flex-1 p-8",children:(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)("div",{className:"h-8 bg-gray-200 rounded w-1/3"}),(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[...Array(3)].map(((e,s)=>(0,r.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow",children:[(0,r.jsx)("div",{className:"h-4 bg-gray-200 rounded mb-2"}),(0,r.jsx)("div",{className:"h-8 bg-gray-200 rounded mb-4"}),(0,r.jsx)("div",{className:"h-4 bg-gray-200 rounded w-2/3"})]},s)))})]})})]})]})});function d(e){let{children:s,requiredRoles:t=[],requiredSiteAccess:d=[],fallback:c,redirectTo:o="/login"}=e;const{user:x,loading:m,error:u}=(0,a.a)(),h=(0,l.useRouter)();if((0,n.useEffect)((()=>{m||x||h.push(o)}),[x,m,h,o]),m)return(0,r.jsx)(i,{});if(u)return(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,r.jsx)("div",{className:"text-center max-w-md mx-auto",children:(0,r.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold text-red-800 mb-2",children:"\u0e40\u0e01\u0e34\u0e14\u0e02\u0e49\u0e2d\u0e1c\u0e34\u0e14\u0e1e\u0e25\u0e32\u0e14"}),(0,r.jsx)("p",{className:"text-red-600 mb-4",children:u}),(0,r.jsx)("button",{onClick:()=>window.location.reload(),className:"bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 transition-colors",children:"\u0e25\u0e2d\u0e07\u0e43\u0e2b\u0e21\u0e48"})]})})});if(!x)return c?(0,r.jsx)(r.Fragment,{children:c}):(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold text-gray-800 mb-2",children:"\u0e01\u0e23\u0e38\u0e13\u0e32\u0e40\u0e02\u0e49\u0e32\u0e2a\u0e39\u0e48\u0e23\u0e30\u0e1a\u0e1a"}),(0,r.jsx)("p",{className:"text-gray-600 mb-4",children:"\u0e04\u0e38\u0e13\u0e15\u0e49\u0e2d\u0e07\u0e40\u0e02\u0e49\u0e32\u0e2a\u0e39\u0e48\u0e23\u0e30\u0e1a\u0e1a\u0e40\u0e1e\u0e37\u0e48\u0e2d\u0e40\u0e02\u0e49\u0e32\u0e16\u0e36\u0e07\u0e2b\u0e19\u0e49\u0e32\u0e19\u0e35\u0e49"}),(0,r.jsx)("button",{onClick:()=>h.push(o),className:"bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 transition-colors",children:"\u0e40\u0e02\u0e49\u0e32\u0e2a\u0e39\u0e48\u0e23\u0e30\u0e1a\u0e1a"})]})});if(t.length>0){if(!t.includes(x.role))return(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,r.jsx)("div",{className:"text-center max-w-md mx-auto",children:(0,r.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-6",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold text-yellow-800 mb-2",children:"\u0e44\u0e21\u0e48\u0e21\u0e35\u0e2a\u0e34\u0e17\u0e18\u0e34\u0e4c\u0e40\u0e02\u0e49\u0e32\u0e16\u0e36\u0e07"}),(0,r.jsx)("p",{className:"text-yellow-700 mb-2",children:"\u0e04\u0e38\u0e13\u0e44\u0e21\u0e48\u0e21\u0e35\u0e2a\u0e34\u0e17\u0e18\u0e34\u0e4c\u0e40\u0e02\u0e49\u0e32\u0e16\u0e36\u0e07\u0e2b\u0e19\u0e49\u0e32\u0e19\u0e35\u0e49"}),(0,r.jsxs)("p",{className:"text-sm text-yellow-600 mb-4",children:["\u0e15\u0e49\u0e2d\u0e07\u0e01\u0e32\u0e23\u0e2a\u0e34\u0e17\u0e18\u0e34\u0e4c: ",t.join(", ")," | \u0e2a\u0e34\u0e17\u0e18\u0e34\u0e4c\u0e1b\u0e31\u0e08\u0e08\u0e38\u0e1a\u0e31\u0e19: ",x.role]}),(0,r.jsx)("button",{onClick:()=>h.back(),className:"bg-yellow-600 text-white px-4 py-2 rounded hover:bg-yellow-700 transition-colors",children:"\u0e22\u0e49\u0e2d\u0e19\u0e01\u0e25\u0e31\u0e1a"})]})})})}if(d.length>0&&"Admin"!==x.role){if(!d.some((e=>{var s;return null===(s=x.sites)||void 0===s?void 0:s.includes(e)})))return(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,r.jsx)("div",{className:"text-center max-w-md mx-auto",children:(0,r.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold text-red-800 mb-2",children:"\u0e44\u0e21\u0e48\u0e21\u0e35\u0e2a\u0e34\u0e17\u0e18\u0e34\u0e4c\u0e40\u0e02\u0e49\u0e32\u0e16\u0e36\u0e07\u0e42\u0e04\u0e23\u0e07\u0e01\u0e32\u0e23"}),(0,r.jsx)("p",{className:"text-red-600 mb-4",children:"\u0e04\u0e38\u0e13\u0e44\u0e21\u0e48\u0e21\u0e35\u0e2a\u0e34\u0e17\u0e18\u0e34\u0e4c\u0e40\u0e02\u0e49\u0e32\u0e16\u0e36\u0e07\u0e42\u0e04\u0e23\u0e07\u0e01\u0e32\u0e23\u0e17\u0e35\u0e48\u0e15\u0e49\u0e2d\u0e07\u0e01\u0e32\u0e23"}),(0,r.jsx)("button",{onClick:()=>h.back(),className:"bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 transition-colors",children:"\u0e22\u0e49\u0e2d\u0e19\u0e01\u0e25\u0e31\u0e1a"})]})})})}return(0,r.jsx)(r.Fragment,{children:s})}}},function(e){e.O(0,[609,15,788,134,246,649,552,971,997,744],(function(){return s=93529,e(e.s=s);var s}));var s=e.O();_N_E=s}]);