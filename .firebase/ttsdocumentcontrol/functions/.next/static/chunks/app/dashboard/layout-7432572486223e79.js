(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[663],{49:function(e,t,n){Promise.resolve().then(n.bind(n,7123))},7123:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return i}});var r=n(7437),u=n(2265),E=n(1313);function i(e){let{children:t}=e;return(0,r.jsx)(u.Suspense,{fallback:(0,r.jsx)("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}),children:(0,r.jsx)(E.Z,{children:t})})}},7649:function(e,t,n){"use strict";n.d(t,{AuthProvider:function(){return s},aC:function(){return c}});var r=n(7437),u=n(2265),E=n(2148),i=n(5978),l=n(6855);let a=null,o=(0,u.createContext)({user:null,firebaseUser:null,loading:!0,error:null,refetch:async()=>{},logout:async()=>{}});function s(e){let{children:t}=e,[n,s]=(0,u.useState)(null),[c,I]=(0,u.useState)(null),[d,P]=(0,u.useState)(!0),[D,N]=(0,u.useState)(null),R=async e=>{try{if(N(null),a&&a.firebaseUserId===e.uid&&Date.now()-a.timestamp<3e5){console.log("\uD83D\uDCCB Using cached user data for: ".concat(e.email)),I(a.user);return}console.log("\uD83D\uDD04 Fetching fresh user data for: ".concat(e.email));let r=(0,i.JU)(l.db,"users",e.uid),u=await (0,i.QT)(r);if(u.exists()){var t,n;let r=u.data(),E={id:e.uid,email:e.email||"",role:r.role,sites:r.sites||[],status:r.status||"ACTIVE",createdFromInvitation:r.createdFromInvitation,createdAt:null===(t=r.createdAt)||void 0===t?void 0:t.toDate(),acceptedAt:null===(n=r.acceptedAt)||void 0===n?void 0:n.toDate()};a={user:E,timestamp:Date.now(),firebaseUserId:e.uid},I(E)}else N("ไม่พบข้อมูลผู้ใช้ในระบบ"),I(null)}catch(e){console.error("Error fetching user data:",e),N("เกิดข้อผิดพลาดในการโหลดข้อมูลผู้ใช้"),I(null)}},_=async()=>{n&&(a=null,await R(n))};(0,u.useEffect)(()=>{let e=(0,E.Aj)(l.I,async e=>{(null==e?void 0:e.uid)===(null==n?void 0:n.uid)&&c||(P(!0),s(e),e?await R(e):(I(null),N(null),a=null),P(!1))});return()=>e()},[]);let f=async()=>{try{await (0,E.w7)(l.I),a=null,I(null),s(null),N(null)}catch(e){throw console.error("Logout error:",e),e}};return(0,r.jsx)(o.Provider,{value:{user:c,firebaseUser:n,loading:d,error:D,refetch:_,logout:f},children:t})}function c(){return(0,u.useContext)(o)}},453:function(e,t,n){"use strict";n.d(t,{K$:function(){return r},NK:function(){return a},gf:function(){return i},n$:function(){return l},oU:function(){return E},uc:function(){return u},yh:function(){return o}});let r={ADMIN:"Admin",BIM:"BIM",SITE_ADMIN:"Site Admin",CM:"CM",ME:"ME",SN:"SN",OE:"OE",PE:"PE",PM:"PM",SE:"SE",ADMIN_SITE_2:"Adminsite2"},u=[r.BIM,r.ME,r.SN],E=[r.SITE_ADMIN,r.ADMIN_SITE_2,r.OE,r.PE],i=[r.CM];r.PM,r.SE;let l={PENDING_REVIEW:"PENDING_REVIEW",PENDING_CM_APPROVAL:"PENDING_CM_APPROVAL",REVISION_REQUIRED:"REVISION_REQUIRED",APPROVED:"APPROVED",APPROVED_WITH_COMMENTS:"APPROVED_WITH_COMMENTS",APPROVED_REVISION_REQUIRED:"APPROVED_REVISION_REQUIRED",REJECTED:"REJECTED",PENDING_FINAL_APPROVAL:"PENDING_FINAL_APPROVAL"},a={[l.PENDING_REVIEW]:"รอตรวจสอบ",[l.PENDING_CM_APPROVAL]:"ส่ง CM",[l.REVISION_REQUIRED]:"แก้ไข",[l.APPROVED]:"อนุมัติ",[l.APPROVED_WITH_COMMENTS]:"อนุมัติตามคอมเมนต์ (ไม่แก้ไข)",[l.APPROVED_REVISION_REQUIRED]:"อนุมัติตามคอมเมนต์ (ต้องแก้ไข)",[l.REJECTED]:"ไม่อนุมัติ",[l.PENDING_FINAL_APPROVAL]:"รอ SITE อนุมัติขั้นสุดท้าย"},o={[l.PENDING_REVIEW]:"#0088FE",[l.PENDING_CM_APPROVAL]:"#00C49F",[l.REVISION_REQUIRED]:"#FFBB28",[l.APPROVED]:"#28A745",[l.REJECTED]:"#DC3545",[l.APPROVED_WITH_COMMENTS]:"#20C997",[l.APPROVED_REVISION_REQUIRED]:"#FD7E14"}},6855:function(e,t,n){"use strict";n.d(t,{I:function(){return l},db:function(){return a}});var r=n(738),u=n(2148),E=n(5978);let i=(0,r.C6)().length>0?(0,r.C6)()[0]:(0,r.ZF)({apiKey:"AIzaSyAsayb-DEOBE0zi0qh-dPBfihClgXrX1sY",authDomain:"ttsdocumentcontrol.firebaseapp.com",projectId:"ttsdocumentcontrol",storageBucket:"ttsdocumentcontrol.firebasestorage.app",messagingSenderId:"48440915675",appId:"1:48440915675:web:f11611895bfb52d4d27efe"}),l=(0,u.v0)(i),a=(0,E.ad)(i)}},function(e){e.O(0,[609,15,783,227,313,971,117,744],function(){return e(e.s=49)}),_N_E=e.O()}]);