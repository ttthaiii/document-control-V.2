(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[571],{1417:function(e,t,s){Promise.resolve().then(s.bind(s,9025))},9025:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return er}});var a=s(7437),l=s(2265),r=s(9376),i=s(7649),n=s(731),c=s(265),d=s(5051),o=s(8736),m=s(44),x=s(2720),u=s(2369),h=s(1047),f=s(1723),p=s(453),N=s(9761);let g=[p.n$.PENDING_REVIEW,p.n$.PENDING_CM_APPROVAL,p.n$.PENDING_FINAL_APPROVAL,p.n$.REVISION_REQUIRED,p.n$.APPROVED_REVISION_REQUIRED,p.n$.REJECTED],j=e=>{if(!e)return null;if("function"==typeof e.toDate)return e.toDate();if(e._seconds)return new Date(1e3*e._seconds);let t=new Date(e);return isNaN(t.getTime())?null:t};function y(e){let{documents:t,isLoading:s,onDocumentClick:r,getStatusColor:i,statusLabels:n,getRFATypeColor:y}=e,[b,v]=(0,l.useState)(!1),[E,w]=(0,l.useState)({key:"updatedAt",direction:"descending"});(0,l.useEffect)(()=>{let e=()=>v(window.innerWidth<=768);return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);let R=e=>{var t,s,a,l;switch(e.status){case p.n$.PENDING_REVIEW:case p.n$.PENDING_FINAL_APPROVAL:return{name:"Site",role:"Site"};case p.n$.PENDING_CM_APPROVAL:return{name:"CM",role:"CM"};case p.n$.REVISION_REQUIRED:case p.n$.APPROVED_REVISION_REQUIRED:return{name:(null===(t=e.createdByInfo)||void 0===t?void 0:t.role)||"Creator",role:(null===(s=e.createdByInfo)||void 0===s?void 0:s.role)||"Creator"};case p.n$.REJECTED:return e.isLatest?{name:(null===(a=e.createdByInfo)||void 0===a?void 0:a.role)||"Creator",role:(null===(l=e.createdByInfo)||void 0===l?void 0:l.role)||"Creator"}:{name:"เสร็จสิ้น",role:"Completed"};case p.n$.APPROVED:case p.n$.APPROVED_WITH_COMMENTS:return{name:"เสร็จสิ้น",role:"Completed"};default:return{name:"N/A",role:"N/A"}}},A=e=>{let t=j(e.updatedAt);if(!t)return 0;let s=new Date;s.setHours(0,0,0,0);let a=new Date(t);return a.setHours(0,0,0,0),Math.max(0,Math.floor((s.getTime()-a.getTime())/864e5))},I=(0,l.useMemo)(()=>{let e=[...t];return null!==E&&e.sort((e,t)=>{let s,a;let l=(e,t)=>t.split(".").reduce((e,t)=>e?e[t]:void 0,e);if("pendingDays"===E.key){let l=g.includes(e.status),r=g.includes(t.status);s=l?A(e):-1,a=r?A(t):-1}else if("responsibleParty"===E.key)s=R(e).name,a=R(t).name;else if("updatedAt"===E.key){var r,i;s=(null===(r=j(e.updatedAt))||void 0===r?void 0:r.getTime())||0,a=(null===(i=j(t.updatedAt))||void 0===i?void 0:i.getTime())||0}else s=l(e,E.key),a=l(t,E.key);return s<a?"ascending"===E.direction?-1:1:s>a?"ascending"===E.direction?1:-1:0}),e},[t,E]),P=e=>{let t="ascending";E&&E.key===e&&"ascending"===E.direction&&(t="descending"),w({key:e,direction:t})},C=e=>{let{columnKey:t}=e;return E&&E.key===t?(0,a.jsx)("span",{className:"ml-2",children:"ascending"===E.direction?(0,a.jsx)(c.Z,{size:14}):(0,a.jsx)(d.Z,{size:14})}):(0,a.jsx)("span",{className:"w-4 h-4 ml-2"})};if(s)return(0,a.jsx)("div",{className:"w-full h-96 flex justify-center items-center bg-white rounded-lg shadow",children:(0,a.jsx)(N.Z,{})});if(!I||0===I.length)return(0,a.jsxs)("div",{className:"w-full h-96 flex flex-col justify-center items-center bg-white rounded-lg shadow text-center",children:[(0,a.jsx)(o.Z,{className:"w-16 h-16 text-gray-300 mb-4"}),(0,a.jsx)("h3",{className:"text-xl font-semibold text-gray-700",children:"ไม่พบเอกสาร"}),(0,a.jsx)("p",{className:"text-gray-500 mt-1",children:"ลองเปลี่ยนตัวกรองหรือสร้างเอกสารใหม่"})]});let D=e=>{let t=j(e);return t?t.toLocaleDateString("th-TH",{day:"2-digit",month:"2-digit",year:"numeric"}):"Invalid Date"};return b?(0,a.jsx)("div",{className:"space-y-4",children:t.map(e=>{var t,s;let l=R(e),c=A(e);return(0,a.jsxs)("div",{onClick:()=>r(e),className:"bg-white rounded-lg shadow border p-4 cursor-pointer",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 mb-1",children:[(0,a.jsx)("span",{className:"inline-flex px-2 py-1 rounded-full text-xs font-medium ".concat(y(e.rfaType)),children:e.rfaType}),(0,a.jsxs)("span",{className:"inline-flex items-center px-2 py-1 bg-gray-200 text-gray-800 rounded-full text-xs font-semibold",children:["REV-",String(e.revisionNumber).padStart(2,"0")]})]}),(0,a.jsx)("h3",{className:"font-medium text-gray-900 text-sm mb-1 truncate",children:e.documentNumber}),(0,a.jsx)("p",{className:"text-sm text-gray-600 line-clamp-2",children:e.title})]}),(0,a.jsx)("div",{className:"flex flex-col items-end space-y-1 flex-shrink-0 ml-2",children:(0,a.jsx)("span",{className:"inline-flex items-center justify-center px-2 py-1 rounded-full text-xs font-medium ".concat(i(e.status)),children:n[e.status]||e.status})})]}),(0,a.jsxs)("div",{className:"space-y-2 text-xs text-gray-600",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(m.Z,{className:"w-3 h-3 mr-2"}),(0,a.jsx)("span",{children:(null===(t=e.site)||void 0===t?void 0:t.name)||"N/A"})]}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(x.Z,{className:"w-3 h-3 mr-2"}),(0,a.jsx)("span",{children:(null===(s=e.category)||void 0===s?void 0:s.categoryCode)||"N/A"})]}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(u.Z,{className:"w-3 h-3 mr-2"}),(0,a.jsxs)("span",{children:["ผู้รับผิดชอบ: ",l.name]})]}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(h.Z,{className:"w-3 h-3 mr-2"}),(0,a.jsxs)("span",{children:["อัปเดต: ",D(e.updatedAt)]})]}),g.includes(e.status)&&c>0&&(0,a.jsxs)("div",{className:"flex items-center text-orange-600",children:[(0,a.jsx)(f.Z,{className:"w-3 h-3 mr-2"}),(0,a.jsxs)("span",{children:["ค้างดำเนินการ: ",c," วัน"]})]})]})]},e.id)})}):(0,a.jsx)("div",{className:"sticky top-16 bg-white rounded-lg shadow overflow-hidden h-[calc(100vh-12rem)] flex flex-col",children:(0,a.jsx)("div",{className:"overflow-auto flex-1",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50 sticky top-0 z-10",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:(0,a.jsxs)("button",{onClick:()=>P("runningNumber"),className:"flex items-center justify-center w-full",children:["System No. ",(0,a.jsx)(C,{columnKey:"runningNumber"})]})}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:(0,a.jsxs)("button",{onClick:()=>P("site.name"),className:"flex items-center w-full",children:["โครงการ ",(0,a.jsx)(C,{columnKey:"site.name"})]})}),(0,a.jsx)("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:(0,a.jsxs)("button",{onClick:()=>P("category.categoryCode"),className:"flex items-center justify-center w-full",children:["หมวดหมู่ ",(0,a.jsx)(C,{columnKey:"category.categoryCode"})]})}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"เอกสาร"}),(0,a.jsx)("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Rev."}),(0,a.jsx)("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider bg-gray-50",children:(0,a.jsxs)("button",{onClick:()=>P("pendingDays"),className:"flex items-center justify-center w-full",children:["สถานะ ",(0,a.jsx)(C,{columnKey:"pendingDays"})]})}),(0,a.jsx)("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:(0,a.jsxs)("button",{onClick:()=>P("responsibleParty"),className:"flex items-center justify-center w-full",children:["ผู้รับผิดชอบ ",(0,a.jsx)(C,{columnKey:"responsibleParty"})]})}),(0,a.jsx)("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:(0,a.jsxs)("button",{onClick:()=>P("updatedAt"),className:"flex items-center justify-center w-full",children:["วันที่อัปเดตล่าสุด ",(0,a.jsx)(C,{columnKey:"updatedAt"})]})})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:I.map(e=>{var t,s;let l=R(e),c=A(e);return(0,a.jsxs)("tr",{className:"hover:bg-gray-50 cursor-pointer",onClick:()=>r(e),children:[(0,a.jsx)("td",{className:"px-6 py-4",children:(0,a.jsx)("p",{className:"text-sm font-semibold text-blue-600 text-center",children:e.runningNumber||"N/A"})}),(0,a.jsx)("td",{className:"px-6 py-4",children:(0,a.jsx)("p",{className:"text-sm text-gray-800",children:(null===(t=e.site)||void 0===t?void 0:t.name)||"N/A"})}),(0,a.jsx)("td",{className:"px-6 py-4",children:(0,a.jsx)("div",{className:"text-sm",children:(0,a.jsx)("p",{className:"text-gray-600 text-center",children:(null===(s=e.category)||void 0===s?void 0:s.categoryCode)||"N/A"})})}),(0,a.jsx)("td",{className:"px-6 py-4",children:(0,a.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900 truncate",children:e.documentNumber}),(0,a.jsx)("p",{className:"text-sm text-gray-600 line-clamp-2",children:e.title})]})}),(0,a.jsx)("td",{className:"px-4 py-4 text-center",children:(0,a.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-semibold bg-gray-200 text-gray-800",children:String(e.revisionNumber).padStart(2,"0")})}),(0,a.jsx)("td",{className:"px-6 py-4",children:(0,a.jsxs)("div",{className:"flex flex-col space-y-1 items-center",children:[(0,a.jsx)("span",{className:"inline-flex items-center justify-center px-2 py-1 rounded-full text-xs font-medium ".concat(i(e.status)),children:n[e.status]||e.status}),g.includes(e.status)&&c>0&&(0,a.jsx)("span",{className:"text-xs text-orange-600 text-center",children:"ค้าง ".concat(c," วัน")})]})}),(0,a.jsx)("td",{className:"px-6 py-4 text-center",children:(0,a.jsxs)("div",{className:"flex items-center justify-center",children:[(0,a.jsx)(u.Z,{className:"w-4 h-4 text-gray-400 mr-2"}),(0,a.jsx)("div",{className:"text-sm",children:(0,a.jsx)("p",{className:"text-gray-900",children:l.name})})]})}),(0,a.jsx)("td",{className:"px-6 py-4",children:(0,a.jsx)("div",{className:"text-sm text-gray-600 text-center",children:(0,a.jsx)("span",{children:D(e.updatedAt)})})})]},e.id)})})]})})})}var b=s(1211),v=s(2663),E=s(3862),w=s(407),R=s(8155),A=s(3250);let I=e=>{let{active:t,payload:s}=e;if(t&&s&&s.length){let e=s[0];return(0,a.jsx)("div",{className:"p-3 bg-white/90 backdrop-blur-sm shadow-lg rounded-lg border border-gray-200",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{style:{width:12,height:12,backgroundColor:e.payload.color,marginRight:8,borderRadius:"50%"}}),(0,a.jsx)("p",{className:"text-sm text-gray-700",children:"".concat(e.name,": ").concat(e.value)})]})})}return null},P=["#0088FE","#00C49F","#FFBB28","#FF8042","#AF19FF","#FF6363","#BC5090"],C=e=>{let t=0;for(let s=0;s<e.length;s++)t=e.charCodeAt(s)+((t<<5)-t);let s=Math.abs(t%P.length);return P[s]};var D=e=>{let{allDocuments:t,onChartFilter:s,activeFilters:r,categories:i}=e,[n,c]=(0,l.useState)(!1);(0,l.useEffect)(()=>{let e=()=>c(window.innerWidth<768);return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);let d=(0,l.useMemo)(()=>{let e={},s={};for(let l of t){var a;e[l.status]=(e[l.status]||0)+1;let t=(null===(a=l.category)||void 0===a?void 0:a.id)||"N/A";"N/A"!==t&&(s[t]=(s[t]||0)+1)}return{statusCounts:e,categoryCounts:s}},[t]),o=(0,l.useMemo)(()=>d?Object.entries(d.statusCounts).map(e=>{let[t,s]=e,a=p.NK[t],l=p.yh[t];return a&&l?{name:a,value:s,statusKey:t,color:l}:null}).filter(e=>null!==e&&e.value>0):[],[d]),m=(0,l.useMemo)(()=>d?Object.entries(d.categoryCounts).map(e=>{let[t,s]=e,a=i.find(e=>e.id===t);return{id:t,name:(null==a?void 0:a.categoryCode)||t,value:s,color:C((null==a?void 0:a.categoryCode)||t)}}).filter(e=>e.value>0):[],[d,i]),{displayData:x,total:u}=(0,l.useMemo)(()=>{let e=o.reduce((e,t)=>e+t.value,0);return{displayData:o,total:e}},[o]),{displayData:h,total:f}=(0,l.useMemo)(()=>{let e=m.reduce((e,t)=>e+t.value,0);return{displayData:m,total:e}},[m]);if(0===t.length)return(0,a.jsx)("div",{className:"text-center p-8 text-gray-500",children:"ไม่มีข้อมูลสำหรับแสดงผล"});let N=e=>{var t;let a=(null===(t=e.payload)||void 0===t?void 0:t.statusKey)||e.statusKey;a&&s("status",r.status===a?"ALL":a)},g=e=>{var t;let a=(null===(t=e.payload)||void 0===t?void 0:t.id)||e.id;a&&s("categoryId",r.categoryId===a?"ALL":a)},j=n?"50%":"40%",y=n?"50%":"30%",P=n?"45%":"50%";return(0,a.jsxs)("div",{className:"relative grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[(0,a.jsx)("div",{children:(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4 text-center",children:"สถานะตามผู้รับผิดชอบ"}),(0,a.jsxs)("div",{className:"relative w-full h-[300px]",children:[(0,a.jsx)(b.h,{children:(0,a.jsxs)(v.u,{children:[(0,a.jsx)(E.b,{data:x,isAnimationActive:!1,cx:j,cy:"50%",innerRadius:n?80:115,outerRadius:n?110:150,dataKey:"value",nameKey:"name",onClick:N,className:"cursor-pointer",children:x.map(e=>(0,a.jsx)(w.b,{fill:e.color,style:{opacity:"ALL"===r.status||r.status===e.statusKey?1:.3}},"cell-".concat(e.name)))}),(0,a.jsx)(R.u,{content:(0,a.jsx)(I,{})}),(0,a.jsx)(A.D,{iconType:"circle",onClick:N,layout:n?"horizontal":"vertical",verticalAlign:n?"bottom":"middle",align:n?"center":"right",wrapperStyle:n?{paddingTop:"20px"}:{},width:n?void 0:150,className:"cursor-pointer"})]})}),(0,a.jsxs)("div",{className:"absolute -translate-y-1/2 -translate-x-1/2 flex flex-col items-center justify-center pointer-events-none",style:{top:P,left:y},children:[(0,a.jsx)("span",{className:"text-base text-gray-500",children:"จำนวนเอกสาร"}),(0,a.jsx)("span",{className:"text-4xl font-bold text-gray-800 mt-1",children:u})]})]})]})}),(0,a.jsx)("div",{children:(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4 text-center",children:"สถานะตามหมวดหมู่"}),(0,a.jsxs)("div",{className:"relative w-full h-[300px]",children:[(0,a.jsx)(b.h,{children:(0,a.jsxs)(v.u,{children:[(0,a.jsx)(E.b,{data:h,isAnimationActive:!1,cx:j,cy:"50%",innerRadius:n?80:115,outerRadius:n?110:150,dataKey:"value",nameKey:"name",onClick:g,className:"cursor-pointer",children:h.map(e=>(0,a.jsx)(w.b,{fill:e.color,style:{opacity:"ALL"===r.categoryId||r.categoryId===e.id?1:.3}},"cell-".concat(e.name)))}),(0,a.jsx)(R.u,{content:(0,a.jsx)(I,{})}),(0,a.jsx)(A.D,{iconType:"circle",onClick:g,layout:n?"horizontal":"vertical",verticalAlign:n?"bottom":"middle",align:n?"center":"right",wrapperStyle:n?{paddingTop:"20px"}:{},width:n?void 0:150,className:"cursor-pointer"})]})}),(0,a.jsxs)("div",{className:"absolute -translate-y-1/2 -translate-x-1/2 flex flex-col items-center justify-center pointer-events-none",style:{top:P,left:y},children:[(0,a.jsx)("span",{className:"text-base text-gray-500",children:"จำนวนเอกสาร"}),(0,a.jsx)("span",{className:"text-4xl font-bold text-gray-800 mt-1",children:f})]})]})]})})]})},_=s(3900),S=s(7168),T=s(9397),M=s(5978),k=s(6855),O=s(5621),F=s(2489),L=s(6980),V=s(6865),K=s(7689),$=s(401),Z=s(2207),B=s(4743),z=s(7157),W=s(3417),G=s(1810),U=s(7576),Q=s(4001);let J=e=>e?new Date(e).toLocaleString("th-TH",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A",H=e=>{if(0===e)return"0 B";let t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(1))+" "+["B","KB","MB","GB"][t]},Y=e=>{let{workflow:t,onClose:s,userRole:r}=e,i=(0,l.useMemo)(()=>{if(r&&p.gf.includes(r)){let e=[p.n$.PENDING_REVIEW,p.n$.REVISION_REQUIRED];return t.filter(t=>!e.includes(t.status))}return t},[t,r]);return(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-60 z-[60] flex items-center justify-center p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[80vh] flex flex-col",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center p-4 border-b",children:[(0,a.jsxs)("h3",{className:"text-lg font-bold text-gray-800 flex items-center",children:[(0,a.jsx)(O.Z,{size:20,className:"mr-2"}),"ประวัติการดำเนินงาน"]}),(0,a.jsx)("button",{onClick:s,className:"text-gray-400 hover:text-gray-600",children:(0,a.jsx)(F.Z,{size:24})})]}),(0,a.jsx)("div",{className:"p-6 overflow-y-auto",children:(0,a.jsx)("div",{className:"border-l-2 border-gray-200 ml-2",children:i.length>0?i.map((e,t)=>(0,a.jsxs)("div",{className:"relative pl-6 pb-8 last:pb-0",children:[(0,a.jsx)("div",{className:"absolute -left-[9px] top-1 w-4 h-4 bg-blue-500 rounded-full border-2 border-white"}),(0,a.jsx)("p",{className:"font-semibold text-gray-800",children:p.NK[e.status]||e.status}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:["โดย: ",e.userName," (",e.role,")"]}),(0,a.jsx)("time",{className:"text-xs text-gray-400",children:J(e.timestamp)}),e.comments&&(0,a.jsx)("div",{className:"mt-2 p-2 bg-gray-50 rounded-md text-xs italic",children:(0,a.jsxs)("p",{className:"text-gray-600",children:['"',e.comments,'"']})}),e.files&&e.files.length>0&&(0,a.jsxs)("div",{className:"mt-2 pl-2 border-l-2 border-gray-100",children:[(0,a.jsx)("p",{className:"text-xs font-semibold text-gray-500 mb-1",children:"ไฟล์แนบ ณ ขั้นตอนนี้:"}),(0,a.jsx)("ul",{className:"space-y-1",children:e.files.map((e,t)=>(0,a.jsxs)("li",{className:"flex items-center text-xs text-gray-600",children:[(0,a.jsx)(o.Z,{size:12,className:"mr-2 flex-shrink-0"}),(0,a.jsx)("a",{href:e.fileUrl,target:"_blank",rel:"noopener noreferrer",className:"truncate hover:underline",title:e.fileName,children:e.fileName})]},t))})]})]},t)):(0,a.jsx)("p",{className:"text-sm text-gray-500 pl-6",children:"ไม่มีประวัติ"})})})]})})};function q(e){var t;let{document:s,onClose:r,onUpdate:n,showOverlay:c=!0}=e,{user:d,firebaseUser:m}=(0,i.a)(),{showNotification:x}=(0,Q.l)(),[u,h]=(0,l.useState)(s),[f,g]=(0,l.useState)(!0),[j,y]=(0,l.useState)(!1),[b,v]=(0,l.useState)(!1),[E,w]=(0,l.useState)(""),[R,A]=(0,l.useState)([]),[I,P]=(0,l.useState)(""),[C,D]=(0,l.useState)([]),[_,S]=(0,l.useState)(null),[T,M]=(0,l.useState)(!1),[k,J]=(0,l.useState)(!1),[q,X]=(0,l.useState)(null),[ee,et]=(0,l.useState)(null),[es,ea]=(0,l.useState)("");(0,l.useEffect)(()=>{(async()=>{if(!s||!m){g(!1);return}g(!0);try{let e=await m.getIdToken(),t=await fetch("/api/rfa/".concat(s.id),{headers:{Authorization:"Bearer ".concat(e)}}),a=await t.json();a.success?h(a.document):h(s)}catch(e){h(s)}finally{g(!1)}})()},[s,m]);let el=(0,l.useMemo)(()=>{if(!u)return[];if(!u.workflow||0===u.workflow.length)return u.files||[];let e=[...u.workflow].reverse().find(e=>e.files&&e.files.length>0);return(null==e?void 0:e.files)||u.files||[]},[u]),er=(0,l.useMemo)(()=>(null==u?void 0:u.workflow)&&0!==u.workflow.length?[...u.workflow].reverse().find(e=>e.comments&&""!==e.comments.trim()):null,[null==u?void 0:u.workflow]),ei=(null==u?void 0:u.createdBy)===(null==d?void 0:d.id),en=(null==u?void 0:u.status)===p.n$.REJECTED&&ei&&(null==u?void 0:u.isLatest);if((0,l.useEffect)(()=>{en&&(null==u?void 0:u.creatorRole)==="BIM"&&m&&u&&(async()=>{var e,t;if(!(null===(e=u.site)||void 0===e?void 0:e.name)||!u.documentNumber||!(null===(t=u.taskData)||void 0===t?void 0:t.taskName)){X("ข้อมูลเอกสารไม่สมบูรณ์ ไม่สามารถตรวจสอบ Task ได้");return}M(!0),J(!1),X(null),et(null);try{let e=await m.getIdToken(),t=(u.revisionNumber||0)+1,s=await fetch("/api/bim-tracking/verify-task",{method:"POST",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"},body:JSON.stringify({documentNumber:u.documentNumber.split("-REV")[0],projectName:u.site.name,rev:t,taskName:u.taskData.taskName})}),a=await s.json();if(s.ok&&a.success)a.exists?(J(!0),et(a.taskId)):X("กรุณาสร้าง Task สำหรับ Revision นี้ในระบบ BIM Tracking ก่อน");else throw Error(a.error||"ไม่สามารถตรวจสอบ Task ได้")}catch(e){X(e.message)}finally{M(!1)}})()},[en,u,m]),f)return(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center",children:(0,a.jsx)(N.Z,{className:"h-12 w-12 text-white"})});if(!u)return null;let ec=u.permissions||{},ed=u.status===p.n$.REVISION_REQUIRED&&ei,eo=(u.revisionNumber||0)+1,em="".concat(u.documentNumber.split("-REV")[0],"-REV").concat(String(eo).padStart(2,"0")),ex=(null==er?void 0:er.comments)||u.description,eu=async e=>{try{if(!m)throw Error("กรุณาล็อกอินก่อนอัปโหลดไฟล์");let t=await m.getIdToken(),s=new FormData;s.append("file",e);let a=await fetch("/api/rfa/upload-temp-file",{method:"POST",headers:{Authorization:"Bearer ".concat(t)},body:s}),l=await a.json();if(l.success)return{status:"success",progress:100,uploadedData:l.fileData};throw Error(l.error||"อัปโหลดล้มเหลว")}catch(e){return{status:"error",error:e instanceof Error?e.message:"เกิดข้อผิดพลาด"}}},eh=(e,t)=>{let s=Array.from(e.target.files||[]);if(!s.length)return;let a=s.map(e=>({id:"".concat(e.name,"-").concat(Date.now()),file:e,status:"pending",progress:0})),l="revision"===t?D:A;l(e=>[...e,...a]),a.forEach(async e=>{l(t=>t.map(t=>t.id===e.id?{...t,status:"uploading"}:t));let t=await eu(e.file);l(s=>s.map(s=>s.id===e.id?{...s,...t}:s))}),e.target.value=""},ef=async(e,t)=>{var s;let a=("revision"===t?C:R)[e];if("success"===a.status&&(null===(s=a.uploadedData)||void 0===s?void 0:s.filePath))try{let e=await (null==m?void 0:m.getIdToken());await fetch("/api/rfa/delete-temp-file",{method:"POST",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"},body:JSON.stringify({filePath:a.uploadedData.filePath})})}catch(e){console.error("Failed to delete temp file:",e)}("revision"===t?D:A)(t=>t.filter((t,s)=>s!==e))},ep=async e=>{if(["REQUEST_REVISION","SEND_TO_CM","SUBMIT_REVISION"].includes(e)&&0===R.filter(e=>"success"===e.status).length){alert("กรุณาแนบไฟล์ประกอบการดำเนินการ");return}y(!0);try{let t=await (null==m?void 0:m.getIdToken()),s={action:e,comments:E,newFiles:R.filter(e=>"success"===e.status).map(e=>e.uploadedData)};ew&&es.trim()&&(s.documentNumber=es.trim());let a=await fetch("/api/rfa/".concat(u.id),{method:"PUT",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"},body:JSON.stringify(s)}),l=await a.json();if(l.success)x("success","ดำเนินการสำเร็จ!",l.message),r();else throw Error(l.error||"เกิดข้อผิดพลาด")}catch(e){x("error","เกิดข้อผิดพลาด",e instanceof Error?e.message:"Unknown error")}finally{y(!1)}},eN=async()=>{let e=C.filter(e=>"success"===e.status);if(0===e.length){alert("กรุณาแนบไฟล์ฉบับแก้ไขอย่างน้อย 1 ไฟล์");return}y(!0);try{let t=await (null==m?void 0:m.getIdToken()),s={originalDocId:u.id,uploadedFiles:e.map(e=>e.uploadedData),comments:I,verifiedTaskId:ee},a=await fetch("/api/rfa/create_revision",{method:"POST",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"},body:JSON.stringify(s)}),l=await a.json();if(l.success)x("success","สร้าง Revision สำเร็จ!","เอกสารฉบับใหม่ ".concat(em," ถูกสร้างแล้ว")),r();else throw Error(l.error||"เกิดข้อผิดพลาดในการสร้าง Revision")}catch(e){x("error","เกิดข้อผิดพลาด",e instanceof Error?e.message:"Unknown error")}finally{y(!1)}},eg=async()=>{await ep("SUBMIT_REVISION")},{role:ej}=d||{},{status:ey}=u,eb=p.oU.includes(ej)&&ey===p.n$.PENDING_REVIEW,ev=ec.canApprove,eE=j||0===R.filter(e=>"success"===e.status).length,ew=eb&&!u.documentNumber;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 ".concat(c?"bg-black bg-opacity-50":""),children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] flex flex-col",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start p-4 border-b",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-baseline space-x-3",children:[(0,a.jsx)("h3",{className:"text-lg font-bold text-blue-600",children:u.documentNumber}),(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-800",children:u.title})]}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:u.runningNumber||"RFA Document"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsxs)("button",{onClick:()=>v(!0),className:"flex items-center text-sm text-gray-500 hover:text-blue-600",children:[(0,a.jsx)(O.Z,{size:16,className:"mr-1"})," ดูประวัติ"]}),(0,a.jsx)("button",{onClick:r,className:"text-gray-400 hover:text-gray-600",children:(0,a.jsx)(F.Z,{size:24})})]})]}),(0,a.jsxs)("div",{className:"p-6 overflow-y-auto space-y-6",children:[(0,a.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{className:"text-gray-500 block mb-1",children:"สถานะ:"}),(0,a.jsx)("span",{className:"px-3 py-1 text-xs font-bold text-white rounded-full",style:{backgroundColor:p.yh[u.status]||"#6c757d"},children:p.NK[u.status]||u.status})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{className:"text-gray-500 block",children:"หมวดงาน:"}),(0,a.jsx)("span",{children:u.category.categoryCode})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{className:"text-gray-500 block",children:"โครงการ:"}),(0,a.jsx)("span",{children:(null===(t=u.site)||void 0===t?void 0:t.name)||"N/A"})]})]}),ex&&""!==ex.trim()&&(0,a.jsxs)("div",{className:"mt-4",children:[(0,a.jsxs)("strong",{className:"text-gray-500 block text-sm",children:[er?"ความคิดเห็นล่าสุด":"รายละเอียดเพิ่มเติม",":"]}),(0,a.jsx)("div",{className:"text-gray-700 whitespace-pre-wrap bg-white p-3 rounded-md mt-1 border",children:(0,a.jsxs)("p",{className:"italic",children:['"',ex,'"']})})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("h4",{className:"text-md font-semibold mb-2 flex items-center text-slate-800",children:[(0,a.jsx)(L.Z,{size:16,className:"mr-2"})," ไฟล์แนบ (ฉบับล่าสุด)"]}),(0,a.jsx)("ul",{className:"space-y-2",children:el.length>0?el.map((e,t)=>{let s="application/pdf"===e.contentType||e.fileName.toLowerCase().endsWith(".pdf"),l=()=>(0,a.jsxs)("div",{className:"flex items-center min-w-0",children:[(0,a.jsx)(o.Z,{className:"w-5 h-5 text-gray-500 mr-3 flex-shrink-0"}),(0,a.jsxs)("div",{className:"flex flex-col min-w-0",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-blue-600 group-hover:text-blue-800 group-hover:underline truncate",children:e.fileName}),(0,a.jsx)("span",{className:"text-xs text-gray-500",children:H(e.fileSize)})]})]});return(0,a.jsx)("li",{className:"bg-slate-50 border border-slate-200 rounded-md",children:s?(0,a.jsx)("button",{onClick:()=>S(e),className:"w-full text-left p-2 rounded-md hover:bg-blue-100 group transition-colors duration-200",title:"ดูตัวอย่างไฟล์ ".concat(e.fileName),children:(0,a.jsx)(l,{})}):(0,a.jsx)("a",{href:e.fileUrl,download:e.fileName,target:"_blank",rel:"noopener noreferrer",className:"w-full text-left p-2 rounded-md hover:bg-blue-100 group transition-colors duration-200 flex",title:"ดาวน์โหลด ".concat(e.fileName),children:(0,a.jsx)(l,{})})},t)}):(0,a.jsx)("p",{className:"text-sm text-slate-500",children:"ไม่มีไฟล์แนบในฉบับล่าสุด"})})]})]}),(0,a.jsxs)("div",{className:"p-4 border-t bg-slate-50",children:[eb&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h3",{className:"text-lg font-bold text-slate-800",children:"ดำเนินการ (Site)"}),ew&&(0,a.jsxs)("div",{className:"p-4 bg-yellow-50 border-l-4 border-yellow-400",children:[(0,a.jsxs)("label",{className:"text-sm font-bold text-yellow-800 mb-2 block",children:[(0,a.jsx)(V.Z,{size:16,className:"inline mr-2"}),"กรุณาระบุเลขที่เอกสาร (Required)"]}),(0,a.jsx)("input",{type:"text",value:es,onChange:e=>ea(e.target.value),placeholder:"กรอกเลขที่เอกสารที่นี่...",className:"w-full p-2 border rounded-md text-sm border-yellow-300 focus:ring-yellow-500 focus:border-yellow-500"}),(0,a.jsx)("p",{className:"text-xs text-yellow-700 mt-1",children:"เอกสารนี้ยังไม่มีเลขที่เอกสาร คุณต้องกำหนดก่อนส่งต่อไปยัง CM"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:["แนบไฟล์ ",(0,a.jsx)("span",{className:"text-red-700",children:"*"})]}),(0,a.jsxs)("div",{className:"border-2 border-dashed border-slate-300 rounded-lg p-4 text-center hover:border-blue-500 transition-colors",children:[(0,a.jsx)("input",{type:"file",multiple:!0,onChange:e=>eh(e,"action"),className:"hidden",id:"action-file-upload"}),(0,a.jsxs)("label",{htmlFor:"action-file-upload",className:"cursor-pointer text-blue-600 hover:text-blue-800 font-medium flex items-center justify-center",children:[(0,a.jsx)(K.Z,{size:16,className:"mr-2"}),"คลิกเพื่อเลือกไฟล์"]})]}),(0,a.jsx)("div",{className:"mt-2 space-y-2",children:R.map((e,t)=>(0,a.jsxs)("div",{className:"flex items-center text-sm p-2 bg-slate-100 rounded",children:[(0,a.jsx)(o.Z,{className:"w-4 h-4 mr-2 text-slate-500"}),(0,a.jsx)("span",{className:"flex-1 truncate",children:e.file.name}),"uploading"===e.status&&(0,a.jsx)(N.Z,{className:"w-4 h-4 mr-2"}),"success"===e.status&&(0,a.jsx)($.Z,{className:"w-4 h-4 text-green-500"}),"error"===e.status&&(0,a.jsx)("span",{title:e.error,children:(0,a.jsx)(V.Z,{className:"w-4 h-4 text-red-500"})}),(0,a.jsx)("button",{onClick:()=>ef(t,"action"),className:"ml-2 text-gray-500 hover:text-red-600",children:(0,a.jsx)(F.Z,{size:16})})]},e.id))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"แสดงความคิดเห็น (Optional)"}),(0,a.jsx)("textarea",{value:E,onChange:e=>w(e.target.value),placeholder:"เพิ่มความคิดเห็น...",className:"w-full p-2 border rounded-md text-sm",rows:2})]}),(0,a.jsxs)("div",{className:"flex flex-wrap justify-end gap-3",children:[(0,a.jsxs)("button",{onClick:()=>ep("REQUEST_REVISION"),disabled:eE||ew&&!es.trim(),className:"flex items-center px-4 py-2 text-sm font-medium text-slate-700 bg-white border border-slate-300 rounded-lg hover:bg-slate-100 disabled:bg-slate-200 disabled:cursor-not-allowed",children:[(0,a.jsx)(Z.Z,{size:16,className:"mr-2"})," ขอแก้ไข"]}),(0,a.jsxs)("button",{onClick:()=>ep("SEND_TO_CM"),disabled:eE||ew&&!es.trim(),className:"flex items-center px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed",children:[(0,a.jsx)(B.Z,{size:16,className:"mr-2"})," ส่งให้ CM"]})]})]}),ed&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h3",{className:"text-lg font-bold text-slate-800",children:"ส่งเอกสารที่แก้ไข"}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:["แนบไฟล์ที่แก้ไขแล้ว ",(0,a.jsx)("span",{className:"text-red-700",children:"*"})]}),(0,a.jsxs)("div",{className:"border-2 border-dashed border-slate-300 rounded-lg p-4 text-center hover:border-blue-500 transition-colors",children:[(0,a.jsx)("input",{type:"file",multiple:!0,onChange:e=>eh(e,"resubmission"),className:"hidden",id:"resubmit-file-upload"}),(0,a.jsxs)("label",{htmlFor:"resubmit-file-upload",className:"cursor-pointer text-blue-600 hover:text-blue-800 font-medium flex items-center justify-center",children:[(0,a.jsx)(K.Z,{size:16,className:"mr-2"}),"คลิกเพื่อเลือกไฟล์"]})]}),(0,a.jsx)("div",{className:"mt-2 space-y-2",children:R.map((e,t)=>(0,a.jsxs)("div",{className:"flex items-center text-sm p-2 bg-slate-100 rounded",children:[(0,a.jsx)(o.Z,{className:"w-4 h-4 mr-2 text-slate-500"}),(0,a.jsx)("span",{className:"flex-1 truncate",children:e.file.name}),"uploading"===e.status&&(0,a.jsx)(N.Z,{className:"w-4 h-4 mr-2"}),"success"===e.status&&(0,a.jsx)($.Z,{className:"w-4 h-4 text-green-500"}),"error"===e.status&&(0,a.jsx)("span",{title:e.error,children:(0,a.jsx)(V.Z,{className:"w-4 h-4 text-red-500"})}),(0,a.jsx)("button",{onClick:()=>ef(t,"resubmission"),className:"ml-2 text-gray-500 hover:text-red-600",children:(0,a.jsx)(F.Z,{size:16})})]},e.id))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"หมายเหตุการแก้ไข"}),(0,a.jsx)("textarea",{value:E,onChange:e=>w(e.target.value),placeholder:"เช่น แก้ไขตาม Comment จาก CM...",className:"w-full p-2 border rounded-md text-sm",rows:2})]}),(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsxs)("button",{onClick:eg,disabled:j||0===R.filter(e=>"success"===e.status).length,className:"flex items-center px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 disabled:bg-gray-300",children:[j?(0,a.jsx)(N.Z,{className:"w-4 h-4 mr-2"}):(0,a.jsx)(B.Z,{size:16,className:"mr-2"}),"ส่งกลับไปตรวจสอบ"]})})]}),u.status===p.n$.REJECTED&&!u.isLatest&&(0,a.jsxs)("div",{className:"p-4 bg-red-50 text-red-800 rounded-lg flex items-center",children:[(0,a.jsx)(V.Z,{size:24,className:"mr-3 flex-shrink-0 text-red-600"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-bold",children:"เอกสารฉบับนี้ถูกแทนที่แล้ว"}),(0,a.jsxs)("p",{className:"text-sm text-red-700",children:["ได้มีการสร้างเอกสารฉบับใหม่ ",(0,a.jsxs)("strong",{children:["(REV-",String((u.revisionNumber||0)+1).padStart(2,"0"),")"]})," จากเอกสารฉบับนี้แล้ว"]})]})]}),en&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h3",{className:"text-lg font-bold text-slate-800 mb-4",children:"สร้างเอกสารฉบับแก้ไข (Create New Revision)"}),"BIM"===u.creatorRole&&(T||q)&&(0,a.jsxs)("div",{className:"mb-4 p-3 rounded-md text-sm font-medium flex items-center border bg-white",children:[T&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(N.Z,{className:"w-4 h-4 mr-3 text-gray-500"}),(0,a.jsx)("span",{className:"text-gray-600",children:"กำลังตรวจสอบ Task ในระบบ BIM Tracking..."})]}),q&&(0,a.jsx)("span",{className:"text-red-600 font-semibold",children:q})]}),("BIM"!==u.creatorRole||k)&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"เอกสารเดิม:"})," ",u.documentNumber]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"เอกสารใหม่:"})," ",em]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:["แนบไฟล์ที่แก้ไขแล้ว ",(0,a.jsx)("span",{className:"text-red-700",children:"*"})]}),(0,a.jsxs)("div",{className:"border-2 border-dashed border-slate-300 rounded-lg p-4 text-center hover:border-blue-500 transition-colors",children:[(0,a.jsx)("input",{type:"file",multiple:!0,onChange:e=>eh(e,"revision"),className:"hidden",id:"revision-file-upload"}),(0,a.jsxs)("label",{htmlFor:"revision-file-upload",className:"cursor-pointer text-blue-600 hover:text-blue-800 font-medium flex items-center justify-center",children:[(0,a.jsx)(K.Z,{size:16,className:"mr-2"}),"คลิกเพื่อเลือกไฟล์"]})]}),(0,a.jsx)("div",{className:"mt-2 space-y-2",children:C.map((e,t)=>(0,a.jsxs)("div",{className:"flex items-center text-sm p-2 bg-slate-100 rounded",children:[(0,a.jsx)(o.Z,{className:"w-4 h-4 mr-2 text-slate-500"}),(0,a.jsx)("span",{className:"flex-1 truncate",children:e.file.name}),"uploading"===e.status&&(0,a.jsx)(N.Z,{className:"w-4 h-4 mr-2"}),"success"===e.status&&(0,a.jsx)($.Z,{className:"w-4 h-4 text-green-500"}),"error"===e.status&&(0,a.jsx)("span",{title:e.error,children:(0,a.jsx)(V.Z,{className:"w-4 h-4 text-red-500"})}),(0,a.jsx)("button",{onClick:()=>ef(t,"revision"),className:"ml-2 text-gray-500 hover:text-red-600",children:(0,a.jsx)(F.Z,{size:16})})]},e.id))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"หมายเหตุการแก้ไข (Optional)"}),(0,a.jsx)("textarea",{value:I,onChange:e=>P(e.target.value),placeholder:"เช่น แก้ไขตาม Comment จาก CM...",className:"w-full p-2 border rounded-md text-sm",rows:2})]}),(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsxs)("button",{onClick:eN,disabled:j||0===C.filter(e=>"success"===e.status).length||"BIM"===u.creatorRole&&!k,className:"flex items-center px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed",children:[j?(0,a.jsx)(N.Z,{className:"w-4 h-4 mr-2"}):(0,a.jsx)(B.Z,{size:16,className:"mr-2"}),"ส่งเอกสารฉบับแก้ไข"]})})]})]}),ev&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h3",{className:"text-lg font-bold text-slate-800",children:"การอนุมัติ (Approval)"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"แนบไฟล์ (Optional)"}),(0,a.jsxs)("div",{className:"border-2 border-dashed border-slate-300 rounded-lg p-4 text-center hover:border-blue-500 transition-colors",children:[(0,a.jsx)("input",{type:"file",multiple:!0,onChange:e=>eh(e,"action"),className:"hidden",id:"action-file-upload-final"}),(0,a.jsxs)("label",{htmlFor:"action-file-upload-final",className:"cursor-pointer text-blue-600 hover:text-blue-800 font-medium flex items-center justify-center",children:[(0,a.jsx)(K.Z,{size:16,className:"mr-2"}),"คลิกเพื่อเลือกไฟล์"]})]}),(0,a.jsx)("div",{className:"mt-2 space-y-2",children:R.map((e,t)=>(0,a.jsxs)("div",{className:"flex items-center text-sm p-2 bg-slate-100 rounded",children:[(0,a.jsx)(o.Z,{className:"w-4 h-4 mr-2 text-slate-500"}),(0,a.jsx)("span",{className:"flex-1 truncate",children:e.file.name}),"uploading"===e.status&&(0,a.jsx)(N.Z,{className:"w-4 h-4 mr-2"}),"success"===e.status&&(0,a.jsx)($.Z,{className:"w-4 h-4 text-green-500"}),"error"===e.status&&(0,a.jsx)("span",{title:e.error,children:(0,a.jsx)(V.Z,{className:"w-4 h-4 text-red-500"})}),(0,a.jsx)("button",{onClick:()=>ef(t,"action"),className:"ml-2 text-gray-500 hover:text-red-600",children:(0,a.jsx)(F.Z,{size:16})})]},e.id))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"แสดงความคิดเห็น (Optional)"}),(0,a.jsx)("textarea",{value:E,onChange:e=>w(e.target.value),placeholder:"เพิ่มความคิดเห็น/เหตุผลประกอบ...",className:"w-full p-2 border rounded-md text-sm",rows:2})]}),(0,a.jsxs)("div",{className:"flex flex-wrap justify-end gap-3",children:[(0,a.jsxs)("button",{onClick:()=>ep("REJECT"),disabled:j,className:"flex items-center px-4 py-2 text-sm font-medium text-white bg-red-600 rounded-lg hover:bg-red-700 disabled:bg-gray-300 disabled:cursor-not-allowed",children:[(0,a.jsx)(z.Z,{size:16,className:"mr-2"})," ไม่อนุมัติ"]}),(0,a.jsxs)("button",{onClick:()=>ep("APPROVE_REVISION_REQUIRED"),disabled:j,className:"flex items-center px-4 py-2 text-sm font-medium text-white bg-orange-500 rounded-lg hover:bg-orange-600 disabled:bg-gray-300 disabled:cursor-not-allowed",children:[(0,a.jsx)(Z.Z,{size:16,className:"mr-2"})," อนุมัติ (ต้องแก้ไข)"]}),(0,a.jsxs)("button",{onClick:()=>ep("APPROVE_WITH_COMMENTS"),disabled:j,className:"flex items-center px-4 py-2 text-sm font-medium text-white bg-teal-600 rounded-lg hover:bg-teal-700 disabled:bg-gray-300 disabled:cursor-not-allowed",children:[(0,a.jsx)(W.Z,{size:16,className:"mr-2"})," อนุมัติ (ตามคอมเมนต์)"]}),(0,a.jsxs)("button",{onClick:()=>ep("APPROVE"),disabled:j,className:"flex items-center px-4 py-2 text-sm font-medium text-white bg-green-600 rounded-lg hover:bg-green-700 disabled:bg-gray-300 disabled:cursor-not-allowed",children:[(0,a.jsx)(G.Z,{size:16,className:"mr-2"})," อนุมัติ"]})]})]})]})]})}),b&&(0,a.jsx)(Y,{workflow:u.workflow||[],onClose:()=>v(!1),userRole:null==d?void 0:d.role}),(0,a.jsx)(U.Z,{isOpen:!!_,file:_,onClose:()=>S(null)})]})}function X(e){let{documentId:t,onClose:s}=e;(0,r.useRouter)();let i=(0,r.useSearchParams)(),[n,c]=(0,l.useState)(null);return((0,l.useEffect)(()=>{if(!t){c(null);return}(async()=>{let e=(0,M.JU)(k.db,"rfaDocuments",t),a=await (0,M.QT)(e);a.exists()?c({id:a.id,...a.data()}):(alert("Error: ไม่พบเอกสารที่คุณต้องการ"),s())})()},[t,s]),(0,l.useEffect)(()=>{let e=i.toString(),a="/dashboard/rfa?".concat(e.replace(/&?docId=[^&]*/,""),"&docId=").concat(t),l=e=>{s()};return t&&(window.history.pushState({docId:t},"",a),window.addEventListener("popstate",l)),()=>{window.removeEventListener("popstate",l)}},[t,s,i]),t)?(0,a.jsx)(q,{document:n,onClose:s,onUpdate:c}):null}var ee=s(3247),et=e=>{let{filters:t,handleFilterChange:s,searchTerm:l,setSearchTerm:r,resetFilters:i,sites:n,categories:c,availableStatuses:d,availableResponsibleParties:o}=e;return(0,a.jsx)("div",{className:"bg-white rounded-lg shadow p-4",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-12 gap-4 items-end",children:[(0,a.jsxs)("div",{className:"md:col-span-2",children:[(0,a.jsx)("label",{htmlFor:"site-filter",className:"text-sm font-medium text-gray-700",children:"โครงการ"}),(0,a.jsxs)("select",{id:"site-filter",value:t.siteId,onChange:e=>s("siteId",e.target.value),className:"w-full mt-1 px-3 py-2 border border-gray-300 rounded-lg",children:[(0,a.jsx)("option",{value:"ALL",children:"ทุกโครงการ"}),n.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,a.jsxs)("div",{className:"md:col-span-2",children:[(0,a.jsx)("label",{htmlFor:"search-filter",className:"text-sm font-medium text-gray-700",children:"ค้นหา"}),(0,a.jsxs)("div",{className:"relative mt-1",children:[(0,a.jsx)(ee.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),(0,a.jsx)("input",{id:"search-filter",type:"text",placeholder:"เลขที่, ชื่อเอกสาร...",value:l,onChange:e=>r(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg"})]})]}),(0,a.jsxs)("div",{className:"md:col-span-2",children:[(0,a.jsx)("label",{htmlFor:"status-filter",className:"text-sm font-medium text-gray-700",children:"สถานะ"}),(0,a.jsxs)("select",{id:"status-filter",value:t.status,onChange:e=>s("status",e.target.value),className:"w-full mt-1 px-3 py-2 border border-gray-300 rounded-lg",children:[(0,a.jsx)("option",{value:"ALL",children:"ทุกสถานะ"}),d.map(e=>(0,a.jsx)("option",{value:e,children:p.NK[e]||e},e))]})]}),(0,a.jsxs)("div",{className:"md:col-span-2",children:[(0,a.jsx)("label",{htmlFor:"responsible-party-filter",className:"text-sm font-medium text-gray-700",children:"ผู้รับผิดชอบ"}),(0,a.jsx)("select",{id:"responsible-party-filter",value:t.responsibleParty,onChange:e=>s("responsibleParty",e.target.value),className:"w-full mt-1 px-3 py-2 border border-gray-300 rounded-lg",children:o.map(e=>(0,a.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,a.jsxs)("div",{className:"md:col-span-2",children:[(0,a.jsx)("label",{htmlFor:"category-filter",className:"text-sm font-medium text-gray-700",children:"หมวดงาน"}),(0,a.jsxs)("select",{id:"category-filter",className:"w-full mt-1 px-3 py-2 border border-gray-300 rounded-lg",value:t.categoryId,onChange:e=>s("categoryId",e.target.value),children:[(0,a.jsx)("option",{value:"ALL",children:"ทุกหมวดงาน"}),c.map(e=>(0,a.jsx)("option",{value:e.id,children:e.categoryCode},e.id))]})]}),(0,a.jsxs)("div",{className:"md:col-span-1 flex items-center h-10",children:[(0,a.jsx)("input",{id:"show-all-revisions",type:"checkbox",checked:t.showAllRevisions,onChange:e=>s("showAllRevisions",e.target.checked),className:"h-4 w-4 rounded border-gray-300 text-blue-600"}),(0,a.jsx)("label",{htmlFor:"show-all-revisions",className:"ml-2 text-sm text-gray-700",children:"ทุกฉบับ"})]}),(0,a.jsx)("div",{className:"md:col-span-1",children:(0,a.jsx)("button",{onClick:i,className:"w-full px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300",children:"รีเซ็ต"})})]})})},es=s(1550);let ea={"RFA-SHOP":"Shop Drawing","RFA-GEN":"General","RFA-MAT":"Material"};function el(){let{user:e,firebaseUser:t}=(0,i.a)(),s=(0,r.useRouter)(),c=(0,r.useSearchParams)(),[d,o]=(0,l.useState)([]),[m,x]=(0,l.useState)(!0),[u,h]=(0,l.useState)(null),[f,N]=(0,l.useState)(""),[g,j]=(0,l.useState)([]),[b,v]=(0,l.useState)(!1),[E,w]=(0,l.useState)([]),[R,A]=(0,l.useState)({rfaType:c.get("type")||"ALL",status:"ALL",siteId:"ALL",showAllRevisions:!1,categoryId:"ALL",responsibleParty:"ALL"});(0,l.useEffect)(()=>{let e=c.get("docId");e&&h(e)},[c]),(0,l.useEffect)(()=>{let e=c.get("type")||"ALL";e!==R.rfaType&&P("rfaType",e)},[c,R.rfaType]),(0,l.useEffect)(()=>{if(!(null==e?void 0:e.sites)||0===e.sites.length){w([]),j([]);return}let t=(0,M.IO)((0,M.hJ)(k.db,"sites"),(0,M.ar)((0,M.Jm)(),"in",e.sites)),s=(0,M.cf)(t,e=>{w(e.docs.map(e=>({id:e.id,...e.data()})))}),a=(0,M.IO)((0,M.B$)(k.db,"categories"),(0,M.ar)("siteId","in",e.sites)),l=(0,M.cf)(a,e=>{j(Array.from(new Map(e.docs.map(e=>({id:e.id,...e.data()})).map(e=>[e.id,e])).values()))});return()=>{s(),l()}},[e]);let I=(0,l.useMemo)(()=>{if(!e||"ALL"===R.rfaType)return!1;let t="";if("RFA-SHOP"===R.rfaType)t="RFA.".concat(es.S4.RFA.CREATE_SHOP);else if("RFA-GEN"===R.rfaType)t="RFA.".concat(es.S4.RFA.CREATE_GEN);else{if("RFA-MAT"!==R.rfaType)return!1;t="RFA.".concat(es.S4.RFA.CREATE_MAT)}let[s,a]=t.split("."),l=(es.yB[t]||[]).includes(e.role);return E.some(t=>{var r,i,n;let c=null===(n=t.userOverrides)||void 0===n?void 0:null===(i=n[e.id])||void 0===i?void 0:null===(r=i[s])||void 0===r?void 0:r[a];return void 0!==c?!0===c:l})},[e,R.rfaType,E]);(0,l.useEffect)(()=>{if(!t||!(null==e?void 0:e.sites)||0===e.sites.length){x(!1);return}x(!0);let s=(0,M.IO)((0,M.hJ)(k.db,"rfaDocuments"),(0,M.ar)("siteId","in",e.sites),(0,M.Xo)("updatedAt","desc")),a=(0,M.cf)(s,e=>{let t=[];e.forEach(e=>{var s,a,l,r,i;let n=e.data();t.push({id:e.id,...n,site:{id:n.siteId,name:n.siteName||"N/A"},category:{id:n.categoryId,categoryCode:(null===(s=n.taskData)||void 0===s?void 0:s.taskCategory)||n.categoryId||"N/A",categoryName:""},createdByInfo:{email:(null===(l=n.workflow)||void 0===l?void 0:null===(a=l[0])||void 0===a?void 0:a.userName)||"N/A",role:(null===(i=n.workflow)||void 0===i?void 0:null===(r=i[0])||void 0===r?void 0:r.role)||"N/A"},permissions:{}})}),o(t),x(!1)},e=>{console.error("Error fetching realtime documents:",e),x(!1)});return()=>a()},[t,e]);let P=(e,t)=>{A(s=>({...s,[e]:t}))},C=(0,l.useMemo)(()=>[{value:"ALL",label:"ทุกคน"}],[]),O=(0,l.useMemo)(()=>Object.values(p.n$),[]),F=(0,l.useMemo)(()=>{let e=new Map(E.map(e=>[e.id,e.name])),t=d.map(t=>({...t,site:{...t.site,name:e.get(t.site.id)||"N/A"}}));if("ALL"!==R.rfaType&&(t=t.filter(e=>e.rfaType===R.rfaType)),"ALL"!==R.status&&(t=t.filter(e=>e.status===R.status)),"ALL"!==R.siteId&&(t=t.filter(e=>e.site.id===R.siteId)),"ALL"!==R.categoryId&&(t=t.filter(e=>{var t;return(null===(t=e.category)||void 0===t?void 0:t.id)===R.categoryId})),f.trim()){let e=f.toLowerCase();t=t.filter(t=>t.documentNumber.toLowerCase().includes(e)||t.title.toLowerCase().includes(e))}return t},[d,R,e,f,E]);return e?(0,a.jsx)(n.AuthGuard,{children:(0,a.jsxs)("div",{className:"max-w-screen-2xl mx-auto",children:[(0,a.jsxs)("div",{className:"mb-6 flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[(0,a.jsx)("div",{children:(0,a.jsxs)("h1",{className:"text-2xl lg:text-3xl font-bold text-gray-900",children:["\uD83D\uDCCB RFA Documents",R.rfaType&&"ALL"!==R.rfaType&&(0,a.jsxs)("span",{className:"text-orange-600",children:[" - ",ea[R.rfaType]]})]})}),(0,a.jsxs)("div",{className:"flex items-center space-x-3 mt-4 sm:mt-0",children:[(0,a.jsxs)("button",{onClick:()=>{},className:"flex items-center px-3 py-2 bg-gray-100 text-gray-700 rounded-lg",disabled:m,children:[(0,a.jsx)(S.Z,{className:"w-4 h-4 mr-2 ".concat(m?"animate-spin":"")}),m?"Syncing...":"Real-time"]}),"ALL"!==R.rfaType&&I&&(0,a.jsxs)("button",{onClick:()=>{v(!0)},className:"flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[(0,a.jsx)(T.Z,{className:"w-4 h-4 mr-2"}),"สร้าง ",ea[R.rfaType]]})]})]}),(0,a.jsx)(D,{allDocuments:F,onChartFilter:(e,t)=>{A(s=>({...s,[e]:t}))},activeFilters:R,categories:g}),(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsx)(et,{filters:R,handleFilterChange:P,searchTerm:f,setSearchTerm:N,resetFilters:()=>{A({rfaType:R.rfaType,status:"ALL",siteId:"ALL",showAllRevisions:!1,categoryId:"ALL",responsibleParty:"ALL"}),N("")},sites:E,categories:g,availableStatuses:O,availableResponsibleParties:C})}),(0,a.jsx)("div",{className:"mt-6",children:m?(0,a.jsx)("div",{className:"text-center p-8 h-full flex items-center justify-center bg-white rounded-lg shadow",children:"กำลังโหลดเอกสาร..."}):(0,a.jsx)(y,{documents:F,isLoading:m,onDocumentClick:e=>{h(e.id)},getStatusColor:e=>"text-gray-600 bg-gray-50",statusLabels:p.NK,getRFATypeColor:e=>"bg-gray-100 text-gray-800"})}),b&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-60 z-50 flex items-center justify-center p-4",children:(0,a.jsx)(_.Z,{onClose:()=>{v(!1)},isModal:!0,userProp:e?{id:e.id,email:e.email,role:e.role,sites:e.sites||[]}:void 0,presetRfaType:"ALL"!==R.rfaType?R.rfaType:void 0})}),(0,a.jsx)(X,{documentId:u,onClose:()=>{h(null),s.push("/dashboard/rfa?".concat(new URLSearchParams(window.location.search).toString().replace(/&?docId=[^&]*/,"")),{scroll:!1})}})]})}):null}function er(){return(0,a.jsx)(l.Suspense,{fallback:(0,a.jsx)("div",{children:"Loading Page..."}),children:(0,a.jsx)(el,{})})}},7576:function(e,t,s){"use strict";s.d(t,{Z:function(){return o}});var a=s(7437),l=s(29),r=s.n(l),i=s(2265),n=s(4415),c=s(5884),d=s(2489);function o(e){let{isOpen:t,file:s,onClose:l}=e,[o,m]=(0,i.useState)(!1),[x,u]=(0,i.useState)(!1),[h]=(0,i.useState)("mozilla");if((0,i.useEffect)(()=>{let e=()=>{u(window.innerWidth<768)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),(0,i.useEffect)(()=>{let e=e=>{"Escape"===e.key&&t&&l()};return t&&(document.addEventListener("keydown",e),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",e),document.body.style.overflow="unset"}},[t,l]),!t||!s)return null;let f=o?"w-full h-full max-w-full max-h-full rounded-none":x?"w-full h-full max-w-full max-h-full rounded-none":"w-full max-w-6xl h-[95vh] rounded-lg";return(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-80 z-[60] flex items-center justify-center",children:(0,a.jsxs)("div",{className:"bg-white shadow-xl flex flex-col transition-all duration-300 ".concat(f),children:[(0,a.jsxs)("div",{className:"flex justify-between items-center p-3 border-b bg-gray-50 flex-shrink-0",children:[(0,a.jsx)("div",{className:"flex items-center space-x-3 flex-1 min-w-0",children:(0,a.jsx)("h3",{className:"text-sm sm:text-base font-semibold text-gray-800 truncate",title:s.fileName,children:s.fileName})}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[!x&&(0,a.jsx)("button",{onClick:()=>m(!o),className:"text-gray-500 hover:text-gray-800 p-2 rounded-md hover:bg-gray-200 transition-colors",title:o?"ออกจากโหมดเต็มจอ":"โหมดเต็มจอ",children:o?(0,a.jsx)(n.Z,{size:16}):(0,a.jsx)(c.Z,{size:16})}),(0,a.jsx)("button",{onClick:l,className:"text-gray-500 hover:text-gray-800 p-2 rounded-md hover:bg-gray-200 transition-colors",title:"ปิด",children:(0,a.jsx)(d.Z,{size:16})})]})]}),(0,a.jsxs)("div",{className:"jsx-c9fb4320352222b7 flex-1 relative overflow-hidden bg-gray-100",children:[(0,a.jsx)("iframe",{src:(()=>{let e=encodeURIComponent(s.fileUrl);return"https://mozilla.github.io/pdf.js/web/viewer.html?file=".concat(e,"#toolbar=1&navpanes=0&scrollbar=1")})(),title:"PDF Viewer - ".concat(s.fileName),allow:"fullscreen",loading:"lazy",style:{backgroundColor:"#ffffff",filter:"none"},className:"jsx-c9fb4320352222b7 w-full h-full border-0"}),(0,a.jsx)(r(),{id:"c9fb4320352222b7",children:"iframe.jsx-c9fb4320352222b7{}"})]}),x&&(0,a.jsx)("div",{className:"p-2 bg-gray-50 border-t text-center text-xs text-gray-600",children:"\uD83D\uDCA1 ใช้นิ้วสองนิ้วเพื่อซูม หรือแตะสองครั้งเพื่อซูมอัตโนมัติ"})]})})}},9761:function(e,t,s){"use strict";var a=s(7437);s(2265),t.Z=e=>{let{className:t}=e;return(0,a.jsx)("div",{className:"\n    inline-block h-8 w-8 animate-spin rounded-full \n    border-4 border-solid border-current border-e-transparent \n    align-[-0.125em] text-gray-400 motion-reduce:animate-[spin_1.5s_linear_infinite]\n    ".concat(t||"","\n  ").trim(),role:"status",children:(0,a.jsx)("span",{className:"!absolute !-m-px !h-px !w-px !overflow-hidden !whitespace-nowrap !border-0 !p-0 ![clip:rect(0,0,0,0)]",children:"Loading..."})})}},1550:function(e,t,s){"use strict";s.d(t,{S4:function(){return l},l8:function(){return n},yB:function(){return i}});var a=s(453);let l={RFA:{VIEW_SHOP:"view_shop",CREATE_SHOP:"create_shop",VIEW_GEN:"view_gen",CREATE_GEN:"create_gen",VIEW_MAT:"view_mat",CREATE_MAT:"create_mat",APPROVE:"can_approve"},WORK_REQUEST:{VIEW:"view_wr",CREATE:"create_wr",APPROVE:"approve_wr",VERIFY:"verify_wr"}};a.K$.ADMIN,a.K$.PD,a.K$.PM,a.K$.SE,a.K$.FM,a.K$.BIM,a.K$.SITE_ADMIN,a.K$.CM,a.K$.ME,a.K$.SN,a.K$.OE,a.K$.PE;let r=[a.K$.ADMIN,a.K$.PD,a.K$.PM,a.K$.BIM,a.K$.SITE_ADMIN,a.K$.CM,a.K$.ME,a.K$.SN,a.K$.OE,a.K$.PE],i={["RFA.".concat(l.RFA.VIEW_SHOP)]:r,["RFA.".concat(l.RFA.CREATE_SHOP)]:[a.K$.BIM,a.K$.ME,a.K$.SN,a.K$.SITE_ADMIN,a.K$.ADMIN,a.K$.PM,a.K$.PE,a.K$.OE],["RFA.".concat(l.RFA.VIEW_GEN)]:r,["RFA.".concat(l.RFA.CREATE_GEN)]:[a.K$.BIM,a.K$.ME,a.K$.SN,a.K$.SITE_ADMIN,a.K$.ADMIN,a.K$.PM,a.K$.PE,a.K$.OE],["RFA.".concat(l.RFA.VIEW_MAT)]:r,["RFA.".concat(l.RFA.CREATE_MAT)]:[a.K$.SITE_ADMIN,a.K$.ADMIN,a.K$.PM,a.K$.PE,a.K$.OE],["RFA.".concat(l.RFA.APPROVE)]:[a.K$.CM,a.K$.ADMIN,a.K$.SITE_ADMIN,a.K$.PM,a.K$.PE,a.K$.OE],["WR.".concat(l.WORK_REQUEST.VIEW)]:r,["WR.".concat(l.WORK_REQUEST.CREATE)]:[a.K$.PE,a.K$.OE,a.K$.ADMIN],["WR.".concat(l.WORK_REQUEST.APPROVE)]:[a.K$.PM,a.K$.ADMIN],["WR.".concat(l.WORK_REQUEST.VERIFY)]:[a.K$.SITE_ADMIN,a.K$.ADMIN,a.K$.BIM]},n=[{title:"RFA - Shop Drawing",permissions:[{key:"RFA.".concat(l.RFA.VIEW_SHOP),label:"เข้าดู (View)"},{key:"RFA.".concat(l.RFA.CREATE_SHOP),label:"สร้าง (Create)"}]},{title:"RFA - General",permissions:[{key:"RFA.".concat(l.RFA.VIEW_GEN),label:"เข้าดู (View)"},{key:"RFA.".concat(l.RFA.CREATE_GEN),label:"สร้าง (Create)"}]},{title:"RFA - Material",permissions:[{key:"RFA.".concat(l.RFA.VIEW_MAT),label:"เข้าดู (View)"},{key:"RFA.".concat(l.RFA.CREATE_MAT),label:"สร้าง (Create)"}]},{title:"RFA - Approval",permissions:[{key:"RFA.".concat(l.RFA.APPROVE),label:"อนุมัติเอกสาร (Approve)"}]},{title:"Work Request",permissions:[{key:"WR.".concat(l.WORK_REQUEST.VIEW),label:"เข้าดู (View)"},{key:"WR.".concat(l.WORK_REQUEST.CREATE),label:"สร้างใบคำขอ (Create)"},{key:"WR.".concat(l.WORK_REQUEST.APPROVE),label:"อนุมัติใบคำขอ (PM)"},{key:"WR.".concat(l.WORK_REQUEST.VERIFY),label:"ตรวจรับงาน (Site)"}]}]},453:function(e,t,s){"use strict";s.d(t,{$p:function(){return n},Ge:function(){return d},K$:function(){return a},NK:function(){return o},c9:function(){return i},gf:function(){return r},n$:function(){return c},oU:function(){return l},yh:function(){return m}});let a={ADMIN:"Admin",BIM:"BIM",SITE_ADMIN:"Site Admin",CM:"CM",ME:"ME",SN:"SN",OE:"OE",PE:"PE",PM:"PM",PD:"PD",SE:"SE",FM:"FM",ADMIN_SITE_2:"Adminsite2"};a.BIM,a.ME,a.SN,a.SITE_ADMIN,a.ADMIN,a.PM,a.PE,a.OE;let l=[a.SITE_ADMIN,a.ADMIN_SITE_2,a.OE,a.PE,a.ADMIN],r=[a.CM,a.ADMIN,a.SITE_ADMIN,a.PM,a.PE,a.OE];a.PM,a.ADMIN,a.SE,a.FM;let i=[a.PE,a.OE,a.ADMIN],n=[a.PM,a.ADMIN];a.PD,a.SE,a.FM;let c={PENDING_REVIEW:"PENDING_REVIEW",PENDING_CM_APPROVAL:"PENDING_CM_APPROVAL",REVISION_REQUIRED:"REVISION_REQUIRED",APPROVED:"APPROVED",APPROVED_WITH_COMMENTS:"APPROVED_WITH_COMMENTS",APPROVED_REVISION_REQUIRED:"APPROVED_REVISION_REQUIRED",REJECTED:"REJECTED",PENDING_FINAL_APPROVAL:"PENDING_FINAL_APPROVAL"},d={DRAFT:"DRAFT",REJECTED_BY_PM:"REJECTED_BY_PM",PENDING_BIM:"PENDING_BIM",IN_PROGRESS:"IN_PROGRESS",PENDING_ACCEPTANCE:"PENDING_ACCEPTANCE",REVISION_REQUESTED:"REVISION_REQUESTED",COMPLETED:"COMPLETED"},o={[c.PENDING_REVIEW]:"รอตรวจสอบ",[c.PENDING_CM_APPROVAL]:"รออนุมัติ (CM/Approver)",[c.REVISION_REQUIRED]:"แก้ไข",[c.APPROVED]:"อนุมัติ",[c.APPROVED_WITH_COMMENTS]:"อนุมัติตามคอมเมนต์ (ไม่แก้ไข)",[c.APPROVED_REVISION_REQUIRED]:"อนุมัติตามคอมเมนต์ (ต้องแก้ไข)",[c.REJECTED]:"ไม่อนุมัติ",[c.PENDING_FINAL_APPROVAL]:"รอ SITE อนุมัติขั้นสุดท้าย",[d.DRAFT]:"รออนุมัติ (PM)",[d.REJECTED_BY_PM]:"ไม่อนุมัติ (PM)",[d.PENDING_BIM]:"รอ BIM รับงาน",[d.IN_PROGRESS]:"BIM กำลังดำเนินการ",[d.PENDING_ACCEPTANCE]:"รอตรวจรับ (Site)",[d.REVISION_REQUESTED]:"ขอแก้ไข (WR)",[d.COMPLETED]:"เสร็จสิ้น"},m={[c.PENDING_REVIEW]:"#0088FE",[c.PENDING_CM_APPROVAL]:"#00C49F",[c.REVISION_REQUIRED]:"#FFBB28",[c.APPROVED]:"#28A745",[c.REJECTED]:"#DC3545",[c.APPROVED_WITH_COMMENTS]:"#2f3e3aff",[c.APPROVED_REVISION_REQUIRED]:"#FD7E14",[d.DRAFT]:"#6c757d",[d.REJECTED_BY_PM]:"#DC3545",[d.PENDING_BIM]:"#0088FE",[d.IN_PROGRESS]:"#FFBB28",[d.PENDING_ACCEPTANCE]:"#AF19FF",[d.REVISION_REQUESTED]:"#FD7E14",[d.COMPLETED]:"#28A745"}}},function(e){e.O(0,[609,15,134,184,238,649,478,971,997,744],function(){return e(e.s=1417)}),_N_E=e.O()}]);