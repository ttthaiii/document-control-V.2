(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[571],{1417:function(e,s,t){Promise.resolve().then(t.bind(t,1239))},1239:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return et}});var a=t(7437),r=t(2265),l=t(9376),n=t(5946),i=t(731),c=t(1313),d=t(44),o=t(2720),m=t(2369),x=t(1047),u=t(1723),h=t(453);let p=[h.n$.PENDING_REVIEW,h.n$.PENDING_CM_APPROVAL,h.n$.REVISION_REQUIRED,h.n$.APPROVED_REVISION_REQUIRED],g=e=>{if(!e)return null;if("function"==typeof e.toDate)return e.toDate();if(e._seconds)return new Date(1e3*e._seconds);let s=new Date(e);return isNaN(s.getTime())?null:s};function f(e){let{documents:s,onDocumentClick:t,getStatusColor:l,statusLabels:n,getRFATypeColor:i}=e,[c,f]=(0,r.useState)(!1);(0,r.useEffect)(()=>{let e=()=>f(window.innerWidth<=768);return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);let N=e=>{let s=g(e);return s?s.toLocaleDateString("th-TH",{day:"2-digit",month:"2-digit",year:"numeric"}):"Invalid Date"},y=e=>{let s=g(e.updatedAt);if(!s)return 0;let t=new Date;t.setHours(0,0,0,0);let a=new Date(s);return a.setHours(0,0,0,0),Math.max(0,Math.floor((t.getTime()-a.getTime())/864e5))},j=e=>{var s,t,a,r;switch(e.status){case h.n$.PENDING_REVIEW:return{name:"Site",role:"Site"};case h.n$.PENDING_CM_APPROVAL:return{name:"CM",role:"CM"};case h.n$.REVISION_REQUIRED:case h.n$.APPROVED_REVISION_REQUIRED:return{name:(null===(s=e.createdByInfo)||void 0===s?void 0:s.role)||"Creator",role:(null===(t=e.createdByInfo)||void 0===t?void 0:t.role)||"Creator"};case h.n$.REJECTED:return e.isLatest?{name:(null===(a=e.createdByInfo)||void 0===a?void 0:a.role)||"Creator",role:(null===(r=e.createdByInfo)||void 0===r?void 0:r.role)||"Creator"}:{name:"เสร็จสิ้น",role:"Completed"};case h.n$.APPROVED:case h.n$.APPROVED_WITH_COMMENTS:return{name:"เสร็จสิ้น",role:"Completed"};default:return{name:"N/A",role:"N/A"}}};return c?(0,a.jsx)("div",{className:"space-y-4",children:s.map(e=>{var s,r;let c=j(e),h=y(e);return(0,a.jsxs)("div",{onClick:()=>t(e),className:"bg-white rounded-lg shadow border p-4 cursor-pointer",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 mb-1",children:[(0,a.jsx)("span",{className:"inline-flex px-2 py-1 rounded-full text-xs font-medium ".concat(i(e.rfaType)),children:e.rfaType}),(0,a.jsxs)("span",{className:"inline-flex items-center px-2 py-1 bg-gray-200 text-gray-800 rounded-full text-xs font-semibold",children:["REV-",String(e.revisionNumber).padStart(2,"0")]})]}),(0,a.jsx)("h3",{className:"font-medium text-gray-900 text-sm mb-1 truncate",children:e.documentNumber}),(0,a.jsx)("p",{className:"text-sm text-gray-600 line-clamp-2",children:e.title})]}),(0,a.jsx)("div",{className:"flex flex-col items-end space-y-1 flex-shrink-0 ml-2",children:(0,a.jsx)("span",{className:"inline-flex items-center justify-center px-2 py-1 rounded-full text-xs font-medium ".concat(l(e.status)),children:n[e.status]||e.status})})]}),(0,a.jsxs)("div",{className:"space-y-2 text-xs text-gray-600",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(d.Z,{className:"w-3 h-3 mr-2"}),(0,a.jsx)("span",{children:(null===(s=e.site)||void 0===s?void 0:s.name)||"N/A"})]}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(o.Z,{className:"w-3 h-3 mr-2"}),(0,a.jsx)("span",{children:(null===(r=e.category)||void 0===r?void 0:r.categoryCode)||"N/A"})]}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(m.Z,{className:"w-3 h-3 mr-2"}),(0,a.jsxs)("span",{children:["ผู้รับผิดชอบ: ",c.name]})]}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(x.Z,{className:"w-3 h-3 mr-2"}),(0,a.jsxs)("span",{children:["อัปเดต: ",N(e.updatedAt)]})]}),p.includes(e.status)&&h>0&&(0,a.jsxs)("div",{className:"flex items-center text-orange-600",children:[(0,a.jsx)(u.Z,{className:"w-3 h-3 mr-2"}),(0,a.jsxs)("span",{children:["ค้างดำเนินการ: ",h," วัน"]})]})]})]},e.id)})}):(0,a.jsx)("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"System No."}),(0,a.jsx)("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"หมวดหมู่"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"เอกสาร"}),(0,a.jsx)("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Rev."}),(0,a.jsx)("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"สถานะ"}),(0,a.jsx)("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ผู้รับผิดชอบ"}),(0,a.jsx)("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"วันที่อัปเดตล่าสุด"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:s.map(e=>{var s;let r=j(e),i=y(e);return(0,a.jsxs)("tr",{className:"hover:bg-gray-50 cursor-pointer",onClick:()=>t(e),children:[(0,a.jsx)("td",{className:"px-6 py-4",children:(0,a.jsx)("p",{className:"text-sm font-semibold text-blue-600 text-center",children:e.runningNumber||"N/A"})}),(0,a.jsx)("td",{className:"px-6 py-4",children:(0,a.jsx)("div",{className:"text-sm",children:(0,a.jsx)("p",{className:"text-gray-600 text-center",children:(null===(s=e.category)||void 0===s?void 0:s.categoryCode)||"N/A"})})}),(0,a.jsx)("td",{className:"px-6 py-4",children:(0,a.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900 truncate",children:e.documentNumber}),(0,a.jsx)("p",{className:"text-sm text-gray-600 line-clamp-2",children:e.title})]})}),(0,a.jsx)("td",{className:"px-4 py-4 text-center",children:(0,a.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-semibold bg-gray-200 text-gray-800",children:String(e.revisionNumber).padStart(2,"0")})}),(0,a.jsx)("td",{className:"px-6 py-4",children:(0,a.jsxs)("div",{className:"flex flex-col space-y-1 items-center",children:[(0,a.jsx)("span",{className:"inline-flex items-center justify-center px-2 py-1 rounded-full text-xs font-medium ".concat(l(e.status)),children:n[e.status]||e.status}),p.includes(e.status)&&i>0&&(0,a.jsx)("span",{className:"text-xs text-orange-600 text-center",children:"ค้าง ".concat(i," วัน")})]})}),(0,a.jsx)("td",{className:"px-6 py-4 text-center",children:(0,a.jsxs)("div",{className:"flex items-center justify-center",children:[(0,a.jsx)(m.Z,{className:"w-4 h-4 text-gray-400 mr-2"}),(0,a.jsx)("div",{className:"text-sm",children:(0,a.jsx)("p",{className:"text-gray-900",children:r.name})})]})}),(0,a.jsx)("td",{className:"px-6 py-4",children:(0,a.jsx)("div",{className:"text-sm text-gray-600 text-center",children:(0,a.jsx)("span",{children:N(e.updatedAt)})})})]},e.id)})})]})})})}var N=t(1211),y=t(2663),j=t(3862),b=t(6283),v=t(8155),E=t(3250);let w=e=>{let{active:s,payload:t}=e;if(s&&t&&t.length){let e=t[0];return(0,a.jsx)("div",{className:"p-3 bg-white/90 backdrop-blur-sm shadow-lg rounded-lg border border-gray-200",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{style:{width:12,height:12,backgroundColor:e.payload.color,marginRight:8,borderRadius:"50%"}}),(0,a.jsx)("p",{className:"text-sm text-gray-700",children:"".concat(e.name,": ").concat(e.value)})]})})}return null},R={[h.n$.PENDING_REVIEW]:"#0088FE",[h.n$.PENDING_CM_APPROVAL]:"#00C49F",[h.n$.REVISION_REQUIRED]:"#FFBB28",[h.n$.APPROVED]:"#28A745",[h.n$.REJECTED]:"#DC3545",[h.n$.APPROVED_WITH_COMMENTS]:"#20C997",[h.n$.APPROVED_REVISION_REQUIRED]:"#FD7E14"},I=["#0088FE","#00C49F","#FFBB28","#FF8042","#AF19FF","#FF6363","#BC5090"],A=e=>{let s=0;for(let t=0;t<e.length;t++)s=e.charCodeAt(t)+((s<<5)-s);let t=Math.abs(s%I.length);return I[t]};var C=e=>{let{allDocuments:s,onChartFilter:t,activeFilters:l,categories:n}=e,[i,c]=(0,r.useState)(!1);(0,r.useEffect)(()=>{let e=()=>c(window.innerWidth<768);return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);let d=(0,r.useMemo)(()=>{let e={responsibleParty:{BIM:0,SITE:0,CM:0,APPROVED:0,REJECTED:0},categories:{}};for(let a of s){var t;switch(a.status){case h.n$.PENDING_REVIEW:e.responsibleParty.SITE+=1;break;case h.n$.PENDING_CM_APPROVAL:e.responsibleParty.CM+=1;break;case h.n$.REVISION_REQUIRED:case h.n$.APPROVED_REVISION_REQUIRED:e.responsibleParty.BIM+=1;break;case h.n$.REJECTED:e.responsibleParty.REJECTED+=1;break;case h.n$.APPROVED:case h.n$.APPROVED_WITH_COMMENTS:e.responsibleParty.APPROVED+=1}let s=(null===(t=a.category)||void 0===t?void 0:t.id)||"N/A";"N/A"!==s&&(e.categories[s]=(e.categories[s]||0)+1)}return e},[s]),o=(0,r.useMemo)(()=>d?[{name:h.NK[h.n$.PENDING_REVIEW],value:d.responsibleParty.SITE,statusKey:h.n$.PENDING_REVIEW,color:R[h.n$.PENDING_REVIEW]},{name:h.NK[h.n$.PENDING_CM_APPROVAL],value:d.responsibleParty.CM,statusKey:h.n$.PENDING_CM_APPROVAL,color:R[h.n$.PENDING_CM_APPROVAL]},{name:h.NK[h.n$.REVISION_REQUIRED],value:d.responsibleParty.BIM,statusKey:h.n$.REVISION_REQUIRED,color:R[h.n$.REVISION_REQUIRED]},{name:h.NK[h.n$.APPROVED],value:d.responsibleParty.APPROVED,statusKey:h.n$.APPROVED,color:R[h.n$.APPROVED]},{name:h.NK[h.n$.REJECTED],value:d.responsibleParty.REJECTED,statusKey:h.n$.REJECTED,color:R[h.n$.REJECTED]}].filter(e=>e.value>0):[],[d]),m=(0,r.useMemo)(()=>d?Object.entries(d.categories).map(e=>{let[s,t]=e,a=n.find(e=>e.id===s);return{id:s,name:(null==a?void 0:a.categoryCode)||s,value:t,color:A((null==a?void 0:a.categoryCode)||s)}}).filter(e=>e.value>0):[],[d,n]),{displayData:x,total:u}=(0,r.useMemo)(()=>{let e=o.reduce((e,s)=>e+s.value,0);return{displayData:o,total:e}},[o]),{displayData:p,total:g}=(0,r.useMemo)(()=>{let e=m.reduce((e,s)=>e+s.value,0);return{displayData:m,total:e}},[m]);if(!d)return(0,a.jsx)("div",{className:"text-center p-8 text-gray-500",children:"ไม่มีข้อมูลสำหรับแสดงผล"});let f=i?"50%":"40%",I=i?"50%":"30%",C=i?"45%":"50%";return(0,a.jsxs)("div",{className:"relative grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[(0,a.jsx)("div",{children:(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4 text-center",children:"สถานะตามผู้รับผิดชอบ"}),(0,a.jsxs)("div",{className:"relative w-full h-[300px]",children:[(0,a.jsx)(N.h,{children:(0,a.jsxs)(y.u,{children:[(0,a.jsx)(j.b,{data:x,cx:f,cy:"50%",innerRadius:i?80:115,outerRadius:i?110:150,dataKey:"value",nameKey:"name",onClick:e=>{let s=e.payload.statusKey;t("status",l.status===s?"ALL":s)},className:"cursor-pointer",isAnimationActive:!1,children:x.map(e=>(0,a.jsx)(b.b,{fill:e.color,style:{opacity:"ALL"===l.status||l.status===e.statusKey?1:.3}},"cell-".concat(e.name)))}),(0,a.jsx)(v.u,{content:(0,a.jsx)(w,{})}),(0,a.jsx)(E.D,{layout:i?"horizontal":"vertical",verticalAlign:i?"bottom":"middle",align:i?"center":"right",wrapperStyle:i?{paddingTop:"20px"}:{},width:i?void 0:150})]})}),(0,a.jsxs)("div",{className:"absolute -translate-y-1/2 -translate-x-1/2 flex flex-col items-center justify-center pointer-events-none",style:{top:C,left:I},children:[(0,a.jsx)("span",{className:"text-base text-gray-500",children:"จำนวนเอกสาร"}),(0,a.jsx)("span",{className:"text-4xl font-bold text-gray-800 mt-1",children:u})]})]})]})}),(0,a.jsx)("div",{children:(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4 text-center",children:"สถานะตามหมวดหมู่"}),(0,a.jsxs)("div",{className:"relative w-full h-[300px]",children:[(0,a.jsx)(N.h,{children:(0,a.jsxs)(y.u,{children:[(0,a.jsx)(j.b,{data:p,cx:f,cy:"50%",innerRadius:i?80:115,outerRadius:i?110:150,dataKey:"value",nameKey:"name",onClick:e=>{let s=e.payload.id;t("categoryId",l.categoryId===s?"ALL":s)},className:"cursor-pointer",isAnimationActive:!1,children:p.map(e=>(0,a.jsx)(b.b,{fill:e.color,style:{opacity:"ALL"===l.categoryId||l.categoryId===e.id?1:.3}},"cell-".concat(e.name)))}),(0,a.jsx)(v.u,{content:(0,a.jsx)(w,{})}),(0,a.jsx)(E.D,{layout:i?"horizontal":"vertical",verticalAlign:i?"bottom":"middle",align:i?"center":"right",wrapperStyle:i?{paddingTop:"20px"}:{},width:i?void 0:150})]})}),(0,a.jsxs)("div",{className:"absolute -translate-y-1/2 -translate-x-1/2 flex flex-col items-center justify-center pointer-events-none",style:{top:C,left:I},children:[(0,a.jsx)("span",{className:"text-base text-gray-500",children:"จำนวนเอกสาร"}),(0,a.jsx)("span",{className:"text-4xl font-bold text-gray-800 mt-1",children:g})]})]})]})})]})},P=t(3900),D=t(7168),S=t(9397),_=t(3247),k=t(6855),L=t(5978),O=t(5621),T=t(2489),V=t(8736),$=t(1817),M=t(6980),Z=t(2735),F=t(7689),z=t(401),U=t(6865),B=t(4743),G=t(2207),Q=t(1810),K=t(3417),J=t(7157);let W=e=>e?new Date(e).toLocaleString("th-TH",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A",H=e=>{if(0===e)return"0 B";let s=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,s)).toFixed(1))+" "+["B","KB","MB","GB"][s]},q=e=>{let{workflow:s,onClose:t,userRole:l}=e,n=(0,r.useMemo)(()=>{if(l&&h.gf.includes(l)){let e=[h.n$.PENDING_REVIEW,h.n$.REVISION_REQUIRED];return s.filter(s=>!e.includes(s.status))}return s},[s,l]);return(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-60 z-[60] flex items-center justify-center p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[80vh] flex flex-col",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center p-4 border-b",children:[(0,a.jsxs)("h3",{className:"text-lg font-bold text-gray-800 flex items-center",children:[(0,a.jsx)(O.Z,{size:20,className:"mr-2"}),"ประวัติการดำเนินงาน"]}),(0,a.jsx)("button",{onClick:t,className:"text-gray-400 hover:text-gray-600",children:(0,a.jsx)(T.Z,{size:24})})]}),(0,a.jsx)("div",{className:"p-6 overflow-y-auto",children:(0,a.jsx)("div",{className:"border-l-2 border-gray-200 ml-2",children:n.length>0?n.map((e,s)=>(0,a.jsxs)("div",{className:"relative pl-6 pb-8 last:pb-0",children:[(0,a.jsx)("div",{className:"absolute -left-[9px] top-1 w-4 h-4 bg-blue-500 rounded-full border-2 border-white"}),(0,a.jsx)("p",{className:"font-semibold text-gray-800",children:h.NK[e.status]||e.status}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:["โดย: ",e.userName," (",e.role,")"]}),(0,a.jsx)("time",{className:"text-xs text-gray-400",children:W(e.timestamp)}),e.comments&&(0,a.jsx)("div",{className:"mt-2 p-2 bg-gray-50 rounded-md text-xs italic",children:(0,a.jsxs)("p",{className:"text-gray-600",children:['"',e.comments,'"']})}),e.files&&e.files.length>0&&(0,a.jsxs)("div",{className:"mt-2 pl-2 border-l-2 border-gray-100",children:[(0,a.jsx)("p",{className:"text-xs font-semibold text-gray-500 mb-1",children:"ไฟล์แนบ ณ ขั้นตอนนี้:"}),(0,a.jsx)("ul",{className:"space-y-1",children:e.files.map((e,s)=>(0,a.jsxs)("li",{className:"flex items-center text-xs text-gray-600",children:[(0,a.jsx)(V.Z,{size:12,className:"mr-2 flex-shrink-0"}),(0,a.jsx)("a",{href:e.fileUrl,target:"_blank",rel:"noopener noreferrer",className:"truncate hover:underline",title:e.fileName,children:e.fileName})]},s))})]})]},s)):(0,a.jsx)("p",{className:"text-sm text-gray-500 pl-6",children:"ไม่มีประวัติ"})})})]})})};function X(e){let{document:s,onClose:t,onUpdate:l,showOverlay:i=!0}=e,{user:c,firebaseUser:d}=(0,n.a)(),[o,m]=(0,r.useState)(s),[x,u]=(0,r.useState)(!0),[p,g]=(0,r.useState)(!1),[f,N]=(0,r.useState)(!1),[y,j]=(0,r.useState)(""),[b,v]=(0,r.useState)([]),[E,w]=(0,r.useState)(""),[R,I]=(0,r.useState)([]);(0,r.useEffect)(()=>{(async()=>{if(!s||!d){u(!1);return}u(!0);try{let e=await d.getIdToken(),t=await fetch("/api/rfa/".concat(s.id),{headers:{Authorization:"Bearer ".concat(e)}}),a=await t.json();a.success?m(a.document):(console.error("Failed to fetch full document:",a.error),m(s))}catch(e){console.error("Error fetching full document:",e),m(s)}finally{u(!1)}})()},[s,d]);let A=(0,r.useMemo)(()=>(null==o?void 0:o.workflow)&&0!==o.workflow.length?[...o.workflow].reverse().find(e=>e.comments&&""!==e.comments.trim()):null,[null==o?void 0:o.workflow]);if(x)return(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center",children:(0,a.jsx)($.Z,{className:"w-12 h-12 text-white animate-spin"})});if(!o)return null;let C=o.permissions||{},P=o.files||[],D=o.createdBy===(null==c?void 0:c.id),S=o.status===h.n$.REVISION_REQUIRED&&D,_=o.status===h.n$.REJECTED&&D&&o.isLatest,k=(o.revisionNumber||0)+1,L="".concat(o.documentNumber.split("-REV")[0],"-REV").concat(String(k).padStart(2,"0")),W=(null==A?void 0:A.comments)||o.description,X=async e=>{try{if(!d)throw Error("กรุณาล็อกอินก่อนอัปโหลดไฟล์");let s=await d.getIdToken(),t=new FormData;t.append("file",e);let a=await fetch("/api/rfa/upload-temp-file",{method:"POST",headers:{Authorization:"Bearer ".concat(s)},body:t}),r=await a.json();if(r.success)return{status:"success",progress:100,uploadedData:r.fileData};throw Error(r.error||"อัปโหลดล้มเหลว")}catch(e){return{status:"error",error:e instanceof Error?e.message:"เกิดข้อผิดพลาด"}}},Y=(e,s)=>{let t=Array.from(e.target.files||[]);if(!t.length)return;let a=t.map(e=>({id:"".concat(e.name,"-").concat(Date.now()),file:e,status:"pending",progress:0})),r="revision"===s?I:v;r(e=>[...e,...a]),a.forEach(async e=>{r(s=>s.map(s=>s.id===e.id?{...s,status:"uploading"}:s));let s=await X(e.file);r(t=>t.map(t=>t.id===e.id?{...t,...s}:t))}),e.target.value=""},ee=async(e,s)=>{var t;let a=("revision"===s?R:b)[e];if("success"===a.status&&(null===(t=a.uploadedData)||void 0===t?void 0:t.filePath))try{let e=await (null==d?void 0:d.getIdToken());await fetch("/api/rfa/delete-temp-file",{method:"POST",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"},body:JSON.stringify({filePath:a.uploadedData.filePath})})}catch(e){console.error("Failed to delete temp file:",e)}("revision"===s?I:v)(s=>s.filter((s,t)=>t!==e))},es=async e=>{let s=b.filter(e=>"success"===e.status);if(0===s.length){alert("กรุณาแนบไฟล์ใหม่สำหรับขั้นตอนนี้ก่อนดำเนินการ");return}g(!0);try{let a=await (null==d?void 0:d.getIdToken()),r={action:e,comments:y,newFiles:s.map(e=>e.uploadedData)},l=await fetch("/api/rfa/".concat(o.id),{method:"PUT",headers:{Authorization:"Bearer ".concat(a),"Content-Type":"application/json"},body:JSON.stringify(r)}),n=await l.json();if(n.success)alert('ดำเนินการ "'.concat(e,'" สำเร็จ!')),t();else throw Error(n.error||"เกิดข้อผิดพลาด")}catch(e){alert("เกิดข้อผิดพลาด: ".concat(e instanceof Error?e.message:"Unknown error"))}finally{g(!1)}},et=async()=>{let e=R.filter(e=>"success"===e.status);if(0===e.length){alert("กรุณาแนบไฟล์ฉบับแก้ไขอย่างน้อย 1 ไฟล์");return}g(!0);try{let s=await (null==d?void 0:d.getIdToken()),a={originalDocId:o.id,uploadedFiles:e.map(e=>e.uploadedData),comments:E},r=await fetch("/api/rfa/create_revision",{method:"POST",headers:{Authorization:"Bearer ".concat(s),"Content-Type":"application/json"},body:JSON.stringify(a)}),l=await r.json();if(l.success)alert("สร้างเอกสารฉบับแก้ไข ".concat(L," สำเร็จ!")),t();else throw Error(l.error||"เกิดข้อผิดพลาดในการสร้าง Revision")}catch(e){alert("เกิดข้อผิดพลาด: ".concat(e instanceof Error?e.message:"Unknown error"))}finally{g(!1)}},ea=async()=>{await es("SUBMIT_REVISION")};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 ".concat(i?"bg-black bg-opacity-50":""),children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] flex flex-col",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center p-4 border-b",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-bold text-blue-600",children:o.runningNumber||"RFA Document"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:o.documentNumber})]}),(0,a.jsxs)("button",{onClick:()=>N(!0),className:"flex items-center text-sm text-gray-500 hover:text-blue-600",children:[(0,a.jsx)(O.Z,{size:16,className:"mr-1"})," ดูประวัติ"]})]}),(0,a.jsx)("button",{onClick:t,className:"text-gray-400 hover:text-gray-600",children:(0,a.jsx)(T.Z,{size:24})})]}),(0,a.jsxs)("div",{className:"p-6 overflow-y-auto space-y-6",children:[(0,a.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-800 mb-2",children:o.title}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{className:"text-gray-500 block",children:"สถานะ:"}),(0,a.jsx)("span",{className:"font-semibold",children:h.NK[o.status]||o.status})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{className:"text-gray-500 block",children:"หมวดงาน:"}),(0,a.jsx)("span",{children:o.category.categoryCode})]})]}),W&&""!==W.trim()&&(0,a.jsxs)("div",{className:"mt-4",children:[(0,a.jsxs)("strong",{className:"text-gray-500 block text-sm",children:[A?"ความคิดเห็นล่าสุด":"รายละเอียดเพิ่มเติม",":"]}),(0,a.jsx)("div",{className:"text-gray-700 whitespace-pre-wrap bg-white p-3 rounded-md mt-1 border",children:(0,a.jsxs)("p",{className:"italic",children:['"',W,'"']})})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("h4",{className:"text-md font-semibold mb-2 flex items-center",children:[(0,a.jsx)(M.Z,{size:16,className:"mr-2"})," ไฟล์แนบ (ฉบับล่าสุด) (",P.length,")"]}),(0,a.jsx)("ul",{className:"space-y-2",children:P.length>0?P.map((e,s)=>(0,a.jsxs)("li",{className:"flex items-center justify-between bg-gray-50 p-2 rounded-md",children:[(0,a.jsxs)("div",{className:"flex items-center min-w-0",children:[(0,a.jsx)(V.Z,{className:"w-5 h-5 text-gray-500 mr-3 flex-shrink-0"}),(0,a.jsxs)("div",{className:"flex flex-col min-w-0",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-gray-800 truncate",children:e.fileName}),(0,a.jsx)("span",{className:"text-xs text-gray-500",children:H(e.size)})]})]}),(0,a.jsx)("a",{href:e.fileUrl,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 p-2 rounded-full hover:bg-blue-100 flex-shrink-0 ml-2",children:(0,a.jsx)(Z.Z,{size:18})})]},s)):(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"ไม่มีไฟล์แนบในฉบับล่าสุด"})})]})]}),(0,a.jsxs)("div",{className:"p-4 border-t bg-gray-50 rounded-b-lg",children:[S&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h3",{className:"text-lg font-bold text-blue-800",children:"ส่งเอกสารที่แก้ไข (Submit Revision)"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"แสดงความคิดเห็น (Optional)"}),(0,a.jsx)("textarea",{value:y,onChange:e=>j(e.target.value),placeholder:"เพิ่มความคิดเห็น/เหตุผลประกอบ...",className:"w-full p-2 border rounded-md text-sm",rows:2})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"แนบไฟล์ที่แก้ไขแล้ว (จำเป็น)"}),(0,a.jsxs)("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-4 text-center hover:border-blue-500 transition-colors",children:[(0,a.jsx)("input",{type:"file",multiple:!0,onChange:e=>Y(e,"resubmission"),className:"hidden",id:"resubmit-file-upload"}),(0,a.jsxs)("label",{htmlFor:"resubmit-file-upload",className:"cursor-pointer text-blue-600 hover:text-blue-800 font-medium flex items-center justify-center",children:[(0,a.jsx)(F.Z,{size:16,className:"mr-2"}),"คลิกเพื่อเลือกไฟล์"]})]}),(0,a.jsx)("div",{className:"mt-2 space-y-2",children:b.map((e,s)=>(0,a.jsxs)("div",{className:"flex items-center text-sm p-2 bg-gray-100 rounded",children:[(0,a.jsx)(V.Z,{className:"w-4 h-4 mr-2 text-gray-500"}),(0,a.jsx)("span",{className:"flex-1 truncate",children:e.file.name}),"uploading"===e.status&&(0,a.jsx)($.Z,{className:"w-4 h-4 animate-spin text-blue-500"}),"success"===e.status&&(0,a.jsx)(z.Z,{className:"w-4 h-4 text-green-500"}),"error"===e.status&&(0,a.jsx)("span",{title:e.error,children:(0,a.jsx)(U.Z,{className:"w-4 h-4 text-red-500"})}),(0,a.jsx)("button",{onClick:()=>ee(s,"resubmission"),className:"ml-2 text-gray-500 hover:text-red-600",children:(0,a.jsx)(T.Z,{size:16})})]},e.id))})]}),(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsxs)("button",{onClick:ea,disabled:p||0===b.filter(e=>"success"===e.status).length,className:"flex items-center px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 disabled:bg-gray-300",children:[p?(0,a.jsx)($.Z,{className:"animate-spin mr-2"}):(0,a.jsx)(B.Z,{size:16,className:"mr-2"}),"ส่งกลับไปตรวจสอบ"]})})]}),o.status===h.n$.REJECTED&&!o.isLatest&&(0,a.jsxs)("div",{className:"p-4 bg-red-50 text-red-800 rounded-lg flex items-center",children:[(0,a.jsx)(U.Z,{size:24,className:"mr-3 flex-shrink-0 text-red-600"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-bold",children:"เอกสารฉบับนี้ถูกแทนที่แล้ว"}),(0,a.jsxs)("p",{className:"text-sm text-red-700",children:["ได้มีการสร้างเอกสารฉบับใหม่ ",(0,a.jsxs)("strong",{children:["(REV-",String((o.revisionNumber||0)+1).padStart(2,"0"),")"]})," จากเอกสารฉบับนี้แล้ว"]})]})]}),_&&(0,a.jsxs)("div",{className:"p-4 border-t bg-yellow-50 rounded-b-lg",children:[(0,a.jsx)("h3",{className:"text-lg font-bold text-yellow-800 mb-4",children:"สร้างเอกสารฉบับแก้ไข (Create New Revision)"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"เอกสารเดิม:"})," ",o.documentNumber]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"เอกสารใหม่:"})," ",L]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"แนบไฟล์ที่แก้ไขแล้ว (จำเป็น)"}),(0,a.jsxs)("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-4 text-center hover:border-blue-500 transition-colors",children:[(0,a.jsx)("input",{type:"file",multiple:!0,onChange:e=>Y(e,"revision"),className:"hidden",id:"revision-file-upload"}),(0,a.jsxs)("label",{htmlFor:"revision-file-upload",className:"cursor-pointer text-blue-600 hover:text-blue-800 font-medium flex items-center justify-center",children:[(0,a.jsx)(F.Z,{size:16,className:"mr-2"}),"คลิกเพื่อเลือกไฟล์"]})]}),(0,a.jsx)("div",{className:"mt-2 space-y-2",children:R.map((e,s)=>(0,a.jsxs)("div",{className:"flex items-center text-sm p-2 bg-gray-100 rounded",children:[(0,a.jsx)(V.Z,{className:"w-4 h-4 mr-2 text-gray-500"}),(0,a.jsx)("span",{className:"flex-1 truncate",children:e.file.name}),"uploading"===e.status&&(0,a.jsx)($.Z,{className:"w-4 h-4 animate-spin text-blue-500"}),"success"===e.status&&(0,a.jsx)(z.Z,{className:"w-4 h-4 text-green-500"}),"error"===e.status&&(0,a.jsx)("span",{title:e.error,children:(0,a.jsx)(U.Z,{className:"w-4 h-4 text-red-500"})}),(0,a.jsx)("button",{onClick:()=>ee(s,"revision"),className:"ml-2 text-gray-500 hover:text-red-600",children:(0,a.jsx)(T.Z,{size:16})})]},e.id))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"หมายเหตุการแก้ไข (Optional)"}),(0,a.jsx)("textarea",{value:E,onChange:e=>w(e.target.value),placeholder:"เช่น แก้ไขตาม Comment จาก CM...",className:"w-full p-2 border rounded-md text-sm",rows:2})]}),(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsxs)("button",{onClick:et,disabled:p||0===R.filter(e=>"success"===e.status).length,className:"flex items-center px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 disabled:bg-gray-300",children:[p?(0,a.jsx)($.Z,{className:"animate-spin mr-2"}):(0,a.jsx)(B.Z,{size:16,className:"mr-2"}),"ส่งเอกสารฉบับแก้ไข"]})})]})]}),!_&&!S&&(C.canSendToCm||C.canApprove)&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"แสดงความคิดเห็น (Optional)"}),(0,a.jsx)("textarea",{value:y,onChange:e=>j(e.target.value),placeholder:"เพิ่มความคิดเห็น/เหตุผลประกอบ...",className:"w-full p-2 border rounded-md text-sm",rows:2})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"แนบไฟล์ใหม่ (จำเป็น)"}),(0,a.jsxs)("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-4 text-center hover:border-blue-500 transition-colors",children:[(0,a.jsx)("input",{type:"file",multiple:!0,onChange:e=>Y(e,"action"),className:"hidden",id:"action-file-upload"}),(0,a.jsxs)("label",{htmlFor:"action-file-upload",className:"cursor-pointer text-blue-600 hover:text-blue-800 font-medium flex items-center justify-center",children:[(0,a.jsx)(F.Z,{size:16,className:"mr-2"}),"คลิกเพื่อเลือกไฟล์"]})]}),(0,a.jsx)("div",{className:"mt-2 space-y-2",children:b.map((e,s)=>(0,a.jsxs)("div",{className:"flex items-center text-sm p-2 bg-gray-100 rounded",children:[(0,a.jsx)(V.Z,{className:"w-4 h-4 mr-2 text-gray-500"}),(0,a.jsx)("span",{className:"flex-1 truncate",children:e.file.name}),"uploading"===e.status&&(0,a.jsx)($.Z,{className:"w-4 h-4 animate-spin text-blue-500"}),"success"===e.status&&(0,a.jsx)(z.Z,{className:"w-4 h-4 text-green-500"}),"error"===e.status&&(0,a.jsx)("span",{title:e.error,children:(0,a.jsx)(U.Z,{className:"w-4 h-4 text-red-500"})}),(0,a.jsx)("button",{onClick:()=>ee(s,"action"),className:"ml-2 text-gray-500 hover:text-red-600",children:(0,a.jsx)(T.Z,{size:16})})]},e.id))})]}),C.canSendToCm&&(0,a.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,a.jsxs)("button",{onClick:()=>es("REQUEST_REVISION"),disabled:p||0===b.filter(e=>"success"===e.status).length,className:"flex items-center px-4 py-2 text-sm font-medium text-white bg-yellow-500 rounded-lg hover:bg-yellow-600 disabled:bg-gray-300",children:[(0,a.jsx)(G.Z,{size:16,className:"mr-2"}),"ขอแก้ไข"]}),(0,a.jsxs)("button",{onClick:()=>es("SEND_TO_CM"),disabled:p||0===b.filter(e=>"success"===e.status).length,className:"flex items-center px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 disabled:bg-gray-300",children:[(0,a.jsx)(B.Z,{size:16,className:"mr-2"}),"ส่งให้ CM"]})]}),C.canApprove&&(0,a.jsxs)("div",{className:"flex flex-wrap justify-end gap-3",children:[(0,a.jsxs)("button",{onClick:()=>es("APPROVE"),disabled:p||0===b.filter(e=>"success"===e.status).length,className:"flex items-center px-4 py-2 text-sm font-medium text-white bg-green-600 rounded-lg hover:bg-green-700 disabled:bg-gray-300",children:[(0,a.jsx)(Q.Z,{size:16,className:"mr-2"}),"อนุมัติ (Approve)"]}),(0,a.jsxs)("button",{onClick:()=>es("APPROVE_WITH_COMMENTS"),disabled:p||0===b.filter(e=>"success"===e.status).length,className:"flex items-center px-4 py-2 text-sm font-medium text-white bg-teal-600 rounded-lg hover:bg-teal-700 disabled:bg-gray-300",children:[(0,a.jsx)(K.Z,{size:16,className:"mr-2"}),"อนุมัติตามคอมเมนต์"]}),(0,a.jsxs)("button",{onClick:()=>es("APPROVE_REVISION_REQUIRED"),disabled:p||0===b.filter(e=>"success"===e.status).length,className:"flex items-center px-4 py-2 text-sm font-medium text-white bg-orange-500 rounded-lg hover:bg-orange-600 disabled:bg-gray-300",children:[(0,a.jsx)(G.Z,{size:16,className:"mr-2"}),"อนุมัติแต่ต้องแก้ไข"]}),(0,a.jsxs)("button",{onClick:()=>es("REJECT"),disabled:p||0===b.filter(e=>"success"===e.status).length,className:"flex items-center px-4 py-2 text-sm font-medium text-white bg-red-600 rounded-lg hover:bg-red-700 disabled:bg-gray-300",children:[(0,a.jsx)(J.Z,{size:16,className:"mr-2"}),"ไม่อนุมัติ (Reject)"]})]})]})]})]})}),f&&(0,a.jsx)(q,{workflow:o.workflow||[],onClose:()=>N(!1),userRole:null==c?void 0:c.role})]})}function Y(e){let{documentId:s,onClose:t}=e;(0,l.useRouter)();let n=(0,l.useSearchParams)(),[i,c]=(0,r.useState)(null);return((0,r.useEffect)(()=>{if(!s){c(null);return}(async()=>{let e=(0,L.JU)(k.db,"rfaDocuments",s),a=await (0,L.QT)(e);a.exists()?c({id:a.id,...a.data()}):(alert("Error: ไม่พบเอกสารที่คุณต้องการ"),t())})()},[s,t]),(0,r.useEffect)(()=>{let e=n.toString(),a="/dashboard/rfa?".concat(e.replace(/&?docId=[^&]*/,""),"&docId=").concat(s),r=e=>{t()};return s&&(window.history.pushState({docId:s},"",a),window.addEventListener("popstate",r)),()=>{window.removeEventListener("popstate",r)}},[s,t,n]),s)?(0,a.jsx)(X,{document:i,onClose:t,onUpdate:c}):null}let ee={"RFA-SHOP":"Shop Drawing","RFA-GEN":"General","RFA-MAT":"Material"};function es(){let{user:e,firebaseUser:s}=(0,n.a)(),t=(0,l.useRouter)(),d=(0,l.useSearchParams)(),[o,m]=(0,r.useState)([]),[x,u]=(0,r.useState)(!0),[p,g]=(0,r.useState)(null),[N,y]=(0,r.useState)(""),[j,b]=(0,r.useState)([]),[v,E]=(0,r.useState)(!1),[w,R]=(0,r.useState)({rfaType:d.get("type")||"ALL",status:"ALL",siteId:"ALL",showAllRevisions:!1,categoryId:"ALL",responsibleParty:"ALL"}),I=(0,r.useMemo)(()=>{let s=Object.values(h.n$);if(e&&h.gf.includes(e.role)){let e=[h.n$.PENDING_REVIEW,h.n$.REVISION_REQUIRED];return s.filter(s=>!e.includes(s))}return s},[e]),A=(0,r.useMemo)(()=>e&&h.gf.includes(e.role)?[{value:"ALL",label:"ทุกคน"},{value:"CM",label:"CM"}]:[{value:"ALL",label:"ทุกคน"},...h.uc.map(e=>({value:e,label:e})),{value:"SITE",label:"Site"},{value:"CM",label:"CM"}],[e]);(0,r.useEffect)(()=>{let e=d.get("docId");e&&g(e)},[d]),(0,r.useEffect)(()=>{let e=d.get("type")||"ALL";e!==w.rfaType&&V("rfaType",e)},[d,w.rfaType]),(0,r.useEffect)(()=>{if(!s||!(null==e?void 0:e.sites)||0===e.sites.length){u(!1);return}u(!0);let t=(0,L.IO)((0,L.hJ)(k.db,"rfaDocuments"),(0,L.ar)("siteId","in",e.sites),(0,L.Xo)("updatedAt","desc")),a=(0,L.cf)(t,e=>{let s=[];e.forEach(e=>{var t,a,r,l,n;let i=e.data();s.push({id:e.id,...i,site:{id:i.siteId,name:i.siteName||"N/A"},category:{id:i.categoryId,categoryCode:(null===(t=i.taskData)||void 0===t?void 0:t.taskCategory)||i.categoryId||"N/A",categoryName:""},createdByInfo:{email:(null===(r=i.workflow)||void 0===r?void 0:null===(a=r[0])||void 0===a?void 0:a.userName)||"N/A",role:(null===(n=i.workflow)||void 0===n?void 0:null===(l=n[0])||void 0===l?void 0:l.role)||"N/A"},permissions:{}})}),m(s),u(!1)},e=>{console.error("Error fetching realtime documents:",e),u(!1)});return()=>a()},[s,e]);let O=(0,r.useMemo)(()=>{let s;let t=e&&h.gf.includes(e.role),a=[h.n$.PENDING_REVIEW,h.n$.REVISION_REQUIRED];if(w.showAllRevisions)s=o;else{let e=new Map;o.forEach(s=>{let t=s.parentRfaId||s.id;e.has(t)||e.set(t,[]),e.get(t).push(s)});let r=[];e.forEach(e=>{if(0===e.length)return;e.sort((e,s)=>(s.revisionNumber||0)-(e.revisionNumber||0));let s=e[0];if(t){if(s&&!a.includes(s.status))r.push(s);else{let s=e.find(e=>!a.includes(e.status));s&&r.push(s)}}else r.push(s)}),s=r}if(t&&(s=s.filter(e=>!a.includes(e.status))),"ALL"!==w.rfaType&&(s=s.filter(e=>e.rfaType===w.rfaType)),"ALL"!==w.status&&(s=s.filter(e=>e.status===w.status)),"ALL"!==w.categoryId&&(s=s.filter(e=>{var s;return(null===(s=e.category)||void 0===s?void 0:s.id)===w.categoryId})),"ALL"!==w.responsibleParty&&(s=s.filter(e=>{var s;let t=w.responsibleParty,a=e.status,r=null===(s=e.createdByInfo)||void 0===s?void 0:s.role;if("SITE"===t)return a===h.n$.PENDING_REVIEW;if("CM"===t)return a===h.n$.PENDING_CM_APPROVAL;if(r&&h.uc.includes(r)){let s=a===h.n$.REVISION_REQUIRED||a===h.n$.APPROVED_REVISION_REQUIRED,l=a===h.n$.REJECTED&&e.isLatest;return(s||l)&&r===t}return!1})),N.trim()){let e=N.toLowerCase();s=s.filter(s=>s.documentNumber.toLowerCase().includes(e)||s.title.toLowerCase().includes(e))}return s},[o,w,e,N]),T=async()=>{if(s)try{let e=await s.getIdToken(),t=await fetch("/api/rfa/categories?rfaType=ALL",{headers:{Authorization:"Bearer ".concat(e)}}),a=await t.json();if(a.success){let e=Array.from(new Map(a.categories.map(e=>[e.id,e])).values());b(e)}}catch(e){console.error("Failed to load categories:",e)}};(0,r.useEffect)(()=>{s&&T()},[s]);let V=(e,s)=>{R(t=>({...t,[e]:s}))};return e?(0,a.jsx)(i.a1,{children:(0,a.jsx)(c.Z,{children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,a.jsxs)("div",{className:"mb-6 flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h1",{className:"text-2xl lg:text-3xl font-bold text-gray-900",children:["\uD83D\uDCCB RFA Documents",w.rfaType&&"ALL"!==w.rfaType&&(0,a.jsxs)("span",{className:"text-orange-600",children:[" - ",ee[w.rfaType]]})]}),(0,a.jsx)("p",{className:"text-gray-600 mt-1",children:"จัดการเอกสาร Request for Approval"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-3 mt-4 sm:mt-0",children:[(0,a.jsxs)("button",{onClick:()=>{},className:"flex items-center px-3 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200",disabled:x,children:[(0,a.jsx)(D.Z,{className:"w-4 h-4 mr-2 ".concat(x?"animate-spin":"")}),x?"Syncing...":"Real-time"]}),(0,a.jsxs)("button",{onClick:()=>{E(!0)},className:"flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[(0,a.jsx)(S.Z,{className:"w-4 h-4 mr-2"}),"สร้าง RFA"]})]})]}),(0,a.jsx)(C,{allDocuments:O,onChartFilter:(e,s)=>{R(t=>({...t,[e]:s}))},activeFilters:w,categories:j}),(0,a.jsx)("div",{className:"bg-white rounded-lg shadow mb-6 p-4",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-12 gap-4 items-end",children:[(0,a.jsxs)("div",{className:"md:col-span-3",children:[(0,a.jsx)("label",{htmlFor:"search-filter",className:"text-sm font-medium text-gray-700",children:"ค้นหา"}),(0,a.jsxs)("div",{className:"relative mt-1",children:[(0,a.jsx)(_.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),(0,a.jsx)("input",{id:"search-filter",type:"text",placeholder:"เลขที่เอกสาร, ชื่อเอกสาร...",value:N,onChange:e=>y(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg"})]})]}),(0,a.jsxs)("div",{className:"md:col-span-2",children:[(0,a.jsx)("label",{htmlFor:"status-filter",className:"text-sm font-medium text-gray-700",children:"สถานะ"}),(0,a.jsxs)("select",{id:"status-filter",value:w.status,onChange:e=>V("status",e.target.value),className:"w-full mt-1 px-3 py-2 border border-gray-300 rounded-lg",children:[(0,a.jsx)("option",{value:"ALL",children:"ทุกสถานะ"}),I.map(e=>(0,a.jsx)("option",{value:e,children:h.NK[e]||e},e))]})]}),(0,a.jsxs)("div",{className:"md:col-span-2",children:[(0,a.jsx)("label",{htmlFor:"responsible-party-filter",className:"text-sm font-medium text-gray-700",children:"ผู้รับผิดชอบ"}),(0,a.jsx)("select",{id:"responsible-party-filter",value:w.responsibleParty,onChange:e=>V("responsibleParty",e.target.value),className:"w-full mt-1 px-3 py-2 border border-gray-300 rounded-lg",children:A.map(e=>(0,a.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,a.jsxs)("div",{className:"md:col-span-2",children:[(0,a.jsx)("label",{htmlFor:"category-filter",className:"text-sm font-medium text-gray-700",children:"หมวดงาน"}),(0,a.jsxs)("select",{id:"category-filter",className:"w-full mt-1 px-3 py-2 border border-gray-300 rounded-lg",value:w.categoryId,onChange:e=>V("categoryId",e.target.value),children:[(0,a.jsx)("option",{value:"ALL",children:"ทุกหมวดงาน"}),j.map(e=>(0,a.jsx)("option",{value:e.id,children:e.categoryCode},e.id))]})]}),(0,a.jsxs)("div",{className:"md:col-span-1 flex items-center h-10",children:[(0,a.jsx)("input",{id:"show-all-revisions",type:"checkbox",checked:w.showAllRevisions,onChange:e=>V("showAllRevisions",e.target.checked),className:"h-4 w-4 rounded border-gray-300 text-blue-600"}),(0,a.jsx)("label",{htmlFor:"show-all-revisions",className:"ml-2 text-sm text-gray-700",children:"ทุกฉบับ"})]}),(0,a.jsx)("div",{className:"md:col-span-2",children:(0,a.jsx)("button",{onClick:()=>{R({rfaType:w.rfaType,status:"ALL",siteId:"ALL",showAllRevisions:!1,categoryId:"ALL",responsibleParty:"ALL"}),y("")},className:"w-full px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300",children:"รีเซ็ต"})})]})}),x?(0,a.jsx)("div",{className:"text-center p-8",children:"กำลังโหลดเอกสาร..."}):0===O.length?(0,a.jsx)("div",{className:"text-center bg-white rounded-lg shadow p-8",children:(0,a.jsx)("p",{className:"text-gray-500",children:"ไม่พบเอกสารที่ตรงกับเงื่อนไข"})}):(0,a.jsx)(f,{documents:O,onDocumentClick:e=>{g(e.id)},getStatusColor:e=>{switch(e){case h.n$.APPROVED:case h.n$.APPROVED_WITH_COMMENTS:case h.n$.APPROVED_REVISION_REQUIRED:return"text-green-600 bg-green-50";case h.n$.REJECTED:return"text-red-600 bg-red-50";case h.n$.PENDING_CM_APPROVAL:return"text-orange-600 bg-orange-50";case h.n$.PENDING_REVIEW:return"text-blue-600 bg-blue-50";case h.n$.REVISION_REQUIRED:return"text-yellow-600 bg-yellow-50";default:return"text-gray-600 bg-gray-50"}},statusLabels:h.NK,getRFATypeColor:e=>{switch(e){case"RFA-SHOP":return"bg-blue-100 text-blue-800";case"RFA-GEN":return"bg-green-100 text-green-800";case"RFA-MAT":return"bg-orange-100 text-orange-800";default:return"bg-gray-100 text-gray-800"}}}),v&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-60 z-50 flex items-center justify-center p-4",children:(0,a.jsx)(P.Z,{onClose:()=>{E(!1)},isModal:!0,userProp:e?{id:e.id,email:e.email,role:e.role,sites:e.sites||[]}:void 0,presetRfaType:"ALL"!==w.rfaType?w.rfaType:void 0})}),(0,a.jsx)(Y,{documentId:p,onClose:()=>{g(null);let e=new URLSearchParams(window.location.search);e.delete("docId"),t.push("/dashboard/rfa?".concat(e.toString()))}})]})})}):null}function et(){return(0,a.jsx)(r.Suspense,{fallback:(0,a.jsx)("div",{children:"Loading..."}),children:(0,a.jsx)(es,{})})}}},function(e){e.O(0,[609,15,351,849,707,514,900,971,117,744],function(){return e(e.s=1417)}),_N_E=e.O()}]);