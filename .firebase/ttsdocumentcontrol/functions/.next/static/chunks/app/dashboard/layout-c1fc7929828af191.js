(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[663],{49:function(e,t,n){Promise.resolve().then(n.bind(n,7123))},7123:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return E}});var r=n(7437),i=n(2265),o=n(1313);function E(e){let{children:t}=e;return(0,r.jsx)(i.Suspense,{fallback:(0,r.jsx)("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}),children:(0,r.jsx)(o.Z,{children:t})})}},7649:function(e,t,n){"use strict";n.d(t,{AuthProvider:function(){return l},a:function(){return I}});var r=n(7437),i=n(2265),o=n(2148),E=n(5978),s=n(7012),c=n(6855);let a=(0,i.createContext)({user:null,firebaseUser:null,loading:!0,error:null,logout:async()=>{},requestNotificationPermission:async()=>{}}),u=()=>/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);function l(e){let{children:t}=e,[n,l]=(0,i.useState)(null),[I,d]=(0,i.useState)(null),[P,D]=(0,i.useState)(!0),[N,A]=(0,i.useState)(null),R=async(e,t)=>{if(c.Fw){if(!u()&&"SAVE"===t){console.log("\uD83D\uDCBB Desktop detected: Notifications are disabled for desktop devices.");return}try{if("SAVE"===t){let t=await Notification.requestPermission();if("granted"===t){let t=await (0,s.LP)(c.Fw,{vapidKey:"BJ13x_HEhi6a7lCuv73CZw78pcmHWQoLdNNZag8EZPcJSD-VNyb2ENgAt_KGnf30p6AzVrE89HckdU4wn4wq9wA"});t&&(await (0,E.r7)((0,E.JU)(c.db,"users",e),{fcmTokens:[t],lastLogin:new Date}),console.log("\uD83D\uDCF1 Mobile Notification Token Updated"))}}else"REMOVE"===t&&await (0,s.pQ)(c.Fw)}catch(e){console.error("FCM Token Error:",e)}}};(0,i.useEffect)(()=>{"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw.js").then(e=>{console.log("✅ PWA Service Worker (sw.js) registered successfully:",e.scope)}).catch(e=>{console.error("❌ PWA Service Worker registration failed:",e)})},[]),(0,i.useEffect)(()=>{if(c.Fw&&u()){let e=(0,s.ps)(c.Fw,e=>{var t,n,r;console.log("\uD83D\uDCE9 Foreground Message Received:",e);let i=(null===(t=e.data)||void 0===t?void 0:t.title)||"การแจ้งเตือนใหม่",o=(null===(n=e.data)||void 0===n?void 0:n.body)||"",E=null===(r=e.data)||void 0===r?void 0:r.url;if("granted"===Notification.permission){let e=new Notification(i,{body:o,icon:"/favicon.ico"});e.onclick=()=>{E&&(window.location.href=E),e.close()}}});return()=>e()}},[]),(0,i.useEffect)(()=>{let e=null,t=(0,o.Aj)(c.I8,async t=>{if(D(!0),l(t),e&&(e(),e=null),t){let n=(0,E.JU)(c.db,"users",t.uid);e=(0,E.cf)(n,e=>{if(e.exists()){var n,r;let i=e.data();if("DISABLED"===i.status){(0,o.w7)(c.I8),d(null),A("บัญชีของคุณถูกระงับการใช้งาน");return}d({id:t.uid,email:t.email||"",role:i.role,sites:i.sites||[],status:i.status||"ACTIVE",createdFromInvitation:i.createdFromInvitation,createdAt:null===(n=i.createdAt)||void 0===n?void 0:n.toDate(),acceptedAt:null===(r=i.acceptedAt)||void 0===r?void 0:r.toDate()})}else d(null);D(!1)},e=>{console.error("Snapshot Error:",e),D(!1)}),R(t.uid,"SAVE")}else d(null),D(!1)});return()=>{t(),e&&e()}},[]);let f=async()=>{try{(null==I?void 0:I.id)&&await R(I.id,"REMOVE"),await (0,o.w7)(c.I8),d(null)}catch(e){throw console.error("Logout error:",e),e}},_=async()=>{if(!u()){alert("ระบบแจ้งเตือนรองรับเฉพาะการใช้งานบนโทรศัพท์มือถือเท่านั้น");return}(null==I?void 0:I.id)&&(await R(I.id,"SAVE"),alert("เปิดรับการแจ้งเตือนเรียบร้อยแล้ว"))};return(0,r.jsx)(a.Provider,{value:{user:I,firebaseUser:n,loading:P,error:N,logout:f,requestNotificationPermission:_},children:t})}function I(){return(0,i.useContext)(a)}},453:function(e,t,n){"use strict";n.d(t,{$p:function(){return c},Ge:function(){return u},K$:function(){return r},NK:function(){return l},c9:function(){return s},gf:function(){return E},n$:function(){return a},oU:function(){return o},uc:function(){return i},yh:function(){return I}});let r={ADMIN:"Admin",BIM:"BIM",SITE_ADMIN:"Site Admin",CM:"CM",ME:"ME",SN:"SN",OE:"OE",PE:"PE",PM:"PM",PD:"PD",SE:"SE",FM:"FM",ADMIN_SITE_2:"Adminsite2"},i=[r.BIM,r.ME,r.SN,r.ADMIN],o=[r.SITE_ADMIN,r.ADMIN_SITE_2,r.OE,r.PE,r.ADMIN],E=[r.CM,r.PD,r.ADMIN];r.PM,r.ADMIN,r.SE,r.FM;let s=[r.PE,r.OE,r.ADMIN],c=[r.PD,r.PM,r.ADMIN],a={PENDING_REVIEW:"PENDING_REVIEW",PENDING_CM_APPROVAL:"PENDING_CM_APPROVAL",REVISION_REQUIRED:"REVISION_REQUIRED",APPROVED:"APPROVED",APPROVED_WITH_COMMENTS:"APPROVED_WITH_COMMENTS",APPROVED_REVISION_REQUIRED:"APPROVED_REVISION_REQUIRED",REJECTED:"REJECTED",PENDING_FINAL_APPROVAL:"PENDING_FINAL_APPROVAL"},u={DRAFT:"DRAFT",REJECTED_BY_PM:"REJECTED_BY_PM",PENDING_BIM:"PENDING_BIM",IN_PROGRESS:"IN_PROGRESS",PENDING_ACCEPTANCE:"PENDING_ACCEPTANCE",REVISION_REQUESTED:"REVISION_REQUESTED",COMPLETED:"COMPLETED"},l={[a.PENDING_REVIEW]:"รอตรวจสอบ",[a.PENDING_CM_APPROVAL]:"ส่ง CM",[a.REVISION_REQUIRED]:"แก้ไข",[a.APPROVED]:"อนุมัติ",[a.APPROVED_WITH_COMMENTS]:"อนุมัติตามคอมเมนต์ (ไม่แก้ไข)",[a.APPROVED_REVISION_REQUIRED]:"อนุมัติตามคอมเมนต์ (ต้องแก้ไข)",[a.REJECTED]:"ไม่อนุมัติ",[a.PENDING_FINAL_APPROVAL]:"รอ SITE อนุมัติขั้นสุดท้าย",[u.DRAFT]:"รออนุมัติ (PM)",[u.REJECTED_BY_PM]:"ไม่อนุมัติ (PM)",[u.PENDING_BIM]:"รอ BIM รับงาน",[u.IN_PROGRESS]:"BIM กำลังดำเนินการ",[u.PENDING_ACCEPTANCE]:"รอตรวจรับ (Site)",[u.REVISION_REQUESTED]:"ขอแก้ไข (WR)",[u.COMPLETED]:"เสร็จสิ้น"},I={[a.PENDING_REVIEW]:"#0088FE",[a.PENDING_CM_APPROVAL]:"#00C49F",[a.REVISION_REQUIRED]:"#FFBB28",[a.APPROVED]:"#28A745",[a.REJECTED]:"#DC3545",[a.APPROVED_WITH_COMMENTS]:"#2f3e3aff",[a.APPROVED_REVISION_REQUIRED]:"#FD7E14",[u.DRAFT]:"#6c757d",[u.REJECTED_BY_PM]:"#DC3545",[u.PENDING_BIM]:"#0088FE",[u.IN_PROGRESS]:"#FFBB28",[u.PENDING_ACCEPTANCE]:"#AF19FF",[u.REVISION_REQUESTED]:"#FD7E14",[u.COMPLETED]:"#28A745"}},6855:function(e,t,n){"use strict";n.d(t,{Fw:function(){return u},I8:function(){return c},db:function(){return a}});var r=n(738),i=n(2148),o=n(5978),E=n(7012);let s=(0,r.C6)().length>0?(0,r.Mq)():(0,r.ZF)({apiKey:"AIzaSyAsayb-DEOBE0zi0qh-dPBfihClgXrX1sY",authDomain:"ttsdocumentcontrol.firebaseapp.com",projectId:"ttsdocumentcontrol",storageBucket:"ttsdocumentcontrol.firebasestorage.app",messagingSenderId:"48440915675",appId:"1:48440915675:web:f11611895bfb52d4d27efe"}),c=(0,i.v0)(s),a=(0,o.ad)(s),u=null;(0,E.Gb)().then(e=>{e&&(u=(0,E.KL)(s))});try{(0,o.ST)(a).then(()=>{console.log("✅ Firestore offline persistence enabled.")}).catch(e=>{"failed-precondition"==e.code?console.warn("Firestore persistence failed: Multiple tabs open."):"unimplemented"==e.code&&console.warn("Firestore persistence is not supported in this browser.")})}catch(e){console.error("An error occurred while enabling Firestore persistence:",e)}}},function(e){e.O(0,[609,15,134,627,313,971,997,744],function(){return e(e.s=49)}),_N_E=e.O()}]);