"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[478],{3900:function(e,s,t){t.d(s,{Z:function(){return v}});var a=t(7437),r=t(2265),l=t(2489),i=t(3245),n=t(1817),d=t(401),c=t(6980),o=t(7689),m=t(8736),x=t(6865),u=t(7649);let h=()=>{let[e,s]=(0,r.useState)(!1),[t,a]=(0,r.useState)(null),{firebaseUser:l}=(0,u.a)(),i=(0,r.useCallback)(async(e,s)=>{if(!l)throw Error("User not authenticated");let t=await l.getIdToken(),a=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify(s)}),r=await a.json();if(!r.success)throw Error(r.error||"Request failed");return r.data},[l]);return{loading:e,error:t,getProjects:(0,r.useCallback)(async e=>{s(!0),a(null);try{return(await i("/api/google-sheets/projects",e)).projects}catch(e){throw a(e.message),e}finally{s(!1)}},[i]),getCategories:(0,r.useCallback)(async(e,t,r)=>{s(!0),a(null);try{return(await i("/api/google-sheets/categories",{...e,projectName:t,rfaType:r})).categories}catch(e){throw a(e.message),e}finally{s(!1)}},[i]),getTasks:(0,r.useCallback)(async(e,t,r)=>{s(!0),a(null);try{return(await i("/api/google-sheets/tasks",{...e,projectName:t,category:r})).tasks}catch(e){throw a(e.message),e}finally{s(!1)}},[i]),clearError:()=>a(null)}};var g=t(9761),b=t(453),p=t(4001),y=t(6855),f=t(5978);let j={rfaType:"",categoryId:"",documentNumber:"",title:"",description:"",revisionNumber:"00",uploadedFiles:[],selectedProject:"",selectedCategory:"",selectedTask:null},N={"RFA-SHOP":{title:"RFA-SHOP",subtitle:"Shop Drawing Approval",icon:"\uD83C\uDFD7️",description:"สำหรับการขออนุมัติ Shop Drawing",workflow:"ผู้สร้าง → Site Admin → CM",allowedRoles:[b.K$.BIM,b.K$.ME,b.K$.SN,b.K$.SITE_ADMIN,b.K$.ADMIN],color:"blue"},"RFA-GEN":{title:"RFA-GEN",subtitle:"General Submission",icon:"\uD83D\uDCCB",description:"สำหรับการส่งเอกสารทั่วไป",workflow:"ผู้สร้าง → CM",allowedRoles:[b.K$.BIM,b.K$.SITE_ADMIN,b.K$.ADMIN,b.K$.ME,b.K$.SN],color:"green"},"RFA-MAT":{title:"RFA-MAT",subtitle:"Material Approval",icon:"\uD83E\uDDF1",description:"สำหรับการขออนุมัติวัสดุ",workflow:"Site Admin → CM",allowedRoles:[b.K$.SITE_ADMIN,b.K$.ADMIN],color:"orange"}};function v(e){var s,t;let{onClose:v,isModal:w=!1,userProp:k,presetRfaType:C}=e,[T,I]=(0,r.useState)({...j,rfaType:C||""}),[F,S]=(0,r.useState)(!1),[A,E]=(0,r.useState)(!1),[D,M]=(0,r.useState)({}),[R,O]=(0,r.useState)(!1),[Z,P]=(0,r.useState)([]),[K,$]=(0,r.useState)([]),[B,z]=(0,r.useState)([]),[_,J]=(0,r.useState)(""),[G,L]=(0,r.useState)(!1),[H,U]=(0,r.useState)(null),[q,X]=(0,r.useState)(""),{firebaseUser:Q,user:V}=(0,u.a)(),{showNotification:W}=(0,p.l)(),{loading:Y,error:ee,getCategories:es,getTasks:et}=h(),[ea,er]=(0,r.useState)(""),[el,ei]=(0,r.useState)([]),en=(0,r.useMemo)(()=>!k||"RFA-MAT"===T.rfaType||"RFA-GEN"===T.rfaType||"RFA-SHOP"!==T.rfaType||k.role!==b.K$.BIM,[k,T.rfaType]);(0,r.useEffect)(()=>{(async()=>{if((null==V?void 0:V.sites)&&0!==V.sites.length){E(!0);try{let e=(0,f.IO)((0,f.hJ)(y.db,"sites"),(0,f.ar)((0,f.Jm)(),"in",V.sites)),s=(await (0,f.PL)(e)).docs.map(e=>{var s,t,a,r;return{id:e.id,name:e.data().name,sheetId:(null===(t=e.data().settings)||void 0===t?void 0:null===(s=t.googleSheetsConfig)||void 0===s?void 0:s.spreadsheetId)||"",sheetName:(null===(r=e.data().settings)||void 0===r?void 0:null===(a=r.googleSheetsConfig)||void 0===a?void 0:a.sheetName)||""}});P(s)}catch(e){console.error("Error loading sites:",e),W("error","เกิดข้อผิดพลาด","ไม่สามารถโหลดรายชื่อโครงการได้")}finally{E(!1)}}})()},[V]),(0,r.useEffect)(()=>{if(!_||!T.documentNumber){U(null);return}L(!0);let e=setTimeout(()=>{X(T.documentNumber)},500);return()=>{clearTimeout(e)}},[T.documentNumber,_]),(0,r.useEffect)(()=>{q&&_&&(async()=>{L(!0),U(null);try{let e=await fetch("/api/rfa/check-duplicate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({siteId:_,documentNumber:q})}),s=await e.json();U(!s.isDuplicate)}catch(e){console.error("Failed to check duplicate:",e),U(null)}finally{L(!1)}})()},[q,_]);let ed=e=>{I(s=>({...s,...e}));let s={...D};Object.keys(e).forEach(e=>delete s[e]),M(s)},ec=()=>{let e={};if(!C){if(T.rfaType){let s=N[T.rfaType];k&&!s.allowedRoles.includes(k.role)&&(e.rfaType="คุณไม่มีสิทธิ์สร้าง ".concat(T.rfaType))}else e.rfaType="กรุณาเลือกประเภท RFA"}return T.title.trim()||(e.title="กรุณาใส่หัวข้อเอกสาร"),T.revisionNumber.trim()||(e.revisionNumber="กรุณาใส่ Rev. No."),_||(e.site="กรุณาเลือกโครงการ"),T.documentNumber.trim()?!1===H&&(e.documentNumber="เลขที่เอกสารนี้ถูกใช้ไปแล้ว"):e.documentNumber="กรุณาใส่เลขที่เอกสาร",en?T.categoryId.trim()||(e.categoryId="กรุณากรอกหมวดงาน"):T.selectedTask||(e.task="กรุณาเลือกงานจาก BIM Tracking"),0===T.uploadedFiles.filter(e=>"success"===e.status).length&&(e.files="กรุณาอัปโหลดไฟล์อย่างน้อย 1 ไฟล์"),M(e),0===Object.keys(e).length},eo=async()=>{if(!ec()){W("warning","ข้อมูลไม่ครบถ้วน","กรุณากรอกข้อมูลในช่องที่มีเครื่องหมาย * ให้ครบ");return}O(!0);try{var e;if(!Q)throw Error("กรุณาล็อกอินก่อน");let s=await Q.getIdToken(),t=T.uploadedFiles.filter(e=>"success"===e.status&&e.uploadedData),a=en?T.categoryId:null===(e=T.selectedTask)||void 0===e?void 0:e.taskCategory,r=en?null:T.selectedTask;if(!a)throw Error("ไม่สามารถระบุ Category ID ได้");let l={rfaType:T.rfaType,title:T.title,description:T.description,siteId:_,documentNumber:T.documentNumber,revisionNumber:parseInt(T.revisionNumber,10)||0,uploadedFiles:t.map(e=>e.uploadedData),categoryId:a,taskData:r},i=await fetch("/api/rfa/create",{method:"POST",headers:{Authorization:"Bearer ".concat(s),"Content-Type":"application/json"},body:JSON.stringify({payload:l})}),n=await i.json();if(!i.ok)throw Error(n.error||"เกิดข้อผิดพลาดในการสร้างเอกสาร");if(n.success)W("success","สร้าง RFA สำเร็จ!","หมายเลขเอกสาร: ".concat(n.runningNumber)),v&&v();else throw Error(n.error)}catch(e){W("error","เกิดข้อผิดพลาด",e instanceof Error?e.message:"An unknown error occurred.")}finally{O(!1)}},em=async e=>{try{if(!Q)throw Error("กรุณาล็อกอินก่อนอัปโหลดไฟล์");let s=await Q.getIdToken(),t=new FormData;t.append("file",e);let a=await fetch("/api/rfa/upload-temp-file",{method:"POST",headers:{Authorization:"Bearer ".concat(s)},body:t}),r=await a.json();if(r.success)return{status:"success",progress:100,uploadedData:r.fileData};throw Error(r.error||"อัปโหลดล้มเหลว")}catch(e){return{status:"error",error:e instanceof Error?e.message:"เกิดข้อผิดพลาด"}}},ex=async e=>{let s=Array.from(e.target.files||[]);if(!s.length)return;let t=s.map(e=>({id:"".concat(e.name,"-").concat(Date.now()),file:e,status:"pending",progress:0,retryCount:0}));for(let e of(I(e=>({...e,uploadedFiles:[...e.uploadedFiles,...t]})),t)){I(s=>({...s,uploadedFiles:s.uploadedFiles.map(s=>s.id===e.id?{...s,status:"uploading"}:s)}));let s=await em(e.file);I(t=>({...t,uploadedFiles:t.uploadedFiles.map(t=>t.id===e.id?{...t,...s}:t)}))}e.target.value=""},eu=e=>{var s;null===(s=T.uploadedFiles[e].uploadedData)||void 0===s||s.filePath,ed({uploadedFiles:T.uploadedFiles.filter((s,t)=>t!==e)})},eh=async e=>{if(J(e),ed({categoryId:"",selectedCategory:"",selectedTask:null}),ei([]),$([]),z([]),er(""),!e)return;let s=Z.find(s=>s.id===e);if(s){if(E(!0),en)try{let s=(0,f.IO)((0,f.hJ)(y.db,"sites/".concat(e,"/categories")),(0,f.Xo)("categoryCode")),t=(await (0,f.PL)(s)).docs.map(e=>({id:e.id,categoryCode:e.data().categoryCode,categoryName:e.data().categoryName}));ei(t)}catch(e){console.error("Failed to fetch site categories:",e),M(e=>({...e,site:"ไม่สามารถโหลดหมวดงานได้"}))}finally{E(!1)}else{ed({selectedProject:s.name});try{let e=await es({sheetId:s.sheetId||""},s.name,T.rfaType);$(e)}catch(e){console.error("Failed to fetch categories from BIM-Tracking:",e),M(e=>({...e,site:"ไม่สามารถโหลดหมวดงานจาก BIM-Tracking ได้"}))}finally{E(!1)}}}},eg=async e=>{ed({selectedCategory:e,selectedTask:null}),z([]);let s=Z.find(e=>e.id===_);if(s&&T.selectedProject)try{let t=await et({sheetId:s.sheetId||""},T.selectedProject,e);z(t)}catch(e){console.error(e)}},eb=e=>{ed({selectedTask:e,title:"".concat(e.taskName," - RFA")}),er(e.taskName)},ep=(0,r.useMemo)(()=>ea?B.filter(e=>e.taskName.toLowerCase().includes(ea.toLowerCase())):B.slice(0,20),[B,ea]);return(0,a.jsxs)("div",{className:"".concat(w?"max-w-4xl w-full mx-auto":""," bg-white rounded-lg shadow-xl flex flex-col h-full max-h-[95vh]"),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-6 border-b bg-gray-50 rounded-t-lg",children:[(0,a.jsx)("div",{children:(0,a.jsxs)("h2",{className:"text-2xl font-bold text-gray-900",children:["สร้าง RFA Document",T.rfaType&&N[T.rfaType]&&(0,a.jsxs)("span",{className:"font-medium text-gray-600",children:[" - ",N[T.rfaType].subtitle]})]})}),v&&(0,a.jsx)("button",{onClick:v,className:"text-gray-400 hover:text-gray-600",children:(0,a.jsx)(l.Z,{})})]}),(0,a.jsxs)("div",{className:"flex-1 p-4 sm:p-6 overflow-y-auto bg-slate-50 space-y-6",children:[!C&&(0,a.jsxs)("section",{className:"bg-white p-6 rounded-lg border border-gray-200",children:[(0,a.jsxs)("h3",{className:"flex items-center text-lg font-semibold text-gray-900 border-b pb-4 mb-6",children:[(0,a.jsx)("span",{className:"w-8 h-8 rounded-full bg-blue-600 text-white flex items-center justify-center mr-3 font-bold text-base",children:"1"}),"เลือกประเภทเอกสาร"]}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:Object.entries(N).map(e=>{let[s,t]=e,r=!!k&&t.allowedRoles.includes(k.role);return(0,a.jsxs)("div",{onClick:()=>r&&ed({rfaType:s}),className:"p-6 border-2 rounded-lg text-center cursor-pointer transition-all duration-200 ".concat(T.rfaType===s?"border-blue-500 bg-blue-50 ring-2 ring-blue-200":r?"border-gray-200 hover:border-gray-400":"border-gray-100 bg-gray-50 opacity-60 cursor-not-allowed"),children:[(0,a.jsx)("div",{className:"text-4xl mb-3",children:t.icon}),(0,a.jsx)("h4",{className:"font-semibold text-gray-800",children:t.title}),(0,a.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:t.description})]},s)})}),D.rfaType&&(0,a.jsx)("p",{className:"text-red-600 text-sm mt-2",children:D.rfaType})]}),(0,a.jsxs)("section",{className:"bg-white p-6 rounded-lg border border-gray-200 ".concat(T.rfaType||C?"":"opacity-40 pointer-events-none"),children:[(0,a.jsxs)("h3",{className:"flex items-center text-lg font-semibold text-gray-900 border-b pb-4 mb-6",children:[(0,a.jsx)(i.Z,{size:20,className:"mr-3 text-blue-600"}),"ข้อมูลเอกสาร"]}),(0,a.jsxs)("div",{className:"space-y-6 max-w-3xl",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["โครงการ ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsxs)("select",{value:_,onChange:e=>eh(e.target.value),className:"w-full p-3 border rounded-lg bg-gray-50",children:[(0,a.jsx)("option",{value:"",children:"-- เลือกโครงการ --"}),Z.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]}),D.site&&(0,a.jsx)("p",{className:"text-red-600 text-sm mt-1",children:D.site})]}),en?(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{htmlFor:"category-manual-input",className:"block text-sm font-medium text-gray-700 mb-2",children:["หมวดงาน ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsx)("input",{id:"category-manual-input",type:"text",list:"category-list",value:T.categoryId,onChange:e=>ed({categoryId:e.target.value}),placeholder:"พิมพ์หรือเลือกหมวดงาน",className:"w-full p-3 border rounded-lg",disabled:!_}),(0,a.jsx)("datalist",{id:"category-list",children:el.map(e=>(0,a.jsx)("option",{value:e.categoryCode},e.id))}),D.categoryId&&(0,a.jsx)("p",{className:"text-red-600 text-sm mt-1",children:D.categoryId})]}):(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2 flex items-center",children:["หมวดงาน ",Y&&(0,a.jsx)(g.Z,{className:"w-4 h-4 ml-2"})," ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsxs)("select",{value:T.selectedCategory,onChange:e=>eg(e.target.value),className:"w-full p-3 border rounded-lg disabled:bg-gray-100 bg-gray-50",disabled:!_||Y,children:[(0,a.jsx)("option",{value:"",children:Y?"กำลังโหลด...":"-- เลือกหมวดงาน --"}),K.map(e=>(0,a.jsx)("option",{value:e,children:e},e))]}),ee&&(0,a.jsxs)("p",{className:"text-red-600 text-sm mt-1",children:["Error: ",ee]})]})]}),!en&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["ค้นหางาน ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsx)("input",{type:"text",placeholder:"ค้นหาชื่องานจาก BIM Tracking...",value:ea,onChange:e=>er(e.target.value),className:"w-full p-3 border rounded-lg",disabled:!T.selectedCategory||Y}),(0,a.jsx)("div",{className:"mt-2 max-h-48 overflow-y-auto border rounded-lg bg-white",children:ep.map(e=>{var s;return(0,a.jsx)("div",{onClick:()=>eb(e),className:"p-3 text-sm cursor-pointer hover:bg-gray-100 ".concat((null===(s=T.selectedTask)||void 0===s?void 0:s.taskName)===e.taskName?"bg-blue-50 font-semibold":""),children:e.taskName},e.taskUid||e.taskName)})}),D.task&&(0,a.jsx)("p",{className:"text-red-600 text-sm mt-1",children:D.task})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{className:"sm:col-span-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"เลขที่เอกสาร"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("input",{type:"text",value:T.documentNumber,onChange:e=>{ed({documentNumber:e.target.value}),U(null)},className:"w-full p-3 border rounded-lg pr-10 ".concat(!1===H?"border-red-500":"")}),(0,a.jsxs)("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:[G&&(0,a.jsx)(n.Z,{className:"h-5 w-5 text-gray-400 animate-spin"}),!G&&!0===H&&(0,a.jsx)(d.Z,{className:"h-5 w-5 text-green-500"}),!G&&!1===H&&(0,a.jsx)(l.Z,{className:"h-5 w-5 text-red-500"})]})]}),D.documentNumber&&(0,a.jsx)("p",{className:"text-red-600 text-sm mt-1",children:D.documentNumber}),!G&&!1===H&&!D.documentNumber&&(0,a.jsx)("p",{className:"text-red-600 text-sm mt-1",children:"เลขที่เอกสารนี้ถูกใช้ไปแล้ว"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Rev. No."}),(0,a.jsx)("input",{type:"text",value:T.revisionNumber,onChange:e=>ed({revisionNumber:e.target.value}),className:"w-full p-3 border rounded-lg"}),D.revisionNumber&&(0,a.jsx)("p",{className:"text-red-600 text-sm mt-1",children:D.revisionNumber})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["หัวข้อเอกสาร ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsx)("input",{type:"text",value:T.title,onChange:e=>ed({title:e.target.value}),className:"w-full p-3 border rounded-lg"}),D.title&&(0,a.jsx)("p",{className:"text-red-600 text-sm mt-1",children:D.title})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"รายละเอียด"}),(0,a.jsx)("textarea",{value:T.description,onChange:e=>ed({description:e.target.value}),rows:3,className:"w-full p-3 border rounded-lg"})]})]})]}),(0,a.jsxs)("section",{className:"bg-white p-6 rounded-lg border border-gray-200 ".concat(T.rfaType||C?"":"opacity-40 pointer-events-none"),children:[(0,a.jsxs)("h3",{className:"flex items-center text-lg font-semibold text-gray-900 border-b pb-4 mb-6",children:[(0,a.jsx)(c.Z,{size:20,className:"mr-3 text-blue-600"}),"แนบไฟล์ ",(0,a.jsx)("span",{className:"text-red-500 ml-1",children:"*"})]}),(0,a.jsxs)("div",{className:"space-y-6 max-w-3xl",children:[(0,a.jsxs)("label",{htmlFor:"file-upload",className:"flex flex-col items-center justify-center w-full h-48 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-slate-50 hover:bg-slate-100 transition-colors",children:[(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center pt-5 pb-6 text-center",children:[(0,a.jsx)(o.Z,{className:"w-10 h-10 mb-4 text-gray-400"}),(0,a.jsxs)("p",{className:"mb-2 text-sm text-gray-500",children:[(0,a.jsx)("span",{className:"font-semibold",children:"คลิกเพื่อเลือกไฟล์"})," หรือลากมาวาง"]}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"สามารถเลือกได้หลายไฟล์พร้อมกัน"})]}),(0,a.jsx)("input",{id:"file-upload",type:"file",multiple:!0,onChange:ex,className:"hidden"})]}),T.uploadedFiles.length>0&&(0,a.jsx)("div",{children:(0,a.jsx)("div",{className:"space-y-2",children:T.uploadedFiles.map((e,s)=>(0,a.jsxs)("div",{className:"flex items-center text-sm p-3 bg-gray-100 rounded-lg",children:[(0,a.jsx)(m.Z,{className:"w-5 h-5 mr-3 text-gray-500 flex-shrink-0"}),(0,a.jsx)("span",{className:"flex-1 truncate",title:e.file.name,children:e.file.name}),(0,a.jsxs)("div",{className:"flex items-center ml-3",children:["uploading"===e.status&&(0,a.jsx)(g.Z,{className:"w-4 h-4"}),"success"===e.status&&(0,a.jsx)(d.Z,{className:"w-5 h-5 text-green-500"}),"error"===e.status&&(0,a.jsx)("span",{title:e.error,children:(0,a.jsx)(x.Z,{className:"w-5 h-5 text-red-500"})}),(0,a.jsx)("button",{type:"button",onClick:()=>eu(s),className:"ml-4 text-gray-500 hover:text-red-600",children:(0,a.jsx)(l.Z,{size:18})})]})]},e.id))})}),D.files&&(0,a.jsx)("p",{className:"text-red-600 text-sm mt-1",children:D.files})]})]}),D.general&&(0,a.jsx)("p",{className:"text-red-600 text-sm mt-4 text-center",children:D.general})]}),(0,a.jsxs)("div",{className:"flex justify-end items-center p-6 border-t bg-gray-100 rounded-b-lg",children:[v&&(0,a.jsx)("button",{onClick:v,disabled:R,className:"px-6 py-2 rounded-lg bg-white border border-gray-300 text-gray-800 hover:bg-gray-100 disabled:opacity-50 mr-4",children:"ยกเลิก"}),(0,a.jsx)("button",{onClick:()=>{ec()?S(!0):alert("กรุณากรอกข้อมูลให้ครบถ้วน")},disabled:R||!T.rfaType&&!C,className:"px-8 py-2 rounded-lg bg-blue-600 text-white font-semibold hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed",children:R?(0,a.jsx)(g.Z,{className:"w-5 h-5"}):"สร้างเอกสาร"})]}),F&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-60 z-50 flex items-center justify-center p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-3xl max-h-[90vh] flex flex-col",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center p-4 border-b",children:[(0,a.jsx)("h3",{className:"text-xl font-bold text-gray-800",children:"ยืนยันข้อมูล"}),(0,a.jsxs)("button",{onClick:()=>S(!1),className:"text-gray-400 hover:text-gray-600",children:[" ",(0,a.jsx)(l.Z,{size:24})," "]})]}),(0,a.jsxs)("div",{className:"p-6 overflow-y-auto space-y-4 text-sm",children:[(0,a.jsx)("h4",{className:"text-base font-semibold text-gray-700",children:"กรุณาตรวจสอบข้อมูลก่อนสร้างเอกสาร"}),(0,a.jsxs)("div",{className:"p-4 bg-gray-50 rounded-lg border space-y-2",children:[(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{className:"font-medium text-gray-500 w-28 inline-block",children:"ประเภท:"})," ",T.rfaType]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{className:"font-medium text-gray-500 w-28 inline-block",children:"โครงการ:"})," ",null===(s=Z.find(e=>e.id===_))||void 0===s?void 0:s.name]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{className:"font-medium text-gray-500 w-28 inline-block",children:"หมวดงาน:"})," ",en?T.categoryId:null===(t=T.selectedTask)||void 0===t?void 0:t.taskCategory]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{className:"font-medium text-gray-500 w-28 inline-block",children:"เลขที่เอกสาร:"})," ",T.documentNumber||"(ไม่ได้ระบุ)"]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{className:"font-medium text-gray-500 w-28 inline-block",children:"Rev.:"})," ",T.revisionNumber]}),(0,a.jsxs)("p",{className:"border-t pt-2 mt-2",children:[(0,a.jsx)("strong",{className:"font-medium text-gray-500 block",children:"หัวข้อ:"})," ",T.title]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("h4",{className:"font-medium text-gray-500",children:["ไฟล์แนบ (",T.uploadedFiles.filter(e=>"success"===e.status).length," ไฟล์):"]}),(0,a.jsx)("ul",{className:"list-disc list-inside mt-1 space-y-1 text-gray-800",children:T.uploadedFiles.filter(e=>"success"===e.status).map(e=>(0,a.jsx)("li",{className:"truncate",children:e.file.name},e.id))})]})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-4 p-4 border-t bg-gray-50",children:[(0,a.jsx)("button",{onClick:()=>S(!1),className:"px-6 py-2 rounded-lg bg-gray-200 text-gray-800 hover:bg-gray-300",children:" กลับไปแก้ไข "}),(0,a.jsx)("button",{onClick:eo,className:"px-6 py-2 rounded-lg bg-green-600 text-white hover:bg-green-700",children:" ยืนยันและสร้างเอกสาร "})]})]})})]})}},731:function(e,s,t){t.d(s,{AuthGuard:function(){return d}});var a=t(7437),r=t(7649),l=t(9376),i=t(2265);t(453);let n=()=>(0,a.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,a.jsxs)("div",{className:"animate-pulse",children:[(0,a.jsx)("div",{className:"bg-white shadow",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,a.jsxs)("div",{className:"flex justify-between items-center py-6",children:[(0,a.jsx)("div",{className:"h-8 bg-gray-200 rounded w-32"}),(0,a.jsx)("div",{className:"h-8 bg-gray-200 rounded w-24"})]})})}),(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsx)("div",{className:"w-64 bg-white border-r border-gray-200 min-h-screen",children:(0,a.jsx)("div",{className:"p-4 space-y-3",children:[...Array(6)].map((e,s)=>(0,a.jsx)("div",{className:"h-10 bg-gray-100 rounded"},s))})}),(0,a.jsx)("div",{className:"flex-1 p-8",children:(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("div",{className:"h-8 bg-gray-200 rounded w-1/3"}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[void 0,void 0,void 0].map((e,s)=>(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow",children:[(0,a.jsx)("div",{className:"h-4 bg-gray-200 rounded mb-2"}),(0,a.jsx)("div",{className:"h-8 bg-gray-200 rounded mb-4"}),(0,a.jsx)("div",{className:"h-4 bg-gray-200 rounded w-2/3"})]},s))})]})})]})]})});function d(e){let{children:s,requiredRoles:t=[],requiredSiteAccess:d=[],fallback:c,redirectTo:o="/login"}=e,{user:m,loading:x,error:u}=(0,r.a)(),h=(0,l.useRouter)();return((0,i.useEffect)(()=>{x||m||h.push(o)},[m,x,h,o]),x)?(0,a.jsx)(n,{}):u?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,a.jsx)("div",{className:"text-center max-w-md mx-auto",children:(0,a.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-red-800 mb-2",children:"เกิดข้อผิดพลาด"}),(0,a.jsx)("p",{className:"text-red-600 mb-4",children:u}),(0,a.jsx)("button",{onClick:()=>window.location.reload(),className:"bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 transition-colors",children:"ลองใหม่"})]})})}):m?t.length>0&&!t.includes(m.role)?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,a.jsx)("div",{className:"text-center max-w-md mx-auto",children:(0,a.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-yellow-800 mb-2",children:"ไม่มีสิทธิ์เข้าถึง"}),(0,a.jsx)("p",{className:"text-yellow-700 mb-2",children:"คุณไม่มีสิทธิ์เข้าถึงหน้านี้"}),(0,a.jsxs)("p",{className:"text-sm text-yellow-600 mb-4",children:["ต้องการสิทธิ์: ",t.join(", ")," | สิทธิ์ปัจจุบัน: ",m.role]}),(0,a.jsx)("button",{onClick:()=>h.back(),className:"bg-yellow-600 text-white px-4 py-2 rounded hover:bg-yellow-700 transition-colors",children:"ย้อนกลับ"})]})})}):d.length>0&&"Admin"!==m.role&&!d.some(e=>{var s;return null===(s=m.sites)||void 0===s?void 0:s.includes(e)})?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,a.jsx)("div",{className:"text-center max-w-md mx-auto",children:(0,a.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-red-800 mb-2",children:"ไม่มีสิทธิ์เข้าถึงโครงการ"}),(0,a.jsx)("p",{className:"text-red-600 mb-4",children:"คุณไม่มีสิทธิ์เข้าถึงโครงการที่ต้องการ"}),(0,a.jsx)("button",{onClick:()=>h.back(),className:"bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 transition-colors",children:"ย้อนกลับ"})]})})}):(0,a.jsx)(a.Fragment,{children:s}):c?(0,a.jsx)(a.Fragment,{children:c}):(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-800 mb-2",children:"กรุณาเข้าสู่ระบบ"}),(0,a.jsx)("p",{className:"text-gray-600 mb-4",children:"คุณต้องเข้าสู่ระบบเพื่อเข้าถึงหน้านี้"}),(0,a.jsx)("button",{onClick:()=>h.push(o),className:"bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 transition-colors",children:"เข้าสู่ระบบ"})]})})}},4001:function(e,s,t){t.d(s,{NotificationProvider:function(){return x},l:function(){return u}});var a=t(7437),r=t(2265),l=t(1671),i=t(9388),n=t(6865);let d={success:(0,a.jsx)(l.Z,{className:"h-12 w-12 text-green-500"}),error:(0,a.jsx)(i.Z,{className:"h-12 w-12 text-red-500"}),warning:(0,a.jsx)(n.Z,{className:"h-12 w-12 text-yellow-500"})},c={success:"bg-green-600 hover:bg-green-700",error:"bg-red-600 hover:bg-red-700",warning:"bg-yellow-600 hover:bg-yellow-700"};var o=e=>{let{isOpen:s,type:t,title:r,message:l,onClose:i}=e;return s?(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-60 z-[100] flex items-center justify-center p-4",children:(0,a.jsxs)("div",{className:"relative bg-white rounded-lg shadow-xl w-full max-w-sm mx-auto p-6 text-center",children:[(0,a.jsx)("div",{className:"flex justify-center mb-4",children:d[t]}),(0,a.jsx)("h3",{className:"text-xl font-semibold text-gray-800 mb-2",children:r}),l&&(0,a.jsx)("p",{className:"text-gray-600 text-sm mb-6 whitespace-pre-wrap",children:l}),(0,a.jsx)("button",{onClick:i,className:"w-full px-4 py-2 text-white font-semibold rounded-lg transition-colors ".concat(c[t]),children:"ตกลง"})]})}):null};let m=(0,r.createContext)(void 0),x=e=>{let{children:s}=e,[t,l]=(0,r.useState)({isOpen:!1,type:"success",title:"",message:null}),i=(0,r.useCallback)(function(e,s){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";l({isOpen:!0,type:e,title:s,message:t})},[]);return(0,a.jsxs)(m.Provider,{value:{showNotification:i},children:[s,(0,a.jsx)(o,{isOpen:t.isOpen,type:t.type,title:t.title,message:t.message,onClose:()=>{l(e=>({...e,isOpen:!1}))}})]})},u=()=>{let e=(0,r.useContext)(m);if(void 0===e)throw Error("useNotification must be used within a NotificationProvider");return e}}}]);