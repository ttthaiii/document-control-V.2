"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[478],{3900:function(e,s,t){t.d(s,{Z:function(){return T}});var a=t(57437),r=t(2265),l=t(89573),i=t(43044),n=t(59426),c=t(32489),o=t(33245),d=t(51817),m=t(30401),x=t(76980),u=t(17689),h=t(48736),g=t(76865),p=t(47649);const b=()=>{const[e,s]=(0,r.useState)(!1),[t,a]=(0,r.useState)(null),{firebaseUser:l}=(0,p.a)(),i=(0,r.useCallback)((async(e,s)=>{if(!l)throw new Error("User not authenticated");const t=await l.getIdToken(),a=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify(s)}),r=await a.json();if(!r.success)throw new Error(r.error||"Request failed");return r.data}),[l]);return{loading:e,error:t,getProjects:(0,r.useCallback)((async e=>{s(!0),a(null);try{return(await i("/api/google-sheets/projects",e)).projects}catch(t){throw a(t.message),t}finally{s(!1)}}),[i]),getCategories:(0,r.useCallback)((async(e,t,r)=>{s(!0),a(null);try{return(await i("/api/google-sheets/categories",{...e,projectName:t,rfaType:r})).categories}catch(l){throw a(l.message),l}finally{s(!1)}}),[i]),getTasks:(0,r.useCallback)((async(e,t,r)=>{s(!0),a(null);try{return(await i("/api/google-sheets/tasks",{...e,projectName:t,category:r})).tasks}catch(l){throw a(l.message),l}finally{s(!1)}}),[i]),clearError:()=>a(null)}};var f=t(99761),y=t(453),j=t(54001),N=t(6855),v=t(5978);const w={rfaType:"",categoryId:"",documentNumber:"",title:"",description:"",revisionNumber:"00",uploadedFiles:[],selectedProject:"",selectedCategory:"",selectedTask:null},k={"RFA-SHOP":{title:"RFA-SHOP",subtitle:"Shop Drawing Approval",icon:(0,a.jsx)(l.Z,{size:40,className:"text-blue-600"}),description:"\u0e2a\u0e33\u0e2b\u0e23\u0e31\u0e1a\u0e01\u0e32\u0e23\u0e02\u0e2d\u0e2d\u0e19\u0e38\u0e21\u0e31\u0e15\u0e34 Shop Drawing",workflow:"\u0e1c\u0e39\u0e49\u0e2a\u0e23\u0e49\u0e32\u0e07 \u2192 Site Admin \u2192 CM",allowedRoles:[y.K$.BIM,y.K$.ME,y.K$.SN,y.K$.SITE_ADMIN,y.K$.ADMIN],color:"blue"},"RFA-GEN":{title:"RFA-GEN",subtitle:"General Submission",icon:(0,a.jsx)(i.Z,{size:40,className:"text-green-600"}),description:"\u0e2a\u0e33\u0e2b\u0e23\u0e31\u0e1a\u0e01\u0e32\u0e23\u0e2a\u0e48\u0e07\u0e40\u0e2d\u0e01\u0e2a\u0e32\u0e23\u0e17\u0e31\u0e48\u0e27\u0e44\u0e1b",workflow:"\u0e1c\u0e39\u0e49\u0e2a\u0e23\u0e49\u0e32\u0e07 \u2192 CM",allowedRoles:[y.K$.BIM,y.K$.SITE_ADMIN,y.K$.ADMIN,y.K$.ME,y.K$.SN],color:"green"},"RFA-MAT":{title:"RFA-MAT",subtitle:"Material Approval",icon:(0,a.jsx)(n.Z,{size:40,className:"text-orange-600"}),description:"\u0e2a\u0e33\u0e2b\u0e23\u0e31\u0e1a\u0e01\u0e32\u0e23\u0e02\u0e2d\u0e2d\u0e19\u0e38\u0e21\u0e31\u0e15\u0e34\u0e27\u0e31\u0e2a\u0e14\u0e38",workflow:"Site Admin \u2192 CM",allowedRoles:[y.K$.SITE_ADMIN,y.K$.ADMIN],color:"orange"}},C="w-full h-11 px-3 border rounded-lg bg-white text-gray-900 font-medium focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all";function T(e){let{onClose:s,isModal:t=!1,userProp:l,presetRfaType:i}=e;var n,T;const[I,S]=(0,r.useState)({...w,rfaType:i||""}),[F,A]=(0,r.useState)(!1),[E,M]=(0,r.useState)(!1),[R,Z]=(0,r.useState)({}),[O,D]=(0,r.useState)(!1),[P,K]=(0,r.useState)([]),[$,z]=(0,r.useState)([]),[B,_]=(0,r.useState)([]),[J,G]=(0,r.useState)(""),[L,U]=(0,r.useState)(!1),[q,H]=(0,r.useState)(null),[X,Q]=(0,r.useState)(""),{firebaseUser:V,user:W}=(0,p.a)(),{showNotification:Y}=(0,j.l)(),{loading:ee,error:se,getCategories:te,getTasks:ae}=b(),[re,le]=(0,r.useState)(""),[ie,ne]=(0,r.useState)([]),ce=(0,r.useMemo)((()=>!l||("RFA-MAT"===I.rfaType||"RFA-GEN"===I.rfaType||("RFA-SHOP"!==I.rfaType||l.role!==y.K$.BIM))),[l,I.rfaType]);(0,r.useEffect)((()=>{(async()=>{if((null===W||void 0===W?void 0:W.sites)&&0!==W.sites.length){M(!0);try{const e=(0,v.IO)((0,v.hJ)(N.db,"sites"),(0,v.ar)((0,v.Jm)(),"in",W.sites)),s=(await(0,v.PL)(e)).docs.map((e=>{var s,t,a,r;return{id:e.id,name:e.data().name,sheetId:(null===(t=e.data().settings)||void 0===t||null===(s=t.googleSheetsConfig)||void 0===s?void 0:s.spreadsheetId)||"",sheetName:(null===(r=e.data().settings)||void 0===r||null===(a=r.googleSheetsConfig)||void 0===a?void 0:a.sheetName)||""}}));K(s)}catch(e){console.error("Error loading sites:",e),Y("error","\u0e40\u0e01\u0e34\u0e14\u0e02\u0e49\u0e2d\u0e1c\u0e34\u0e14\u0e1e\u0e25\u0e32\u0e14","\u0e44\u0e21\u0e48\u0e2a\u0e32\u0e21\u0e32\u0e23\u0e16\u0e42\u0e2b\u0e25\u0e14\u0e23\u0e32\u0e22\u0e0a\u0e37\u0e48\u0e2d\u0e42\u0e04\u0e23\u0e07\u0e01\u0e32\u0e23\u0e44\u0e14\u0e49")}finally{M(!1)}}})()}),[W]),(0,r.useEffect)((()=>{if(!J||!I.documentNumber)return void H(null);U(!0);const e=setTimeout((()=>{Q(I.documentNumber)}),500);return()=>{clearTimeout(e)}}),[I.documentNumber,J]),(0,r.useEffect)((()=>{if(!X||!J)return;(async()=>{U(!0),H(null);try{const e=await fetch("/api/rfa/check-duplicate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({siteId:J,documentNumber:X})}),s=await e.json();H(!s.isDuplicate)}catch(e){console.error("Failed to check duplicate:",e),H(null)}finally{U(!1)}})()}),[X,J]);const oe=e=>{S((s=>({...s,...e})));const s={...R};Object.keys(e).forEach((e=>delete s[e])),Z(s)},de=()=>{const e={};if(!i)if(I.rfaType){const s=k[I.rfaType];l&&!s.allowedRoles.includes(l.role)&&(e.rfaType="\u0e04\u0e38\u0e13\u0e44\u0e21\u0e48\u0e21\u0e35\u0e2a\u0e34\u0e17\u0e18\u0e34\u0e4c\u0e2a\u0e23\u0e49\u0e32\u0e07 ".concat(I.rfaType))}else e.rfaType="\u0e01\u0e23\u0e38\u0e13\u0e32\u0e40\u0e25\u0e37\u0e2d\u0e01\u0e1b\u0e23\u0e30\u0e40\u0e20\u0e17 RFA";return I.title.trim()||(e.title="\u0e01\u0e23\u0e38\u0e13\u0e32\u0e43\u0e2a\u0e48\u0e2b\u0e31\u0e27\u0e02\u0e49\u0e2d\u0e40\u0e2d\u0e01\u0e2a\u0e32\u0e23"),I.revisionNumber.trim()||(e.revisionNumber="\u0e01\u0e23\u0e38\u0e13\u0e32\u0e43\u0e2a\u0e48 Rev. No."),J||(e.site="\u0e01\u0e23\u0e38\u0e13\u0e32\u0e40\u0e25\u0e37\u0e2d\u0e01\u0e42\u0e04\u0e23\u0e07\u0e01\u0e32\u0e23"),I.documentNumber.trim()?!1===q&&(e.documentNumber="\u0e40\u0e25\u0e02\u0e17\u0e35\u0e48\u0e40\u0e2d\u0e01\u0e2a\u0e32\u0e23\u0e19\u0e35\u0e49\u0e16\u0e39\u0e01\u0e43\u0e0a\u0e49\u0e44\u0e1b\u0e41\u0e25\u0e49\u0e27"):e.documentNumber="\u0e01\u0e23\u0e38\u0e13\u0e32\u0e43\u0e2a\u0e48\u0e40\u0e25\u0e02\u0e17\u0e35\u0e48\u0e40\u0e2d\u0e01\u0e2a\u0e32\u0e23",ce?I.categoryId.trim()||(e.categoryId="\u0e01\u0e23\u0e38\u0e13\u0e32\u0e01\u0e23\u0e2d\u0e01\u0e2b\u0e21\u0e27\u0e14\u0e07\u0e32\u0e19"):I.selectedTask||(e.task="\u0e01\u0e23\u0e38\u0e13\u0e32\u0e40\u0e25\u0e37\u0e2d\u0e01\u0e07\u0e32\u0e19\u0e08\u0e32\u0e01 BIM Tracking"),0===I.uploadedFiles.filter((e=>"success"===e.status)).length&&(e.files="\u0e01\u0e23\u0e38\u0e13\u0e32\u0e2d\u0e31\u0e1b\u0e42\u0e2b\u0e25\u0e14\u0e44\u0e1f\u0e25\u0e4c\u0e2d\u0e22\u0e48\u0e32\u0e07\u0e19\u0e49\u0e2d\u0e22 1 \u0e44\u0e1f\u0e25\u0e4c"),Z(e),0===Object.keys(e).length},me=async e=>{try{if(!V)throw new Error("\u0e01\u0e23\u0e38\u0e13\u0e32\u0e25\u0e47\u0e2d\u0e01\u0e2d\u0e34\u0e19\u0e01\u0e48\u0e2d\u0e19\u0e2d\u0e31\u0e1b\u0e42\u0e2b\u0e25\u0e14\u0e44\u0e1f\u0e25\u0e4c");const s=await V.getIdToken(),t=new FormData;t.append("file",e);const a=await fetch("/api/rfa/upload-temp-file",{method:"POST",headers:{Authorization:"Bearer ".concat(s)},body:t}),r=await a.json();if(r.success)return{status:"success",progress:100,uploadedData:r.fileData};throw new Error(r.error||"\u0e2d\u0e31\u0e1b\u0e42\u0e2b\u0e25\u0e14\u0e25\u0e49\u0e21\u0e40\u0e2b\u0e25\u0e27")}catch(s){return{status:"error",error:s instanceof Error?s.message:"\u0e40\u0e01\u0e34\u0e14\u0e02\u0e49\u0e2d\u0e1c\u0e34\u0e14\u0e1e\u0e25\u0e32\u0e14"}}},xe=(0,r.useMemo)((()=>re?B.filter((e=>e.taskName.toLowerCase().includes(re.toLowerCase()))):B.slice(0,20)),[B,re]);return(0,a.jsxs)("div",{className:"".concat(t?"max-w-4xl w-full mx-auto":""," bg-white rounded-lg shadow-xl flex flex-col h-full max-h-[95vh]"),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-6 border-b bg-gray-50 rounded-t-lg",children:[(0,a.jsx)("div",{children:(0,a.jsxs)("h2",{className:"text-2xl font-bold text-gray-900",children:["\u0e2a\u0e23\u0e49\u0e32\u0e07 RFA Document",I.rfaType&&k[I.rfaType]&&(0,a.jsxs)("span",{className:"font-medium text-gray-600",children:[" - ",k[I.rfaType].subtitle]})]})}),s&&(0,a.jsx)("button",{onClick:s,className:"text-gray-400 hover:text-gray-600",children:(0,a.jsx)(c.Z,{})})]}),(0,a.jsxs)("div",{className:"flex-1 p-4 sm:p-6 overflow-y-auto bg-slate-50 space-y-6",children:[!i&&(0,a.jsxs)("section",{className:"bg-white p-6 rounded-lg border border-gray-200",children:[(0,a.jsxs)("h3",{className:"flex items-center text-lg font-semibold text-gray-900 border-b pb-4 mb-6",children:[(0,a.jsx)("span",{className:"w-8 h-8 rounded-full bg-blue-600 text-white flex items-center justify-center mr-3 font-bold text-base",children:"1"}),"\u0e40\u0e25\u0e37\u0e2d\u0e01\u0e1b\u0e23\u0e30\u0e40\u0e20\u0e17\u0e40\u0e2d\u0e01\u0e2a\u0e32\u0e23"]}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:Object.entries(k).map((e=>{let[s,t]=e;const r=!!l&&t.allowedRoles.includes(l.role);return(0,a.jsxs)("div",{onClick:()=>r&&oe({rfaType:s}),className:"p-6 border-2 rounded-lg text-center cursor-pointer transition-all duration-200 ...",children:[(0,a.jsx)("div",{className:"mb-3 flex justify-center",children:t.icon}),(0,a.jsx)("h4",{className:"font-semibold text-gray-800",children:t.title}),(0,a.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:t.description})]},s)}))}),R.rfaType&&(0,a.jsx)("p",{className:"text-red-600 text-sm mt-2",children:R.rfaType})]}),(0,a.jsxs)("section",{className:"bg-white p-6 rounded-lg border border-gray-200 ".concat(I.rfaType||i?"":"opacity-40 pointer-events-none"),children:[(0,a.jsxs)("h3",{className:"flex items-center text-lg font-semibold text-gray-900 border-b pb-4 mb-6",children:[(0,a.jsx)(o.Z,{size:20,className:"mr-3 text-blue-600"}),"\u0e02\u0e49\u0e2d\u0e21\u0e39\u0e25\u0e40\u0e2d\u0e01\u0e2a\u0e32\u0e23"]}),(0,a.jsxs)("div",{className:"space-y-6 max-w-3xl",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-800 mb-2",children:["\u0e42\u0e04\u0e23\u0e07\u0e01\u0e32\u0e23 ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsxs)("select",{value:J,onChange:e=>(async s=>{if(G(s),oe({categoryId:"",selectedCategory:"",selectedTask:null}),ne([]),z([]),_([]),le(""),!s)return;const t=P.find((e=>e.id===s));if(t)if(M(!0),ce)try{const e=(0,v.IO)((0,v.hJ)(N.db,"sites/".concat(s,"/categories")),(0,v.Xo)("categoryCode")),t=(await(0,v.PL)(e)).docs.map((e=>({id:e.id,categoryCode:e.data().categoryCode,categoryName:e.data().categoryName})));ne(t)}catch(e){console.error("Failed to fetch site categories:",e),Z((e=>({...e,site:"\u0e44\u0e21\u0e48\u0e2a\u0e32\u0e21\u0e32\u0e23\u0e16\u0e42\u0e2b\u0e25\u0e14\u0e2b\u0e21\u0e27\u0e14\u0e07\u0e32\u0e19\u0e44\u0e14\u0e49"})))}finally{M(!1)}else{oe({selectedProject:t.name});try{const e=await te({sheetId:t.sheetId||""},t.name,I.rfaType);z(e)}catch(e){console.error("Failed to fetch categories from BIM-Tracking:",e),Z((e=>({...e,site:"\u0e44\u0e21\u0e48\u0e2a\u0e32\u0e21\u0e32\u0e23\u0e16\u0e42\u0e2b\u0e25\u0e14\u0e2b\u0e21\u0e27\u0e14\u0e07\u0e32\u0e19\u0e08\u0e32\u0e01 BIM-Tracking \u0e44\u0e14\u0e49"})))}finally{M(!1)}}})(e.target.value),className:C,children:[(0,a.jsx)("option",{value:"",children:"-- \u0e40\u0e25\u0e37\u0e2d\u0e01\u0e42\u0e04\u0e23\u0e07\u0e01\u0e32\u0e23 --"}),P.map((e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id)))]}),R.site&&(0,a.jsx)("p",{className:"text-red-600 text-sm mt-1",children:R.site})]}),ce?(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{htmlFor:"category-manual-input",className:"block text-sm font-medium text-gray-800 mb-2",children:["\u0e2b\u0e21\u0e27\u0e14\u0e07\u0e32\u0e19 ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsx)("input",{id:"category-manual-input",type:"text",list:"category-list",value:I.categoryId,onChange:e=>oe({categoryId:e.target.value}),placeholder:"\u0e1e\u0e34\u0e21\u0e1e\u0e4c\u0e2b\u0e23\u0e37\u0e2d\u0e40\u0e25\u0e37\u0e2d\u0e01\u0e2b\u0e21\u0e27\u0e14\u0e07\u0e32\u0e19",className:C,disabled:!J}),(0,a.jsx)("datalist",{id:"category-list",children:ie.map((e=>(0,a.jsx)("option",{value:e.categoryCode},e.id)))}),R.categoryId&&(0,a.jsx)("p",{className:"text-red-600 text-sm mt-1",children:R.categoryId})]}):(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-800 mb-2 flex items-center",children:["\u0e2b\u0e21\u0e27\u0e14\u0e07\u0e32\u0e19 ",ee&&(0,a.jsx)(f.Z,{className:"w-4 h-4 ml-2"})," ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsxs)("select",{value:I.selectedCategory,onChange:e=>(async s=>{oe({selectedCategory:s,selectedTask:null}),_([]);const t=P.find((e=>e.id===J));if(t&&I.selectedProject)try{const e=await ae({sheetId:t.sheetId||""},I.selectedProject,s);_(e)}catch(e){console.error(e)}})(e.target.value),className:C,disabled:!J||ee,children:[(0,a.jsx)("option",{value:"",children:ee?"\u0e01\u0e33\u0e25\u0e31\u0e07\u0e42\u0e2b\u0e25\u0e14...":"-- \u0e40\u0e25\u0e37\u0e2d\u0e01\u0e2b\u0e21\u0e27\u0e14\u0e07\u0e32\u0e19 --"}),$.map((e=>(0,a.jsx)("option",{value:e,children:e},e)))]}),se&&(0,a.jsxs)("p",{className:"text-red-600 text-sm mt-1",children:["Error: ",se]})]})]}),!ce&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-800 mb-2",children:["\u0e04\u0e49\u0e19\u0e2b\u0e32\u0e07\u0e32\u0e19 ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsx)("input",{type:"text",placeholder:"\u0e04\u0e49\u0e19\u0e2b\u0e32\u0e0a\u0e37\u0e48\u0e2d\u0e07\u0e32\u0e19\u0e08\u0e32\u0e01 BIM Tracking...",value:re,onChange:e=>le(e.target.value),className:C,disabled:!I.selectedCategory||ee}),(0,a.jsx)("div",{className:"mt-2 max-h-48 overflow-y-auto border rounded-lg bg-white",children:xe.map((e=>{var s;return(0,a.jsx)("div",{onClick:()=>(e=>{oe({selectedTask:e,title:"".concat(e.taskName," - RFA")}),le(e.taskName)})(e),className:"p-3 text-sm cursor-pointer hover:bg-gray-100 ".concat((null===(s=I.selectedTask)||void 0===s?void 0:s.taskName)===e.taskName?"bg-blue-50 font-semibold":""),children:e.taskName},e.taskUid||e.taskName)}))}),R.task&&(0,a.jsx)("p",{className:"text-red-600 text-sm mt-1",children:R.task})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{className:"sm:col-span-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-800 mb-2",children:"\u0e40\u0e25\u0e02\u0e17\u0e35\u0e48\u0e40\u0e2d\u0e01\u0e2a\u0e32\u0e23"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("input",{type:"text",value:I.documentNumber,onChange:e=>{oe({documentNumber:e.target.value}),H(null)},className:"".concat(C," pr-10 ").concat(!1===q?"border-red-500":"")}),(0,a.jsxs)("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:[L&&(0,a.jsx)(d.Z,{className:"h-5 w-5 text-gray-400 animate-spin"}),!L&&!0===q&&(0,a.jsx)(m.Z,{className:"h-5 w-5 text-green-500"}),!L&&!1===q&&(0,a.jsx)(c.Z,{className:"h-5 w-5 text-red-500"})]})]}),R.documentNumber&&(0,a.jsx)("p",{className:"text-red-600 text-sm mt-1",children:R.documentNumber}),!L&&!1===q&&!R.documentNumber&&(0,a.jsx)("p",{className:"text-red-600 text-sm mt-1",children:"\u0e40\u0e25\u0e02\u0e17\u0e35\u0e48\u0e40\u0e2d\u0e01\u0e2a\u0e32\u0e23\u0e19\u0e35\u0e49\u0e16\u0e39\u0e01\u0e43\u0e0a\u0e49\u0e44\u0e1b\u0e41\u0e25\u0e49\u0e27"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-800 mb-2",children:"Rev. No."}),(0,a.jsx)("input",{type:"text",value:I.revisionNumber,onChange:e=>oe({revisionNumber:e.target.value}),className:C}),R.revisionNumber&&(0,a.jsx)("p",{className:"text-red-600 text-sm mt-1",children:R.revisionNumber})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-800 mb-2",children:["\u0e2b\u0e31\u0e27\u0e02\u0e49\u0e2d\u0e40\u0e2d\u0e01\u0e2a\u0e32\u0e23 ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsx)("input",{type:"text",value:I.title,onChange:e=>oe({title:e.target.value}),className:C}),R.title&&(0,a.jsx)("p",{className:"text-red-600 text-sm mt-1",children:R.title})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-800 mb-2",children:"\u0e23\u0e32\u0e22\u0e25\u0e30\u0e40\u0e2d\u0e35\u0e22\u0e14"}),(0,a.jsx)("textarea",{value:I.description,onChange:e=>oe({description:e.target.value}),rows:3,className:"w-full p-3 border rounded-lg bg-white text-gray-900"})]})]})]}),(0,a.jsxs)("section",{className:"bg-white p-6 rounded-lg border border-gray-200 ".concat(I.rfaType||i?"":"opacity-40 pointer-events-none"),children:[(0,a.jsxs)("h3",{className:"flex items-center text-lg font-semibold text-gray-900 border-b pb-4 mb-6",children:[(0,a.jsx)(x.Z,{size:20,className:"mr-3 text-blue-600"}),"\u0e41\u0e19\u0e1a\u0e44\u0e1f\u0e25\u0e4c ",(0,a.jsx)("span",{className:"text-red-500 ml-1",children:"*"})]}),(0,a.jsxs)("div",{className:"space-y-6 max-w-3xl",children:[(0,a.jsxs)("label",{htmlFor:"file-upload",className:"flex flex-col items-center justify-center w-full h-48 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-slate-50 hover:bg-slate-100 transition-colors",children:[(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center pt-5 pb-6 text-center",children:[(0,a.jsx)(u.Z,{className:"w-10 h-10 mb-4 text-gray-400"}),(0,a.jsxs)("p",{className:"mb-2 text-sm text-gray-500",children:[(0,a.jsx)("span",{className:"font-semibold",children:"\u0e04\u0e25\u0e34\u0e01\u0e40\u0e1e\u0e37\u0e48\u0e2d\u0e40\u0e25\u0e37\u0e2d\u0e01\u0e44\u0e1f\u0e25\u0e4c"})," \u0e2b\u0e23\u0e37\u0e2d\u0e25\u0e32\u0e01\u0e21\u0e32\u0e27\u0e32\u0e07"]}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"\u0e2a\u0e32\u0e21\u0e32\u0e23\u0e16\u0e40\u0e25\u0e37\u0e2d\u0e01\u0e44\u0e14\u0e49\u0e2b\u0e25\u0e32\u0e22\u0e44\u0e1f\u0e25\u0e4c\u0e1e\u0e23\u0e49\u0e2d\u0e21\u0e01\u0e31\u0e19"})]}),(0,a.jsx)("input",{id:"file-upload",type:"file",multiple:!0,onChange:async e=>{const s=Array.from(e.target.files||[]);if(!s.length)return;const t=s.map((e=>({id:"".concat(e.name,"-").concat(Date.now()),file:e,status:"pending",progress:0,retryCount:0})));S((e=>({...e,uploadedFiles:[...e.uploadedFiles,...t]})));for(const a of t){S((e=>({...e,uploadedFiles:e.uploadedFiles.map((e=>e.id===a.id?{...e,status:"uploading"}:e))})));const e=await me(a.file);S((s=>({...s,uploadedFiles:s.uploadedFiles.map((s=>s.id===a.id?{...s,...e}:s))})))}e.target.value=""},className:"hidden"})]}),I.uploadedFiles.length>0&&(0,a.jsx)("div",{children:(0,a.jsx)("div",{className:"space-y-2",children:I.uploadedFiles.map(((e,s)=>(0,a.jsxs)("div",{className:"flex items-center text-sm p-3 bg-gray-100 rounded-lg",children:[(0,a.jsx)(h.Z,{className:"w-5 h-5 mr-3 text-gray-500 flex-shrink-0"}),(0,a.jsx)("span",{className:"flex-1 truncate",title:e.file.name,children:e.file.name}),(0,a.jsxs)("div",{className:"flex items-center ml-3",children:["uploading"===e.status&&(0,a.jsx)(f.Z,{className:"w-4 h-4"}),"success"===e.status&&(0,a.jsx)(m.Z,{className:"w-5 h-5 text-green-500"}),"error"===e.status&&(0,a.jsx)("span",{title:e.error,children:(0,a.jsx)(g.Z,{className:"w-5 h-5 text-red-500"})}),(0,a.jsx)("button",{type:"button",onClick:()=>(e=>{var s;null===(s=I.uploadedFiles[e].uploadedData)||void 0===s||s.filePath,oe({uploadedFiles:I.uploadedFiles.filter(((s,t)=>t!==e))})})(s),className:"ml-4 text-gray-500 hover:text-red-600",children:(0,a.jsx)(c.Z,{size:18})})]})]},e.id)))})}),R.files&&(0,a.jsx)("p",{className:"text-red-600 text-sm mt-1",children:R.files})]})]}),R.general&&(0,a.jsx)("p",{className:"text-red-600 text-sm mt-4 text-center",children:R.general})]}),(0,a.jsxs)("div",{className:"flex justify-end items-center p-6 border-t bg-gray-100 rounded-b-lg",children:[s&&(0,a.jsx)("button",{onClick:s,disabled:O,className:"px-6 py-2 rounded-lg bg-white border border-gray-300 text-gray-800 hover:bg-gray-100 disabled:opacity-50 mr-4",children:"\u0e22\u0e01\u0e40\u0e25\u0e34\u0e01"}),(0,a.jsx)("button",{onClick:()=>{de()?A(!0):alert("\u0e01\u0e23\u0e38\u0e13\u0e32\u0e01\u0e23\u0e2d\u0e01\u0e02\u0e49\u0e2d\u0e21\u0e39\u0e25\u0e43\u0e2b\u0e49\u0e04\u0e23\u0e1a\u0e16\u0e49\u0e27\u0e19")},disabled:O||!I.rfaType&&!i,className:"px-8 py-2 rounded-lg bg-blue-600 text-white font-semibold hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed",children:O?(0,a.jsx)(f.Z,{className:"w-5 h-5"}):"\u0e2a\u0e23\u0e49\u0e32\u0e07\u0e40\u0e2d\u0e01\u0e2a\u0e32\u0e23"})]}),F&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-60 z-50 flex items-center justify-center p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-3xl max-h-[90vh] flex flex-col",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center p-4 border-b",children:[(0,a.jsx)("h3",{className:"text-xl font-bold text-gray-800",children:"\u0e22\u0e37\u0e19\u0e22\u0e31\u0e19\u0e02\u0e49\u0e2d\u0e21\u0e39\u0e25"}),(0,a.jsxs)("button",{onClick:()=>A(!1),className:"text-gray-400 hover:text-gray-600",children:[" ",(0,a.jsx)(c.Z,{size:24})," "]})]}),(0,a.jsxs)("div",{className:"p-6 overflow-y-auto space-y-4 text-sm",children:[(0,a.jsx)("h4",{className:"text-base font-semibold text-gray-800",children:"\u0e01\u0e23\u0e38\u0e13\u0e32\u0e15\u0e23\u0e27\u0e08\u0e2a\u0e2d\u0e1a\u0e02\u0e49\u0e2d\u0e21\u0e39\u0e25\u0e01\u0e48\u0e2d\u0e19\u0e2a\u0e23\u0e49\u0e32\u0e07\u0e40\u0e2d\u0e01\u0e2a\u0e32\u0e23"}),(0,a.jsxs)("div",{className:"p-4 bg-gray-50 rounded-lg border space-y-2",children:[(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{className:"font-medium text-gray-700 w-28 inline-block",children:"\u0e1b\u0e23\u0e30\u0e40\u0e20\u0e17:"})," ",I.rfaType]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{className:"font-medium text-gray-700 w-28 inline-block",children:"\u0e42\u0e04\u0e23\u0e07\u0e01\u0e32\u0e23:"})," ",null===(n=P.find((e=>e.id===J)))||void 0===n?void 0:n.name]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{className:"font-medium text-gray-700 w-28 inline-block",children:"\u0e2b\u0e21\u0e27\u0e14\u0e07\u0e32\u0e19:"})," ",ce?I.categoryId:null===(T=I.selectedTask)||void 0===T?void 0:T.taskCategory]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{className:"font-medium text-gray-700 w-28 inline-block",children:"\u0e40\u0e25\u0e02\u0e17\u0e35\u0e48\u0e40\u0e2d\u0e01\u0e2a\u0e32\u0e23:"})," ",I.documentNumber||"(\u0e44\u0e21\u0e48\u0e44\u0e14\u0e49\u0e23\u0e30\u0e1a\u0e38)"]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{className:"font-medium text-gray-700 w-28 inline-block",children:"Rev.:"})," ",I.revisionNumber]}),(0,a.jsxs)("p",{className:"border-t pt-2 mt-2",children:[(0,a.jsx)("strong",{className:"font-medium text-gray-700 block",children:"\u0e2b\u0e31\u0e27\u0e02\u0e49\u0e2d:"})," ",I.title]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("h4",{className:"font-medium text-gray-700",children:["\u0e44\u0e1f\u0e25\u0e4c\u0e41\u0e19\u0e1a (",I.uploadedFiles.filter((e=>"success"===e.status)).length," \u0e44\u0e1f\u0e25\u0e4c):"]}),(0,a.jsxs)("ul",{className:"list-disc list-inside mt-1 space-y-1 text-gray-900",children:[" ",I.uploadedFiles.filter((e=>"success"===e.status)).map((e=>(0,a.jsx)("li",{className:"truncate",children:e.file.name},e.id)))]})]})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-4 p-4 border-t bg-gray-50",children:[(0,a.jsx)("button",{onClick:()=>A(!1),className:"px-6 py-2 rounded-lg bg-gray-200 text-gray-800 hover:bg-gray-300",children:" \u0e01\u0e25\u0e31\u0e1a\u0e44\u0e1b\u0e41\u0e01\u0e49\u0e44\u0e02 "}),(0,a.jsx)("button",{onClick:async()=>{if(de()){D(!0);try{var e;if(!V)throw new Error("\u0e01\u0e23\u0e38\u0e13\u0e32\u0e25\u0e47\u0e2d\u0e01\u0e2d\u0e34\u0e19\u0e01\u0e48\u0e2d\u0e19");const t=await V.getIdToken(),a=I.uploadedFiles.filter((e=>"success"===e.status&&e.uploadedData)),r=ce?I.categoryId:null===(e=I.selectedTask)||void 0===e?void 0:e.taskCategory,l=ce?null:I.selectedTask;if(!r)throw new Error("\u0e44\u0e21\u0e48\u0e2a\u0e32\u0e21\u0e32\u0e23\u0e16\u0e23\u0e30\u0e1a\u0e38 Category ID \u0e44\u0e14\u0e49");const i={rfaType:I.rfaType,title:I.title,description:I.description,siteId:J,documentNumber:I.documentNumber,revisionNumber:parseInt(I.revisionNumber,10)||0,uploadedFiles:a.map((e=>e.uploadedData)),categoryId:r,taskData:l},n=await fetch("/api/rfa/create",{method:"POST",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"},body:JSON.stringify({payload:i})}),c=await n.json();if(!n.ok)throw new Error(c.error||"\u0e40\u0e01\u0e34\u0e14\u0e02\u0e49\u0e2d\u0e1c\u0e34\u0e14\u0e1e\u0e25\u0e32\u0e14\u0e43\u0e19\u0e01\u0e32\u0e23\u0e2a\u0e23\u0e49\u0e32\u0e07\u0e40\u0e2d\u0e01\u0e2a\u0e32\u0e23");if(!c.success)throw new Error(c.error);Y("success","\u0e2a\u0e23\u0e49\u0e32\u0e07 RFA \u0e2a\u0e33\u0e40\u0e23\u0e47\u0e08!","\u0e2b\u0e21\u0e32\u0e22\u0e40\u0e25\u0e02\u0e40\u0e2d\u0e01\u0e2a\u0e32\u0e23: ".concat(c.runningNumber)),s&&s()}catch(t){const e=t instanceof Error?t.message:"An unknown error occurred.";Y("error","\u0e40\u0e01\u0e34\u0e14\u0e02\u0e49\u0e2d\u0e1c\u0e34\u0e14\u0e1e\u0e25\u0e32\u0e14",e)}finally{D(!1)}}else Y("warning","\u0e02\u0e49\u0e2d\u0e21\u0e39\u0e25\u0e44\u0e21\u0e48\u0e04\u0e23\u0e1a\u0e16\u0e49\u0e27\u0e19","\u0e01\u0e23\u0e38\u0e13\u0e32\u0e01\u0e23\u0e2d\u0e01\u0e02\u0e49\u0e2d\u0e21\u0e39\u0e25\u0e43\u0e19\u0e0a\u0e48\u0e2d\u0e07\u0e17\u0e35\u0e48\u0e21\u0e35\u0e40\u0e04\u0e23\u0e37\u0e48\u0e2d\u0e07\u0e2b\u0e21\u0e32\u0e22 * \u0e43\u0e2b\u0e49\u0e04\u0e23\u0e1a")},className:"px-6 py-2 rounded-lg bg-green-600 text-white hover:bg-green-700",children:" \u0e22\u0e37\u0e19\u0e22\u0e31\u0e19\u0e41\u0e25\u0e30\u0e2a\u0e23\u0e49\u0e32\u0e07\u0e40\u0e2d\u0e01\u0e2a\u0e32\u0e23 "})]})]})})]})}},20731:function(e,s,t){t.d(s,{AuthGuard:function(){return c}});var a=t(57437),r=t(47649),l=t(99376),i=t(2265);t(453);const n=()=>(0,a.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,a.jsxs)("div",{className:"animate-pulse",children:[(0,a.jsx)("div",{className:"bg-white shadow",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,a.jsxs)("div",{className:"flex justify-between items-center py-6",children:[(0,a.jsx)("div",{className:"h-8 bg-gray-200 rounded w-32"}),(0,a.jsx)("div",{className:"h-8 bg-gray-200 rounded w-24"})]})})}),(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsx)("div",{className:"w-64 bg-white border-r border-gray-200 min-h-screen",children:(0,a.jsx)("div",{className:"p-4 space-y-3",children:[...Array(6)].map(((e,s)=>(0,a.jsx)("div",{className:"h-10 bg-gray-100 rounded"},s)))})}),(0,a.jsx)("div",{className:"flex-1 p-8",children:(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("div",{className:"h-8 bg-gray-200 rounded w-1/3"}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[...Array(3)].map(((e,s)=>(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow",children:[(0,a.jsx)("div",{className:"h-4 bg-gray-200 rounded mb-2"}),(0,a.jsx)("div",{className:"h-8 bg-gray-200 rounded mb-4"}),(0,a.jsx)("div",{className:"h-4 bg-gray-200 rounded w-2/3"})]},s)))})]})})]})]})});function c(e){let{children:s,requiredRoles:t=[],requiredSiteAccess:c=[],fallback:o,redirectTo:d="/login"}=e;const{user:m,loading:x,error:u}=(0,r.a)(),h=(0,l.useRouter)();if((0,i.useEffect)((()=>{x||m||h.push(d)}),[m,x,h,d]),x)return(0,a.jsx)(n,{});if(u)return(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,a.jsx)("div",{className:"text-center max-w-md mx-auto",children:(0,a.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-red-800 mb-2",children:"\u0e40\u0e01\u0e34\u0e14\u0e02\u0e49\u0e2d\u0e1c\u0e34\u0e14\u0e1e\u0e25\u0e32\u0e14"}),(0,a.jsx)("p",{className:"text-red-600 mb-4",children:u}),(0,a.jsx)("button",{onClick:()=>window.location.reload(),className:"bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 transition-colors",children:"\u0e25\u0e2d\u0e07\u0e43\u0e2b\u0e21\u0e48"})]})})});if(!m)return o?(0,a.jsx)(a.Fragment,{children:o}):(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-800 mb-2",children:"\u0e01\u0e23\u0e38\u0e13\u0e32\u0e40\u0e02\u0e49\u0e32\u0e2a\u0e39\u0e48\u0e23\u0e30\u0e1a\u0e1a"}),(0,a.jsx)("p",{className:"text-gray-600 mb-4",children:"\u0e04\u0e38\u0e13\u0e15\u0e49\u0e2d\u0e07\u0e40\u0e02\u0e49\u0e32\u0e2a\u0e39\u0e48\u0e23\u0e30\u0e1a\u0e1a\u0e40\u0e1e\u0e37\u0e48\u0e2d\u0e40\u0e02\u0e49\u0e32\u0e16\u0e36\u0e07\u0e2b\u0e19\u0e49\u0e32\u0e19\u0e35\u0e49"}),(0,a.jsx)("button",{onClick:()=>h.push(d),className:"bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 transition-colors",children:"\u0e40\u0e02\u0e49\u0e32\u0e2a\u0e39\u0e48\u0e23\u0e30\u0e1a\u0e1a"})]})});if(t.length>0){if(!t.includes(m.role))return(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,a.jsx)("div",{className:"text-center max-w-md mx-auto",children:(0,a.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-yellow-800 mb-2",children:"\u0e44\u0e21\u0e48\u0e21\u0e35\u0e2a\u0e34\u0e17\u0e18\u0e34\u0e4c\u0e40\u0e02\u0e49\u0e32\u0e16\u0e36\u0e07"}),(0,a.jsx)("p",{className:"text-yellow-700 mb-2",children:"\u0e04\u0e38\u0e13\u0e44\u0e21\u0e48\u0e21\u0e35\u0e2a\u0e34\u0e17\u0e18\u0e34\u0e4c\u0e40\u0e02\u0e49\u0e32\u0e16\u0e36\u0e07\u0e2b\u0e19\u0e49\u0e32\u0e19\u0e35\u0e49"}),(0,a.jsxs)("p",{className:"text-sm text-yellow-600 mb-4",children:["\u0e15\u0e49\u0e2d\u0e07\u0e01\u0e32\u0e23\u0e2a\u0e34\u0e17\u0e18\u0e34\u0e4c: ",t.join(", ")," | \u0e2a\u0e34\u0e17\u0e18\u0e34\u0e4c\u0e1b\u0e31\u0e08\u0e08\u0e38\u0e1a\u0e31\u0e19: ",m.role]}),(0,a.jsx)("button",{onClick:()=>h.back(),className:"bg-yellow-600 text-white px-4 py-2 rounded hover:bg-yellow-700 transition-colors",children:"\u0e22\u0e49\u0e2d\u0e19\u0e01\u0e25\u0e31\u0e1a"})]})})})}if(c.length>0&&"Admin"!==m.role){if(!c.some((e=>{var s;return null===(s=m.sites)||void 0===s?void 0:s.includes(e)})))return(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,a.jsx)("div",{className:"text-center max-w-md mx-auto",children:(0,a.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-red-800 mb-2",children:"\u0e44\u0e21\u0e48\u0e21\u0e35\u0e2a\u0e34\u0e17\u0e18\u0e34\u0e4c\u0e40\u0e02\u0e49\u0e32\u0e16\u0e36\u0e07\u0e42\u0e04\u0e23\u0e07\u0e01\u0e32\u0e23"}),(0,a.jsx)("p",{className:"text-red-600 mb-4",children:"\u0e04\u0e38\u0e13\u0e44\u0e21\u0e48\u0e21\u0e35\u0e2a\u0e34\u0e17\u0e18\u0e34\u0e4c\u0e40\u0e02\u0e49\u0e32\u0e16\u0e36\u0e07\u0e42\u0e04\u0e23\u0e07\u0e01\u0e32\u0e23\u0e17\u0e35\u0e48\u0e15\u0e49\u0e2d\u0e07\u0e01\u0e32\u0e23"}),(0,a.jsx)("button",{onClick:()=>h.back(),className:"bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 transition-colors",children:"\u0e22\u0e49\u0e2d\u0e19\u0e01\u0e25\u0e31\u0e1a"})]})})})}return(0,a.jsx)(a.Fragment,{children:s})}},54001:function(e,s,t){t.d(s,{NotificationProvider:function(){return x},l:function(){return u}});var a=t(57437),r=t(2265),l=t(41671),i=t(99388),n=t(76865);const c={success:(0,a.jsx)(l.Z,{className:"h-12 w-12 text-green-500"}),error:(0,a.jsx)(i.Z,{className:"h-12 w-12 text-red-500"}),warning:(0,a.jsx)(n.Z,{className:"h-12 w-12 text-yellow-500"})},o={success:"bg-green-600 hover:bg-green-700",error:"bg-red-600 hover:bg-red-700",warning:"bg-yellow-600 hover:bg-yellow-700"};var d=e=>{let{isOpen:s,type:t,title:r,message:l,onClose:i}=e;return s?(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-60 z-[100] flex items-center justify-center p-4",children:(0,a.jsxs)("div",{className:"relative bg-white rounded-lg shadow-xl w-full max-w-sm mx-auto p-6 text-center",children:[(0,a.jsx)("div",{className:"flex justify-center mb-4",children:c[t]}),(0,a.jsx)("h3",{className:"text-xl font-semibold text-gray-800 mb-2",children:r}),l&&(0,a.jsx)("p",{className:"text-gray-600 text-sm mb-6 whitespace-pre-wrap",children:l}),(0,a.jsx)("button",{onClick:i,className:"w-full px-4 py-2 text-white font-semibold rounded-lg transition-colors ".concat(o[t]),children:"\u0e15\u0e01\u0e25\u0e07"})]})}):null};const m=(0,r.createContext)(void 0),x=e=>{let{children:s}=e;const[t,l]=(0,r.useState)({isOpen:!1,type:"success",title:"",message:null}),i=(0,r.useCallback)((function(e,s){l({isOpen:!0,type:e,title:s,message:arguments.length>2&&void 0!==arguments[2]?arguments[2]:""})}),[]);return(0,a.jsxs)(m.Provider,{value:{showNotification:i},children:[s,(0,a.jsx)(d,{isOpen:t.isOpen,type:t.type,title:t.title,message:t.message,onClose:()=>{l((e=>({...e,isOpen:!1})))}})]})},u=()=>{const e=(0,r.useContext)(m);if(void 0===e)throw new Error("useNotification must be used within a NotificationProvider");return e}}}]);