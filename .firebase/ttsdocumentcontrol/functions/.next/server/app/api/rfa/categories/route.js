"use strict";(()=>{var e={};e.id=927,e.ids=[927],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63298:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>f,patchFetch:()=>v,requestAsyncStorage:()=>d,routeModule:()=>u,serverHooks:()=>g,staticGenerationAsyncStorage:()=>l});var s={};t.r(s),t.d(s,{GET:()=>p});var a=t(49303),o=t(88716),i=t(60670),n=t(87070),c=t(40416);async function p(e){try{let r=e.headers.get("authorization");if(!r?.startsWith("Bearer "))return n.NextResponse.json({success:!1,error:"Missing or invalid authorization header"},{status:401});let t=r.split("Bearer ")[1],s=(await c.CZ.verifyIdToken(t)).uid,a=await c.iW.collection("users").doc(s).get();if(!a.exists)return n.NextResponse.json({success:!1,error:"User not found"},{status:404});let o=a.data(),i=o?.sites||[];if(0===i.length)return n.NextResponse.json({success:!1,error:"No site access"},{status:403});let{searchParams:p}=new URL(e.url),u=p.get("rfaType");if(!u)return n.NextResponse.json({success:!1,error:"Missing rfaType parameter"},{status:400});let d=[];for(let e of i){let r=c.iW.collection("sites").doc(e).collection("categories").where("active","==",!0);"ALL"!==u&&(r=r.where("rfaTypes","array-contains",u)),(await r.get()).forEach(r=>{let t=r.data();d.push({id:r.id,siteId:e,categoryCode:t.categoryCode||"UNKNOWN",categoryName:t.categoryName||"Unknown Category",rfaTypes:t.rfaTypes,sequence:t.sequence||0})})}return d.sort((e,r)=>e.sequence!==r.sequence?e.sequence-r.sequence:e.categoryCode.localeCompare(r.categoryCode)),n.NextResponse.json({success:!0,categories:d,count:d.length})}catch(e){return console.error("Error fetching RFA categories:",e),n.NextResponse.json({success:!1,error:"Internal server error"},{status:500})}}let u=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/rfa/categories/route",pathname:"/api/rfa/categories",filename:"route",bundlePath:"app/api/rfa/categories/route"},resolvedPagePath:"D:\\ttsdoc-v2\\src\\app\\api\\rfa\\categories\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:d,staticGenerationAsyncStorage:l,serverHooks:g}=u,f="/api/rfa/categories/route";function v(){return(0,i.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:l})}},40416:(e,r,t)=>{t.d(r,{CZ:()=>u,Hf:()=>d,iW:()=>p,uE:()=>l});let s=require("firebase-admin");var a=t.n(s);let o={credential:a().credential.cert({projectId:process.env.FIREBASE_PROJECT_ID,clientEmail:process.env.FIREBASE_CLIENT_EMAIL,privateKey:process.env.FIREBASE_PRIVATE_KEY?.replace(/\\n/g,"\n")}),storageBucket:"ttsdocumentcontrol.firebasestorage.app"},i={credential:a().credential.cert({projectId:process.env.BIM_TRACKING_PROJECT_ID,clientEmail:process.env.BIM_TRACKING_CLIENT_EMAIL,privateKey:process.env.BIM_TRACKING_PRIVATE_KEY?.replace(/\\n/g,"\n")})},n=a().apps.find(e=>e?.name==="ttsdoc-v2")||a().initializeApp(o,"ttsdoc-v2"),c=a().apps.find(e=>e?.name==="bim-tracking")||a().initializeApp(i,"bim-tracking"),p=n.firestore(),u=n.auth(),d=n.storage().bucket(),l=c.firestore()}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[948,972],()=>t(63298));module.exports=s})();