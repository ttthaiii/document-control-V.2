"use strict";(()=>{var e={id:5927,ids:[5927]};e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63298:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>v,patchFetch:()=>y,requestAsyncStorage:()=>g,routeModule:()=>d,serverHooks:()=>f,staticGenerationAsyncStorage:()=>l});var s={};t.r(s),t.d(s,{GET:()=>p,dynamic:()=>u});var o=t(49303),a=t(88716),n=t(60670),c=t(87070),i=t(40416);const u="force-dynamic";async function p(e){try{const r=e.headers.get("authorization");if(!r?.startsWith("Bearer "))return c.NextResponse.json({success:!1,error:"Missing or invalid authorization header"},{status:401});const t=r.split("Bearer ")[1],s=(await i.CZ.verifyIdToken(t)).uid,o=await i.iW.collection("users").doc(s).get();if(!o.exists)return c.NextResponse.json({success:!1,error:"User not found"},{status:404});const a=o.data(),n=a?.sites||[];if(0===n.length)return c.NextResponse.json({success:!1,error:"No site access"},{status:403});const{searchParams:u}=new URL(e.url),p=u.get("rfaType");if(!p)return c.NextResponse.json({success:!1,error:"Missing rfaType parameter"},{status:400});const d=[];for(const e of n){let r=i.iW.collection("sites").doc(e).collection("categories").where("active","==",!0);"ALL"!==p&&(r=r.where("rfaTypes","array-contains",p));(await r.get()).forEach((r=>{const t=r.data();d.push({id:r.id,siteId:e,categoryCode:t.categoryCode||"UNKNOWN",categoryName:t.categoryName||"Unknown Category",rfaTypes:t.rfaTypes,sequence:t.sequence||0})}))}return d.sort(((e,r)=>e.sequence!==r.sequence?e.sequence-r.sequence:e.categoryCode.localeCompare(r.categoryCode))),c.NextResponse.json({success:!0,categories:d,count:d.length})}catch(r){return console.error("Error fetching RFA categories:",r),c.NextResponse.json({success:!1,error:"Internal server error"},{status:500})}}const d=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/rfa/categories/route",pathname:"/api/rfa/categories",filename:"route",bundlePath:"app/api/rfa/categories/route"},resolvedPagePath:"D:\\ttsdoc-v2\\src\\app\\api\\rfa\\categories\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:g,staticGenerationAsyncStorage:l,serverHooks:f}=d,v="/api/rfa/categories/route";function y(){return(0,n.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:l})}},40416:(e,r,t)=>{t.d(r,{CZ:()=>c,Hf:()=>i,iW:()=>n,SI:()=>u,uE:()=>p,Dh:()=>g,aj:()=>l,_B:()=>d,Lv:()=>f});const s=require("firebase-admin"),o=(e,r)=>s.apps.find((r=>r?.name===e))||s.initializeApp(r,e),a=()=>{const e={credential:s.credential.cert({projectId:process.env.TTSDOC_PROJECT_ID,clientEmail:process.env.TTSDOC_CLIENT_EMAIL,privateKey:process.env.TTSDOC_PRIVATE_KEY?.replace(/\\n/g,"\n")}),storageBucket:"ttsdocumentcontrol.firebasestorage.app"};return o("ttsdoc-v2",e)},n=a().firestore(),c=a().auth(),i=a().storage().bucket(),u=a().messaging(),p=(()=>{const e={credential:s.credential.cert({projectId:process.env.BIM_TRACKING_PROJECT_ID,clientEmail:process.env.BIM_TRACKING_CLIENT_EMAIL,privateKey:process.env.BIM_TRACKING_PRIVATE_KEY?.replace(/\\n/g,"\n")})};return o("bim-tracking",e)})().firestore(),d=()=>n,g=()=>c,l=()=>i,f=()=>p}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=r.X(0,[9276,5972],(()=>{return e=63298,r(r.s=e);var e}));module.exports=t})();