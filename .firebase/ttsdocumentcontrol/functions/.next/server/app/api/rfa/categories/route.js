"use strict";(()=>{var e={};e.id=5927,e.ids=[5927],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63298:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>v,patchFetch:()=>T,requestAsyncStorage:()=>l,routeModule:()=>d,serverHooks:()=>f,staticGenerationAsyncStorage:()=>g});var s={};t.r(s),t.d(s,{GET:()=>p,dynamic:()=>u});var a=t(49303),o=t(88716),n=t(60670),i=t(87070),c=t(40416);let u="force-dynamic";async function p(e){try{let r=e.headers.get("authorization");if(!r?.startsWith("Bearer "))return i.NextResponse.json({success:!1,error:"Missing or invalid authorization header"},{status:401});let t=r.split("Bearer ")[1],s=(await c.CZ.verifyIdToken(t)).uid,a=await c.iW.collection("users").doc(s).get();if(!a.exists)return i.NextResponse.json({success:!1,error:"User not found"},{status:404});let o=a.data(),n=o?.sites||[];if(0===n.length)return i.NextResponse.json({success:!1,error:"No site access"},{status:403});let{searchParams:u}=new URL(e.url),p=u.get("rfaType");if(!p)return i.NextResponse.json({success:!1,error:"Missing rfaType parameter"},{status:400});let d=[];for(let e of n){let r=c.iW.collection("sites").doc(e).collection("categories").where("active","==",!0);"ALL"!==p&&(r=r.where("rfaTypes","array-contains",p)),(await r.get()).forEach(r=>{let t=r.data();d.push({id:r.id,siteId:e,categoryCode:t.categoryCode||"UNKNOWN",categoryName:t.categoryName||"Unknown Category",rfaTypes:t.rfaTypes,sequence:t.sequence||0})})}return d.sort((e,r)=>e.sequence!==r.sequence?e.sequence-r.sequence:e.categoryCode.localeCompare(r.categoryCode)),i.NextResponse.json({success:!0,categories:d,count:d.length})}catch(e){return console.error("Error fetching RFA categories:",e),i.NextResponse.json({success:!1,error:"Internal server error"},{status:500})}}let d=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/rfa/categories/route",pathname:"/api/rfa/categories",filename:"route",bundlePath:"app/api/rfa/categories/route"},resolvedPagePath:"D:\\ttsdoc-v2\\src\\app\\api\\rfa\\categories\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:l,staticGenerationAsyncStorage:g,serverHooks:f}=d,v="/api/rfa/categories/route";function T(){return(0,n.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:g})}},40416:(e,r,t)=>{t.d(r,{CZ:()=>i,Hf:()=>c,iW:()=>n,uE:()=>u,Lv:()=>p});let s=require("firebase-admin"),a=(e,r)=>s.apps.find(r=>r?.name===e)||s.initializeApp(r,e),o=()=>a("ttsdoc-v2",{credential:s.credential.cert({projectId:process.env.TTSDOC_PROJECT_ID,clientEmail:process.env.TTSDOC_CLIENT_EMAIL,privateKey:process.env.TTSDOC_PRIVATE_KEY?.replace(/\\n/g,"\n")}),storageBucket:"ttsdocumentcontrol.firebasestorage.app"}),n=o().firestore(),i=o().auth(),c=o().storage().bucket(),u=a("bim-tracking",{credential:s.credential.cert({projectId:process.env.BIM_TRACKING_PROJECT_ID,clientEmail:process.env.BIM_TRACKING_CLIENT_EMAIL,privateKey:process.env.BIM_TRACKING_PRIVATE_KEY?.replace(/\\n/g,"\n")})}).firestore(),p=()=>u}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[8948,5972],()=>t(63298));module.exports=s})();