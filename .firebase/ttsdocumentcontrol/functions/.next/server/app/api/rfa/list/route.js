"use strict";(()=>{var e={};e.id=5426,e.ids=[5426],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},85871:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>N,patchFetch:()=>_,requestAsyncStorage:()=>R,routeModule:()=>d,serverHooks:()=>p,staticGenerationAsyncStorage:()=>P});var s={};r.r(s),r.d(s,{GET:()=>u,dynamic:()=>I});var i=r(49303),a=r(88716),n=r(60670),o=r(87070),E=r(40416),c=r(4458);let I="force-dynamic";async function u(e){try{let t=e.headers.get("authorization");if(!t?.startsWith("Bearer "))return o.NextResponse.json({success:!1,error:"Missing or invalid authorization header"},{status:401});let r=t.split("Bearer ")[1],s=(await E.CZ.verifyIdToken(r)).uid,i=await E.iW.collection("users").doc(s).get();if(!i.exists)return o.NextResponse.json({success:!1,error:"User not found"},{status:404});let a=i.data().sites||[];if(0===a.length)return o.NextResponse.json({success:!0,documents:[]});let{searchParams:n}=new URL(e.url),I=n.get("view");if("approved"!==I)return o.NextResponse.json({success:!1,error:"Invalid view parameter for this endpoint"},{status:400});let u=E.iW.collection("rfaDocuments"),d=[c.n$.APPROVED,c.n$.APPROVED_WITH_COMMENTS,c.n$.APPROVED_REVISION_REQUIRED];u=u.where("isLatest","==",!0).where("status","in",d);let R=n.get("siteId");if(R&&"ALL"!==R){if(!a.includes(R))return o.NextResponse.json({success:!0,documents:[]});u=u.where("siteId","==",R)}else u=u.where("siteId","in",a);let P=n.get("categoryId");P&&"ALL"!==P&&(u=u.where("categoryId","==",P)),u=u.orderBy("updatedAt","desc");let p=await u.get(),N=[];return p.forEach(e=>{let t=e.data();N.push({id:e.id,documentNumber:t.documentNumber,title:t.title,status:t.status,updatedAt:t.updatedAt,rfaType:t.rfaType,site:{id:t.siteId,name:t.siteName||"N/A"},category:{id:t.categoryId,categoryCode:t.taskData?.taskCategory||t.categoryId||"N/A"},files:t.files||[]})}),o.NextResponse.json({success:!0,documents:N})}catch(t){if(console.error("Error fetching approved RFA documents:",t),t instanceof Error&&t.message.includes("FAILED_PRECONDITION"))return o.NextResponse.json({success:!1,error:"Firestore query requires a composite index. Please check the server logs for the creation link."},{status:400});let e=t instanceof Error?t.message:"Internal Server Error";return o.NextResponse.json({success:!1,error:e},{status:500})}}let d=new i.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/rfa/list/route",pathname:"/api/rfa/list",filename:"route",bundlePath:"app/api/rfa/list/route"},resolvedPagePath:"D:\\ttsdoc-v2\\src\\app\\api\\rfa\\list\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:R,staticGenerationAsyncStorage:P,serverHooks:p}=d,N="/api/rfa/list/route";function _(){return(0,n.patchFetch)({serverHooks:p,staticGenerationAsyncStorage:P})}},4458:(e,t,r)=>{r.d(t,{K$:()=>s,gf:()=>n,n$:()=>o,oU:()=>a,uc:()=>i});let s={ADMIN:"Admin",BIM:"BIM",SITE_ADMIN:"Site Admin",CM:"CM",ME:"ME",SN:"SN",OE:"OE",PE:"PE",PM:"PM",SE:"SE",ADMIN_SITE_2:"Adminsite2"},i=[s.BIM,s.ME,s.SN],a=[s.SITE_ADMIN,s.ADMIN_SITE_2,s.OE,s.PE],n=[s.CM];s.PM,s.SE;let o={PENDING_REVIEW:"PENDING_REVIEW",PENDING_CM_APPROVAL:"PENDING_CM_APPROVAL",REVISION_REQUIRED:"REVISION_REQUIRED",APPROVED:"APPROVED",APPROVED_WITH_COMMENTS:"APPROVED_WITH_COMMENTS",APPROVED_REVISION_REQUIRED:"APPROVED_REVISION_REQUIRED",REJECTED:"REJECTED",PENDING_FINAL_APPROVAL:"PENDING_FINAL_APPROVAL"};o.PENDING_REVIEW,o.PENDING_CM_APPROVAL,o.REVISION_REQUIRED,o.APPROVED,o.APPROVED_WITH_COMMENTS,o.APPROVED_REVISION_REQUIRED,o.REJECTED,o.PENDING_FINAL_APPROVAL,o.PENDING_REVIEW,o.PENDING_CM_APPROVAL,o.REVISION_REQUIRED,o.APPROVED,o.REJECTED,o.APPROVED_WITH_COMMENTS,o.APPROVED_REVISION_REQUIRED},40416:(e,t,r)=>{r.d(t,{CZ:()=>o,Hf:()=>E,iW:()=>n,uE:()=>c,Lv:()=>I});let s=require("firebase-admin"),i=(e,t)=>s.apps.find(t=>t?.name===e)||s.initializeApp(t,e),a=()=>i("ttsdoc-v2",{credential:s.credential.cert({projectId:process.env.TTSDOC_PROJECT_ID,clientEmail:process.env.TTSDOC_CLIENT_EMAIL,privateKey:process.env.TTSDOC_PRIVATE_KEY?.replace(/\\n/g,"\n")}),storageBucket:"ttsdocumentcontrol.firebasestorage.app"}),n=a().firestore(),o=a().auth(),E=a().storage().bucket(),c=i("bim-tracking",{credential:s.credential.cert({projectId:process.env.BIM_TRACKING_PROJECT_ID,clientEmail:process.env.BIM_TRACKING_CLIENT_EMAIL,privateKey:process.env.BIM_TRACKING_PRIVATE_KEY?.replace(/\\n/g,"\n")})}).firestore(),I=()=>c}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[8948,5972],()=>r(85871));module.exports=s})();