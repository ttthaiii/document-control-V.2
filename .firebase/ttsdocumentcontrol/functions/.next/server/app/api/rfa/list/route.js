"use strict";(()=>{var e={};e.id=426,e.ids=[426],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},79637:e=>{e.exports=import("firebase-admin/auth")},6871:(e,t,r)=>{r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{originalPathname:()=>l,patchFetch:()=>c,requestAsyncStorage:()=>d,routeModule:()=>u,serverHooks:()=>R,staticGenerationAsyncStorage:()=>I});var a=r(49303),n=r(88716),i=r(60670),o=r(5854),E=e([o]);o=(E.then?(await E)():E)[0];let u=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/rfa/list/route",pathname:"/api/rfa/list",filename:"route",bundlePath:"app/api/rfa/list/route"},resolvedPagePath:"D:\\ttsdoc-v2\\src\\app\\api\\rfa\\list\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:d,staticGenerationAsyncStorage:I,serverHooks:R}=u,l="/api/rfa/list/route";function c(){return(0,i.patchFetch)({serverHooks:R,staticGenerationAsyncStorage:I})}s()}catch(e){s(e)}})},5854:(e,t,r)=>{r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{GET:()=>c});var a=r(87070),n=r(40416),i=r(79637),o=r(4458),E=e([i]);async function c(e){try{let t=e.headers.get("authorization");if(!t?.startsWith("Bearer "))return a.NextResponse.json({success:!1,error:"Missing or invalid authorization header"},{status:401});let r=t.split("Bearer ")[1],s=(await (0,i.getAuth)().verifyIdToken(r)).uid,E=await n.iW.collection("users").doc(s).get();if(!E.exists)return a.NextResponse.json({success:!1,error:"User not found"},{status:404});let c=E.data(),u=c.role,d=c.sites||[];if(0===d.length)return a.NextResponse.json({success:!0,documents:[]});let{searchParams:I}=new URL(e.url),R=I.get("rfaType"),l=I.get("status"),p=I.get("categoryId"),P=n.iW.collection("rfaDocuments");P=P.where("siteId","in",d),R&&"ALL"!==R&&(P=P.where("rfaType","==",R)),p&&"ALL"!==p&&(P=P.where("categoryId","==",p)),l&&"ALL"!==l&&(P=P.where("status","==",l)),o.gf.includes(u)&&(P=P.where("status","not-in",[o.n$.PENDING_REVIEW,o.n$.REVISION_REQUIRED])),P=P.orderBy("status").orderBy("updatedAt","desc");let _=await P.get(),N=[],A=[o.n$.APPROVED,o.n$.REJECTED,o.n$.APPROVED_WITH_COMMENTS,o.n$.APPROVED_REVISION_REQUIRED];for(let e of _.docs){let t=e.data(),r=!0;if(o.gf.includes(u)?[o.n$.PENDING_CM_APPROVAL,...A].includes(t.status)||(r=!1):o.rz.includes(u)&&!A.includes(t.status)&&(r=!1),r){let r={canView:!0,canEdit:t.createdBy===s&&t.status===o.n$.REVISION_REQUIRED,canSendToCm:o.oU.includes(u)&&t.status===o.n$.PENDING_REVIEW,canRequestRevision:o.oU.includes(u)&&t.status===o.n$.PENDING_REVIEW,canApprove:o.gf.includes(u)&&t.status===o.n$.PENDING_CM_APPROVAL,canReject:o.gf.includes(u)&&t.status===o.n$.PENDING_CM_APPROVAL},a={id:t.siteId,name:t.siteName||"N/A"},n={id:t.categoryId,categoryCode:t.taskData?.taskCategory||"N/A"},i={email:t.workflow[0]?.userName||"N/A",role:t.workflow[0]?.role||"N/A"};N.push({id:e.id,...t,site:a,category:n,createdByInfo:i,assignedUserInfo:null,permissions:r})}}return a.NextResponse.json({success:!0,documents:N})}catch(t){console.error("Error fetching RFA documents:",t);let e=t instanceof Error?t.message:"Internal Server Error";return a.NextResponse.json({success:!1,error:e},{status:500})}}i=(E.then?(await E)():E)[0],s()}catch(e){s(e)}})},4458:(e,t,r)=>{r.d(t,{gf:()=>n,n$:()=>o,oU:()=>a,rz:()=>i,uc:()=>s});let s=["BIM","ME","SN"],a=["Site Admin","Adminsite2","OE","PE"],n=["CM"],i=["SE"],o={PENDING_REVIEW:"PENDING_REVIEW",PENDING_CM_APPROVAL:"PENDING_CM_APPROVAL",REVISION_REQUIRED:"REVISION_REQUIRED",APPROVED:"APPROVED",APPROVED_WITH_COMMENTS:"APPROVED_WITH_COMMENTS",APPROVED_REVISION_REQUIRED:"APPROVED_REVISION_REQUIRED",REJECTED:"REJECTED"};o.PENDING_REVIEW,o.PENDING_CM_APPROVAL,o.REVISION_REQUIRED,o.APPROVED,o.APPROVED_WITH_COMMENTS,o.APPROVED_REVISION_REQUIRED,o.REJECTED},40416:(e,t,r)=>{r.d(t,{CZ:()=>u,Hf:()=>d,iW:()=>c,uE:()=>I});let s=require("firebase-admin");var a=r.n(s);let n={credential:a().credential.cert({projectId:process.env.FIREBASE_PROJECT_ID,clientEmail:process.env.FIREBASE_CLIENT_EMAIL,privateKey:process.env.FIREBASE_PRIVATE_KEY?.replace(/\\n/g,"\n")}),storageBucket:"ttsdocumentcontrol.firebasestorage.app"},i={credential:a().credential.cert({projectId:process.env.BIM_TRACKING_PROJECT_ID,clientEmail:process.env.BIM_TRACKING_CLIENT_EMAIL,privateKey:process.env.BIM_TRACKING_PRIVATE_KEY?.replace(/\\n/g,"\n")})},o=a().apps.find(e=>e?.name==="ttsdoc-v2")||a().initializeApp(n,"ttsdoc-v2"),E=a().apps.find(e=>e?.name==="bim-tracking")||a().initializeApp(i,"bim-tracking"),c=o.firestore(),u=o.auth(),d=o.storage().bucket(),I=E.firestore()}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[948,972],()=>r(6871));module.exports=s})();