"use strict";(()=>{var e={id:5426,ids:[5426]};e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},85871:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>A,patchFetch:()=>u,requestAsyncStorage:()=>R,routeModule:()=>N,serverHooks:()=>D,staticGenerationAsyncStorage:()=>_});var s={};r.r(s),r.d(s,{GET:()=>P,dynamic:()=>c});var E=r(49303),n=r(88716),o=r(60670),a=r(87070),i=r(40416),I=r(4458);const c="force-dynamic";async function P(e){try{const t=e.headers.get("authorization");if(!t?.startsWith("Bearer "))return a.NextResponse.json({success:!1,error:"Missing or invalid authorization header"},{status:401});const r=t.split("Bearer ")[1],s=(await i.CZ.verifyIdToken(r)).uid,E=await i.iW.collection("users").doc(s).get();if(!E.exists)return a.NextResponse.json({success:!1,error:"User not found"},{status:404});const n=E.data().sites||[];if(0===n.length)return a.NextResponse.json({success:!0,documents:[]});const{searchParams:o}=new URL(e.url);if("approved"!==o.get("view"))return a.NextResponse.json({success:!1,error:"Invalid view parameter for this endpoint"},{status:400});let c=i.iW.collection("rfaDocuments");const P=[I.n$.APPROVED,I.n$.APPROVED_WITH_COMMENTS,I.n$.APPROVED_REVISION_REQUIRED];c=c.where("isLatest","==",!0).where("status","in",P);const N=o.get("siteId");if(N&&"ALL"!==N){if(!n.includes(N))return a.NextResponse.json({success:!0,documents:[]});c=c.where("siteId","==",N)}else c=c.where("siteId","in",n);const R=o.get("categoryId");R&&"ALL"!==R&&(c=c.where("categoryId","==",R)),c=c.orderBy("updatedAt","desc");const _=await c.get(),D=[];return _.forEach((e=>{const t=e.data();D.push({id:e.id,documentNumber:t.documentNumber,title:t.title,status:t.status,updatedAt:t.updatedAt,rfaType:t.rfaType,site:{id:t.siteId,name:t.siteName||"N/A"},category:{id:t.categoryId,categoryCode:t.taskData?.taskCategory||t.categoryId||"N/A"},files:t.files||[]})})),a.NextResponse.json({success:!0,documents:D})}catch(t){if(console.error("Error fetching approved RFA documents:",t),t instanceof Error&&t.message.includes("FAILED_PRECONDITION"))return a.NextResponse.json({success:!1,error:"Firestore query requires a composite index. Please check the server logs for the creation link."},{status:400});const e=t instanceof Error?t.message:"Internal Server Error";return a.NextResponse.json({success:!1,error:e},{status:500})}}const N=new E.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/rfa/list/route",pathname:"/api/rfa/list",filename:"route",bundlePath:"app/api/rfa/list/route"},resolvedPagePath:"D:\\ttsdoc-v2\\src\\app\\api\\rfa\\list\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:R,staticGenerationAsyncStorage:_,serverHooks:D}=N,A="/api/rfa/list/route";function u(){return(0,o.patchFetch)({serverHooks:D,staticGenerationAsyncStorage:_})}},4458:(e,t,r)=>{r.d(t,{$p:()=>i,Ge:()=>c,K$:()=>s,NK:()=>P,c9:()=>a,gf:()=>o,n$:()=>I,oU:()=>n,uc:()=>E});const s={ADMIN:"Admin",BIM:"BIM",SITE_ADMIN:"Site Admin",CM:"CM",ME:"ME",SN:"SN",OE:"OE",PE:"PE",PM:"PM",PD:"PD",SE:"SE",FM:"FM",ADMIN_SITE_2:"Adminsite2"},E=[s.BIM,s.ME,s.SN,s.SITE_ADMIN,s.ADMIN,s.PM,s.PE,s.OE],n=[s.SITE_ADMIN,s.ADMIN_SITE_2,s.OE,s.PE,s.ADMIN],o=[s.CM,s.ADMIN,s.SITE_ADMIN,s.PM,s.PE,s.OE],a=(s.PM,s.ADMIN,s.SE,s.FM,[s.PE,s.OE,s.ADMIN]),i=[s.PM,s.ADMIN],I=(s.PD,s.SE,s.FM,{PENDING_REVIEW:"PENDING_REVIEW",PENDING_CM_APPROVAL:"PENDING_CM_APPROVAL",REVISION_REQUIRED:"REVISION_REQUIRED",APPROVED:"APPROVED",APPROVED_WITH_COMMENTS:"APPROVED_WITH_COMMENTS",APPROVED_REVISION_REQUIRED:"APPROVED_REVISION_REQUIRED",REJECTED:"REJECTED",PENDING_FINAL_APPROVAL:"PENDING_FINAL_APPROVAL"}),c={DRAFT:"DRAFT",REJECTED_BY_PM:"REJECTED_BY_PM",PENDING_BIM:"PENDING_BIM",IN_PROGRESS:"IN_PROGRESS",PENDING_ACCEPTANCE:"PENDING_ACCEPTANCE",REVISION_REQUESTED:"REVISION_REQUESTED",COMPLETED:"COMPLETED"},P={[I.PENDING_REVIEW]:"\u0e23\u0e2d\u0e15\u0e23\u0e27\u0e08\u0e2a\u0e2d\u0e1a",[I.PENDING_CM_APPROVAL]:"\u0e23\u0e2d\u0e2d\u0e19\u0e38\u0e21\u0e31\u0e15\u0e34 (CM/Approver)",[I.REVISION_REQUIRED]:"\u0e41\u0e01\u0e49\u0e44\u0e02",[I.APPROVED]:"\u0e2d\u0e19\u0e38\u0e21\u0e31\u0e15\u0e34",[I.APPROVED_WITH_COMMENTS]:"\u0e2d\u0e19\u0e38\u0e21\u0e31\u0e15\u0e34\u0e15\u0e32\u0e21\u0e04\u0e2d\u0e21\u0e40\u0e21\u0e19\u0e15\u0e4c (\u0e44\u0e21\u0e48\u0e41\u0e01\u0e49\u0e44\u0e02)",[I.APPROVED_REVISION_REQUIRED]:"\u0e2d\u0e19\u0e38\u0e21\u0e31\u0e15\u0e34\u0e15\u0e32\u0e21\u0e04\u0e2d\u0e21\u0e40\u0e21\u0e19\u0e15\u0e4c (\u0e15\u0e49\u0e2d\u0e07\u0e41\u0e01\u0e49\u0e44\u0e02)",[I.REJECTED]:"\u0e44\u0e21\u0e48\u0e2d\u0e19\u0e38\u0e21\u0e31\u0e15\u0e34",[I.PENDING_FINAL_APPROVAL]:"\u0e23\u0e2d SITE \u0e2d\u0e19\u0e38\u0e21\u0e31\u0e15\u0e34\u0e02\u0e31\u0e49\u0e19\u0e2a\u0e38\u0e14\u0e17\u0e49\u0e32\u0e22",[c.DRAFT]:"\u0e23\u0e2d\u0e2d\u0e19\u0e38\u0e21\u0e31\u0e15\u0e34 (PM)",[c.REJECTED_BY_PM]:"\u0e44\u0e21\u0e48\u0e2d\u0e19\u0e38\u0e21\u0e31\u0e15\u0e34 (PM)",[c.PENDING_BIM]:"\u0e23\u0e2d BIM \u0e23\u0e31\u0e1a\u0e07\u0e32\u0e19",[c.IN_PROGRESS]:"BIM \u0e01\u0e33\u0e25\u0e31\u0e07\u0e14\u0e33\u0e40\u0e19\u0e34\u0e19\u0e01\u0e32\u0e23",[c.PENDING_ACCEPTANCE]:"\u0e23\u0e2d\u0e15\u0e23\u0e27\u0e08\u0e23\u0e31\u0e1a (Site)",[c.REVISION_REQUESTED]:"\u0e02\u0e2d\u0e41\u0e01\u0e49\u0e44\u0e02 (WR)",[c.COMPLETED]:"\u0e40\u0e2a\u0e23\u0e47\u0e08\u0e2a\u0e34\u0e49\u0e19"};I.PENDING_REVIEW,I.PENDING_CM_APPROVAL,I.REVISION_REQUIRED,I.APPROVED,I.REJECTED,I.APPROVED_WITH_COMMENTS,I.APPROVED_REVISION_REQUIRED,I.PENDING_FINAL_APPROVAL,c.DRAFT,c.REJECTED_BY_PM,c.PENDING_BIM,c.IN_PROGRESS,c.PENDING_ACCEPTANCE,c.REVISION_REQUESTED,c.COMPLETED},40416:(e,t,r)=>{r.d(t,{CZ:()=>a,Hf:()=>i,iW:()=>o,SI:()=>I,uE:()=>c,Dh:()=>N,aj:()=>R,_B:()=>P,Lv:()=>_});const s=require("firebase-admin"),E=(e,t)=>s.apps.find((t=>t?.name===e))||s.initializeApp(t,e),n=()=>{const e={credential:s.credential.cert({projectId:process.env.TTSDOC_PROJECT_ID,clientEmail:process.env.TTSDOC_CLIENT_EMAIL,privateKey:process.env.TTSDOC_PRIVATE_KEY?.replace(/\\n/g,"\n")}),storageBucket:"ttsdocumentcontrol.firebasestorage.app"};return E("ttsdoc-v2",e)},o=n().firestore(),a=n().auth(),i=n().storage().bucket(),I=n().messaging(),c=(()=>{const e={credential:s.credential.cert({projectId:process.env.BIM_TRACKING_PROJECT_ID,clientEmail:process.env.BIM_TRACKING_CLIENT_EMAIL,privateKey:process.env.BIM_TRACKING_PRIVATE_KEY?.replace(/\\n/g,"\n")})};return E("bim-tracking",e)})().firestore(),P=()=>o,N=()=>a,R=()=>i,_=()=>c}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=t.X(0,[9276,5972],(()=>{return e=85871,t(t.s=e);var e}));module.exports=r})();