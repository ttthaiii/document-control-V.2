"use strict";(()=>{var e={};e.id=5426,e.ids=[5426],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},85871:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>u,patchFetch:()=>d,requestAsyncStorage:()=>c,routeModule:()=>N,serverHooks:()=>D,staticGenerationAsyncStorage:()=>_});var E={};r.r(E),r.d(E,{GET:()=>R,dynamic:()=>P});var s=r(49303),i=r(88716),a=r(60670),n=r(87070),I=r(40416),o=r(4458);let P="force-dynamic";async function R(e){try{let t=e.headers.get("authorization");if(!t?.startsWith("Bearer "))return n.NextResponse.json({success:!1,error:"Missing or invalid authorization header"},{status:401});let r=t.split("Bearer ")[1],E=(await I.CZ.verifyIdToken(r)).uid,s=await I.iW.collection("users").doc(E).get();if(!s.exists)return n.NextResponse.json({success:!1,error:"User not found"},{status:404});let i=s.data().sites||[];if(0===i.length)return n.NextResponse.json({success:!0,documents:[]});let{searchParams:a}=new URL(e.url),P=a.get("view");if("approved"!==P)return n.NextResponse.json({success:!1,error:"Invalid view parameter for this endpoint"},{status:400});let R=I.iW.collection("rfaDocuments"),N=[o.n$.APPROVED,o.n$.APPROVED_WITH_COMMENTS,o.n$.APPROVED_REVISION_REQUIRED];R=R.where("isLatest","==",!0).where("status","in",N);let c=a.get("siteId");if(c&&"ALL"!==c){if(!i.includes(c))return n.NextResponse.json({success:!0,documents:[]});R=R.where("siteId","==",c)}else R=R.where("siteId","in",i);let _=a.get("categoryId");_&&"ALL"!==_&&(R=R.where("categoryId","==",_)),R=R.orderBy("updatedAt","desc");let D=await R.get(),u=[];return D.forEach(e=>{let t=e.data();u.push({id:e.id,documentNumber:t.documentNumber,title:t.title,status:t.status,updatedAt:t.updatedAt,rfaType:t.rfaType,site:{id:t.siteId,name:t.siteName||"N/A"},category:{id:t.categoryId,categoryCode:t.taskData?.taskCategory||t.categoryId||"N/A"},files:t.files||[]})}),n.NextResponse.json({success:!0,documents:u})}catch(t){if(console.error("Error fetching approved RFA documents:",t),t instanceof Error&&t.message.includes("FAILED_PRECONDITION"))return n.NextResponse.json({success:!1,error:"Firestore query requires a composite index. Please check the server logs for the creation link."},{status:400});let e=t instanceof Error?t.message:"Internal Server Error";return n.NextResponse.json({success:!1,error:e},{status:500})}}let N=new s.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/rfa/list/route",pathname:"/api/rfa/list",filename:"route",bundlePath:"app/api/rfa/list/route"},resolvedPagePath:"D:\\ttsdoc-v2\\src\\app\\api\\rfa\\list\\route.ts",nextConfigOutput:"",userland:E}),{requestAsyncStorage:c,staticGenerationAsyncStorage:_,serverHooks:D}=N,u="/api/rfa/list/route";function d(){return(0,a.patchFetch)({serverHooks:D,staticGenerationAsyncStorage:_})}},4458:(e,t,r)=>{r.d(t,{$p:()=>I,Ge:()=>P,K$:()=>E,c9:()=>n,gf:()=>a,n$:()=>o,oU:()=>i,uc:()=>s});let E={ADMIN:"Admin",BIM:"BIM",SITE_ADMIN:"Site Admin",CM:"CM",ME:"ME",SN:"SN",OE:"OE",PE:"PE",PM:"PM",PD:"PD",SE:"SE",FM:"FM",ADMIN_SITE_2:"Adminsite2"},s=[E.BIM,E.ME,E.SN,E.ADMIN],i=[E.SITE_ADMIN,E.ADMIN_SITE_2,E.OE,E.PE,E.ADMIN],a=[E.CM,E.PD,E.ADMIN];E.PM,E.ADMIN,E.SE,E.FM;let n=[E.PE,E.OE,E.ADMIN],I=[E.PD,E.PM,E.ADMIN],o={PENDING_REVIEW:"PENDING_REVIEW",PENDING_CM_APPROVAL:"PENDING_CM_APPROVAL",REVISION_REQUIRED:"REVISION_REQUIRED",APPROVED:"APPROVED",APPROVED_WITH_COMMENTS:"APPROVED_WITH_COMMENTS",APPROVED_REVISION_REQUIRED:"APPROVED_REVISION_REQUIRED",REJECTED:"REJECTED",PENDING_FINAL_APPROVAL:"PENDING_FINAL_APPROVAL"},P={DRAFT:"DRAFT",REJECTED_BY_PM:"REJECTED_BY_PM",PENDING_BIM:"PENDING_BIM",IN_PROGRESS:"IN_PROGRESS",PENDING_ACCEPTANCE:"PENDING_ACCEPTANCE",REVISION_REQUESTED:"REVISION_REQUESTED",COMPLETED:"COMPLETED"};o.PENDING_REVIEW,o.PENDING_CM_APPROVAL,o.REVISION_REQUIRED,o.APPROVED,o.APPROVED_WITH_COMMENTS,o.APPROVED_REVISION_REQUIRED,o.REJECTED,o.PENDING_FINAL_APPROVAL,P.DRAFT,P.REJECTED_BY_PM,P.PENDING_BIM,P.IN_PROGRESS,P.PENDING_ACCEPTANCE,P.REVISION_REQUESTED,P.COMPLETED,o.PENDING_REVIEW,o.PENDING_CM_APPROVAL,o.REVISION_REQUIRED,o.APPROVED,o.REJECTED,o.APPROVED_WITH_COMMENTS,o.APPROVED_REVISION_REQUIRED,P.DRAFT,P.REJECTED_BY_PM,P.PENDING_BIM,P.IN_PROGRESS,P.PENDING_ACCEPTANCE,P.REVISION_REQUESTED,P.COMPLETED},40416:(e,t,r)=>{r.d(t,{CZ:()=>n,Hf:()=>I,iW:()=>a,SI:()=>o,uE:()=>P,Dh:()=>N,_B:()=>R,Lv:()=>c});let E=require("firebase-admin"),s=(e,t)=>E.apps.find(t=>t?.name===e)||E.initializeApp(t,e),i=()=>s("ttsdoc-v2",{credential:E.credential.cert({projectId:process.env.TTSDOC_PROJECT_ID,clientEmail:process.env.TTSDOC_CLIENT_EMAIL,privateKey:process.env.TTSDOC_PRIVATE_KEY?.replace(/\\n/g,"\n")}),storageBucket:"ttsdocumentcontrol.firebasestorage.app"}),a=i().firestore(),n=i().auth(),I=i().storage().bucket(),o=i().messaging(),P=s("bim-tracking",{credential:E.credential.cert({projectId:process.env.BIM_TRACKING_PROJECT_ID,clientEmail:process.env.BIM_TRACKING_CLIENT_EMAIL,privateKey:process.env.BIM_TRACKING_PRIVATE_KEY?.replace(/\\n/g,"\n")})}).firestore(),R=()=>a,N=()=>n,c=()=>P}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),E=t.X(0,[9276,5972],()=>r(85871));module.exports=E})();