"use strict";(()=>{var e={id:5102,ids:[5102]};e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},89591:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>l,patchFetch:()=>f,requestAsyncStorage:()=>m,routeModule:()=>d,serverHooks:()=>g,staticGenerationAsyncStorage:()=>v});var s={};t.r(s),t.d(s,{POST:()=>p,dynamic:()=>u});var i=t(49303),n=t(88716),a=t(60670),o=t(87070),c=t(40416);const u="force-dynamic";async function p(e){try{const r=e.headers.get("authorization");if(!r?.startsWith("Bearer "))return o.NextResponse.json({success:!1,error:"Authorization required"},{status:401});const t=r.split("Bearer ")[1];await c.CZ.verifyIdToken(t);const{documentNumber:s,projectName:i,rev:n,taskName:a}=await e.json();if(!s||!i||void 0===n||!a)return o.NextResponse.json({success:!1,error:"Missing required fields for verification"},{status:400});const u=(0,c.Lv)(),p=u.collection("projects").where("name","==",i).limit(1),d=await p.get();if(d.empty)return o.NextResponse.json({success:!0,exists:!1,message:`\u0e44\u0e21\u0e48\u0e1e\u0e1a\u0e42\u0e1b\u0e23\u0e40\u0e08\u0e01\u0e15\u0e4c '${i}' \u0e43\u0e19\u0e23\u0e30\u0e1a\u0e1a BIM Tracking`});const m=d.docs[0].id,v=u.collection("tasks").where("documentNumber","==",s).where("projectId","==",m).where("rev","==",String(n).padStart(2,"0")).limit(1),g=await v.get();if(g.empty)return o.NextResponse.json({success:!0,exists:!1,message:"\u0e44\u0e21\u0e48\u0e1e\u0e1a Task \u0e17\u0e35\u0e48\u0e15\u0e23\u0e07\u0e01\u0e31\u0e19\u0e43\u0e19\u0e23\u0e30\u0e1a\u0e1a BIM Tracking"});{const e=g.docs[0].id;return o.NextResponse.json({success:!0,exists:!0,taskId:e})}}catch(r){return console.error("BIM Tracking Verification Error:",r),o.NextResponse.json({success:!1,error:"Internal Server Error",details:r.message},{status:500})}}const d=new i.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/bim-tracking/verify-task/route",pathname:"/api/bim-tracking/verify-task",filename:"route",bundlePath:"app/api/bim-tracking/verify-task/route"},resolvedPagePath:"D:\\ttsdoc-v2\\src\\app\\api\\bim-tracking\\verify-task\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:m,staticGenerationAsyncStorage:v,serverHooks:g}=d,l="/api/bim-tracking/verify-task/route";function f(){return(0,a.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:v})}},40416:(e,r,t)=>{t.d(r,{CZ:()=>o,Hf:()=>c,iW:()=>a,SI:()=>u,uE:()=>p,Dh:()=>m,aj:()=>v,_B:()=>d,Lv:()=>g});const s=require("firebase-admin"),i=(e,r)=>s.apps.find((r=>r?.name===e))||s.initializeApp(r,e),n=()=>{const e={credential:s.credential.cert({projectId:process.env.TTSDOC_PROJECT_ID,clientEmail:process.env.TTSDOC_CLIENT_EMAIL,privateKey:process.env.TTSDOC_PRIVATE_KEY?.replace(/\\n/g,"\n")}),storageBucket:"ttsdocumentcontrol.firebasestorage.app"};return i("ttsdoc-v2",e)},a=n().firestore(),o=n().auth(),c=n().storage().bucket(),u=n().messaging(),p=(()=>{const e={credential:s.credential.cert({projectId:process.env.BIM_TRACKING_PROJECT_ID,clientEmail:process.env.BIM_TRACKING_CLIENT_EMAIL,privateKey:process.env.BIM_TRACKING_PRIVATE_KEY?.replace(/\\n/g,"\n")})};return i("bim-tracking",e)})().firestore(),d=()=>a,m=()=>o,v=()=>c,g=()=>p}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=r.X(0,[9276,5972],(()=>{return e=89591,r(r.s=e);var e}));module.exports=t})();