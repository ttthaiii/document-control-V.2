"use strict";(()=>{var e={};e.id=5102,e.ids=[5102],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},89591:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>g,patchFetch:()=>f,requestAsyncStorage:()=>l,routeModule:()=>d,serverHooks:()=>v,staticGenerationAsyncStorage:()=>m});var s={};t.r(s),t.d(s,{POST:()=>u,dynamic:()=>p});var i=t(49303),a=t(88716),n=t(60670),o=t(87070),c=t(40416);let p="force-dynamic";async function u(e){try{let r=e.headers.get("authorization");if(!r?.startsWith("Bearer "))return o.NextResponse.json({success:!1,error:"Authorization required"},{status:401});let t=r.split("Bearer ")[1];await c.CZ.verifyIdToken(t);let{documentNumber:s,projectName:i,rev:a,taskName:n}=await e.json();if(!s||!i||void 0===a||!n)return o.NextResponse.json({success:!1,error:"Missing required fields for verification"},{status:400});let p=(0,c.Lv)(),u=p.collection("projects").where("name","==",i).limit(1),d=await u.get();if(d.empty)return o.NextResponse.json({success:!0,exists:!1,message:`ไม่พบโปรเจกต์ '${i}' ในระบบ BIM Tracking`});let l=d.docs[0].id,m=p.collection("tasks").where("documentNumber","==",s).where("projectId","==",l).where("rev","==",String(a).padStart(2,"0")).limit(1),v=await m.get();if(v.empty)return o.NextResponse.json({success:!0,exists:!1,message:"ไม่พบ Task ที่ตรงกันในระบบ BIM Tracking"});{let e=v.docs[0].id;return o.NextResponse.json({success:!0,exists:!0,taskId:e})}}catch(e){return console.error("BIM Tracking Verification Error:",e),o.NextResponse.json({success:!1,error:"Internal Server Error",details:e.message},{status:500})}}let d=new i.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/bim-tracking/verify-task/route",pathname:"/api/bim-tracking/verify-task",filename:"route",bundlePath:"app/api/bim-tracking/verify-task/route"},resolvedPagePath:"D:\\ttsdoc-v2\\src\\app\\api\\bim-tracking\\verify-task\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:l,staticGenerationAsyncStorage:m,serverHooks:v}=d,g="/api/bim-tracking/verify-task/route";function f(){return(0,n.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:m})}},40416:(e,r,t)=>{t.d(r,{CZ:()=>o,Hf:()=>c,iW:()=>n,uE:()=>p,Dh:()=>d,_B:()=>u,Lv:()=>l});let s=require("firebase-admin"),i=(e,r)=>s.apps.find(r=>r?.name===e)||s.initializeApp(r,e),a=()=>i("ttsdoc-v2",{credential:s.credential.cert({projectId:process.env.TTSDOC_PROJECT_ID,clientEmail:process.env.TTSDOC_CLIENT_EMAIL,privateKey:process.env.TTSDOC_PRIVATE_KEY?.replace(/\\n/g,"\n")}),storageBucket:"ttsdocumentcontrol.firebasestorage.app"}),n=a().firestore(),o=a().auth(),c=a().storage().bucket(),p=i("bim-tracking",{credential:s.credential.cert({projectId:process.env.BIM_TRACKING_PROJECT_ID,clientEmail:process.env.BIM_TRACKING_CLIENT_EMAIL,privateKey:process.env.BIM_TRACKING_PRIVATE_KEY?.replace(/\\n/g,"\n")})}).firestore(),u=()=>n,d=()=>o,l=()=>p}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[8948,5972],()=>t(89591));module.exports=s})();