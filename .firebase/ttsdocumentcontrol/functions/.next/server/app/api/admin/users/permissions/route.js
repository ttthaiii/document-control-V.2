"use strict";(()=>{var e={};e.id=9828,e.ids=[9828],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},83634:(e,E,r)=>{r.r(E),r.d(E,{originalPathname:()=>M,patchFetch:()=>p,requestAsyncStorage:()=>_,routeModule:()=>o,serverHooks:()=>A,staticGenerationAsyncStorage:()=>D});var s={};r.r(s),r.d(s,{POST:()=>a,dynamic:()=>R});var t=r(49303),I=r(88716),i=r(60670),P=r(87070),n=r(40416),N=r(4458);let R="force-dynamic";async function a(e){try{let E=e.headers.get("authorization");if(!E?.startsWith("Bearer "))return P.NextResponse.json({error:"Unauthorized"},{status:401});let r=E.split("Bearer ")[1],s=await n.CZ.verifyIdToken(r),t=await n.iW.collection("users").doc(s.uid).get();if(!t.exists||t.data()?.role!==N.K$.ADMIN)return P.NextResponse.json({error:"Permission denied"},{status:403});let{siteId:I,targetUserId:i,overrides:R}=await e.json();if(!I||!i||!R)return P.NextResponse.json({error:"Missing required fields"},{status:400});let a=`userOverrides.${i}`;return await n.iW.collection("sites").doc(I).update({[a]:R}),P.NextResponse.json({success:!0})}catch(e){return console.error("Update permissions error:",e),P.NextResponse.json({success:!1,error:e.message},{status:500})}}let o=new t.AppRouteRouteModule({definition:{kind:I.x.APP_ROUTE,page:"/api/admin/users/permissions/route",pathname:"/api/admin/users/permissions",filename:"route",bundlePath:"app/api/admin/users/permissions/route"},resolvedPagePath:"D:\\ttsdoc-v2\\src\\app\\api\\admin\\users\\permissions\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:_,staticGenerationAsyncStorage:D,serverHooks:A}=o,M="/api/admin/users/permissions/route";function p(){return(0,i.patchFetch)({serverHooks:A,staticGenerationAsyncStorage:D})}},4458:(e,E,r)=>{r.d(E,{$p:()=>n,Ge:()=>R,K$:()=>s,NK:()=>a,c9:()=>P,gf:()=>i,n$:()=>N,oU:()=>I,uc:()=>t});let s={ADMIN:"Admin",BIM:"BIM",SITE_ADMIN:"Site Admin",CM:"CM",ME:"ME",SN:"SN",OE:"OE",PE:"PE",PM:"PM",PD:"PD",SE:"SE",FM:"FM",ADMIN_SITE_2:"Adminsite2"},t=[s.BIM,s.ME,s.SN,s.SITE_ADMIN,s.ADMIN,s.PM,s.PE,s.OE],I=[s.SITE_ADMIN,s.ADMIN_SITE_2,s.OE,s.PE,s.ADMIN],i=[s.CM,s.ADMIN,s.SITE_ADMIN,s.PM,s.PE,s.OE];s.PM,s.ADMIN,s.SE,s.FM;let P=[s.PE,s.OE,s.ADMIN],n=[s.PM,s.ADMIN];s.PD,s.SE,s.FM;let N={PENDING_REVIEW:"PENDING_REVIEW",PENDING_CM_APPROVAL:"PENDING_CM_APPROVAL",REVISION_REQUIRED:"REVISION_REQUIRED",APPROVED:"APPROVED",APPROVED_WITH_COMMENTS:"APPROVED_WITH_COMMENTS",APPROVED_REVISION_REQUIRED:"APPROVED_REVISION_REQUIRED",REJECTED:"REJECTED",PENDING_FINAL_APPROVAL:"PENDING_FINAL_APPROVAL"},R={DRAFT:"DRAFT",REJECTED_BY_PM:"REJECTED_BY_PM",PENDING_BIM:"PENDING_BIM",IN_PROGRESS:"IN_PROGRESS",PENDING_ACCEPTANCE:"PENDING_ACCEPTANCE",REVISION_REQUESTED:"REVISION_REQUESTED",COMPLETED:"COMPLETED"},a={[N.PENDING_REVIEW]:"รอตรวจสอบ",[N.PENDING_CM_APPROVAL]:"รออนุมัติ (CM/Approver)",[N.REVISION_REQUIRED]:"แก้ไข",[N.APPROVED]:"อนุมัติ",[N.APPROVED_WITH_COMMENTS]:"อนุมัติตามคอมเมนต์ (ไม่แก้ไข)",[N.APPROVED_REVISION_REQUIRED]:"อนุมัติตามคอมเมนต์ (ต้องแก้ไข)",[N.REJECTED]:"ไม่อนุมัติ",[N.PENDING_FINAL_APPROVAL]:"รอ SITE อนุมัติขั้นสุดท้าย",[R.DRAFT]:"รออนุมัติ (PM)",[R.REJECTED_BY_PM]:"ไม่อนุมัติ (PM)",[R.PENDING_BIM]:"รอ BIM รับงาน",[R.IN_PROGRESS]:"BIM กำลังดำเนินการ",[R.PENDING_ACCEPTANCE]:"รอตรวจรับ (Site)",[R.REVISION_REQUESTED]:"ขอแก้ไข (WR)",[R.COMPLETED]:"เสร็จสิ้น"};N.PENDING_REVIEW,N.PENDING_CM_APPROVAL,N.REVISION_REQUIRED,N.APPROVED,N.REJECTED,N.APPROVED_WITH_COMMENTS,N.APPROVED_REVISION_REQUIRED,R.DRAFT,R.REJECTED_BY_PM,R.PENDING_BIM,R.IN_PROGRESS,R.PENDING_ACCEPTANCE,R.REVISION_REQUESTED,R.COMPLETED},40416:(e,E,r)=>{r.d(E,{CZ:()=>P,Hf:()=>n,iW:()=>i,SI:()=>N,uE:()=>R,Dh:()=>o,_B:()=>a,Lv:()=>_});let s=require("firebase-admin"),t=(e,E)=>s.apps.find(E=>E?.name===e)||s.initializeApp(E,e),I=()=>t("ttsdoc-v2",{credential:s.credential.cert({projectId:process.env.TTSDOC_PROJECT_ID,clientEmail:process.env.TTSDOC_CLIENT_EMAIL,privateKey:process.env.TTSDOC_PRIVATE_KEY?.replace(/\\n/g,"\n")}),storageBucket:"ttsdocumentcontrol.firebasestorage.app"}),i=I().firestore(),P=I().auth(),n=I().storage().bucket(),N=I().messaging(),R=t("bim-tracking",{credential:s.credential.cert({projectId:process.env.BIM_TRACKING_PROJECT_ID,clientEmail:process.env.BIM_TRACKING_CLIENT_EMAIL,privateKey:process.env.BIM_TRACKING_PRIVATE_KEY?.replace(/\\n/g,"\n")})}).firestore(),a=()=>i,o=()=>P,_=()=>R}};var E=require("../../../../../webpack-runtime.js");E.C(e);var r=e=>E(E.s=e),s=E.X(0,[9276,5972],()=>r(83634));module.exports=s})();