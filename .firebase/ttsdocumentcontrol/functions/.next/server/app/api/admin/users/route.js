"use strict";(()=>{var e={};e.id=2628,e.ids=[2628],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},17646:(e,E,t)=>{t.r(E),t.d(E,{originalPathname:()=>M,patchFetch:()=>c,requestAsyncStorage:()=>_,routeModule:()=>D,serverHooks:()=>A,staticGenerationAsyncStorage:()=>o});var r={};t.r(r),t.d(r,{GET:()=>R,dynamic:()=>N});var I=t(49303),s=t(88716),a=t(60670),P=t(87070),i=t(40416),n=t(4458);let N="force-dynamic";async function R(e){try{let E=e.headers.get("authorization");if(!E?.startsWith("Bearer "))return P.NextResponse.json({error:"Unauthorized"},{status:401});let t=E.split("Bearer ")[1],r=await i.CZ.verifyIdToken(t),I=await i.iW.collection("users").doc(r.uid).get();if(!I.exists||I.data()?.role!==n.K$.ADMIN)return P.NextResponse.json({error:"Permission denied"},{status:403});let s=(await i.iW.collection("users").get()).docs.map(e=>{let E=e.data();return{id:e.id,email:E.email,name:E.name||"",employeeId:E.employeeId||"",role:E.role,status:E.status,sites:E.sites||[],createdAt:(E.createdAt||E.acceptedAt)?.toDate?.().toISOString()||null,lastLogin:E.lastLogin?.toDate?.().toISOString()||null}});return s.sort((e,E)=>{let t=e.createdAt?new Date(e.createdAt).getTime():0;return(E.createdAt?new Date(E.createdAt).getTime():0)-t}),P.NextResponse.json({success:!0,users:s})}catch(e){return P.NextResponse.json({success:!1,error:e.message},{status:500})}}let D=new I.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/admin/users/route",pathname:"/api/admin/users",filename:"route",bundlePath:"app/api/admin/users/route"},resolvedPagePath:"D:\\ttsdoc-v2\\src\\app\\api\\admin\\users\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:_,staticGenerationAsyncStorage:o,serverHooks:A}=D,M="/api/admin/users/route";function c(){return(0,a.patchFetch)({serverHooks:A,staticGenerationAsyncStorage:o})}},4458:(e,E,t)=>{t.d(E,{$p:()=>i,Ge:()=>N,K$:()=>r,NK:()=>R,c9:()=>P,gf:()=>a,n$:()=>n,oU:()=>s,uc:()=>I});let r={ADMIN:"Admin",BIM:"BIM",SITE_ADMIN:"Site Admin",CM:"CM",ME:"ME",SN:"SN",OE:"OE",PE:"PE",PM:"PM",PD:"PD",SE:"SE",FM:"FM",ADMIN_SITE_2:"Adminsite2"},I=[r.BIM,r.ME,r.SN,r.SITE_ADMIN,r.ADMIN,r.PM,r.PE,r.OE],s=[r.SITE_ADMIN,r.ADMIN_SITE_2,r.OE,r.PE,r.ADMIN],a=[r.CM,r.ADMIN,r.SITE_ADMIN,r.PM,r.PE,r.OE];r.PM,r.ADMIN,r.SE,r.FM;let P=[r.PE,r.OE,r.ADMIN],i=[r.PM,r.ADMIN];r.PD,r.SE,r.FM;let n={PENDING_REVIEW:"PENDING_REVIEW",PENDING_CM_APPROVAL:"PENDING_CM_APPROVAL",REVISION_REQUIRED:"REVISION_REQUIRED",APPROVED:"APPROVED",APPROVED_WITH_COMMENTS:"APPROVED_WITH_COMMENTS",APPROVED_REVISION_REQUIRED:"APPROVED_REVISION_REQUIRED",REJECTED:"REJECTED",PENDING_FINAL_APPROVAL:"PENDING_FINAL_APPROVAL"},N={DRAFT:"DRAFT",REJECTED_BY_PM:"REJECTED_BY_PM",PENDING_BIM:"PENDING_BIM",IN_PROGRESS:"IN_PROGRESS",PENDING_ACCEPTANCE:"PENDING_ACCEPTANCE",REVISION_REQUESTED:"REVISION_REQUESTED",COMPLETED:"COMPLETED"},R={[n.PENDING_REVIEW]:"รอตรวจสอบ",[n.PENDING_CM_APPROVAL]:"รออนุมัติ (CM/Approver)",[n.REVISION_REQUIRED]:"แก้ไข",[n.APPROVED]:"อนุมัติ",[n.APPROVED_WITH_COMMENTS]:"อนุมัติตามคอมเมนต์ (ไม่แก้ไข)",[n.APPROVED_REVISION_REQUIRED]:"อนุมัติตามคอมเมนต์ (ต้องแก้ไข)",[n.REJECTED]:"ไม่อนุมัติ",[n.PENDING_FINAL_APPROVAL]:"รอ SITE อนุมัติขั้นสุดท้าย",[N.DRAFT]:"รออนุมัติ (PM)",[N.REJECTED_BY_PM]:"ไม่อนุมัติ (PM)",[N.PENDING_BIM]:"รอ BIM รับงาน",[N.IN_PROGRESS]:"BIM กำลังดำเนินการ",[N.PENDING_ACCEPTANCE]:"รอตรวจรับ (Site)",[N.REVISION_REQUESTED]:"ขอแก้ไข (WR)",[N.COMPLETED]:"เสร็จสิ้น"};n.PENDING_REVIEW,n.PENDING_CM_APPROVAL,n.REVISION_REQUIRED,n.APPROVED,n.REJECTED,n.APPROVED_WITH_COMMENTS,n.APPROVED_REVISION_REQUIRED,N.DRAFT,N.REJECTED_BY_PM,N.PENDING_BIM,N.IN_PROGRESS,N.PENDING_ACCEPTANCE,N.REVISION_REQUESTED,N.COMPLETED},40416:(e,E,t)=>{t.d(E,{CZ:()=>P,Hf:()=>i,iW:()=>a,SI:()=>n,uE:()=>N,Dh:()=>D,_B:()=>R,Lv:()=>_});let r=require("firebase-admin"),I=(e,E)=>r.apps.find(E=>E?.name===e)||r.initializeApp(E,e),s=()=>I("ttsdoc-v2",{credential:r.credential.cert({projectId:process.env.TTSDOC_PROJECT_ID,clientEmail:process.env.TTSDOC_CLIENT_EMAIL,privateKey:process.env.TTSDOC_PRIVATE_KEY?.replace(/\\n/g,"\n")}),storageBucket:"ttsdocumentcontrol.firebasestorage.app"}),a=s().firestore(),P=s().auth(),i=s().storage().bucket(),n=s().messaging(),N=I("bim-tracking",{credential:r.credential.cert({projectId:process.env.BIM_TRACKING_PROJECT_ID,clientEmail:process.env.BIM_TRACKING_CLIENT_EMAIL,privateKey:process.env.BIM_TRACKING_PRIVATE_KEY?.replace(/\\n/g,"\n")})}).firestore(),R=()=>a,D=()=>P,_=()=>N}};var E=require("../../../../webpack-runtime.js");E.C(e);var t=e=>E(E.s=e),r=E.X(0,[9276,5972],()=>t(17646));module.exports=r})();