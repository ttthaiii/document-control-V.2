"use strict";(()=>{var e={id:1338,ids:[1338]};e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},96282:(e,t,s)=>{s.r(t),s.d(t,{originalPathname:()=>h,patchFetch:()=>k,requestAsyncStorage:()=>l,routeModule:()=>d,serverHooks:()=>m,staticGenerationAsyncStorage:()=>g});var r={};s.r(r),s.d(r,{POST:()=>u,dynamic:()=>p});var o=s(49303),a=s(88716),n=s(60670),c=s(87070),i=s(40416);const p="force-dynamic";async function u(e){try{const t=e.headers.get("authorization");if(!t?.startsWith("Bearer "))return c.NextResponse.json({error:"Authorization required"},{status:401});const s=await i.CZ.verifyIdToken(t.split("Bearer ")[1]),{projectName:r,category:o}=await e.json();if(console.log(`[TASKS_DEBUG] Received projectName: "${r}", category: "${o}"`),!r||!o)return c.NextResponse.json({error:"Project Name and Category are required"},{status:400});const a=i.uE.collection("projects").where("name","==",r).limit(1),n=await a.get();if(n.empty)return console.log(`[TASKS_DEBUG] Project with name "${r}" not found.`),c.NextResponse.json({success:!0,data:{tasks:[]}});const p=n.docs[0].id;console.log(`[TASKS_DEBUG] Found project ID: "${p}"`);const u=i.uE.collection("tasks").where("projectId","==",p).where("taskCategory","==",o),d=await u.get();if(d.empty)return c.NextResponse.json({success:!0,data:{tasks:[]}});const l=d.docs.filter((e=>!e.data().link)).map((e=>{const t=e.data();return{taskUid:e.id,taskCategory:t.taskCategory||"",taskName:t.taskName||"",projectName:t.projectName||"",startDate:t.startDate||"",finishDate:t.finishDate||"",percentComplete:t.percentComplete||0}}));return c.NextResponse.json({success:!0,data:{tasks:l,projectName:r,category:o,totalTasks:l.length,userId:s.uid}})}catch(t){return console.error("\u274c Firestore tasks API error:",t),c.NextResponse.json({success:!1,error:t.message},{status:500})}}const d=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/google-sheets/tasks/route",pathname:"/api/google-sheets/tasks",filename:"route",bundlePath:"app/api/google-sheets/tasks/route"},resolvedPagePath:"D:\\ttsdoc-v2\\src\\app\\api\\google-sheets\\tasks\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:l,staticGenerationAsyncStorage:g,serverHooks:m}=d,h="/api/google-sheets/tasks/route";function k(){return(0,n.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:g})}},40416:(e,t,s)=>{s.d(t,{CZ:()=>c,Hf:()=>i,iW:()=>n,SI:()=>p,uE:()=>u,Dh:()=>l,aj:()=>g,_B:()=>d,Lv:()=>m});const r=require("firebase-admin"),o=(e,t)=>r.apps.find((t=>t?.name===e))||r.initializeApp(t,e),a=()=>{const e={credential:r.credential.cert({projectId:process.env.TTSDOC_PROJECT_ID,clientEmail:process.env.TTSDOC_CLIENT_EMAIL,privateKey:process.env.TTSDOC_PRIVATE_KEY?.replace(/\\n/g,"\n")}),storageBucket:"ttsdocumentcontrol.firebasestorage.app"};return o("ttsdoc-v2",e)},n=a().firestore(),c=a().auth(),i=a().storage().bucket(),p=a().messaging(),u=(()=>{const e={credential:r.credential.cert({projectId:process.env.BIM_TRACKING_PROJECT_ID,clientEmail:process.env.BIM_TRACKING_CLIENT_EMAIL,privateKey:process.env.BIM_TRACKING_PRIVATE_KEY?.replace(/\\n/g,"\n")})};return o("bim-tracking",e)})().firestore(),d=()=>n,l=()=>c,g=()=>i,m=()=>u}};var t=require("../../../../webpack-runtime.js");t.C(e);var s=t.X(0,[9276,5972],(()=>{return e=96282,t(t.s=e);var e}));module.exports=s})();