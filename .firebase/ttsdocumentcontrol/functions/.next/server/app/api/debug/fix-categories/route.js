"use strict";(()=>{var e={};e.id=897,e.ids=[897],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},72929:e=>{e.exports=import("firebase-admin/firestore")},24219:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.r(t),a.d(t,{originalPathname:()=>m,patchFetch:()=>p,requestAsyncStorage:()=>u,routeModule:()=>d,serverHooks:()=>g,staticGenerationAsyncStorage:()=>l});var s=a(49303),i=a(88716),o=a(60670),c=a(62503),n=e([c]);c=(n.then?(await n)():n)[0];let d=new s.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/debug/fix-categories/route",pathname:"/api/debug/fix-categories",filename:"route",bundlePath:"app/api/debug/fix-categories/route"},resolvedPagePath:"D:\\ttsdoc-v2\\src\\app\\api\\debug\\fix-categories\\route.ts",nextConfigOutput:"",userland:c}),{requestAsyncStorage:u,staticGenerationAsyncStorage:l,serverHooks:g}=d,m="/api/debug/fix-categories/route";function p(){return(0,o.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:l})}r()}catch(e){r(e)}})},62503:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.r(t),a.d(t,{GET:()=>n});var s=a(87070),i=a(40416),o=a(72929),c=e([o]);async function n(){try{let e="O4GN2NuHj72uq2Z8WKp4",t=[],a=new Map;for(let r of((await i.iW.collection("rfaDocuments").where("siteId","==",e).get()).forEach(e=>{let t=e.data();if(t.taskData&&t.taskData.taskCategory){let e=t.taskData.taskCategory,r=e?e.trim().replace(/[^\p{L}\p{N}]+/gu,"_").replace(/^_+|_+$/g,"").toUpperCase():"";a.has(r)||a.set(r,e)}}),(await i.iW.collection("sites").doc(e).collection("categories").get()).docs)){let e=r.data(),s={},i=!1,c=a.get(r.id);c&&(e.categoryCode!==c&&(s.categoryCode=c,i=!0),e.categoryName!==c&&(s.categoryName=c,i=!0)),i&&(s.updatedAt=o.FieldValue.serverTimestamp(),await r.ref.update(s),t.push({id:r.id,foundCorrectName:c,updates:s}))}return s.NextResponse.json({success:!0,message:`Corrected ${t.length} categories based on RFA documents.`,fixes:t})}catch(e){return s.NextResponse.json({success:!1,error:e.message},{status:500})}}o=(c.then?(await c)():c)[0],r()}catch(e){r(e)}})},40416:(e,t,a)=>{a.d(t,{CZ:()=>d,Hf:()=>u,iW:()=>p,uE:()=>l});let r=require("firebase-admin");var s=a.n(r);let i={credential:s().credential.cert({projectId:process.env.TTSDOC_PROJECT_ID,clientEmail:process.env.TTSDOC_CLIENT_EMAIL,privateKey:process.env.TTSDOC_PRIVATE_KEY?.replace(/\\n/g,"\n")}),storageBucket:"ttsdocumentcontrol.firebasestorage.app"},o={credential:s().credential.cert({projectId:process.env.BIM_TRACKING_PROJECT_ID,clientEmail:process.env.BIM_TRACKING_CLIENT_EMAIL,privateKey:process.env.BIM_TRACKING_PRIVATE_KEY?.replace(/\\n/g,"\n")})},c=s().apps.find(e=>e?.name==="ttsdoc-v2")||s().initializeApp(i,"ttsdoc-v2"),n=s().apps.find(e=>e?.name==="bim-tracking")||s().initializeApp(o,"bim-tracking"),p=c.firestore(),d=c.auth(),u=c.storage().bucket(),l=n.firestore()}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[948,972],()=>a(24219));module.exports=r})();