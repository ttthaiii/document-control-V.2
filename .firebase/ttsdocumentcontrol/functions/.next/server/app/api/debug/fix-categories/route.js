"use strict";(()=>{var e={id:5897,ids:[5897]};e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},72929:e=>{e.exports=import("firebase-admin/firestore")},24219:(e,t,r)=>{r.a(e,(async(e,a)=>{try{r.r(t),r.d(t,{originalPathname:()=>f,patchFetch:()=>v,requestAsyncStorage:()=>g,routeModule:()=>d,serverHooks:()=>m,staticGenerationAsyncStorage:()=>l});var s=r(49303),o=r(88716),i=r(60670),c=r(62503),n=e([c]);c=(n.then?(await n)():n)[0];const u="",d=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/debug/fix-categories/route",pathname:"/api/debug/fix-categories",filename:"route",bundlePath:"app/api/debug/fix-categories/route"},resolvedPagePath:"D:\\ttsdoc-v2\\src\\app\\api\\debug\\fix-categories\\route.ts",nextConfigOutput:u,userland:c}),{requestAsyncStorage:g,staticGenerationAsyncStorage:l,serverHooks:m}=d,f="/api/debug/fix-categories/route";function v(){return(0,i.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:l})}a()}catch(p){a(p)}}))},62503:(e,t,r)=>{r.a(e,(async(e,a)=>{try{r.r(t),r.d(t,{GET:()=>p});var s=r(87070),o=r(40416),i=r(72929),c=e([i]);async function p(){try{const e="O4GN2NuHj72uq2Z8WKp4",t=[],r=new Map;(await o.iW.collection("rfaDocuments").where("siteId","==",e).get()).forEach((e=>{const t=e.data();if(t.taskData&&t.taskData.taskCategory){const e=t.taskData.taskCategory,s=(a=e)?a.trim().replace(/[^\p{L}\p{N}]+/gu,"_").replace(/^_+|_+$/g,"").toUpperCase():"";r.has(s)||r.set(s,e)}var a}));const a=await o.iW.collection("sites").doc(e).collection("categories").get();for(const s of a.docs){const e=s.data(),a={};let o=!1;const c=r.get(s.id);c&&(e.categoryCode!==c&&(a.categoryCode=c,o=!0),e.categoryName!==c&&(a.categoryName=c,o=!0)),o&&(a.updatedAt=i.FieldValue.serverTimestamp(),await s.ref.update(a),t.push({id:s.id,foundCorrectName:c,updates:a}))}return s.NextResponse.json({success:!0,message:`Corrected ${t.length} categories based on RFA documents.`,fixes:t})}catch(e){return s.NextResponse.json({success:!1,error:e.message},{status:500})}}i=(c.then?(await c)():c)[0],a()}catch(n){a(n)}}))},40416:(e,t,r)=>{r.d(t,{CZ:()=>c,Hf:()=>n,iW:()=>i,SI:()=>p,uE:()=>u,Dh:()=>g,aj:()=>l,_B:()=>d,Lv:()=>m});const a=require("firebase-admin"),s=(e,t)=>a.apps.find((t=>t?.name===e))||a.initializeApp(t,e),o=()=>{const e={credential:a.credential.cert({projectId:process.env.TTSDOC_PROJECT_ID,clientEmail:process.env.TTSDOC_CLIENT_EMAIL,privateKey:process.env.TTSDOC_PRIVATE_KEY?.replace(/\\n/g,"\n")}),storageBucket:"ttsdocumentcontrol.firebasestorage.app"};return s("ttsdoc-v2",e)},i=o().firestore(),c=o().auth(),n=o().storage().bucket(),p=o().messaging(),u=(()=>{const e={credential:a.credential.cert({projectId:process.env.BIM_TRACKING_PROJECT_ID,clientEmail:process.env.BIM_TRACKING_CLIENT_EMAIL,privateKey:process.env.BIM_TRACKING_PRIVATE_KEY?.replace(/\\n/g,"\n")})};return s("bim-tracking",e)})().firestore(),d=()=>i,g=()=>c,l=()=>n,m=()=>u}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=t.X(0,[9276,5972],(()=>{return e=24219,t(t.s=e);var e}));module.exports=r})();