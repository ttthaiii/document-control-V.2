"use strict";(()=>{var e={id:3285,ids:[3285]};e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},72929:e=>{e.exports=import("firebase-admin/firestore")},64413:(e,t,r)=>{r.a(e,(async(e,s)=>{try{r.r(t),r.d(t,{originalPathname:()=>v,patchFetch:()=>f,requestAsyncStorage:()=>l,routeModule:()=>p,serverHooks:()=>m,staticGenerationAsyncStorage:()=>g});var o=r(49303),a=r(88716),i=r(60670),n=r(28252),c=e([n]);n=(c.then?(await c)():c)[0];const d="",p=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/debug/migrate-revisions/route",pathname:"/api/debug/migrate-revisions",filename:"route",bundlePath:"app/api/debug/migrate-revisions/route"},resolvedPagePath:"D:\\ttsdoc-v2\\src\\app\\api\\debug\\migrate-revisions\\route.ts",nextConfigOutput:d,userland:n}),{requestAsyncStorage:l,staticGenerationAsyncStorage:g,serverHooks:m}=p,v="/api/debug/migrate-revisions/route";function f(){return(0,i.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:g})}s()}catch(u){s(u)}}))},28252:(e,t,r)=>{r.a(e,(async(e,s)=>{try{r.r(t),r.d(t,{GET:()=>u});var o=r(87070),a=r(40416),i=r(72929),n=e([i]);async function u(){try{console.log("\ud83d\ude80 Starting RFA documents migration via API (Corrected Logic)...");const e=a.iW.collection("rfaDocuments");let t=0;const r=[],s=await e.get();if(s.empty)return o.NextResponse.json({success:!0,message:"No documents found in the rfaDocuments collection."});console.log(`\ud83d\udd0d Found ${s.size} total documents. Checking for migration status...`);const n=a.iW.batch();let c=0;if(s.forEach((t=>{if(void 0===t.data().revisionNumber){const s=e.doc(t.id);console.log(`  - Staging update for doc: ${t.id}`),n.update(s,{revisionNumber:0,isLatest:!0,updatedAt:i.FieldValue.serverTimestamp()}),r.push({id:t.id,status:"UPDATED"}),c++}else r.push({id:t.id,status:"SKIPPED"})})),0===c)return o.NextResponse.json({success:!0,message:"\u2705 All documents are already up-to-date. No migration needed.",report:r});await n.commit(),t=c;const u=`\ud83c\udf89 Migration successful! Updated ${t} documents.`;return console.log(u),o.NextResponse.json({success:!0,message:u,report:r})}catch(e){return console.error("\u274c Migration API failed:",e),o.NextResponse.json({success:!1,error:"Migration failed.",details:e.message},{status:500})}}i=(n.then?(await n)():n)[0],s()}catch(c){s(c)}}))},40416:(e,t,r)=>{r.d(t,{CZ:()=>n,Hf:()=>c,iW:()=>i,SI:()=>u,uE:()=>d,Dh:()=>l,aj:()=>g,_B:()=>p,Lv:()=>m});const s=require("firebase-admin"),o=(e,t)=>s.apps.find((t=>t?.name===e))||s.initializeApp(t,e),a=()=>{const e={credential:s.credential.cert({projectId:process.env.TTSDOC_PROJECT_ID,clientEmail:process.env.TTSDOC_CLIENT_EMAIL,privateKey:process.env.TTSDOC_PRIVATE_KEY?.replace(/\\n/g,"\n")}),storageBucket:"ttsdocumentcontrol.firebasestorage.app"};return o("ttsdoc-v2",e)},i=a().firestore(),n=a().auth(),c=a().storage().bucket(),u=a().messaging(),d=(()=>{const e={credential:s.credential.cert({projectId:process.env.BIM_TRACKING_PROJECT_ID,clientEmail:process.env.BIM_TRACKING_CLIENT_EMAIL,privateKey:process.env.BIM_TRACKING_PRIVATE_KEY?.replace(/\\n/g,"\n")})};return o("bim-tracking",e)})().firestore(),p=()=>i,l=()=>n,g=()=>c,m=()=>d}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=t.X(0,[9276,5972],(()=>{return e=64413,t(t.s=e);var e}));module.exports=r})();