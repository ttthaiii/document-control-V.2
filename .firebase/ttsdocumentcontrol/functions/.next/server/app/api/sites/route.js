"use strict";(()=>{var e={};e.id=9865,e.ids=[9865],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},24711:(e,t,s)=>{s.r(t),s.d(t,{originalPathname:()=>l,patchFetch:()=>u,requestAsyncStorage:()=>_,routeModule:()=>c,serverHooks:()=>p,staticGenerationAsyncStorage:()=>N});var r={};s.r(r),s.d(r,{GET:()=>R,dynamic:()=>P});var i=s(49303),E=s(88716),o=s(60670),n=s(87070),a=s(40416),I=s(4458);let P="force-dynamic";async function R(e){try{let t;let s=e.headers.get("authorization");if(!s?.startsWith("Bearer "))return n.NextResponse.json({error:"Authorization required"},{status:401});let r=s.split("Bearer ")[1],i=await a.CZ.verifyIdToken(r),E=(await a.iW.collection("users").doc(i.uid).get()).data();if(!E)return n.NextResponse.json({error:"User profile not found"},{status:404});if(E.role===I.K$.ADMIN)t=(await a.iW.collection("sites").get()).docs;else{let e=E.sites||[];if(0===e.length)return n.NextResponse.json({success:!0,sites:[]});let s=e.map(e=>a.iW.collection("sites").doc(e).get());t=await Promise.all(s)}let o=t.filter(e=>e.exists).map(e=>{let t=e.data();return{id:e.id,name:t.name,sheetId:t.settings?.googleSheetsConfig?.spreadsheetId||null,sheetName:t.settings?.googleSheetsConfig?.sheetName||null}});return n.NextResponse.json({success:!0,sites:o})}catch(e){return console.error("âŒ Sites API error:",e),n.NextResponse.json({success:!1,error:e.message},{status:500})}}let c=new i.AppRouteRouteModule({definition:{kind:E.x.APP_ROUTE,page:"/api/sites/route",pathname:"/api/sites",filename:"route",bundlePath:"app/api/sites/route"},resolvedPagePath:"D:\\ttsdoc-v2\\src\\app\\api\\sites\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:_,staticGenerationAsyncStorage:N,serverHooks:p}=c,l="/api/sites/route";function u(){return(0,o.patchFetch)({serverHooks:p,staticGenerationAsyncStorage:N})}},4458:(e,t,s)=>{s.d(t,{K$:()=>r,gf:()=>o,n$:()=>n,oU:()=>E,uc:()=>i});let r={ADMIN:"Admin",BIM:"BIM",SITE_ADMIN:"Site Admin",CM:"CM",ME:"ME",SN:"SN",OE:"OE",PE:"PE",PM:"PM",SE:"SE",ADMIN_SITE_2:"Adminsite2"},i=[r.BIM,r.ME,r.SN],E=[r.SITE_ADMIN,r.ADMIN_SITE_2,r.OE,r.PE],o=[r.CM];r.PM,r.SE;let n={PENDING_REVIEW:"PENDING_REVIEW",PENDING_CM_APPROVAL:"PENDING_CM_APPROVAL",REVISION_REQUIRED:"REVISION_REQUIRED",APPROVED:"APPROVED",APPROVED_WITH_COMMENTS:"APPROVED_WITH_COMMENTS",APPROVED_REVISION_REQUIRED:"APPROVED_REVISION_REQUIRED",REJECTED:"REJECTED",PENDING_FINAL_APPROVAL:"PENDING_FINAL_APPROVAL"};n.PENDING_REVIEW,n.PENDING_CM_APPROVAL,n.REVISION_REQUIRED,n.APPROVED,n.APPROVED_WITH_COMMENTS,n.APPROVED_REVISION_REQUIRED,n.REJECTED,n.PENDING_FINAL_APPROVAL,n.PENDING_REVIEW,n.PENDING_CM_APPROVAL,n.REVISION_REQUIRED,n.APPROVED,n.REJECTED,n.APPROVED_WITH_COMMENTS,n.APPROVED_REVISION_REQUIRED},40416:(e,t,s)=>{s.d(t,{CZ:()=>n,Hf:()=>a,iW:()=>o,uE:()=>I,Lv:()=>P});let r=require("firebase-admin"),i=(e,t)=>r.apps.find(t=>t?.name===e)||r.initializeApp(t,e),E=()=>i("ttsdoc-v2",{credential:r.credential.cert({projectId:process.env.TTSDOC_PROJECT_ID,clientEmail:process.env.TTSDOC_CLIENT_EMAIL,privateKey:process.env.TTSDOC_PRIVATE_KEY?.replace(/\\n/g,"\n")}),storageBucket:"ttsdocumentcontrol.firebasestorage.app"}),o=E().firestore(),n=E().auth(),a=E().storage().bucket(),I=i("bim-tracking",{credential:r.credential.cert({projectId:process.env.BIM_TRACKING_PROJECT_ID,clientEmail:process.env.BIM_TRACKING_CLIENT_EMAIL,privateKey:process.env.BIM_TRACKING_PRIVATE_KEY?.replace(/\\n/g,"\n")})}).firestore(),P=()=>I}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[8948,5972],()=>s(24711));module.exports=r})();