"use strict";(()=>{var e={};e.id=9865,e.ids=[9865],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},24711:(e,E,t)=>{t.r(E),t.d(E,{originalPathname:()=>c,patchFetch:()=>M,requestAsyncStorage:()=>_,routeModule:()=>R,serverHooks:()=>A,staticGenerationAsyncStorage:()=>D});var s={};t.r(s),t.d(s,{GET:()=>a,dynamic:()=>N});var r=t(49303),I=t(88716),i=t(60670),P=t(87070),n=t(40416),o=t(4458);let N="force-dynamic";async function a(e){try{let E;let t=e.headers.get("authorization");if(!t?.startsWith("Bearer "))return P.NextResponse.json({error:"Authorization required"},{status:401});let s=t.split("Bearer ")[1],r=await n.CZ.verifyIdToken(s),I=(await n.iW.collection("users").doc(r.uid).get()).data();if(!I)return P.NextResponse.json({error:"User profile not found"},{status:404});if(I.role===o.K$.ADMIN)E=(await n.iW.collection("sites").get()).docs;else{let e=I.sites||[];if(0===e.length)return P.NextResponse.json({success:!0,sites:[]});let t=e.map(e=>n.iW.collection("sites").doc(e).get());E=await Promise.all(t)}let i=E.filter(e=>e.exists).map(e=>{let E=e.data();return{id:e.id,name:E.name,sheetId:E.settings?.googleSheetsConfig?.spreadsheetId||null,sheetName:E.settings?.googleSheetsConfig?.sheetName||null}});return P.NextResponse.json({success:!0,sites:i})}catch(e){return console.error("âŒ Sites API error:",e),P.NextResponse.json({success:!1,error:e.message},{status:500})}}let R=new r.AppRouteRouteModule({definition:{kind:I.x.APP_ROUTE,page:"/api/sites/route",pathname:"/api/sites",filename:"route",bundlePath:"app/api/sites/route"},resolvedPagePath:"D:\\ttsdoc-v2\\src\\app\\api\\sites\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:_,staticGenerationAsyncStorage:D,serverHooks:A}=R,c="/api/sites/route";function M(){return(0,i.patchFetch)({serverHooks:A,staticGenerationAsyncStorage:D})}},4458:(e,E,t)=>{t.d(E,{$p:()=>n,Ge:()=>N,K$:()=>s,c9:()=>P,gf:()=>i,n$:()=>o,oU:()=>I,uc:()=>r});let s={ADMIN:"Admin",BIM:"BIM",SITE_ADMIN:"Site Admin",CM:"CM",ME:"ME",SN:"SN",OE:"OE",PE:"PE",PM:"PM",PD:"PD",SE:"SE",FM:"FM",ADMIN_SITE_2:"Adminsite2"},r=[s.BIM,s.ME,s.SN,s.ADMIN],I=[s.SITE_ADMIN,s.ADMIN_SITE_2,s.OE,s.PE,s.ADMIN],i=[s.CM,s.PD,s.ADMIN];s.PM,s.ADMIN,s.SE,s.FM;let P=[s.PE,s.OE,s.ADMIN],n=[s.PD,s.PM,s.ADMIN],o={PENDING_REVIEW:"PENDING_REVIEW",PENDING_CM_APPROVAL:"PENDING_CM_APPROVAL",REVISION_REQUIRED:"REVISION_REQUIRED",APPROVED:"APPROVED",APPROVED_WITH_COMMENTS:"APPROVED_WITH_COMMENTS",APPROVED_REVISION_REQUIRED:"APPROVED_REVISION_REQUIRED",REJECTED:"REJECTED",PENDING_FINAL_APPROVAL:"PENDING_FINAL_APPROVAL"},N={DRAFT:"DRAFT",REJECTED_BY_PM:"REJECTED_BY_PM",PENDING_BIM:"PENDING_BIM",IN_PROGRESS:"IN_PROGRESS",PENDING_ACCEPTANCE:"PENDING_ACCEPTANCE",REVISION_REQUESTED:"REVISION_REQUESTED",COMPLETED:"COMPLETED"};o.PENDING_REVIEW,o.PENDING_CM_APPROVAL,o.REVISION_REQUIRED,o.APPROVED,o.APPROVED_WITH_COMMENTS,o.APPROVED_REVISION_REQUIRED,o.REJECTED,o.PENDING_FINAL_APPROVAL,N.DRAFT,N.REJECTED_BY_PM,N.PENDING_BIM,N.IN_PROGRESS,N.PENDING_ACCEPTANCE,N.REVISION_REQUESTED,N.COMPLETED,o.PENDING_REVIEW,o.PENDING_CM_APPROVAL,o.REVISION_REQUIRED,o.APPROVED,o.REJECTED,o.APPROVED_WITH_COMMENTS,o.APPROVED_REVISION_REQUIRED,N.DRAFT,N.REJECTED_BY_PM,N.PENDING_BIM,N.IN_PROGRESS,N.PENDING_ACCEPTANCE,N.REVISION_REQUESTED,N.COMPLETED},40416:(e,E,t)=>{t.d(E,{CZ:()=>P,Hf:()=>n,iW:()=>i,SI:()=>o,uE:()=>N,Dh:()=>R,_B:()=>a,Lv:()=>_});let s=require("firebase-admin"),r=(e,E)=>s.apps.find(E=>E?.name===e)||s.initializeApp(E,e),I=()=>r("ttsdoc-v2",{credential:s.credential.cert({projectId:process.env.TTSDOC_PROJECT_ID,clientEmail:process.env.TTSDOC_CLIENT_EMAIL,privateKey:process.env.TTSDOC_PRIVATE_KEY?.replace(/\\n/g,"\n")}),storageBucket:"ttsdocumentcontrol.firebasestorage.app"}),i=I().firestore(),P=I().auth(),n=I().storage().bucket(),o=I().messaging(),N=r("bim-tracking",{credential:s.credential.cert({projectId:process.env.BIM_TRACKING_PROJECT_ID,clientEmail:process.env.BIM_TRACKING_CLIENT_EMAIL,privateKey:process.env.BIM_TRACKING_PRIVATE_KEY?.replace(/\\n/g,"\n")})}).firestore(),a=()=>i,R=()=>P,_=()=>N}};var E=require("../../../webpack-runtime.js");E.C(e);var t=e=>E(E.s=e),s=E.X(0,[9276,5972],()=>t(24711));module.exports=s})();