"use strict";(()=>{var e={};e.id=9865,e.ids=[9865],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},24711:(e,E,t)=>{t.r(E),t.d(E,{originalPathname:()=>M,patchFetch:()=>c,requestAsyncStorage:()=>_,routeModule:()=>R,serverHooks:()=>A,staticGenerationAsyncStorage:()=>D});var s={};t.r(s),t.d(s,{GET:()=>a,dynamic:()=>n});var r=t(49303),I=t(88716),i=t(60670),P=t(87070),N=t(40416),o=t(4458);let n="force-dynamic";async function a(e){try{let E;let t=e.headers.get("authorization");if(!t?.startsWith("Bearer "))return P.NextResponse.json({error:"Authorization required"},{status:401});let s=t.split("Bearer ")[1],r=await N.CZ.verifyIdToken(s),I=(await N.iW.collection("users").doc(r.uid).get()).data();if(!I)return P.NextResponse.json({error:"User profile not found"},{status:404});if(I.role===o.K$.ADMIN)E=(await N.iW.collection("sites").get()).docs;else{let e=I.sites||[];if(0===e.length)return P.NextResponse.json({success:!0,sites:[]});let t=e.map(e=>N.iW.collection("sites").doc(e).get());E=await Promise.all(t)}let i=E.filter(e=>e.exists).map(e=>{let E=e.data();return{id:e.id,name:E.name,sheetId:E.settings?.googleSheetsConfig?.spreadsheetId||null,sheetName:E.settings?.googleSheetsConfig?.sheetName||null}});return P.NextResponse.json({success:!0,sites:i})}catch(e){return console.error("❌ Sites API error:",e),P.NextResponse.json({success:!1,error:e.message},{status:500})}}let R=new r.AppRouteRouteModule({definition:{kind:I.x.APP_ROUTE,page:"/api/sites/route",pathname:"/api/sites",filename:"route",bundlePath:"app/api/sites/route"},resolvedPagePath:"D:\\ttsdoc-v2\\src\\app\\api\\sites\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:_,staticGenerationAsyncStorage:D,serverHooks:A}=R,M="/api/sites/route";function c(){return(0,i.patchFetch)({serverHooks:A,staticGenerationAsyncStorage:D})}},4458:(e,E,t)=>{t.d(E,{$p:()=>N,Ge:()=>n,K$:()=>s,NK:()=>a,c9:()=>P,gf:()=>i,n$:()=>o,oU:()=>I,uc:()=>r});let s={ADMIN:"Admin",BIM:"BIM",SITE_ADMIN:"Site Admin",CM:"CM",ME:"ME",SN:"SN",OE:"OE",PE:"PE",PM:"PM",PD:"PD",SE:"SE",FM:"FM",ADMIN_SITE_2:"Adminsite2"},r=[s.BIM,s.ME,s.SN,s.SITE_ADMIN,s.ADMIN,s.PM,s.PE,s.OE],I=[s.SITE_ADMIN,s.ADMIN_SITE_2,s.OE,s.PE,s.ADMIN],i=[s.CM,s.ADMIN,s.SITE_ADMIN,s.PM,s.PE,s.OE];s.PM,s.ADMIN,s.SE,s.FM;let P=[s.PE,s.OE,s.ADMIN],N=[s.PM,s.ADMIN];s.PD,s.SE,s.FM;let o={PENDING_REVIEW:"PENDING_REVIEW",PENDING_CM_APPROVAL:"PENDING_CM_APPROVAL",REVISION_REQUIRED:"REVISION_REQUIRED",APPROVED:"APPROVED",APPROVED_WITH_COMMENTS:"APPROVED_WITH_COMMENTS",APPROVED_REVISION_REQUIRED:"APPROVED_REVISION_REQUIRED",REJECTED:"REJECTED",PENDING_FINAL_APPROVAL:"PENDING_FINAL_APPROVAL"},n={DRAFT:"DRAFT",REJECTED_BY_PM:"REJECTED_BY_PM",PENDING_BIM:"PENDING_BIM",IN_PROGRESS:"IN_PROGRESS",PENDING_ACCEPTANCE:"PENDING_ACCEPTANCE",REVISION_REQUESTED:"REVISION_REQUESTED",COMPLETED:"COMPLETED"},a={[o.PENDING_REVIEW]:"รอตรวจสอบ",[o.PENDING_CM_APPROVAL]:"รออนุมัติ (CM/Approver)",[o.REVISION_REQUIRED]:"แก้ไข",[o.APPROVED]:"อนุมัติ",[o.APPROVED_WITH_COMMENTS]:"อนุมัติตามคอมเมนต์ (ไม่แก้ไข)",[o.APPROVED_REVISION_REQUIRED]:"อนุมัติตามคอมเมนต์ (ต้องแก้ไข)",[o.REJECTED]:"ไม่อนุมัติ",[o.PENDING_FINAL_APPROVAL]:"รอ SITE อนุมัติขั้นสุดท้าย",[n.DRAFT]:"รออนุมัติ (PM)",[n.REJECTED_BY_PM]:"ไม่อนุมัติ (PM)",[n.PENDING_BIM]:"รอ BIM รับงาน",[n.IN_PROGRESS]:"BIM กำลังดำเนินการ",[n.PENDING_ACCEPTANCE]:"รอตรวจรับ (Site)",[n.REVISION_REQUESTED]:"ขอแก้ไข (WR)",[n.COMPLETED]:"เสร็จสิ้น"};o.PENDING_REVIEW,o.PENDING_CM_APPROVAL,o.REVISION_REQUIRED,o.APPROVED,o.REJECTED,o.APPROVED_WITH_COMMENTS,o.APPROVED_REVISION_REQUIRED,n.DRAFT,n.REJECTED_BY_PM,n.PENDING_BIM,n.IN_PROGRESS,n.PENDING_ACCEPTANCE,n.REVISION_REQUESTED,n.COMPLETED},40416:(e,E,t)=>{t.d(E,{CZ:()=>P,Hf:()=>N,iW:()=>i,SI:()=>o,uE:()=>n,Dh:()=>R,_B:()=>a,Lv:()=>_});let s=require("firebase-admin"),r=(e,E)=>s.apps.find(E=>E?.name===e)||s.initializeApp(E,e),I=()=>r("ttsdoc-v2",{credential:s.credential.cert({projectId:process.env.TTSDOC_PROJECT_ID,clientEmail:process.env.TTSDOC_CLIENT_EMAIL,privateKey:process.env.TTSDOC_PRIVATE_KEY?.replace(/\\n/g,"\n")}),storageBucket:"ttsdocumentcontrol.firebasestorage.app"}),i=I().firestore(),P=I().auth(),N=I().storage().bucket(),o=I().messaging(),n=r("bim-tracking",{credential:s.credential.cert({projectId:process.env.BIM_TRACKING_PROJECT_ID,clientEmail:process.env.BIM_TRACKING_CLIENT_EMAIL,privateKey:process.env.BIM_TRACKING_PRIVATE_KEY?.replace(/\\n/g,"\n")})}).firestore(),a=()=>i,R=()=>P,_=()=>n}};var E=require("../../../webpack-runtime.js");E.C(e);var t=e=>E(E.s=e),s=E.X(0,[9276,5972],()=>t(24711));module.exports=s})();