"use strict";(()=>{var e={id:9865,ids:[9865]};e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},24711:(e,t,E)=>{E.r(t),E.d(t,{originalPathname:()=>A,patchFetch:()=>M,requestAsyncStorage:()=>_,routeModule:()=>R,serverHooks:()=>c,staticGenerationAsyncStorage:()=>D});var s={};E.r(s),E.d(s,{GET:()=>N,dynamic:()=>a});var r=E(49303),I=E(88716),n=E(60670),o=E(87070),i=E(40416),P=E(4458);const a="force-dynamic";async function N(e){try{const t=e.headers.get("authorization");if(!t?.startsWith("Bearer "))return o.NextResponse.json({error:"Authorization required"},{status:401});const E=t.split("Bearer ")[1],s=await i.CZ.verifyIdToken(E),r=(await i.iW.collection("users").doc(s.uid).get()).data();if(!r)return o.NextResponse.json({error:"User profile not found"},{status:404});let I;if(r.role===P.K$.ADMIN){I=(await i.iW.collection("sites").get()).docs}else{const e=r.sites||[];if(0===e.length)return o.NextResponse.json({success:!0,sites:[]});const t=e.map((e=>i.iW.collection("sites").doc(e).get()));I=await Promise.all(t)}const n=I.filter((e=>e.exists)).map((e=>{const t=e.data();return{id:e.id,name:t.name,sheetId:t.settings?.googleSheetsConfig?.spreadsheetId||null,sheetName:t.settings?.googleSheetsConfig?.sheetName||null}}));return o.NextResponse.json({success:!0,sites:n})}catch(t){return console.error("\u274c Sites API error:",t),o.NextResponse.json({success:!1,error:t.message},{status:500})}}const R=new r.AppRouteRouteModule({definition:{kind:I.x.APP_ROUTE,page:"/api/sites/route",pathname:"/api/sites",filename:"route",bundlePath:"app/api/sites/route"},resolvedPagePath:"D:\\ttsdoc-v2\\src\\app\\api\\sites\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:_,staticGenerationAsyncStorage:D,serverHooks:c}=R,A="/api/sites/route";function M(){return(0,n.patchFetch)({serverHooks:c,staticGenerationAsyncStorage:D})}},4458:(e,t,E)=>{E.d(t,{$p:()=>i,Ge:()=>a,K$:()=>s,NK:()=>N,c9:()=>o,gf:()=>n,n$:()=>P,oU:()=>I,uc:()=>r});const s={ADMIN:"Admin",BIM:"BIM",SITE_ADMIN:"Site Admin",CM:"CM",ME:"ME",SN:"SN",OE:"OE",PE:"PE",PM:"PM",PD:"PD",SE:"SE",FM:"FM",ADMIN_SITE_2:"Adminsite2"},r=[s.BIM,s.ME,s.SN,s.SITE_ADMIN,s.ADMIN,s.PM,s.PE,s.OE],I=[s.SITE_ADMIN,s.ADMIN_SITE_2,s.OE,s.PE,s.ADMIN],n=[s.CM,s.ADMIN,s.SITE_ADMIN,s.PM,s.PE,s.OE],o=(s.PM,s.ADMIN,s.SE,s.FM,[s.PE,s.OE,s.ADMIN]),i=[s.PM,s.ADMIN],P=(s.PD,s.SE,s.FM,{PENDING_REVIEW:"PENDING_REVIEW",PENDING_CM_APPROVAL:"PENDING_CM_APPROVAL",REVISION_REQUIRED:"REVISION_REQUIRED",APPROVED:"APPROVED",APPROVED_WITH_COMMENTS:"APPROVED_WITH_COMMENTS",APPROVED_REVISION_REQUIRED:"APPROVED_REVISION_REQUIRED",REJECTED:"REJECTED",PENDING_FINAL_APPROVAL:"PENDING_FINAL_APPROVAL"}),a={DRAFT:"DRAFT",REJECTED_BY_PM:"REJECTED_BY_PM",PENDING_BIM:"PENDING_BIM",IN_PROGRESS:"IN_PROGRESS",PENDING_ACCEPTANCE:"PENDING_ACCEPTANCE",REVISION_REQUESTED:"REVISION_REQUESTED",COMPLETED:"COMPLETED"},N={[P.PENDING_REVIEW]:"\u0e23\u0e2d\u0e15\u0e23\u0e27\u0e08\u0e2a\u0e2d\u0e1a",[P.PENDING_CM_APPROVAL]:"\u0e23\u0e2d\u0e2d\u0e19\u0e38\u0e21\u0e31\u0e15\u0e34 (CM/Approver)",[P.REVISION_REQUIRED]:"\u0e41\u0e01\u0e49\u0e44\u0e02",[P.APPROVED]:"\u0e2d\u0e19\u0e38\u0e21\u0e31\u0e15\u0e34",[P.APPROVED_WITH_COMMENTS]:"\u0e2d\u0e19\u0e38\u0e21\u0e31\u0e15\u0e34\u0e15\u0e32\u0e21\u0e04\u0e2d\u0e21\u0e40\u0e21\u0e19\u0e15\u0e4c (\u0e44\u0e21\u0e48\u0e41\u0e01\u0e49\u0e44\u0e02)",[P.APPROVED_REVISION_REQUIRED]:"\u0e2d\u0e19\u0e38\u0e21\u0e31\u0e15\u0e34\u0e15\u0e32\u0e21\u0e04\u0e2d\u0e21\u0e40\u0e21\u0e19\u0e15\u0e4c (\u0e15\u0e49\u0e2d\u0e07\u0e41\u0e01\u0e49\u0e44\u0e02)",[P.REJECTED]:"\u0e44\u0e21\u0e48\u0e2d\u0e19\u0e38\u0e21\u0e31\u0e15\u0e34",[P.PENDING_FINAL_APPROVAL]:"\u0e23\u0e2d SITE \u0e2d\u0e19\u0e38\u0e21\u0e31\u0e15\u0e34\u0e02\u0e31\u0e49\u0e19\u0e2a\u0e38\u0e14\u0e17\u0e49\u0e32\u0e22",[a.DRAFT]:"\u0e23\u0e2d\u0e2d\u0e19\u0e38\u0e21\u0e31\u0e15\u0e34 (PM)",[a.REJECTED_BY_PM]:"\u0e44\u0e21\u0e48\u0e2d\u0e19\u0e38\u0e21\u0e31\u0e15\u0e34 (PM)",[a.PENDING_BIM]:"\u0e23\u0e2d BIM \u0e23\u0e31\u0e1a\u0e07\u0e32\u0e19",[a.IN_PROGRESS]:"BIM \u0e01\u0e33\u0e25\u0e31\u0e07\u0e14\u0e33\u0e40\u0e19\u0e34\u0e19\u0e01\u0e32\u0e23",[a.PENDING_ACCEPTANCE]:"\u0e23\u0e2d\u0e15\u0e23\u0e27\u0e08\u0e23\u0e31\u0e1a (Site)",[a.REVISION_REQUESTED]:"\u0e02\u0e2d\u0e41\u0e01\u0e49\u0e44\u0e02 (WR)",[a.COMPLETED]:"\u0e40\u0e2a\u0e23\u0e47\u0e08\u0e2a\u0e34\u0e49\u0e19"};P.PENDING_REVIEW,P.PENDING_CM_APPROVAL,P.REVISION_REQUIRED,P.APPROVED,P.REJECTED,P.APPROVED_WITH_COMMENTS,P.APPROVED_REVISION_REQUIRED,P.PENDING_FINAL_APPROVAL,a.DRAFT,a.REJECTED_BY_PM,a.PENDING_BIM,a.IN_PROGRESS,a.PENDING_ACCEPTANCE,a.REVISION_REQUESTED,a.COMPLETED},40416:(e,t,E)=>{E.d(t,{CZ:()=>o,Hf:()=>i,iW:()=>n,SI:()=>P,uE:()=>a,Dh:()=>R,aj:()=>_,_B:()=>N,Lv:()=>D});const s=require("firebase-admin"),r=(e,t)=>s.apps.find((t=>t?.name===e))||s.initializeApp(t,e),I=()=>{const e={credential:s.credential.cert({projectId:process.env.TTSDOC_PROJECT_ID,clientEmail:process.env.TTSDOC_CLIENT_EMAIL,privateKey:process.env.TTSDOC_PRIVATE_KEY?.replace(/\\n/g,"\n")}),storageBucket:"ttsdocumentcontrol.firebasestorage.app"};return r("ttsdoc-v2",e)},n=I().firestore(),o=I().auth(),i=I().storage().bucket(),P=I().messaging(),a=(()=>{const e={credential:s.credential.cert({projectId:process.env.BIM_TRACKING_PROJECT_ID,clientEmail:process.env.BIM_TRACKING_CLIENT_EMAIL,privateKey:process.env.BIM_TRACKING_PRIVATE_KEY?.replace(/\\n/g,"\n")})};return r("bim-tracking",e)})().firestore(),N=()=>n,R=()=>o,_=()=>i,D=()=>a}};var t=require("../../../webpack-runtime.js");t.C(e);var E=t.X(0,[9276,5972],(()=>{return e=24711,t(t.s=e);var e}));module.exports=E})();