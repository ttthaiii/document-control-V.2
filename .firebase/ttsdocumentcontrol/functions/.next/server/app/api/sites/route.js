"use strict";(()=>{var e={};e.id=9865,e.ids=[9865],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},24711:(e,E,t)=>{t.r(E),t.d(E,{originalPathname:()=>c,patchFetch:()=>p,requestAsyncStorage:()=>_,routeModule:()=>N,serverHooks:()=>A,staticGenerationAsyncStorage:()=>D});var s={};t.r(s),t.d(s,{GET:()=>R,dynamic:()=>a});var r=t(49303),i=t(88716),I=t(60670),P=t(87070),o=t(40416),n=t(4458);let a="force-dynamic";async function R(e){try{let E;let t=e.headers.get("authorization");if(!t?.startsWith("Bearer "))return P.NextResponse.json({error:"Authorization required"},{status:401});let s=t.split("Bearer ")[1],r=await o.CZ.verifyIdToken(s),i=(await o.iW.collection("users").doc(r.uid).get()).data();if(!i)return P.NextResponse.json({error:"User profile not found"},{status:404});if(i.role===n.K$.ADMIN)E=(await o.iW.collection("sites").get()).docs;else{let e=i.sites||[];if(0===e.length)return P.NextResponse.json({success:!0,sites:[]});let t=e.map(e=>o.iW.collection("sites").doc(e).get());E=await Promise.all(t)}let I=E.filter(e=>e.exists).map(e=>{let E=e.data();return{id:e.id,name:E.name,sheetId:E.settings?.googleSheetsConfig?.spreadsheetId||null,sheetName:E.settings?.googleSheetsConfig?.sheetName||null}});return P.NextResponse.json({success:!0,sites:I})}catch(e){return console.error("âŒ Sites API error:",e),P.NextResponse.json({success:!1,error:e.message},{status:500})}}let N=new r.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/sites/route",pathname:"/api/sites",filename:"route",bundlePath:"app/api/sites/route"},resolvedPagePath:"D:\\ttsdoc-v2\\src\\app\\api\\sites\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:_,staticGenerationAsyncStorage:D,serverHooks:A}=N,c="/api/sites/route";function p(){return(0,I.patchFetch)({serverHooks:A,staticGenerationAsyncStorage:D})}},4458:(e,E,t)=>{t.d(E,{$p:()=>o,Ge:()=>a,K$:()=>s,c9:()=>P,gf:()=>I,n$:()=>n,oU:()=>i,uc:()=>r});let s={ADMIN:"Admin",BIM:"BIM",SITE_ADMIN:"Site Admin",CM:"CM",ME:"ME",SN:"SN",OE:"OE",PE:"PE",PM:"PM",PD:"PD",SE:"SE",ADMIN_SITE_2:"Adminsite2"},r=[s.BIM,s.ME,s.SN],i=[s.SITE_ADMIN,s.ADMIN_SITE_2,s.OE,s.PE],I=[s.CM,s.PD];s.PM,s.SE;let P=[s.PE,s.OE,s.ADMIN],o=[s.PD,s.PM,s.ADMIN],n={PENDING_REVIEW:"PENDING_REVIEW",PENDING_CM_APPROVAL:"PENDING_CM_APPROVAL",REVISION_REQUIRED:"REVISION_REQUIRED",APPROVED:"APPROVED",APPROVED_WITH_COMMENTS:"APPROVED_WITH_COMMENTS",APPROVED_REVISION_REQUIRED:"APPROVED_REVISION_REQUIRED",REJECTED:"REJECTED",PENDING_FINAL_APPROVAL:"PENDING_FINAL_APPROVAL"},a={DRAFT:"DRAFT",REJECTED_BY_PM:"REJECTED_BY_PM",PENDING_BIM:"PENDING_BIM",IN_PROGRESS:"IN_PROGRESS",PENDING_ACCEPTANCE:"PENDING_ACCEPTANCE",REVISION_REQUESTED:"REVISION_REQUESTED",COMPLETED:"COMPLETED"};n.PENDING_REVIEW,n.PENDING_CM_APPROVAL,n.REVISION_REQUIRED,n.APPROVED,n.APPROVED_WITH_COMMENTS,n.APPROVED_REVISION_REQUIRED,n.REJECTED,n.PENDING_FINAL_APPROVAL,a.DRAFT,a.REJECTED_BY_PM,a.PENDING_BIM,a.IN_PROGRESS,a.PENDING_ACCEPTANCE,a.REVISION_REQUESTED,a.COMPLETED,n.PENDING_REVIEW,n.PENDING_CM_APPROVAL,n.REVISION_REQUIRED,n.APPROVED,n.REJECTED,n.APPROVED_WITH_COMMENTS,n.APPROVED_REVISION_REQUIRED,a.DRAFT,a.REJECTED_BY_PM,a.PENDING_BIM,a.IN_PROGRESS,a.PENDING_ACCEPTANCE,a.REVISION_REQUESTED,a.COMPLETED},40416:(e,E,t)=>{t.d(E,{CZ:()=>P,Hf:()=>o,iW:()=>I,uE:()=>n,Dh:()=>R,_B:()=>a,Lv:()=>N});let s=require("firebase-admin"),r=(e,E)=>s.apps.find(E=>E?.name===e)||s.initializeApp(E,e),i=()=>r("ttsdoc-v2",{credential:s.credential.cert({projectId:process.env.TTSDOC_PROJECT_ID,clientEmail:process.env.TTSDOC_CLIENT_EMAIL,privateKey:process.env.TTSDOC_PRIVATE_KEY?.replace(/\\n/g,"\n")}),storageBucket:"ttsdocumentcontrol.firebasestorage.app"}),I=i().firestore(),P=i().auth(),o=i().storage().bucket(),n=r("bim-tracking",{credential:s.credential.cert({projectId:process.env.BIM_TRACKING_PROJECT_ID,clientEmail:process.env.BIM_TRACKING_CLIENT_EMAIL,privateKey:process.env.BIM_TRACKING_PRIVATE_KEY?.replace(/\\n/g,"\n")})}).firestore(),a=()=>I,R=()=>P,N=()=>n}};var E=require("../../../webpack-runtime.js");E.C(e);var t=e=>E(E.s=e),s=E.X(0,[8948,5972],()=>t(24711));module.exports=s})();