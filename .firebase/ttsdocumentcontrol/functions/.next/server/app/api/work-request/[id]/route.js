"use strict";(()=>{var e={id:932,ids:[932]};e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},86178:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>A,patchFetch:()=>u,requestAsyncStorage:()=>R,routeModule:()=>N,serverHooks:()=>D,staticGenerationAsyncStorage:()=>_});var E={};r.r(E),r.d(E,{GET:()=>c,dynamic:()=>P});var s=r(49303),o=r(88716),n=r(60670),i=r(87070),I=r(40416),a=r(4458);const P="force-dynamic";async function c(e,{params:t}){try{const r=e.headers.get("authorization");if(!r?.startsWith("Bearer "))return i.NextResponse.json({success:!1,error:"Unauthorized"},{status:401});const E=r.split("Bearer ")[1],s=(await I.CZ.verifyIdToken(E)).uid,o=await I.iW.collection("users").doc(s).get();if(!o.exists)return i.NextResponse.json({success:!1,error:"User not found"},{status:404});const n=o.data(),P=n.sites||[],c=t.id,N=I.iW.collection("workRequests").doc(c),R=await N.get();if(!R.exists)return i.NextResponse.json({success:!1,error:"Document not found"},{status:404});const _=R.data();if(n.role!==a.K$.ADMIN&&!P.includes(_.siteId))return i.NextResponse.json({success:!1,error:"Access to this document is denied"},{status:403});const D=await I.iW.collection("sites").doc(_.siteId).get(),A=D.exists?{id:D.id,...D.data()}:{id:_.siteId,name:"Unknown Site"},u=Array.from(new Set(_.workflow.map((e=>e.userId)))).map((e=>I.iW.collection("users").doc(e).get())),d=await Promise.all(u),M={};return d.forEach((e=>{if(e.exists){const t=e.data();M[e.id]={email:t.email,role:t.role}}})),i.NextResponse.json({success:!0,document:{id:R.id,..._,site:A,usersInfo:M}})}catch(r){console.error(`Error fetching work request ${t.id}:`,r);const e=r instanceof Error?r.message:"Internal Server Error";return i.NextResponse.json({success:!1,error:e},{status:500})}}const N=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/work-request/[id]/route",pathname:"/api/work-request/[id]",filename:"route",bundlePath:"app/api/work-request/[id]/route"},resolvedPagePath:"D:\\ttsdoc-v2\\src\\app\\api\\work-request\\[id]\\route.ts",nextConfigOutput:"",userland:E}),{requestAsyncStorage:R,staticGenerationAsyncStorage:_,serverHooks:D}=N,A="/api/work-request/[id]/route";function u(){return(0,n.patchFetch)({serverHooks:D,staticGenerationAsyncStorage:_})}},4458:(e,t,r)=>{r.d(t,{$p:()=>I,Ge:()=>P,K$:()=>E,NK:()=>c,c9:()=>i,gf:()=>n,n$:()=>a,oU:()=>o,uc:()=>s});const E={ADMIN:"Admin",BIM:"BIM",SITE_ADMIN:"Site Admin",CM:"CM",ME:"ME",SN:"SN",OE:"OE",PE:"PE",PM:"PM",PD:"PD",SE:"SE",FM:"FM",ADMIN_SITE_2:"Adminsite2"},s=[E.BIM,E.ME,E.SN,E.SITE_ADMIN,E.ADMIN,E.PM,E.PE,E.OE],o=[E.SITE_ADMIN,E.ADMIN_SITE_2,E.OE,E.PE,E.ADMIN],n=[E.CM,E.ADMIN,E.SITE_ADMIN,E.PM,E.PE,E.OE],i=(E.PM,E.ADMIN,E.SE,E.FM,[E.PE,E.OE,E.ADMIN]),I=[E.PM,E.ADMIN],a=(E.PD,E.SE,E.FM,{PENDING_REVIEW:"PENDING_REVIEW",PENDING_CM_APPROVAL:"PENDING_CM_APPROVAL",REVISION_REQUIRED:"REVISION_REQUIRED",APPROVED:"APPROVED",APPROVED_WITH_COMMENTS:"APPROVED_WITH_COMMENTS",APPROVED_REVISION_REQUIRED:"APPROVED_REVISION_REQUIRED",REJECTED:"REJECTED",PENDING_FINAL_APPROVAL:"PENDING_FINAL_APPROVAL"}),P={DRAFT:"DRAFT",REJECTED_BY_PM:"REJECTED_BY_PM",PENDING_BIM:"PENDING_BIM",IN_PROGRESS:"IN_PROGRESS",PENDING_ACCEPTANCE:"PENDING_ACCEPTANCE",REVISION_REQUESTED:"REVISION_REQUESTED",COMPLETED:"COMPLETED"},c={[a.PENDING_REVIEW]:"\u0e23\u0e2d\u0e15\u0e23\u0e27\u0e08\u0e2a\u0e2d\u0e1a",[a.PENDING_CM_APPROVAL]:"\u0e23\u0e2d\u0e2d\u0e19\u0e38\u0e21\u0e31\u0e15\u0e34 (CM/Approver)",[a.REVISION_REQUIRED]:"\u0e41\u0e01\u0e49\u0e44\u0e02",[a.APPROVED]:"\u0e2d\u0e19\u0e38\u0e21\u0e31\u0e15\u0e34",[a.APPROVED_WITH_COMMENTS]:"\u0e2d\u0e19\u0e38\u0e21\u0e31\u0e15\u0e34\u0e15\u0e32\u0e21\u0e04\u0e2d\u0e21\u0e40\u0e21\u0e19\u0e15\u0e4c (\u0e44\u0e21\u0e48\u0e41\u0e01\u0e49\u0e44\u0e02)",[a.APPROVED_REVISION_REQUIRED]:"\u0e2d\u0e19\u0e38\u0e21\u0e31\u0e15\u0e34\u0e15\u0e32\u0e21\u0e04\u0e2d\u0e21\u0e40\u0e21\u0e19\u0e15\u0e4c (\u0e15\u0e49\u0e2d\u0e07\u0e41\u0e01\u0e49\u0e44\u0e02)",[a.REJECTED]:"\u0e44\u0e21\u0e48\u0e2d\u0e19\u0e38\u0e21\u0e31\u0e15\u0e34",[a.PENDING_FINAL_APPROVAL]:"\u0e23\u0e2d SITE \u0e2d\u0e19\u0e38\u0e21\u0e31\u0e15\u0e34\u0e02\u0e31\u0e49\u0e19\u0e2a\u0e38\u0e14\u0e17\u0e49\u0e32\u0e22",[P.DRAFT]:"\u0e23\u0e2d\u0e2d\u0e19\u0e38\u0e21\u0e31\u0e15\u0e34 (PM)",[P.REJECTED_BY_PM]:"\u0e44\u0e21\u0e48\u0e2d\u0e19\u0e38\u0e21\u0e31\u0e15\u0e34 (PM)",[P.PENDING_BIM]:"\u0e23\u0e2d BIM \u0e23\u0e31\u0e1a\u0e07\u0e32\u0e19",[P.IN_PROGRESS]:"BIM \u0e01\u0e33\u0e25\u0e31\u0e07\u0e14\u0e33\u0e40\u0e19\u0e34\u0e19\u0e01\u0e32\u0e23",[P.PENDING_ACCEPTANCE]:"\u0e23\u0e2d\u0e15\u0e23\u0e27\u0e08\u0e23\u0e31\u0e1a (Site)",[P.REVISION_REQUESTED]:"\u0e02\u0e2d\u0e41\u0e01\u0e49\u0e44\u0e02 (WR)",[P.COMPLETED]:"\u0e40\u0e2a\u0e23\u0e47\u0e08\u0e2a\u0e34\u0e49\u0e19"};a.PENDING_REVIEW,a.PENDING_CM_APPROVAL,a.REVISION_REQUIRED,a.APPROVED,a.REJECTED,a.APPROVED_WITH_COMMENTS,a.APPROVED_REVISION_REQUIRED,a.PENDING_FINAL_APPROVAL,P.DRAFT,P.REJECTED_BY_PM,P.PENDING_BIM,P.IN_PROGRESS,P.PENDING_ACCEPTANCE,P.REVISION_REQUESTED,P.COMPLETED},40416:(e,t,r)=>{r.d(t,{CZ:()=>i,Hf:()=>I,iW:()=>n,SI:()=>a,uE:()=>P,Dh:()=>N,aj:()=>R,_B:()=>c,Lv:()=>_});const E=require("firebase-admin"),s=(e,t)=>E.apps.find((t=>t?.name===e))||E.initializeApp(t,e),o=()=>{const e={credential:E.credential.cert({projectId:process.env.TTSDOC_PROJECT_ID,clientEmail:process.env.TTSDOC_CLIENT_EMAIL,privateKey:process.env.TTSDOC_PRIVATE_KEY?.replace(/\\n/g,"\n")}),storageBucket:"ttsdocumentcontrol.firebasestorage.app"};return s("ttsdoc-v2",e)},n=o().firestore(),i=o().auth(),I=o().storage().bucket(),a=o().messaging(),P=(()=>{const e={credential:E.credential.cert({projectId:process.env.BIM_TRACKING_PROJECT_ID,clientEmail:process.env.BIM_TRACKING_CLIENT_EMAIL,privateKey:process.env.BIM_TRACKING_PRIVATE_KEY?.replace(/\\n/g,"\n")})};return s("bim-tracking",e)})().firestore(),c=()=>n,N=()=>i,R=()=>I,_=()=>P}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=t.X(0,[9276,5972],(()=>{return e=86178,t(t.s=e);var e}));module.exports=r})();