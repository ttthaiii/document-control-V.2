"use strict";(()=>{var e={};e.id=932,e.ids=[932],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},86178:(e,t,E)=>{E.r(t),E.d(t,{originalPathname:()=>d,patchFetch:()=>u,requestAsyncStorage:()=>_,routeModule:()=>N,serverHooks:()=>D,staticGenerationAsyncStorage:()=>c});var r={};E.r(r),E.d(r,{GET:()=>R,dynamic:()=>P});var s=E(49303),i=E(88716),o=E(60670),I=E(87070),n=E(40416),a=E(4458);let P="force-dynamic";async function R(e,{params:t}){try{let E=e.headers.get("authorization");if(!E?.startsWith("Bearer "))return I.NextResponse.json({success:!1,error:"Unauthorized"},{status:401});let r=E.split("Bearer ")[1],s=(await n.CZ.verifyIdToken(r)).uid,i=await n.iW.collection("users").doc(s).get();if(!i.exists)return I.NextResponse.json({success:!1,error:"User not found"},{status:404});let o=i.data(),P=o.sites||[],R=t.id,N=n.iW.collection("workRequests").doc(R),_=await N.get();if(!_.exists)return I.NextResponse.json({success:!1,error:"Document not found"},{status:404});let c=_.data();if(o.role!==a.K$.ADMIN&&!P.includes(c.siteId))return I.NextResponse.json({success:!1,error:"Access to this document is denied"},{status:403});let D=await n.iW.collection("sites").doc(c.siteId).get(),d=D.exists?{id:D.id,...D.data()}:{id:c.siteId,name:"Unknown Site"},u=Array.from(new Set(c.workflow.map(e=>e.userId))).map(e=>n.iW.collection("users").doc(e).get()),A=await Promise.all(u),p={};return A.forEach(e=>{if(e.exists){let t=e.data();p[e.id]={email:t.email,role:t.role}}}),I.NextResponse.json({success:!0,document:{id:_.id,...c,site:d,usersInfo:p}})}catch(E){console.error(`Error fetching work request ${t.id}:`,E);let e=E instanceof Error?E.message:"Internal Server Error";return I.NextResponse.json({success:!1,error:e},{status:500})}}let N=new s.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/work-request/[id]/route",pathname:"/api/work-request/[id]",filename:"route",bundlePath:"app/api/work-request/[id]/route"},resolvedPagePath:"D:\\ttsdoc-v2\\src\\app\\api\\work-request\\[id]\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:_,staticGenerationAsyncStorage:c,serverHooks:D}=N,d="/api/work-request/[id]/route";function u(){return(0,o.patchFetch)({serverHooks:D,staticGenerationAsyncStorage:c})}},4458:(e,t,E)=>{E.d(t,{$p:()=>n,Ge:()=>P,K$:()=>r,c9:()=>I,gf:()=>o,n$:()=>a,oU:()=>i,uc:()=>s});let r={ADMIN:"Admin",BIM:"BIM",SITE_ADMIN:"Site Admin",CM:"CM",ME:"ME",SN:"SN",OE:"OE",PE:"PE",PM:"PM",PD:"PD",SE:"SE",ADMIN_SITE_2:"Adminsite2"},s=[r.BIM,r.ME,r.SN],i=[r.SITE_ADMIN,r.ADMIN_SITE_2,r.OE,r.PE],o=[r.CM,r.PD];r.PM,r.SE;let I=[r.PE,r.OE,r.ADMIN],n=[r.PD,r.PM,r.ADMIN],a={PENDING_REVIEW:"PENDING_REVIEW",PENDING_CM_APPROVAL:"PENDING_CM_APPROVAL",REVISION_REQUIRED:"REVISION_REQUIRED",APPROVED:"APPROVED",APPROVED_WITH_COMMENTS:"APPROVED_WITH_COMMENTS",APPROVED_REVISION_REQUIRED:"APPROVED_REVISION_REQUIRED",REJECTED:"REJECTED",PENDING_FINAL_APPROVAL:"PENDING_FINAL_APPROVAL"},P={DRAFT:"DRAFT",REJECTED_BY_PM:"REJECTED_BY_PM",PENDING_BIM:"PENDING_BIM",IN_PROGRESS:"IN_PROGRESS",PENDING_ACCEPTANCE:"PENDING_ACCEPTANCE",REVISION_REQUESTED:"REVISION_REQUESTED",COMPLETED:"COMPLETED"};a.PENDING_REVIEW,a.PENDING_CM_APPROVAL,a.REVISION_REQUIRED,a.APPROVED,a.APPROVED_WITH_COMMENTS,a.APPROVED_REVISION_REQUIRED,a.REJECTED,a.PENDING_FINAL_APPROVAL,P.DRAFT,P.REJECTED_BY_PM,P.PENDING_BIM,P.IN_PROGRESS,P.PENDING_ACCEPTANCE,P.REVISION_REQUESTED,P.COMPLETED,a.PENDING_REVIEW,a.PENDING_CM_APPROVAL,a.REVISION_REQUIRED,a.APPROVED,a.REJECTED,a.APPROVED_WITH_COMMENTS,a.APPROVED_REVISION_REQUIRED,P.DRAFT,P.REJECTED_BY_PM,P.PENDING_BIM,P.IN_PROGRESS,P.PENDING_ACCEPTANCE,P.REVISION_REQUESTED,P.COMPLETED},40416:(e,t,E)=>{E.d(t,{CZ:()=>I,Hf:()=>n,iW:()=>o,uE:()=>a,Dh:()=>R,_B:()=>P,Lv:()=>N});let r=require("firebase-admin"),s=(e,t)=>r.apps.find(t=>t?.name===e)||r.initializeApp(t,e),i=()=>s("ttsdoc-v2",{credential:r.credential.cert({projectId:process.env.TTSDOC_PROJECT_ID,clientEmail:process.env.TTSDOC_CLIENT_EMAIL,privateKey:process.env.TTSDOC_PRIVATE_KEY?.replace(/\\n/g,"\n")}),storageBucket:"ttsdocumentcontrol.firebasestorage.app"}),o=i().firestore(),I=i().auth(),n=i().storage().bucket(),a=s("bim-tracking",{credential:r.credential.cert({projectId:process.env.BIM_TRACKING_PROJECT_ID,clientEmail:process.env.BIM_TRACKING_CLIENT_EMAIL,privateKey:process.env.BIM_TRACKING_PRIVATE_KEY?.replace(/\\n/g,"\n")})}).firestore(),P=()=>o,R=()=>I,N=()=>a}};var t=require("../../../../webpack-runtime.js");t.C(e);var E=e=>t(t.s=e),r=t.X(0,[8948,5972],()=>E(86178));module.exports=r})();