(()=>{var e={id:5223,ids:[5223]};e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},84770:e=>{"use strict";e.exports=require("crypto")},80665:e=>{"use strict";e.exports=require("dns")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},32694:e=>{"use strict";e.exports=require("http2")},98216:e=>{"use strict";e.exports=require("net")},19801:e=>{"use strict";e.exports=require("os")},55315:e=>{"use strict";e.exports=require("path")},35816:e=>{"use strict";e.exports=require("process")},76162:e=>{"use strict";e.exports=require("stream")},82452:e=>{"use strict";e.exports=require("tls")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},6162:e=>{"use strict";e.exports=require("worker_threads")},71568:e=>{"use strict";e.exports=require("zlib")},3477:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>i.a,__next_app__:()=>m,originalPathname:()=>x,pages:()=>d,routeModule:()=>u,tree:()=>c});s(32848),s(22834),s(96868),s(35866);var r=s(23191),a=s(88716),l=s(37922),i=s.n(l),n=s(95231),o={};for(const h in n)["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(h)<0&&(o[h]=()=>n[h]);s.d(t,o);const c=["",{children:["dashboard",{children:["work-request",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,32848)),"D:\\ttsdoc-v2\\src\\app\\dashboard\\work-request\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,22834)),"D:\\ttsdoc-v2\\src\\app\\dashboard\\layout.tsx"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,96868)),"D:\\ttsdoc-v2\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,35866,23)),"next/dist/client/components/not-found-error"]}],d=["D:\\ttsdoc-v2\\src\\app\\dashboard\\work-request\\page.tsx"],x="/dashboard/work-request/page",m={require:s,loadChunk:()=>Promise.resolve()},u=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/dashboard/work-request/page",pathname:"/dashboard/work-request",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},44011:(e,t,s)=>{Promise.resolve().then(s.bind(s,93155))},31540:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});const r=(0,s(62881).Z)("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]])},12714:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});const r=(0,s(62881).Z)("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},70717:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});const r=(0,s(62881).Z)("history",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]])},56418:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});const r=(0,s(62881).Z)("paperclip",[["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 2.829 2.829l8.414-8.586a4 4 0 1 0-5.657-5.657l-8.379 8.551a6 6 0 1 0 8.485 8.485l8.379-8.551",key:"1miecu"}]])},21405:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});const r=(0,s(62881).Z)("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])},687:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});const r=(0,s(62881).Z)("thumbs-down",[["path",{d:"M17 14V2",key:"8ymqnk"}],["path",{d:"M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22a3.13 3.13 0 0 1-3-3.88Z",key:"m61m77"}]])},59593:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});const r=(0,s(62881).Z)("thumbs-up",[["path",{d:"M7 10v12",key:"1qc93n"}],["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2a3.13 3.13 0 0 1 3 3.88Z",key:"emmmcr"}]])},93155:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>B});var r=s(10326),a=s(17577),l=s(35047),i=s(26107),n=s(32875),o=s(79821),c=s(36283),d=s(59593),x=s(687),m=s(7619);const u=e=>{if(!e)return"N/A";if("function"===typeof e.toDate){return e.toDate().toLocaleDateString("th-TH",{day:"2-digit",month:"short",year:"numeric"})}const t=new Date(e);return isNaN(t.getTime())?"Invalid Date":t.toLocaleDateString("th-TH",{day:"2-digit",month:"short",year:"numeric"})},h=e=>{const t=m.NK[e]||e;let s="text-gray-800",r="bg-gray-100";switch(e){case m.Ge.DRAFT:r="bg-gray-200",s="text-gray-700";break;case m.Ge.REJECTED_BY_PM:r="bg-red-100",s="text-red-800";break;case m.Ge.PENDING_BIM:r="bg-blue-100",s="text-blue-800";break;case m.Ge.IN_PROGRESS:r="bg-yellow-100",s="text-yellow-800";break;case m.Ge.PENDING_ACCEPTANCE:r="bg-purple-100",s="text-purple-800";break;case m.Ge.REVISION_REQUESTED:r="bg-orange-100",s="text-orange-800";break;case m.Ge.COMPLETED:r="bg-green-100",s="text-green-800";break;default:r="bg-gray-100",s="text-gray-800"}return{text:t,colorClasses:`${r} ${s}`}};function p({documents:e,isLoading:t,onDocumentClick:s,selectedIds:l,onSelectionChange:n,onApproveRejectClick:p}){const{user:g}=(0,i.a)(),b=g&&m.$p.includes(g.role),f=(0,a.useMemo)((()=>{if(!g)return[];const t=g.role;return t===m.K$.ADMIN||m.$p.includes(t)?e:t===m.K$.BIM?e.filter((e=>e.status!==m.Ge.DRAFT&&e.status!==m.Ge.REJECTED_BY_PM)):m.c9.includes(t)&&g.sites&&g.sites.length>0?e.filter((e=>e.createdBy===g.id||e.status!==m.Ge.DRAFT&&e.status!==m.Ge.REJECTED_BY_PM)):e.filter((e=>e.status!==m.Ge.DRAFT&&e.status!==m.Ge.REJECTED_BY_PM))}),[e,g]),j=(0,a.useMemo)((()=>f.filter((e=>e.status===m.Ge.DRAFT))),[f]),y=j.length>0&&j.every((e=>l.includes(e.id)));return t?r.jsx("div",{className:"w-full h-96 flex justify-center items-center bg-white rounded-lg shadow",children:r.jsx(o.Z,{})}):e&&0!==e.length?r.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden h-full flex flex-col",children:r.jsx("div",{className:"overflow-auto flex-1 relative",children:(0,r.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[r.jsx("thead",{className:"bg-gray-50 sticky top-0 z-10",children:(0,r.jsxs)("tr",{children:[b&&r.jsx("th",{className:"px-4 py-3 text-left w-[50px]",children:r.jsx("input",{type:"checkbox",className:"h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500",checked:y,onChange:e=>(e=>{const t=f.filter((e=>e.status===m.Ge.DRAFT)).map((e=>e.id));if(e){const e=Array.from(new Set([...l,...t]));n(e)}else n(l.filter((e=>!t.includes(e))))})(e.target.checked),disabled:0===j.length})}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"\u0e40\u0e25\u0e02\u0e17\u0e35\u0e48\u0e40\u0e2d\u0e01\u0e2a\u0e32\u0e23"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"\u0e2b\u0e31\u0e27\u0e02\u0e49\u0e2d\u0e40\u0e23\u0e37\u0e48\u0e2d\u0e07"}),r.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"\u0e42\u0e04\u0e23\u0e07\u0e01\u0e32\u0e23"}),r.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"\u0e2a\u0e16\u0e32\u0e19\u0e30"}),r.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"\u0e2d\u0e31\u0e1b\u0e40\u0e14\u0e15\u0e25\u0e48\u0e32\u0e2a\u0e38\u0e14"}),b&&r.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"Actions"})]})}),r.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:f.map((e=>{const t=h(e.status),a=e.status===m.Ge.DRAFT,i=l.includes(e.id);return(0,r.jsxs)("tr",{className:"hover:bg-gray-50 transition-colors "+(a?"bg-yellow-50/50 hover:bg-yellow-100/50":""),onClick:t=>{const r=t.target;"INPUT"===r.tagName||r.closest("button")||s(e)},children:[b&&r.jsx("td",{className:"px-4 py-4",children:a?r.jsx("input",{type:"checkbox",className:"h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500 cursor-pointer",checked:i,onChange:t=>{return s=e.id,r=t.target.checked,void n(r?[...l,s]:l.filter((e=>e!==s)));var s,r},onClick:e=>e.stopPropagation()}):null}),r.jsx("td",{className:"px-6 py-4",children:r.jsx("p",{className:"text-sm font-semibold text-blue-600",children:e.documentNumber})}),r.jsx("td",{className:"px-6 py-4",children:r.jsx("p",{className:"text-sm text-gray-800 line-clamp-2 font-medium",children:e.taskName})}),r.jsx("td",{className:"px-6 py-4 text-center",children:r.jsx("p",{className:"text-sm text-gray-600",children:e.site?.name||"N/A"})}),r.jsx("td",{className:"px-6 py-4 text-center",children:r.jsx("span",{className:`inline-flex items-center justify-center px-2.5 py-1 rounded-full text-xs font-bold shadow-sm ${t.colorClasses}`,children:t.text})}),r.jsx("td",{className:"px-6 py-4 text-center",children:r.jsx("span",{className:"text-sm text-gray-600",children:u(e.updatedAt)})}),b&&r.jsx("td",{className:"px-4 py-4 text-center whitespace-nowrap",children:a&&p&&(0,r.jsxs)(r.Fragment,{children:[r.jsx("button",{onClick:t=>{t.stopPropagation(),p("APPROVE_DRAFT",e.id)},className:"text-green-600 hover:text-green-800 p-1.5 rounded-md hover:bg-green-100 mx-1 disabled:opacity-50 transition-colors",title:"\u0e2d\u0e19\u0e38\u0e21\u0e31\u0e15\u0e34",children:r.jsx(d.Z,{size:18})}),r.jsx("button",{onClick:t=>{t.stopPropagation(),p("REJECT_DRAFT",e.id)},className:"text-red-600 hover:text-red-800 p-1.5 rounded-md hover:bg-red-100 mx-1 disabled:opacity-50 transition-colors",title:"\u0e44\u0e21\u0e48\u0e2d\u0e19\u0e38\u0e21\u0e31\u0e15\u0e34",children:r.jsx(x.Z,{size:18})})]})})]},e.id)}))})]})})}):(0,r.jsxs)("div",{className:"w-full h-96 flex flex-col justify-center items-center bg-white rounded-lg shadow text-center border-2 border-dashed",children:[r.jsx(c.Z,{className:"w-16 h-16 text-gray-300 mb-4"}),r.jsx("h3",{className:"text-xl font-semibold text-gray-700",children:"\u0e44\u0e21\u0e48\u0e1e\u0e1a Work Request"}),r.jsx("p",{className:"text-gray-500 mt-1",children:"\u0e22\u0e31\u0e07\u0e44\u0e21\u0e48\u0e21\u0e35\u0e01\u0e32\u0e23\u0e2a\u0e23\u0e49\u0e32\u0e07\u0e04\u0e33\u0e23\u0e49\u0e2d\u0e07\u0e02\u0e2d\u0e07\u0e32\u0e19\u0e43\u0e19\u0e42\u0e04\u0e23\u0e07\u0e01\u0e32\u0e23\u0e19\u0e35\u0e49"})]})}var g=s(70717),b=s(94019),f=s(32933),j=s(62881);const y=(0,j.Z)("pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);var N=s(50949),w=s(98091),v=s(56418),k=s(12714),C=s(31540),E=s(63685);const S=(0,j.Z)("corner-up-left",[["path",{d:"M20 20v-7a4 4 0 0 0-4-4H4",key:"1nkjon"}],["path",{d:"M9 14 4 9l5-5",key:"102s5s"}]]);var T=s(69436),D=s(31469),R=s(31539);const A=e=>{if(!e)return"0 B";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(1))+" "+["B","KB","MB","GB"][t]},Z=(e,t=!0)=>{if(!e)return"N/A";let s;if(s=e&&"object"===typeof e&&"_seconds"in e?new Date(1e3*e._seconds):new Date(e),isNaN(s.getTime()))return"Invalid Date";const r={day:"2-digit",month:"short",year:"numeric"};return t&&(r.hour="2-digit",r.minute="2-digit"),s.toLocaleString("th-TH",r)},P=e=>({text:m.NK[e]||e,color:m.yh[e]||"#6c757d"}),M=({workflow:e,onClose:t})=>r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 z-[60] flex items-center justify-center p-4",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[80vh] flex flex-col",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center p-4 border-b",children:[(0,r.jsxs)("h3",{className:"text-lg font-bold text-gray-800 flex items-center",children:[r.jsx(g.Z,{size:20,className:"mr-2"}),"\u0e1b\u0e23\u0e30\u0e27\u0e31\u0e15\u0e34 Work Request"]}),r.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600",children:r.jsx(b.Z,{size:24})})]}),r.jsx("div",{className:"p-6 overflow-y-auto",children:r.jsx("div",{className:"border-l-2 border-gray-200 ml-2",children:e.length>0?e.map(((e,t)=>(0,r.jsxs)("div",{className:"relative pl-6 pb-8 last:pb-0",children:[r.jsx("div",{className:"absolute -left-[9px] top-1 w-4 h-4 bg-blue-500 rounded-full border-2 border-white"}),r.jsx("p",{className:"font-semibold text-gray-800",children:P(e.status).text}),(0,r.jsxs)("p",{className:"text-sm text-gray-600",children:["\u0e42\u0e14\u0e22: ",e.userName," (",e.role,")"]}),r.jsx("time",{className:"text-xs text-gray-400",children:Z(e.timestamp)}),e.comments&&r.jsx("div",{className:"mt-2 p-2 bg-gray-50 rounded-md text-xs italic",children:(0,r.jsxs)("p",{className:"text-gray-600",children:['"',e.comments,'"']})})]},t))):r.jsx("p",{className:"text-sm text-gray-500 pl-6",children:"\u0e44\u0e21\u0e48\u0e21\u0e35\u0e1b\u0e23\u0e30\u0e27\u0e31\u0e15\u0e34"})})})]})});function _({documentId:e,onClose:t,onUpdate:s}){const{user:l,firebaseUser:n}=(0,i.a)(),{showNotification:u}=(0,D.l)(),[h,p]=(0,a.useState)(null),[j,_]=(0,a.useState)(!0),[z,q]=(0,a.useState)(!1),[I,$]=(0,a.useState)(""),[O,F]=(0,a.useState)([]),[G,B]=(0,a.useState)(!1),[U,L]=(0,a.useState)(""),[J,V]=(0,a.useState)([]),[K,W]=(0,a.useState)(!1),[H,Q]=(0,a.useState)(!1),[Y,X]=(0,a.useState)(null),[ee,te]=(0,a.useState)(null),[se,re]=(0,a.useState)(""),[ae,le]=(0,a.useState)(null),[ie,ne]=(0,a.useState)(null),[oe,ce]=(0,a.useState)(""),de=l?.role===m.K$.BIM&&h?.status===m.Ge.IN_PROGRESS,xe=l&&m.oU.includes(l.role)&&h?.status===m.Ge.PENDING_ACCEPTANCE,me=l?.role===m.K$.BIM&&h?.status===m.Ge.REVISION_REQUESTED,ue=l&&m.$p.includes(l.role)&&h?.status===m.Ge.DRAFT,he=(0,a.useMemo)((()=>(h?.revisionNumber||0)+1),[h]),pe=(0,a.useMemo)((()=>h?`${h.documentNumber.split("-REV")[0]}-REV${String(he).padStart(2,"0")}`:""),[h,he]),ge=(0,a.useMemo)((()=>{if(!h||!h.workflow)return[];const e=h.workflow.find((e=>e.status===h.status));return e?.files||[]}),[h]),be=async e=>{try{if(!n)throw new Error("\u0e01\u0e23\u0e38\u0e13\u0e32\u0e25\u0e47\u0e2d\u0e01\u0e2d\u0e34\u0e19\u0e01\u0e48\u0e2d\u0e19\u0e2d\u0e31\u0e1b\u0e42\u0e2b\u0e25\u0e14\u0e44\u0e1f\u0e25\u0e4c");const t=await n.getIdToken(),s=new FormData;s.append("file",e);const r=await fetch("/api/rfa/upload-temp-file",{method:"POST",headers:{Authorization:`Bearer ${t}`},body:s}),a=await r.json();if(a.success)return{status:"success",uploadedData:a.fileData};throw new Error(a.error||"\u0e2d\u0e31\u0e1b\u0e42\u0e2b\u0e25\u0e14\u0e25\u0e49\u0e21\u0e40\u0e2b\u0e25\u0e27")}catch(t){return{status:"error",error:t instanceof Error?t.message:"\u0e40\u0e01\u0e34\u0e14\u0e02\u0e49\u0e2d\u0e1c\u0e34\u0e14\u0e1e\u0e25\u0e32\u0e14"}}},fe=async(e,t)=>{const s=Array.from(e.target.files||[]);s.length&&(Ne(s,t),e.target.value="")},je=(e,t)=>{("revision"===t?V:F)((t=>t.map((t=>{if(t.id===e){const e=t.uploadedData?{...t.uploadedData,fileName:oe}:void 0;return{...t,customName:oe,uploadedData:e}}return t})))),ne(null)},ye=()=>{ne(null),ce("")},Ne=async(e,t)=>{const s=e.map((e=>({id:`${e.name}-${Date.now()}`,file:e,status:"pending"}))),r="revision"===t?V:F;r((e=>[...e,...s]));for(const a of s){r((e=>e.map((e=>e.id===a.id?{...e,status:"uploading"}:e))));const e=await be(a.file);r((t=>t.map((t=>t.id===a.id?{...t,...e}:t))))}},we=async e=>{if(h&&n){q(!0);try{const r=await n.getIdToken(),a=O.filter((e=>"success"===e.status)),l=await fetch(`/api/work-request/${h.id}/update`,{method:"POST",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"},body:JSON.stringify({action:e,payload:{comments:I,files:a.map((e=>e.uploadedData))}})}),i=await l.json();if(!i.success)throw new Error(i.error);u("success","\u0e14\u0e33\u0e40\u0e19\u0e34\u0e19\u0e01\u0e32\u0e23\u0e2a\u0e33\u0e40\u0e23\u0e47\u0e08",`\u0e2a\u0e16\u0e32\u0e19\u0e30\u0e16\u0e39\u0e01\u0e40\u0e1b\u0e25\u0e35\u0e48\u0e22\u0e19\u0e40\u0e1b\u0e47\u0e19: ${P(i.newStatus).text}`),s(),t()}catch(r){u("error","\u0e40\u0e01\u0e34\u0e14\u0e02\u0e49\u0e2d\u0e1c\u0e34\u0e14\u0e1e\u0e25\u0e32\u0e14",r instanceof Error?r.message:"Failed to perform action")}finally{q(!1)}}},ve=async e=>{if(h&&n)if("REJECT_DRAFT"!==e||se.trim()){q(!0);try{const r=await n.getIdToken(),a=await fetch(`/api/work-request/${h.id}/update`,{method:"POST",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"},body:JSON.stringify({action:e,payload:{comments:se}})}),l=await a.json();if(!l.success)throw new Error(l.error||"\u0e40\u0e01\u0e34\u0e14\u0e02\u0e49\u0e2d\u0e1c\u0e34\u0e14\u0e1e\u0e25\u0e32\u0e14\u0e43\u0e19\u0e01\u0e32\u0e23\u0e14\u0e33\u0e40\u0e19\u0e34\u0e19\u0e01\u0e32\u0e23");u("success","\u0e14\u0e33\u0e40\u0e19\u0e34\u0e19\u0e01\u0e32\u0e23\u0e2a\u0e33\u0e40\u0e23\u0e47\u0e08",`\u0e2a\u0e16\u0e32\u0e19\u0e30\u0e16\u0e39\u0e01\u0e40\u0e1b\u0e25\u0e35\u0e48\u0e22\u0e19\u0e40\u0e1b\u0e47\u0e19: ${P(l.newStatus).text}`),s(),t()}catch(r){u("error","\u0e40\u0e01\u0e34\u0e14\u0e02\u0e49\u0e2d\u0e1c\u0e34\u0e14\u0e1e\u0e25\u0e32\u0e14",r instanceof Error?r.message:"Unknown error")}finally{q(!1)}}else u("warning","\u0e01\u0e23\u0e38\u0e13\u0e32\u0e01\u0e23\u0e2d\u0e01\u0e40\u0e2b\u0e15\u0e38\u0e1c\u0e25","\u0e15\u0e49\u0e2d\u0e07\u0e23\u0e30\u0e1a\u0e38\u0e40\u0e2b\u0e15\u0e38\u0e1c\u0e25\u0e43\u0e19\u0e01\u0e32\u0e23\u0e44\u0e21\u0e48\u0e2d\u0e19\u0e38\u0e21\u0e31\u0e15\u0e34")};if(j)return r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center",children:r.jsx(o.Z,{className:"w-12 h-12 text-white"})});if(!h)return null;const ke=P(h.status),Ce=(e,t)=>r.jsx("div",{className:"mt-2 space-y-2",children:e.map((e=>(0,r.jsxs)("div",{className:"flex items-center text-sm p-2 bg-gray-100 rounded border border-gray-200 group",children:[r.jsx(c.Z,{className:"w-4 h-4 mr-3 text-gray-500 flex-shrink-0"}),ie===e.id?(0,r.jsxs)("div",{className:"flex-1 flex items-center gap-2 min-w-0 bg-white p-1 rounded border border-blue-300 ring-2 ring-blue-100",children:[r.jsx("input",{type:"text",value:oe,onChange:e=>ce(e.target.value),className:"flex-1 p-1 text-sm outline-none bg-white text-gray-900",autoFocus:!0,onKeyDown:s=>{"Enter"===s.key&&(s.preventDefault(),je(e.id,t)),"Escape"===s.key&&ye()}}),(0,r.jsxs)("div",{className:"flex items-center border-l pl-1 space-x-1",children:[r.jsx("button",{onClick:()=>je(e.id,t),className:"p-1 hover:bg-green-100 text-green-600 rounded transition-colors",title:"\u0e1a\u0e31\u0e19\u0e17\u0e36\u0e01\u0e0a\u0e37\u0e48\u0e2d",children:r.jsx(f.Z,{size:16})}),r.jsx("button",{onClick:ye,className:"p-1 hover:bg-red-100 text-red-500 rounded transition-colors",title:"\u0e22\u0e01\u0e40\u0e25\u0e34\u0e01",children:r.jsx(b.Z,{size:16})})]})]}):(0,r.jsxs)("div",{className:"flex-1 min-w-0 flex items-center gap-2",children:[r.jsx("span",{onClick:()=>(e=>{const t=URL.createObjectURL(e.file);if("application/pdf"===e.file.type||e.file.name.toLowerCase().endsWith(".pdf")){const s={fileName:e.customName||e.uploadedData?.fileName||e.file.name,fileUrl:t,filePath:"",size:e.file.size,fileSize:e.file.size,contentType:e.file.type,uploadedAt:(new Date).toISOString(),uploadedBy:l?.id||""};le(s)}else window.open(t,"_blank")})(e),className:"truncate cursor-pointer text-blue-600 hover:underline font-medium",title:"\u0e04\u0e25\u0e34\u0e01\u0e40\u0e1e\u0e37\u0e48\u0e2d\u0e14\u0e39\u0e15\u0e31\u0e27\u0e2d\u0e22\u0e48\u0e32\u0e07",children:e.customName||e.uploadedData?.fileName||e.file.name}),r.jsx("button",{onClick:()=>(e=>{ne(e.id);const t=e.customName||e.uploadedData?.fileName||e.file.name;ce(t)})(e),className:"opacity-0 group-hover:opacity-100 p-1 text-gray-400 hover:text-blue-600 rounded transition-all",title:"\u0e40\u0e1b\u0e25\u0e35\u0e48\u0e22\u0e19\u0e0a\u0e37\u0e48\u0e2d\u0e44\u0e1f\u0e25\u0e4c",children:r.jsx(y,{size:14})})]}),ie!==e.id&&(0,r.jsxs)("div",{className:"flex items-center ml-3 space-x-3",children:[(0,r.jsxs)("div",{className:"flex items-center",children:["uploading"===e.status&&r.jsx(o.Z,{className:"w-4 h-4 text-blue-500"}),"success"===e.status&&r.jsx(f.Z,{className:"w-4 h-4 text-green-500"}),"error"===e.status&&r.jsx("span",{title:e.error,children:r.jsx(N.Z,{className:"w-4 h-4 text-red-500"})})]}),r.jsx("button",{type:"button",onClick:()=>((e,t)=>{("revision"===t?V:F)((t=>t.filter((t=>t.id!==e))))})(e.id,t),className:"text-gray-400 hover:text-red-600 transition-colors p-1 hover:bg-red-50 rounded",title:"\u0e25\u0e1a\u0e44\u0e1f\u0e25\u0e4c",children:r.jsx(w.Z,{size:16})})]})]},e.id)))});return(0,r.jsxs)(r.Fragment,{children:[r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 z-50 flex items-center justify-center p-4",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] flex flex-col",children:[(0,r.jsxs)("div",{className:"flex justify-between items-start p-4 border-b",children:[(0,r.jsxs)("div",{children:[r.jsx("h3",{className:"text-lg font-bold text-blue-600",children:h.documentNumber}),r.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:h.taskName})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,r.jsxs)("button",{onClick:()=>B(!0),className:"flex items-center text-sm text-gray-500 hover:text-blue-600",children:[r.jsx(g.Z,{size:16,className:"mr-1"})," \u0e14\u0e39\u0e1b\u0e23\u0e30\u0e27\u0e31\u0e15\u0e34"]}),r.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600",children:r.jsx(b.Z,{size:24})})]})]}),(0,r.jsxs)("div",{className:"p-6 overflow-y-auto space-y-6",children:[(0,r.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-200",children:[(0,r.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[(0,r.jsxs)("div",{children:[r.jsx("strong",{className:"text-gray-700 font-semibold block mb-1",children:"\u0e2a\u0e16\u0e32\u0e19\u0e30:"}),r.jsx("span",{className:"px-3 py-1 text-xs font-bold text-white rounded-full shadow-sm",style:{backgroundColor:ke.color},children:ke.text})]}),(0,r.jsxs)("div",{children:[r.jsx("strong",{className:"text-gray-700 font-semibold block",children:"\u0e42\u0e04\u0e23\u0e07\u0e01\u0e32\u0e23:"}),r.jsx("span",{className:"text-gray-900",children:h.site?.name||"N/A"})]}),(0,r.jsxs)("div",{children:[r.jsx("strong",{className:"text-gray-700 font-semibold block",children:"\u0e27\u0e31\u0e19\u0e17\u0e35\u0e48\u0e40\u0e23\u0e34\u0e48\u0e21 (\u0e41\u0e1c\u0e19):"}),r.jsx("span",{className:"text-gray-900",children:Z(h.planStartDate,!1)})]}),(0,r.jsxs)("div",{children:[r.jsx("strong",{className:"text-gray-700 font-semibold block",children:"\u0e27\u0e31\u0e19\u0e17\u0e35\u0e48\u0e01\u0e33\u0e2b\u0e19\u0e14\u0e2a\u0e48\u0e07:"}),r.jsx("span",{className:"text-gray-900",children:Z(h.dueDate,!1)})]})]}),h.description&&(0,r.jsxs)("div",{className:"mt-4",children:[r.jsx("strong",{className:"text-gray-700 font-semibold block text-sm",children:"\u0e23\u0e32\u0e22\u0e25\u0e30\u0e40\u0e2d\u0e35\u0e22\u0e14:"}),r.jsx("div",{className:"text-gray-900 whitespace-pre-wrap bg-white p-3 rounded-md mt-1 border border-gray-300 shadow-sm",children:(0,r.jsxs)("p",{children:['"',h.description,'"']})})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("h4",{className:"text-md font-semibold mb-2 flex items-center text-slate-800",children:[r.jsx(v.Z,{size:16,className:"mr-2"})," \u0e44\u0e1f\u0e25\u0e4c\u0e41\u0e19\u0e1a"]}),r.jsx("ul",{className:"space-y-2",children:ge.length>0?ge.map(((e,t)=>{const s=e.fileName.toLowerCase().endsWith(".pdf")||"application/pdf"===e.contentType;return r.jsx("li",{children:(0,r.jsxs)("div",{className:"flex items-center justify-between p-2 bg-slate-100 border border-slate-200 rounded-md hover:bg-slate-200 transition-colors group",children:[(0,r.jsxs)("div",{className:"flex items-center min-w-0 flex-1 cursor-pointer",onClick:()=>s?le(e):window.open(e.fileUrl),children:[r.jsx(c.Z,{className:"w-5 h-5 text-gray-500 mr-3 flex-shrink-0"}),(0,r.jsxs)("div",{className:"flex flex-col min-w-0",children:[r.jsx("span",{className:"text-sm font-medium text-blue-600 group-hover:underline truncate",children:e.fileName}),r.jsx("span",{className:"text-xs text-gray-500",children:A(e.fileSize||e.size)})]})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2 ml-2",children:[s&&r.jsx("button",{onClick:()=>le(e),className:"p-1 text-gray-400 hover:text-blue-600",title:"\u0e14\u0e39/\u0e41\u0e01\u0e49\u0e44\u0e02 PDF",children:r.jsx(k.Z,{size:18})}),!s&&r.jsx("a",{href:e.fileUrl,target:"_blank",rel:"noopener noreferrer",className:"p-1 text-gray-400 hover:text-gray-600",children:r.jsx(C.Z,{size:18})})]})]})},t)})):r.jsx("p",{className:"text-sm text-gray-500 italic",children:"\u0e44\u0e21\u0e48\u0e21\u0e35\u0e44\u0e1f\u0e25\u0e4c\u0e41\u0e19\u0e1a"})})]})]}),(0,r.jsxs)("div",{className:"p-4 border-t bg-slate-50",children:[ue&&(0,r.jsxs)("div",{className:"space-y-4",children:[r.jsx("h3",{className:"text-lg font-bold text-slate-800",children:"\u0e14\u0e33\u0e40\u0e19\u0e34\u0e19\u0e01\u0e32\u0e23 (\u0e2a\u0e33\u0e2b\u0e23\u0e31\u0e1a PM/PD)"}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"\u0e40\u0e2b\u0e15\u0e38\u0e1c\u0e25\u0e43\u0e19\u0e01\u0e32\u0e23\u0e44\u0e21\u0e48\u0e2d\u0e19\u0e38\u0e21\u0e31\u0e15\u0e34 (\u0e16\u0e49\u0e32\u0e21\u0e35)"}),r.jsx("textarea",{value:se,onChange:e=>re(e.target.value),rows:3,placeholder:"\u0e01\u0e23\u0e2d\u0e01\u0e40\u0e2b\u0e15\u0e38\u0e1c\u0e25\u0e17\u0e35\u0e48\u0e44\u0e21\u0e48\u0e2d\u0e19\u0e38\u0e21\u0e31\u0e15\u0e34...",className:"w-full p-2 border rounded-md bg-white text-gray-900"})]}),(0,r.jsxs)("div",{className:"flex justify-end gap-3 pt-2",children:[(0,r.jsxs)("button",{onClick:()=>ve("REJECT_DRAFT"),disabled:z,className:"flex items-center px-4 py-2 text-sm font-medium text-white bg-red-600 rounded-lg hover:bg-red-700 disabled:bg-red-300 disabled:cursor-not-allowed",children:[r.jsx(x.Z,{size:16,className:"mr-2"})," ",z?"\u0e01\u0e33\u0e25\u0e31\u0e07\u0e14\u0e33\u0e40\u0e19\u0e34\u0e19\u0e01\u0e32\u0e23...":"\u0e44\u0e21\u0e48\u0e2d\u0e19\u0e38\u0e21\u0e31\u0e15\u0e34"]}),(0,r.jsxs)("button",{onClick:()=>ve("APPROVE_DRAFT"),disabled:z,className:"flex items-center px-4 py-2 text-sm font-medium text-white bg-green-600 rounded-lg hover:bg-green-700 disabled:bg-green-300 disabled:cursor-not-allowed",children:[r.jsx(d.Z,{size:16,className:"mr-2"})," ",z?"\u0e01\u0e33\u0e25\u0e31\u0e07\u0e2d\u0e19\u0e38\u0e21\u0e31\u0e15\u0e34...":"\u0e2d\u0e19\u0e38\u0e21\u0e31\u0e15\u0e34 (\u0e2a\u0e48\u0e07\u0e43\u0e2b\u0e49 BIM)"]})]})]}),xe&&(0,r.jsxs)("div",{className:"space-y-4",children:[r.jsx("h3",{className:"text-lg font-bold text-slate-800",children:"\u0e14\u0e33\u0e40\u0e19\u0e34\u0e19\u0e01\u0e32\u0e23 (\u0e2a\u0e33\u0e2b\u0e23\u0e31\u0e1a Site)"}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"\u0e41\u0e19\u0e1a\u0e44\u0e1f\u0e25\u0e4c\u0e40\u0e1e\u0e34\u0e48\u0e21\u0e40\u0e15\u0e34\u0e21 (\u0e16\u0e49\u0e32\u0e21\u0e35)"}),(0,r.jsxs)("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-4 text-center hover:border-blue-500 transition-colors",children:[r.jsx("input",{type:"file",multiple:!0,onChange:e=>fe(e,"action"),id:"site-file-upload",className:"hidden"}),(0,r.jsxs)("label",{htmlFor:"site-file-upload",className:"cursor-pointer text-blue-600 hover:text-blue-800 font-medium flex items-center justify-center",children:[r.jsx(E.Z,{size:16,className:"mr-2"})," \u0e04\u0e25\u0e34\u0e01\u0e40\u0e1e\u0e37\u0e48\u0e2d\u0e40\u0e25\u0e37\u0e2d\u0e01\u0e44\u0e1f\u0e25\u0e4c"]})]}),O.length>0&&Ce(O,"action")]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"\u0e2b\u0e21\u0e32\u0e22\u0e40\u0e2b\u0e15\u0e38 / \u0e04\u0e2d\u0e21\u0e40\u0e21\u0e19\u0e15\u0e4c (\u0e16\u0e49\u0e32\u0e21\u0e35)"}),r.jsx("textarea",{value:I,onChange:e=>$(e.target.value),rows:3,placeholder:"\u0e2b\u0e32\u0e01\u0e15\u0e49\u0e2d\u0e07\u0e01\u0e32\u0e23\u0e43\u0e2b\u0e49\u0e41\u0e01\u0e49\u0e44\u0e02 \u0e01\u0e23\u0e38\u0e13\u0e32\u0e43\u0e2a\u0e48\u0e23\u0e32\u0e22\u0e25\u0e30\u0e40\u0e2d\u0e35\u0e22\u0e14...",className:"w-full p-2 border rounded-md bg-white text-gray-900"})]}),(0,r.jsxs)("div",{className:"flex justify-end gap-3 pt-2",children:[(0,r.jsxs)("button",{onClick:()=>we("REQUEST_REVISION"),disabled:z,className:"flex items-center px-4 py-2 text-sm font-medium text-white bg-orange-600 rounded-lg hover:bg-orange-700 disabled:bg-orange-300",children:[r.jsx(S,{size:16,className:"mr-2"}),z?"\u0e01\u0e33\u0e25\u0e31\u0e07\u0e2a\u0e48\u0e07...":"\u0e2a\u0e48\u0e07\u0e01\u0e25\u0e31\u0e1a\u0e43\u0e2b\u0e49\u0e41\u0e01\u0e49\u0e44\u0e02"]}),(0,r.jsxs)("button",{onClick:()=>we("COMPLETE"),disabled:z,className:"flex items-center px-4 py-2 text-sm font-medium text-white bg-green-600 rounded-lg hover:bg-green-700 disabled:bg-green-300",children:[r.jsx(f.Z,{size:16,className:"mr-2"}),z?"\u0e01\u0e33\u0e25\u0e31\u0e07\u0e1b\u0e34\u0e14\u0e07\u0e32\u0e19...":"\u0e15\u0e23\u0e27\u0e08\u0e23\u0e31\u0e1a\u0e41\u0e25\u0e30\u0e1b\u0e34\u0e14\u0e07\u0e32\u0e19"]})]})]}),de&&(0,r.jsxs)("div",{className:"space-y-4",children:[r.jsx("h3",{className:"text-lg font-bold text-slate-800",children:"\u0e2a\u0e48\u0e07\u0e21\u0e2d\u0e1a\u0e07\u0e32\u0e19 (Submit Work)"}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["\u0e41\u0e19\u0e1a\u0e44\u0e1f\u0e25\u0e4c\u0e1c\u0e25\u0e07\u0e32\u0e19 ",r.jsx("span",{className:"text-red-500",children:"*"})]}),(0,r.jsxs)("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-4 text-center hover:border-blue-500 transition-colors",children:[r.jsx("input",{type:"file",multiple:!0,onChange:e=>fe(e,"action"),id:"submit-file-upload",className:"hidden"}),(0,r.jsxs)("label",{htmlFor:"submit-file-upload",className:"cursor-pointer text-blue-600 hover:text-blue-800 font-medium flex items-center justify-center",children:[r.jsx(E.Z,{size:16,className:"mr-2"})," \u0e04\u0e25\u0e34\u0e01\u0e40\u0e1e\u0e37\u0e48\u0e2d\u0e40\u0e25\u0e37\u0e2d\u0e01\u0e44\u0e1f\u0e25\u0e4c"]})]}),O.length>0&&Ce(O,"action")]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"\u0e2b\u0e21\u0e32\u0e22\u0e40\u0e2b\u0e15\u0e38 / \u0e04\u0e2d\u0e21\u0e40\u0e21\u0e19\u0e15\u0e4c (\u0e16\u0e49\u0e32\u0e21\u0e35)"}),r.jsx("textarea",{value:I,onChange:e=>$(e.target.value),rows:3,placeholder:"\u0e2d\u0e18\u0e34\u0e1a\u0e32\u0e22\u0e23\u0e32\u0e22\u0e25\u0e30\u0e40\u0e2d\u0e35\u0e22\u0e14\u0e01\u0e32\u0e23\u0e17\u0e33\u0e07\u0e32\u0e19...",className:"w-full p-2 border rounded-md bg-white text-gray-900"})]}),r.jsx("div",{className:"flex justify-end pt-2",children:(0,r.jsxs)("button",{onClick:()=>(async e=>{if(h&&n){q(!0);try{const r=await n.getIdToken(),a=O.filter((e=>"success"===e.status));if(0===a.length)return u("warning","\u0e01\u0e23\u0e38\u0e13\u0e32\u0e41\u0e19\u0e1a\u0e44\u0e1f\u0e25\u0e4c","\u0e15\u0e49\u0e2d\u0e07\u0e41\u0e19\u0e1a\u0e44\u0e1f\u0e25\u0e4c\u0e1c\u0e25\u0e07\u0e32\u0e19\u0e2d\u0e22\u0e48\u0e32\u0e07\u0e19\u0e49\u0e2d\u0e22 1 \u0e44\u0e1f\u0e25\u0e4c"),void q(!1);const l={action:e,payload:{comments:I,files:a.map((e=>e.uploadedData))}},i=await fetch(`/api/work-request/${h.id}/update`,{method:"POST",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"},body:JSON.stringify(l)}),o=await i.json();if(!o.success)throw new Error(o.error);u("success","\u0e14\u0e33\u0e40\u0e19\u0e34\u0e19\u0e01\u0e32\u0e23\u0e2a\u0e33\u0e40\u0e23\u0e47\u0e08",`\u0e2a\u0e16\u0e32\u0e19\u0e30\u0e16\u0e39\u0e01\u0e40\u0e1b\u0e25\u0e35\u0e48\u0e22\u0e19\u0e40\u0e1b\u0e47\u0e19: ${P(o.newStatus).text}`),s(),t()}catch(r){u("error","\u0e40\u0e01\u0e34\u0e14\u0e02\u0e49\u0e2d\u0e1c\u0e34\u0e14\u0e1e\u0e25\u0e32\u0e14",r instanceof Error?r.message:"Unknown error")}finally{q(!1)}}})("SUBMIT_WORK"),disabled:0===O.filter((e=>"success"===e.status)).length||z,className:"flex items-center px-6 py-2 text-sm font-medium text-white bg-green-600 rounded-lg hover:bg-green-700 disabled:bg-green-300",children:[z?r.jsx(o.Z,{className:"w-5 h-5 mr-2"}):r.jsx(T.Z,{size:16,className:"mr-2"}),z?"\u0e01\u0e33\u0e25\u0e31\u0e07\u0e2a\u0e48\u0e07\u0e07\u0e32\u0e19...":"\u0e2a\u0e48\u0e07\u0e07\u0e32\u0e19\u0e43\u0e2b\u0e49 Site \u0e15\u0e23\u0e27\u0e08\u0e23\u0e31\u0e1a"]})})]}),me&&(0,r.jsxs)("div",{className:"space-y-4",children:[r.jsx("h3",{className:"text-lg font-bold text-slate-800",children:"\u0e2a\u0e23\u0e49\u0e32\u0e07\u0e40\u0e2d\u0e01\u0e2a\u0e32\u0e23\u0e09\u0e1a\u0e31\u0e1a\u0e41\u0e01\u0e49\u0e44\u0e02 (Create Revision)"}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,r.jsxs)("p",{children:[r.jsx("strong",{children:"\u0e40\u0e2d\u0e01\u0e2a\u0e32\u0e23\u0e40\u0e14\u0e34\u0e21:"})," ",h.documentNumber]}),(0,r.jsxs)("p",{children:[r.jsx("strong",{children:"\u0e40\u0e2d\u0e01\u0e2a\u0e32\u0e23\u0e43\u0e2b\u0e21\u0e48:"})," ",pe]})]}),(K||Y)&&(0,r.jsxs)("div",{className:"mb-4 p-3 rounded-md text-sm font-medium flex items-center border bg-white",children:[K&&(0,r.jsxs)(r.Fragment,{children:[r.jsx(o.Z,{className:"w-4 h-4 mr-3 text-gray-500"}),r.jsx("span",{className:"text-gray-600",children:"\u0e01\u0e33\u0e25\u0e31\u0e07\u0e15\u0e23\u0e27\u0e08\u0e2a\u0e2d\u0e1a Task \u0e43\u0e19\u0e23\u0e30\u0e1a\u0e1a BIM Tracking..."})]}),Y&&r.jsx("span",{className:"text-red-600 font-semibold",children:Y})]}),H&&(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["\u0e41\u0e19\u0e1a\u0e44\u0e1f\u0e25\u0e4c\u0e17\u0e35\u0e48\u0e41\u0e01\u0e49\u0e44\u0e02\u0e41\u0e25\u0e49\u0e27 ",r.jsx("span",{className:"text-red-700",children:"*"})]}),(0,r.jsxs)("div",{className:"border-2 border-dashed border-slate-300 rounded-lg p-4 text-center hover:border-blue-500 transition-colors",children:[r.jsx("input",{type:"file",multiple:!0,onChange:e=>fe(e,"revision"),id:"revision-file-upload",className:"hidden"}),(0,r.jsxs)("label",{htmlFor:"revision-file-upload",className:"cursor-pointer text-blue-600 hover:text-blue-800 font-medium flex items-center justify-center",children:[r.jsx(E.Z,{size:16,className:"mr-2"}),"\u0e04\u0e25\u0e34\u0e01\u0e40\u0e1e\u0e37\u0e48\u0e2d\u0e40\u0e25\u0e37\u0e2d\u0e01\u0e44\u0e1f\u0e25\u0e4c"]})]}),J.length>0&&Ce(J,"revision")]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"\u0e2b\u0e21\u0e32\u0e22\u0e40\u0e2b\u0e15\u0e38\u0e01\u0e32\u0e23\u0e41\u0e01\u0e49\u0e44\u0e02 (Optional)"}),r.jsx("textarea",{value:U,onChange:e=>L(e.target.value),placeholder:"\u0e40\u0e0a\u0e48\u0e19 \u0e41\u0e01\u0e49\u0e44\u0e02\u0e15\u0e32\u0e21 Comment \u0e08\u0e32\u0e01 CM...",className:"w-full p-2 border rounded-md text-sm bg-white text-gray-900",rows:2})]}),r.jsx("div",{className:"flex justify-end",children:(0,r.jsxs)("button",{onClick:async()=>{const e=J.filter((e=>"success"===e.status));if(0!==e.length)if(ee){q(!0);try{const r=await(n?.getIdToken()),a={originalDocId:h.id,uploadedFiles:e.map((e=>e.uploadedData)),comments:U,verifiedTaskId:ee},l=await fetch("/api/work-request/create_revision",{method:"POST",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"},body:JSON.stringify(a)}),i=await l.json();if(!i.success)throw new Error(i.error||"\u0e40\u0e01\u0e34\u0e14\u0e02\u0e49\u0e2d\u0e1c\u0e34\u0e14\u0e1e\u0e25\u0e32\u0e14\u0e43\u0e19\u0e01\u0e32\u0e23\u0e2a\u0e23\u0e49\u0e32\u0e07 Revision");u("success","\u0e2a\u0e23\u0e49\u0e32\u0e07 Revision \u0e2a\u0e33\u0e40\u0e23\u0e47\u0e08!",`\u0e40\u0e2d\u0e01\u0e2a\u0e32\u0e23\u0e09\u0e1a\u0e31\u0e1a\u0e43\u0e2b\u0e21\u0e48 ${i.newDocumentNumber} \u0e16\u0e39\u0e01\u0e2a\u0e48\u0e07\u0e43\u0e2b\u0e49 Site \u0e15\u0e23\u0e27\u0e08\u0e2a\u0e2d\u0e1a\u0e41\u0e25\u0e49\u0e27`),s(),t()}catch(r){u("error","\u0e40\u0e01\u0e34\u0e14\u0e02\u0e49\u0e2d\u0e1c\u0e34\u0e14\u0e1e\u0e25\u0e32\u0e14",r instanceof Error?r.message:"Unknown error")}finally{q(!1)}}else u("error","Task \u0e44\u0e21\u0e48\u0e16\u0e39\u0e01\u0e15\u0e49\u0e2d\u0e07","\u0e44\u0e21\u0e48\u0e1e\u0e1a Task ID \u0e17\u0e35\u0e48\u0e15\u0e23\u0e27\u0e08\u0e2a\u0e2d\u0e1a\u0e41\u0e25\u0e49\u0e27");else u("warning","\u0e01\u0e23\u0e38\u0e13\u0e32\u0e41\u0e19\u0e1a\u0e44\u0e1f\u0e25\u0e4c","\u0e15\u0e49\u0e2d\u0e07\u0e41\u0e19\u0e1a\u0e44\u0e1f\u0e25\u0e4c\u0e09\u0e1a\u0e31\u0e1a\u0e41\u0e01\u0e49\u0e44\u0e02\u0e2d\u0e22\u0e48\u0e32\u0e07\u0e19\u0e49\u0e2d\u0e22 1 \u0e44\u0e1f\u0e25\u0e4c")},disabled:z||0===J.filter((e=>"success"===e.status)).length||!H,className:"flex items-center px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed",children:[z?r.jsx(o.Z,{className:"w-4 h-4 mr-2"}):r.jsx(T.Z,{size:16,className:"mr-2"}),"\u0e2a\u0e48\u0e07\u0e40\u0e2d\u0e01\u0e2a\u0e32\u0e23\u0e09\u0e1a\u0e31\u0e1a\u0e41\u0e01\u0e49\u0e44\u0e02"]})})]})]})]})]})}),G&&r.jsx(M,{workflow:h.workflow||[],onClose:()=>B(!1)}),r.jsx(R.Z,{isOpen:!!ae,file:ae,allowEdit:xe||de||me,onClose:()=>le(null),onSave:async e=>{console.log("Annotated File Received:",e);let t="action";me&&(t="revision"),await Ne([e],t),u("success","\u0e1a\u0e31\u0e19\u0e17\u0e36\u0e01\u0e41\u0e25\u0e30\u0e41\u0e19\u0e1a\u0e44\u0e1f\u0e25\u0e4c\u0e40\u0e23\u0e35\u0e22\u0e1a\u0e23\u0e49\u0e2d\u0e22","\u0e44\u0e1f\u0e25\u0e4c\u0e17\u0e35\u0e48\u0e04\u0e38\u0e13\u0e41\u0e01\u0e49\u0e44\u0e02\u0e16\u0e39\u0e01\u0e41\u0e19\u0e1a\u0e43\u0e19\u0e23\u0e32\u0e22\u0e01\u0e32\u0e23\u0e40\u0e15\u0e23\u0e35\u0e22\u0e21\u0e2a\u0e48\u0e07\u0e41\u0e25\u0e49\u0e27"),le(null)}})]})}var z=s(80191);const q=(0,j.Z)("pen-tool",[["path",{d:"M15.707 21.293a1 1 0 0 1-1.414 0l-1.586-1.586a1 1 0 0 1 0-1.414l5.586-5.586a1 1 0 0 1 1.414 0l1.586 1.586a1 1 0 0 1 0 1.414z",key:"nt11vn"}],["path",{d:"m18 13-1.375-6.874a1 1 0 0 0-.746-.776L3.235 2.028a1 1 0 0 0-1.207 1.207L5.35 15.879a1 1 0 0 0 .776.746L13 18",key:"15qc1e"}],["path",{d:"m2.3 2.3 7.286 7.286",key:"1wuzzi"}],["circle",{cx:"11",cy:"11",r:"2",key:"xmgehs"}]]);var I=s(21405),$=s(83855),O=(s(67967),s(76),s(10842));const F=({isOpen:e,onClose:t,onSubmit:s,isSubmitting:l})=>{const[i,n]=(0,a.useState)(""),[c,d]=(0,a.useState)("");return e?r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 z-[70] flex items-center justify-center p-4",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center p-4 border-b",children:[r.jsx("h3",{className:"text-lg font-bold text-gray-800",children:"\u0e40\u0e2b\u0e15\u0e38\u0e1c\u0e25\u0e43\u0e19\u0e01\u0e32\u0e23\u0e44\u0e21\u0e48\u0e2d\u0e19\u0e38\u0e21\u0e31\u0e15\u0e34"}),r.jsx("button",{onClick:t,disabled:l,className:"text-gray-400 hover:text-gray-600 disabled:opacity-50",children:r.jsx(b.Z,{size:24})})]}),(0,r.jsxs)("div",{className:"p-6 space-y-4",children:[r.jsx("textarea",{value:i,onChange:e=>{n(e.target.value),d("")},rows:4,placeholder:"\u0e01\u0e23\u0e38\u0e13\u0e32\u0e23\u0e30\u0e1a\u0e38\u0e40\u0e2b\u0e15\u0e38\u0e1c\u0e25...",className:`w-full p-2 border rounded-md ${c?"border-red-500":"border-gray-300"} bg-white text-gray-900`,disabled:l}),c&&r.jsx("p",{className:"text-red-500 text-sm",children:c})]}),(0,r.jsxs)("div",{className:"flex justify-end gap-4 p-4 border-t bg-gray-50",children:[r.jsx("button",{onClick:t,disabled:l,className:"px-4 py-2 text-sm text-gray-700 bg-white border rounded-lg hover:bg-gray-100 disabled:opacity-50",children:"\u0e22\u0e01\u0e40\u0e25\u0e34\u0e01"}),(0,r.jsxs)("button",{onClick:()=>{i.trim()?s(i):d("\u0e01\u0e23\u0e38\u0e13\u0e32\u0e01\u0e23\u0e2d\u0e01\u0e40\u0e2b\u0e15\u0e38\u0e1c\u0e25")},disabled:l,className:"flex items-center px-4 py-2 text-sm text-white bg-red-600 rounded-lg hover:bg-red-700 disabled:bg-red-300",children:[l?r.jsx(o.Z,{className:"w-4 h-4 mr-2"}):r.jsx(x.Z,{size:16,className:"mr-2"}),"\u0e22\u0e37\u0e19\u0e22\u0e31\u0e19\u0e44\u0e21\u0e48\u0e2d\u0e19\u0e38\u0e21\u0e31\u0e15\u0e34"]})]})]})}):null};function G(){const{user:e,firebaseUser:t}=(0,i.a)(),[s,n]=((0,l.useRouter)(),(0,a.useState)([])),[c,u]=(0,a.useState)([]),[h,g]=(0,a.useState)(!0),[b,f]=(0,a.useState)(null),[j,y]=(0,a.useState)(!1),{showNotification:N}=(0,D.l)(),[w,v]=(0,a.useState)([]),[k,C]=(0,a.useState)(!1),[E,S]=(0,a.useState)(!1),[T,R]=(0,a.useState)(null),A=(0,a.useMemo)((()=>{if(0===c.length)return s;const e=new Map(c.map((e=>[e.id,e.name])));return s.map((t=>({...t,site:{id:t.site.id,name:e.get(t.site.id)||"Unknown Site"}})))}),[s,c]),Z=(0,a.useMemo)((()=>{if(!e)return!1;const t=`WR.${O.S4.WORK_REQUEST.CREATE}`,[s,r]=t.split("."),a=(O.yB[t]||[]).includes(e.role);return c.some((t=>{const l=t.userOverrides?.[e.id]?.[s]?.[r];return void 0!==l?!0===l:a}))}),[e,c]),P=(e&&m.c9.includes(e.role),e&&m.$p.includes(e.role)),M=(0,a.useCallback)((async(e,s)=>{const r=T?[T]:w;if(0!==r.length){C(!0);try{if(!t)throw new Error("\u0e01\u0e23\u0e38\u0e13\u0e32\u0e25\u0e47\u0e2d\u0e01\u0e2d\u0e34\u0e19\u0e01\u0e48\u0e2d\u0e19");const a=await t.getIdToken(),l=await fetch("/api/work-request/batch-update",{method:"POST",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"},body:JSON.stringify({ids:r,action:e,payload:{comments:s||""}})}),i=await l.json();if(!i.success)throw new Error(i.error||`\u0e40\u0e01\u0e34\u0e14\u0e02\u0e49\u0e2d\u0e1c\u0e34\u0e14\u0e1e\u0e25\u0e32\u0e14\u0e43\u0e19\u0e01\u0e32\u0e23 ${e}`);N("success","\u0e14\u0e33\u0e40\u0e19\u0e34\u0e19\u0e01\u0e32\u0e23\u0e2a\u0e33\u0e40\u0e23\u0e47\u0e08!",`${"APPROVE_DRAFT"===e?"\u0e2d\u0e19\u0e38\u0e21\u0e31\u0e15\u0e34":"\u0e44\u0e21\u0e48\u0e2d\u0e19\u0e38\u0e21\u0e31\u0e15\u0e34"} ${i.updatedCount} \u0e23\u0e32\u0e22\u0e01\u0e32\u0e23\u0e40\u0e23\u0e35\u0e22\u0e1a\u0e23\u0e49\u0e2d\u0e22\u0e41\u0e25\u0e49\u0e27`),v([]),S(!1),R(null)}catch(a){N("error","\u0e40\u0e01\u0e34\u0e14\u0e02\u0e49\u0e2d\u0e1c\u0e34\u0e14\u0e1e\u0e25\u0e32\u0e14",a instanceof Error?a.message:"Unknown error")}finally{C(!1)}}}),[t,w,T,N]),G=(0,a.useCallback)((async(e,s,r)=>{C(!0);try{if(!t)throw new Error("\u0e01\u0e23\u0e38\u0e13\u0e32\u0e25\u0e47\u0e2d\u0e01\u0e2d\u0e34\u0e19\u0e01\u0e48\u0e2d\u0e19");const a=await t.getIdToken(),l=await fetch(`/api/work-request/${s}/update`,{method:"POST",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"},body:JSON.stringify({action:e,payload:{comments:r||""}})}),i=await l.json();if(!i.success)throw new Error(i.error||`\u0e40\u0e01\u0e34\u0e14\u0e02\u0e49\u0e2d\u0e1c\u0e34\u0e14\u0e1e\u0e25\u0e32\u0e14\u0e43\u0e19\u0e01\u0e32\u0e23 ${e}`);N("success","\u0e14\u0e33\u0e40\u0e19\u0e34\u0e19\u0e01\u0e32\u0e23\u0e2a\u0e33\u0e40\u0e23\u0e47\u0e08!",`${"APPROVE_DRAFT"===e?"\u0e2d\u0e19\u0e38\u0e21\u0e31\u0e15\u0e34":"\u0e44\u0e21\u0e48\u0e2d\u0e19\u0e38\u0e21\u0e31\u0e15\u0e34"}\u0e40\u0e2d\u0e01\u0e2a\u0e32\u0e23\u0e40\u0e23\u0e35\u0e22\u0e1a\u0e23\u0e49\u0e2d\u0e22\u0e41\u0e25\u0e49\u0e27`),S(!1),R(null)}catch(a){N("error","\u0e40\u0e01\u0e34\u0e14\u0e02\u0e49\u0e2d\u0e1c\u0e34\u0e14\u0e1e\u0e25\u0e32\u0e14",a instanceof Error?a.message:"Unknown error")}finally{C(!1)}}),[t,N]);return(0,r.jsxs)("div",{className:"max-w-screen-2xl mx-auto flex flex-col h-full",children:[r.jsx("div",{children:(0,r.jsxs)("div",{className:"mb-6 flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("h1",{className:"text-2xl lg:text-3xl font-bold text-gray-900 flex items-center gap-3",children:[r.jsx(q,{className:"text-orange-600",size:32}),"Work Requests"]}),r.jsx("p",{className:"text-gray-600 mt-1",children:"\u0e23\u0e32\u0e22\u0e01\u0e32\u0e23\u0e04\u0e33\u0e23\u0e49\u0e2d\u0e07\u0e02\u0e2d\u0e07\u0e32\u0e19\u0e17\u0e31\u0e49\u0e07\u0e2b\u0e21\u0e14 (Real-time)"})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-3 mt-4 sm:mt-0",children:[(0,r.jsxs)("button",{className:"flex items-center px-3 py-2 bg-gray-100 text-gray-700 rounded-lg cursor-default",disabled:!0,children:[r.jsx(I.Z,{className:"w-4 h-4 mr-2 "+(h?"animate-spin":"")}),"Real-time Sync"]}),Z&&(0,r.jsxs)("button",{onClick:()=>y(!0),className:"flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[r.jsx($.Z,{className:"w-4 h-4 mr-2"}),"\u0e2a\u0e23\u0e49\u0e32\u0e07 Work Request"]})]})]})}),P&&(0,r.jsxs)("div",{className:"bg-white p-3 rounded-lg shadow border border-gray-200 flex items-center space-x-3",children:[(0,r.jsxs)("span",{className:"text-sm font-medium text-gray-700",children:["\u0e23\u0e32\u0e22\u0e01\u0e32\u0e23\u0e17\u0e35\u0e48\u0e40\u0e25\u0e37\u0e2d\u0e01 (",w.length,"):"]}),(0,r.jsxs)("button",{onClick:()=>{0!==w.length&&M("APPROVE_DRAFT")},disabled:0===w.length||k,className:"flex items-center px-3 py-1.5 text-xs font-medium text-white bg-green-600 rounded-md hover:bg-green-700 disabled:bg-gray-300 disabled:cursor-not-allowed",children:[k?r.jsx(o.Z,{className:"w-4 h-4 mr-1"}):r.jsx(d.Z,{size:14,className:"mr-1"})," \u0e2d\u0e19\u0e38\u0e21\u0e31\u0e15\u0e34"]}),(0,r.jsxs)("button",{onClick:()=>{0!==w.length&&(R(null),S(!0))},disabled:0===w.length||k,className:"flex items-center px-3 py-1.5 text-xs font-medium text-white bg-red-600 rounded-md hover:bg-red-700 disabled:bg-gray-300 disabled:cursor-not-allowed",children:[k?r.jsx(o.Z,{className:"w-4 h-4 mr-1"}):r.jsx(x.Z,{size:14,className:"mr-1"})," \u0e44\u0e21\u0e48\u0e2d\u0e19\u0e38\u0e21\u0e31\u0e15\u0e34"]}),k&&r.jsx("span",{className:"text-xs text-gray-500 italic",children:"\u0e01\u0e33\u0e25\u0e31\u0e07\u0e14\u0e33\u0e40\u0e19\u0e34\u0e19\u0e01\u0e32\u0e23..."})]}),r.jsx("div",{className:"flex-1 min-h-0",children:r.jsx(p,{documents:A,isLoading:h,onDocumentClick:e=>{f(e.id)},selectedIds:w,onSelectionChange:v,onApproveRejectClick:(e,t)=>{"APPROVE_DRAFT"===e?(e=>{G("APPROVE_DRAFT",e)})(t):"REJECT_DRAFT"===e&&(e=>{R(e),S(!0)})(t)}})}),b&&r.jsx(_,{documentId:b,onClose:()=>{f(null)},onUpdate:()=>{}}),j&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 z-50 flex items-center justify-center p-4",children:r.jsx("div",{className:"w-full max-w-4xl bg-white rounded-lg shadow-xl p-6",children:r.jsx(z.Z,{onClose:()=>{y(!1)},userProp:e||void 0})})}),r.jsx(F,{isOpen:E,onClose:()=>{S(!1),R(null)},onSubmit:T?e=>{T&&G("REJECT_DRAFT",T,e)}:e=>{M("REJECT_DRAFT",e)},isSubmitting:k})]})}function B(){return r.jsx(n.AuthGuard,{requiredRoles:[m.K$.ADMIN,m.K$.SITE_ADMIN,m.K$.BIM,...m.c9,...m.$p],children:r.jsx(a.Suspense,{fallback:r.jsx("div",{className:"text-center p-8",children:"Loading Page..."}),children:r.jsx(G,{})})})}},32848:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>r});const r=(0,s(68570).createProxy)(String.raw`D:\ttsdoc-v2\src\app\dashboard\work-request\page.tsx#default`)}};var t=require("../../../webpack-runtime.js");t.C(e);var s=t.X(0,[9276,4637,3881,2574,3706,8077,3431,191],(()=>{return e=3477,t(t.s=e);var e}));module.exports=s})();