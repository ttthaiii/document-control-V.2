"use strict";exports.id=607,exports.ids=[607],exports.modules={32933:(e,s,t)=>{t.d(s,{Z:()=>a});let a=(0,t(62881).Z)("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]])},77506:(e,s,t)=>{t.d(s,{Z:()=>a});let a=(0,t(62881).Z)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},50949:(e,s,t)=>{t.d(s,{Z:()=>a});let a=(0,t(62881).Z)("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},86607:(e,s,t)=>{t.r(s),t.d(s,{default:()=>M});var a=t(10326),l=t(17577),r=t(35047);t(76),t(67967);var i=t(28882),n=t(62881);let d=(0,n.Z)("history",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);var c=t(94019),o=t(36283),m=t(77506);let x=(0,n.Z)("paperclip",[["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 2.829 2.829l8.414-8.586a4 4 0 1 0-5.657-5.657l-8.379 8.551a6 6 0 1 0 8.485 8.485l8.379-8.551",key:"1miecu"}]]),h=(0,n.Z)("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]),u=(0,n.Z)("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]]);var p=t(32933),g=t(50949);let b=(0,n.Z)("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]),f=(0,n.Z)("pen-line",[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]),j=(0,n.Z)("thumbs-up",[["path",{d:"M7 10v12",key:"1qc93n"}],["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2a3.13 3.13 0 0 1 3 3.88Z",key:"emmmcr"}]]),N=(0,n.Z)("message-square",[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]]),y=(0,n.Z)("thumbs-down",[["path",{d:"M17 14V2",key:"8ymqnk"}],["path",{d:"M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22a3.13 3.13 0 0 1-3-3.88Z",key:"m61m77"}]]);var v=t(62665),w=t(7619);let k=e=>e?new Date(e).toLocaleString("th-TH",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A",Z=e=>{if(0===e)return"0 B";let s=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,s)).toFixed(1))+" "+["B","KB","MB","GB"][s]},E=({workflow:e,onClose:s,userRole:t})=>{let r=(0,l.useMemo)(()=>{if(t&&w.gf.includes(t)){let s=[w.n$.PENDING_REVIEW,w.n$.REVISION_REQUIRED];return e.filter(e=>!s.includes(e.status))}return e},[e,t]);return a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 z-[60] flex items-center justify-center p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[80vh] flex flex-col",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center p-4 border-b",children:[(0,a.jsxs)("h3",{className:"text-lg font-bold text-gray-800 flex items-center",children:[a.jsx(d,{size:20,className:"mr-2"}),"ประวัติการดำเนินงาน"]}),a.jsx("button",{onClick:s,className:"text-gray-400 hover:text-gray-600",children:a.jsx(c.Z,{size:24})})]}),a.jsx("div",{className:"p-6 overflow-y-auto",children:a.jsx("div",{className:"border-l-2 border-gray-200 ml-2",children:r.length>0?r.map((e,s)=>(0,a.jsxs)("div",{className:"relative pl-6 pb-8 last:pb-0",children:[a.jsx("div",{className:"absolute -left-[9px] top-1 w-4 h-4 bg-blue-500 rounded-full border-2 border-white"}),a.jsx("p",{className:"font-semibold text-gray-800",children:w.NK[e.status]||e.status}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:["โดย: ",e.userName," (",e.role,")"]}),a.jsx("time",{className:"text-xs text-gray-400",children:k(e.timestamp)}),e.comments&&a.jsx("div",{className:"mt-2 p-2 bg-gray-50 rounded-md text-xs italic",children:(0,a.jsxs)("p",{className:"text-gray-600",children:['"',e.comments,'"']})}),e.files&&e.files.length>0&&(0,a.jsxs)("div",{className:"mt-2 pl-2 border-l-2 border-gray-100",children:[a.jsx("p",{className:"text-xs font-semibold text-gray-500 mb-1",children:"ไฟล์แนบ ณ ขั้นตอนนี้:"}),a.jsx("ul",{className:"space-y-1",children:e.files.map((e,s)=>(0,a.jsxs)("li",{className:"flex items-center text-xs text-gray-600",children:[a.jsx(o.Z,{size:12,className:"mr-2 flex-shrink-0"}),a.jsx("a",{href:e.fileUrl,target:"_blank",rel:"noopener noreferrer",className:"truncate hover:underline",title:e.fileName,children:e.fileName})]},s))})]})]},s)):a.jsx("p",{className:"text-sm text-gray-500 pl-6",children:"ไม่มีประวัติ"})})})]})})};function C({document:e,onClose:s,onUpdate:t,showOverlay:r=!0}){let{user:i,firebaseUser:n}=(0,v.a)(),[k,C]=(0,l.useState)(e),[z,S]=(0,l.useState)(!0),[M,R]=(0,l.useState)(!1),[I,T]=(0,l.useState)(!1),[O,$]=(0,l.useState)(""),[D,A]=(0,l.useState)([]),[P,V]=(0,l.useState)(""),[_,B]=(0,l.useState)([]),F=(0,l.useMemo)(()=>k?.workflow&&0!==k.workflow.length?[...k.workflow].reverse().find(e=>e.comments&&""!==e.comments.trim()):null,[k?.workflow]);if(z)return a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center",children:a.jsx(m.Z,{className:"w-12 h-12 text-white animate-spin"})});if(!k)return null;let U=k.permissions||{},H=k.files||[],L=k.createdBy===i?.id,q=k.status===w.n$.REVISION_REQUIRED&&L,J=k.status===w.n$.REJECTED&&L&&k.isLatest,Q=(k.revisionNumber||0)+1,K=`${k.documentNumber.split("-REV")[0]}-REV${String(Q).padStart(2,"0")}`,G=F?.comments||k.description,W=F?`ความคิดเห็นล่าสุด`:"รายละเอียดเพิ่มเติม",X=async e=>{try{if(!n)throw Error("กรุณาล็อกอินก่อนอัปโหลดไฟล์");let s=await n.getIdToken(),t=new FormData;t.append("file",e);let a=await fetch("/api/rfa/upload-temp-file",{method:"POST",headers:{Authorization:`Bearer ${s}`},body:t}),l=await a.json();if(l.success)return{status:"success",progress:100,uploadedData:l.fileData};throw Error(l.error||"อัปโหลดล้มเหลว")}catch(e){return{status:"error",error:e instanceof Error?e.message:"เกิดข้อผิดพลาด"}}},Y=(e,s)=>{let t=Array.from(e.target.files||[]);if(!t.length)return;let a=t.map(e=>({id:`${e.name}-${Date.now()}`,file:e,status:"pending",progress:0})),l="revision"===s?B:A;l(e=>[...e,...a]),a.forEach(async e=>{l(s=>s.map(s=>s.id===e.id?{...s,status:"uploading"}:s));let s=await X(e.file);l(t=>t.map(t=>t.id===e.id?{...t,...s}:t))}),e.target.value=""},ee=async(e,s)=>{let t=("revision"===s?_:D)[e];if("success"===t.status&&t.uploadedData?.filePath)try{let e=await n?.getIdToken();await fetch("/api/rfa/delete-temp-file",{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({filePath:t.uploadedData.filePath})})}catch(e){console.error("Failed to delete temp file:",e)}("revision"===s?B:A)(s=>s.filter((s,t)=>t!==e))},es=async e=>{let t=D.filter(e=>"success"===e.status);if(0===t.length){alert("กรุณาแนบไฟล์ใหม่สำหรับขั้นตอนนี้ก่อนดำเนินการ");return}R(!0);try{let a=await n?.getIdToken(),l={action:e,comments:O,newFiles:t.map(e=>e.uploadedData)},r=await fetch(`/api/rfa/${k.id}`,{method:"PUT",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"},body:JSON.stringify(l)}),i=await r.json();if(i.success)alert(`ดำเนินการ "${e}" สำเร็จ!`),s();else throw Error(i.error||"เกิดข้อผิดพลาด")}catch(e){alert(`เกิดข้อผิดพลาด: ${e instanceof Error?e.message:"Unknown error"}`)}finally{R(!1)}},et=async()=>{let e=_.filter(e=>"success"===e.status);if(0===e.length){alert("กรุณาแนบไฟล์ฉบับแก้ไขอย่างน้อย 1 ไฟล์");return}R(!0);try{let t=await n?.getIdToken(),a={originalDocId:k.id,uploadedFiles:e.map(e=>e.uploadedData),comments:P},l=await fetch("/api/rfa/create_revision",{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify(a)}),r=await l.json();if(r.success)alert(`สร้างเอกสารฉบับแก้ไข ${K} สำเร็จ!`),s();else throw Error(r.error||"เกิดข้อผิดพลาดในการสร้าง Revision")}catch(e){alert(`เกิดข้อผิดพลาด: ${e instanceof Error?e.message:"Unknown error"}`)}finally{R(!1)}},ea=async()=>{await es("SUBMIT_REVISION")};return(0,a.jsxs)(a.Fragment,{children:[a.jsx("div",{className:`fixed inset-0 z-50 flex items-center justify-center p-4 ${r?"bg-black bg-opacity-50":""}`,children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] flex flex-col",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center p-4 border-b",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsxs)("div",{children:[a.jsx("h3",{className:"text-lg font-bold text-blue-600",children:k.runningNumber||"RFA Document"}),a.jsx("p",{className:"text-sm text-gray-500",children:k.documentNumber})]}),(0,a.jsxs)("button",{onClick:()=>T(!0),className:"flex items-center text-sm text-gray-500 hover:text-blue-600",children:[a.jsx(d,{size:16,className:"mr-1"})," ดูประวัติ"]})]}),a.jsx("button",{onClick:s,className:"text-gray-400 hover:text-gray-600",children:a.jsx(c.Z,{size:24})})]}),(0,a.jsxs)("div",{className:"p-6 overflow-y-auto space-y-6",children:[(0,a.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg",children:[a.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-2",children:k.title}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[(0,a.jsxs)("div",{children:[a.jsx("strong",{className:"text-gray-500 block",children:"สถานะ:"}),a.jsx("span",{className:"font-semibold",children:w.NK[k.status]||k.status})]}),(0,a.jsxs)("div",{children:[a.jsx("strong",{className:"text-gray-500 block",children:"หมวดงาน:"}),a.jsx("span",{children:k.category.categoryCode})]})]}),G&&""!==G.trim()&&(0,a.jsxs)("div",{className:"mt-4",children:[(0,a.jsxs)("strong",{className:"text-gray-500 block text-sm",children:[W,":"]}),a.jsx("div",{className:"text-gray-700 whitespace-pre-wrap bg-white p-3 rounded-md mt-1 border",children:(0,a.jsxs)("p",{className:"italic",children:['"',G,'"']})})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("h4",{className:"text-md font-semibold mb-2 flex items-center",children:[a.jsx(x,{size:16,className:"mr-2"})," ไฟล์แนบ (ฉบับล่าสุด) (",H.length,")"]}),a.jsx("ul",{className:"space-y-2",children:H.length>0?H.map((e,s)=>(0,a.jsxs)("li",{className:"flex items-center justify-between bg-gray-50 p-2 rounded-md",children:[(0,a.jsxs)("div",{className:"flex items-center min-w-0",children:[a.jsx(o.Z,{className:"w-5 h-5 text-gray-500 mr-3 flex-shrink-0"}),(0,a.jsxs)("div",{className:"flex flex-col min-w-0",children:[a.jsx("span",{className:"text-sm font-medium text-gray-800 truncate",children:e.fileName}),a.jsx("span",{className:"text-xs text-gray-500",children:Z(e.size)})]})]}),a.jsx("a",{href:e.fileUrl,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 p-2 rounded-full hover:bg-blue-100 flex-shrink-0 ml-2",children:a.jsx(h,{size:18})})]},s)):a.jsx("p",{className:"text-sm text-gray-500",children:"ไม่มีไฟล์แนบในฉบับล่าสุด"})})]})]}),(0,a.jsxs)("div",{className:"p-4 border-t bg-gray-50 rounded-b-lg",children:[q&&(0,a.jsxs)("div",{className:"space-y-4",children:[a.jsx("h3",{className:"text-lg font-bold text-blue-800",children:"ส่งเอกสารที่แก้ไข (Submit Revision)"}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"แสดงความคิดเห็น (Optional)"}),a.jsx("textarea",{value:O,onChange:e=>$(e.target.value),placeholder:"เพิ่มความคิดเห็น/เหตุผลประกอบ...",className:"w-full p-2 border rounded-md text-sm",rows:2})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"แนบไฟล์ที่แก้ไขแล้ว (จำเป็น)"}),(0,a.jsxs)("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-4 text-center hover:border-blue-500 transition-colors",children:[a.jsx("input",{type:"file",multiple:!0,onChange:e=>Y(e,"resubmission"),className:"hidden",id:"resubmit-file-upload"}),(0,a.jsxs)("label",{htmlFor:"resubmit-file-upload",className:"cursor-pointer text-blue-600 hover:text-blue-800 font-medium flex items-center justify-center",children:[a.jsx(u,{size:16,className:"mr-2"}),"คลิกเพื่อเลือกไฟล์"]})]}),a.jsx("div",{className:"mt-2 space-y-2",children:D.map((e,s)=>(0,a.jsxs)("div",{className:"flex items-center text-sm p-2 bg-gray-100 rounded",children:[a.jsx(o.Z,{className:"w-4 h-4 mr-2 text-gray-500"}),a.jsx("span",{className:"flex-1 truncate",children:e.file.name}),"uploading"===e.status&&a.jsx(m.Z,{className:"w-4 h-4 animate-spin text-blue-500"}),"success"===e.status&&a.jsx(p.Z,{className:"w-4 h-4 text-green-500"}),"error"===e.status&&a.jsx("span",{title:e.error,children:a.jsx(g.Z,{className:"w-4 h-4 text-red-500"})}),a.jsx("button",{onClick:()=>ee(s,"resubmission"),className:"ml-2 text-gray-500 hover:text-red-600",children:a.jsx(c.Z,{size:16})})]},e.id))})]}),a.jsx("div",{className:"flex justify-end",children:(0,a.jsxs)("button",{onClick:ea,disabled:M||0===D.filter(e=>"success"===e.status).length,className:"flex items-center px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 disabled:bg-gray-300",children:[M?a.jsx(m.Z,{className:"animate-spin mr-2"}):a.jsx(b,{size:16,className:"mr-2"}),"ส่งกลับไปตรวจสอบ"]})})]}),k.status===w.n$.REJECTED&&!k.isLatest&&(0,a.jsxs)("div",{className:"p-4 bg-red-50 text-red-800 rounded-lg flex items-center",children:[a.jsx(g.Z,{size:24,className:"mr-3 flex-shrink-0 text-red-600"}),(0,a.jsxs)("div",{children:[a.jsx("h4",{className:"font-bold",children:"เอกสารฉบับนี้ถูกแทนที่แล้ว"}),(0,a.jsxs)("p",{className:"text-sm text-red-700",children:["ได้มีการสร้างเอกสารฉบับใหม่ ",(0,a.jsxs)("strong",{children:["(REV-",String((k.revisionNumber||0)+1).padStart(2,"0"),")"]})," จากเอกสารฉบับนี้แล้ว"]})]})]}),J&&(0,a.jsxs)("div",{className:"p-4 border-t bg-yellow-50 rounded-b-lg",children:[a.jsx("h3",{className:"text-lg font-bold text-yellow-800 mb-4",children:"สร้างเอกสารฉบับแก้ไข (Create New Revision)"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,a.jsxs)("p",{children:[a.jsx("strong",{children:"เอกสารเดิม:"})," ",k.documentNumber]}),(0,a.jsxs)("p",{children:[a.jsx("strong",{children:"เอกสารใหม่:"})," ",K]})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"แนบไฟล์ที่แก้ไขแล้ว (จำเป็น)"}),(0,a.jsxs)("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-4 text-center hover:border-blue-500 transition-colors",children:[a.jsx("input",{type:"file",multiple:!0,onChange:e=>Y(e,"revision"),className:"hidden",id:"revision-file-upload"}),(0,a.jsxs)("label",{htmlFor:"revision-file-upload",className:"cursor-pointer text-blue-600 hover:text-blue-800 font-medium flex items-center justify-center",children:[a.jsx(u,{size:16,className:"mr-2"}),"คลิกเพื่อเลือกไฟล์"]})]}),a.jsx("div",{className:"mt-2 space-y-2",children:_.map((e,s)=>(0,a.jsxs)("div",{className:"flex items-center text-sm p-2 bg-gray-100 rounded",children:[a.jsx(o.Z,{className:"w-4 h-4 mr-2 text-gray-500"}),a.jsx("span",{className:"flex-1 truncate",children:e.file.name}),"uploading"===e.status&&a.jsx(m.Z,{className:"w-4 h-4 animate-spin text-blue-500"}),"success"===e.status&&a.jsx(p.Z,{className:"w-4 h-4 text-green-500"}),"error"===e.status&&a.jsx("span",{title:e.error,children:a.jsx(g.Z,{className:"w-4 h-4 text-red-500"})}),a.jsx("button",{onClick:()=>ee(s,"revision"),className:"ml-2 text-gray-500 hover:text-red-600",children:a.jsx(c.Z,{size:16})})]},e.id))})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"หมายเหตุการแก้ไข (Optional)"}),a.jsx("textarea",{value:P,onChange:e=>V(e.target.value),placeholder:"เช่น แก้ไขตาม Comment จาก CM...",className:"w-full p-2 border rounded-md text-sm",rows:2})]}),a.jsx("div",{className:"flex justify-end",children:(0,a.jsxs)("button",{onClick:et,disabled:M||0===_.filter(e=>"success"===e.status).length,className:"flex items-center px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 disabled:bg-gray-300",children:[M?a.jsx(m.Z,{className:"animate-spin mr-2"}):a.jsx(b,{size:16,className:"mr-2"}),"ส่งเอกสารฉบับแก้ไข"]})})]})]}),!J&&!q&&(U.canSendToCm||U.canApprove)&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[a.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"แสดงความคิดเห็น (Optional)"}),a.jsx("textarea",{value:O,onChange:e=>$(e.target.value),placeholder:"เพิ่มความคิดเห็น/เหตุผลประกอบ...",className:"w-full p-2 border rounded-md text-sm",rows:2})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"แนบไฟล์ใหม่ (จำเป็น)"}),(0,a.jsxs)("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-4 text-center hover:border-blue-500 transition-colors",children:[a.jsx("input",{type:"file",multiple:!0,onChange:e=>Y(e,"action"),className:"hidden",id:"action-file-upload"}),(0,a.jsxs)("label",{htmlFor:"action-file-upload",className:"cursor-pointer text-blue-600 hover:text-blue-800 font-medium flex items-center justify-center",children:[a.jsx(u,{size:16,className:"mr-2"}),"คลิกเพื่อเลือกไฟล์"]})]}),a.jsx("div",{className:"mt-2 space-y-2",children:D.map((e,s)=>(0,a.jsxs)("div",{className:"flex items-center text-sm p-2 bg-gray-100 rounded",children:[a.jsx(o.Z,{className:"w-4 h-4 mr-2 text-gray-500"}),a.jsx("span",{className:"flex-1 truncate",children:e.file.name}),"uploading"===e.status&&a.jsx(m.Z,{className:"w-4 h-4 animate-spin text-blue-500"}),"success"===e.status&&a.jsx(p.Z,{className:"w-4 h-4 text-green-500"}),"error"===e.status&&a.jsx("span",{title:e.error,children:a.jsx(g.Z,{className:"w-4 h-4 text-red-500"})}),a.jsx("button",{onClick:()=>ee(s,"action"),className:"ml-2 text-gray-500 hover:text-red-600",children:a.jsx(c.Z,{size:16})})]},e.id))})]}),U.canSendToCm&&(0,a.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,a.jsxs)("button",{onClick:()=>es("REQUEST_REVISION"),disabled:M||0===D.filter(e=>"success"===e.status).length,className:"flex items-center px-4 py-2 text-sm font-medium text-white bg-yellow-500 rounded-lg hover:bg-yellow-600 disabled:bg-gray-300",children:[a.jsx(f,{size:16,className:"mr-2"}),"ขอแก้ไข"]}),(0,a.jsxs)("button",{onClick:()=>es("SEND_TO_CM"),disabled:M||0===D.filter(e=>"success"===e.status).length,className:"flex items-center px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 disabled:bg-gray-300",children:[a.jsx(b,{size:16,className:"mr-2"}),"ส่งให้ CM"]})]}),U.canApprove&&(0,a.jsxs)("div",{className:"flex flex-wrap justify-end gap-3",children:[(0,a.jsxs)("button",{onClick:()=>es("APPROVE"),disabled:M||0===D.filter(e=>"success"===e.status).length,className:"flex items-center px-4 py-2 text-sm font-medium text-white bg-green-600 rounded-lg hover:bg-green-700 disabled:bg-gray-300",children:[a.jsx(j,{size:16,className:"mr-2"}),"อนุมัติ (Approve)"]}),(0,a.jsxs)("button",{onClick:()=>es("APPROVE_WITH_COMMENTS"),disabled:M||0===D.filter(e=>"success"===e.status).length,className:"flex items-center px-4 py-2 text-sm font-medium text-white bg-teal-600 rounded-lg hover:bg-teal-700 disabled:bg-gray-300",children:[a.jsx(N,{size:16,className:"mr-2"}),"อนุมัติตามคอมเมนต์"]}),(0,a.jsxs)("button",{onClick:()=>es("APPROVE_REVISION_REQUIRED"),disabled:M||0===D.filter(e=>"success"===e.status).length,className:"flex items-center px-4 py-2 text-sm font-medium text-white bg-orange-500 rounded-lg hover:bg-orange-600 disabled:bg-gray-300",children:[a.jsx(f,{size:16,className:"mr-2"}),"อนุมัติแต่ต้องแก้ไข"]}),(0,a.jsxs)("button",{onClick:()=>es("REJECT"),disabled:M||0===D.filter(e=>"success"===e.status).length,className:"flex items-center px-4 py-2 text-sm font-medium text-white bg-red-600 rounded-lg hover:bg-red-700 disabled:bg-gray-300",children:[a.jsx(y,{size:16,className:"mr-2"}),"ไม่อนุมัติ (Reject)"]})]})]})]})]})}),I&&a.jsx(E,{workflow:k.workflow||[],onClose:()=>T(!1),userRole:i?.role})]})}var z=t(32875);function S(){let e=(0,r.useRouter)(),s=(0,r.useParams)(),[t,n]=(0,l.useState)(null),[d,c]=(0,l.useState)(!0),[o,m]=(0,l.useState)(null);return s.id,a.jsx(i.Z,{children:a.jsx(C,{document:t,onClose:()=>e.back(),onUpdate:e=>n(e)})})}function M(){return a.jsx(l.Suspense,{fallback:a.jsx("div",{children:"Loading Page..."}),children:a.jsx(z.a1,{children:a.jsx(S,{})})})}}};