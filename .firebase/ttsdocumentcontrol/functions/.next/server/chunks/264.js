exports.id=264,exports.ids=[264],exports.modules={31635:(e,t,s)=>{Promise.resolve().then(s.t.bind(s,12994,23)),Promise.resolve().then(s.t.bind(s,96114,23)),Promise.resolve().then(s.t.bind(s,9727,23)),Promise.resolve().then(s.t.bind(s,79671,23)),Promise.resolve().then(s.t.bind(s,41868,23)),Promise.resolve().then(s.t.bind(s,84759,23))},5072:(e,t,s)=>{Promise.resolve().then(s.bind(s,62665))},28882:(e,t,s)=>{"use strict";s.d(t,{Z:()=>N});var r=s(10326),a=s(17577),n=s(62665),l=s(90434),i=s(35047),o=s(94019),d=s(26754),c=s(36283),x=s(941),m=s(39183),h=s(36728),u=s(67048),g=s(71810),b=s(7619);let f=({isOpen:e,onToggle:t})=>{let s=(0,i.usePathname)(),f=(0,i.useRouter)(),p=(0,i.useSearchParams)(),{user:j,logout:y}=(0,n.a)(),[N,v]=(0,a.useState)(!1),[E,D]=(0,a.useState)([]),P=()=>!!j&&[...b.uc,...b.oU,...b.gf,"Admin"].includes(j.role);(0,a.useEffect)(()=>{let e=async()=>{if(j?.sites&&0!==j.sites.length)try{let e=j.sites.map((e,t)=>({id:e,name:`Site ${t+1}`}));D(e)}catch(e){console.error("Error fetching sites:",e)}};j&&e()},[j]),(0,a.useEffect)(()=>{(s.includes("/rfa")||s.includes("/dashboard/rfa"))&&v(!0)},[s]);let R=async()=>{try{await y(),f.push("/")}catch(e){console.error("Logout error:",e)}},w=e=>s===e||s.startsWith(e+"/");return j?(0,r.jsxs)(r.Fragment,{children:[e&&r.jsx("div",{className:"lg:hidden fixed inset-0 bg-black bg-opacity-50 z-30",onClick:t}),(0,r.jsxs)("div",{className:`
        fixed inset-y-0 left-0 z-40
        w-64 bg-gradient-to-b from-amber-50 to-orange-50
        border-r border-orange-200
        transform transition-transform duration-300 ease-in-out
        ${e?"translate-x-0":"-translate-x-full"}
        flex flex-col h-screen pt-16
      `,children:[(0,r.jsxs)("div",{className:"bg-gradient-to-r from-orange-600 to-orange-700 text-white p-4 lg:p-6",children:[r.jsx("div",{className:"lg:hidden flex justify-end mb-2",children:r.jsx("button",{onClick:t,className:"p-1 rounded-md hover:bg-white hover:bg-opacity-20",children:r.jsx(o.Z,{size:20})})}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsxs)("h3",{className:"font-semibold text-lg truncate",children:["Welcome ",j.email?.split("@")[0]]}),(0,r.jsxs)("p",{className:"text-orange-100 text-sm",children:["Role: ",j.role]}),E.length>0&&(0,r.jsxs)("p",{className:"text-orange-100 text-xs truncate",children:["Site: ",E.map(e=>e.name).join(", ")]})]})]}),(0,r.jsxs)("nav",{className:"flex-1 p-4 space-y-2 overflow-y-auto",children:[(0,r.jsxs)(l.default,{href:"/dashboard",className:`
              flex items-center px-3 py-2 rounded-lg transition-colors
              ${w("/dashboard")&&"/dashboard"===s?"bg-blue-100 text-blue-700":"text-gray-700 hover:bg-gray-100"}
            `,children:[r.jsx(d.Z,{className:"w-5 h-5 mr-3"}),"Dashboard"]}),P()&&(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsxs)("button",{onClick:()=>{v(!N)},className:`
                  w-full flex items-center justify-between gap-3 px-3 py-2.5 rounded-lg text-sm font-medium
                  transition-colors duration-200
                  ${s.startsWith("/dashboard/rfa")||s.startsWith("/rfa/")?"bg-orange-200 text-orange-900":"text-gray-700 hover:bg-orange-100 hover:text-orange-800"}
                `,children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[r.jsx(c.Z,{size:18}),r.jsx("span",{children:"RFA Documents"})]}),N?r.jsx(x.Z,{size:16}):r.jsx(m.Z,{size:16})]}),N&&(0,r.jsxs)("div",{className:"ml-6 space-y-1 border-l-2 border-orange-200 pl-4",children:[(0,r.jsxs)(l.default,{href:"/dashboard/rfa?type=RFA-SHOP",className:`
                      flex items-center gap-3 px-3 py-2 rounded-md text-sm
                      transition-colors duration-200
                      ${"/dashboard/rfa"===s&&"RFA-SHOP"===p.get("type")?"bg-blue-100 text-blue-900 font-medium":"text-gray-600 hover:bg-gray-100 hover:text-gray-800"}
                    `,children:[r.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),r.jsx("span",{children:"\uD83C\uDFD7️ Shop Drawing"})]}),(0,r.jsxs)(l.default,{href:"/dashboard/rfa?type=RFA-GEN",className:`
                      flex items-center gap-3 px-3 py-2 rounded-md text-sm
                      transition-colors duration-200
                      ${"/dashboard/rfa"===s&&"RFA-GEN"===p.get("type")?"bg-green-100 text-green-900 font-medium":"text-gray-600 hover:bg-gray-100 hover:text-gray-800"}
                    `,children:[r.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),r.jsx("span",{children:"\uD83D\uDCCB General"})]}),(0,r.jsxs)(l.default,{href:"/dashboard/rfa?type=RFA-MAT",className:`
                      flex items-center gap-3 px-3 py-2 rounded-md text-sm
                      transition-colors duration-200
                      ${"/dashboard/rfa"===s&&"RFA-MAT"===p.get("type")?"bg-orange-100 text-orange-900 font-medium":"text-gray-600 hover:bg-gray-100 hover:text-gray-800"}
                    `,children:[r.jsx("div",{className:"w-2 h-2 bg-orange-500 rounded-full"}),r.jsx("span",{children:"\uD83E\uDDF1 Material"})]})]})]}),P()&&(0,r.jsxs)(l.default,{href:"/rfi",className:`
                flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium
                transition-colors duration-200
                ${w("/rfi")?"bg-orange-200 text-orange-900":"text-gray-700 hover:bg-orange-100 hover:text-orange-800"}
              `,children:[r.jsx(h.Z,{size:18}),r.jsx("span",{children:"RFI"})]}),(0,r.jsxs)(l.default,{href:"/work-request",className:`
              flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium
              transition-colors duration-200
              ${w("/work-request")?"bg-orange-200 text-orange-900":"text-gray-700 hover:bg-orange-100 hover:text-orange-800"}
            `,children:[r.jsx(u.Z,{size:18}),r.jsx("span",{children:"Work Request"})]})]}),r.jsx("div",{className:"p-4 border-t border-orange-200",children:(0,r.jsxs)("button",{onClick:R,className:"   w-full flex items-center justify-center gap-2    px-4 py-2.5 rounded-lg text-sm font-medium   bg-red-500 hover:bg-red-600 text-white   transition-colors duration-200   ",children:[r.jsx(g.Z,{size:16}),r.jsx("span",{children:"ออกจากระบบ"})]})})]})]}):null};var p=s(90748),j=s(6507),y=s(59734);let N=({children:e})=>{let[t,s]=(0,a.useState)(!0),{user:l}=(0,n.a)(),i=()=>{s(!t)};return(0,r.jsxs)("div",{className:"min-h-screen bg-gray-100",children:[r.jsx("header",{className:"fixed top-0 left-0 right-0 h-16 bg-white border-b border-gray-200 z-50",children:(0,r.jsxs)("div",{className:"flex items-center justify-between h-full px-4",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[r.jsx("button",{onClick:i,className:"p-2 rounded-md text-gray-600 hover:bg-gray-100 hover:text-gray-900 transition-colors",children:r.jsx(p.Z,{size:20})}),r.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:"\uD83C\uDFD7️ ttsdoc v2"})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[r.jsx("button",{className:"p-2 rounded-md text-gray-600 hover:bg-gray-100 hover:text-gray-900 transition-colors",children:r.jsx(j.Z,{size:18})}),l&&(0,r.jsxs)("span",{className:"hidden sm:block text-sm text-gray-600",children:["\uD83D\uDC4B สวัสดี, ",l.email.split("@")[0]]}),(0,r.jsxs)("div",{className:"hidden md:flex items-center space-x-2 text-gray-600",children:[r.jsx(y.Z,{size:18}),r.jsx("span",{className:"text-sm font-medium",children:"T.T.S. Engineering"})]})]})]})}),(0,r.jsxs)("div",{className:"flex",children:[r.jsx(f,{isOpen:t,onToggle:i}),r.jsx("main",{className:`
            flex-1 transition-all duration-300 ease-in-out pt-16
            ${t?"lg:ml-64":"lg:ml-0"}
          `,children:r.jsx("div",{className:"p-4 sm:p-6 lg:p-8",children:e})})]})]})}},62665:(e,t,s)=>{"use strict";s.d(t,{AuthProvider:()=>d,a:()=>c});var r=s(17577),a=s.n(r),n=s(5779),l=s(76),i=s(67967);let o=(0,r.createContext)({user:null,firebaseUser:null,loading:!0,error:null,refetch:async()=>{},logout:async()=>{}});function d({children:e}){let[t,s]=(0,r.useState)(null),[d,c]=(0,r.useState)(null),[x,m]=(0,r.useState)(!0),[h,u]=(0,r.useState)(null),g=async e=>{try{u(null);let t=await (0,l.QT)((0,l.JU)(i.db,"users",e.uid));if(t.exists()){let s=t.data();c({id:e.uid,email:e.email||"",role:s.role,sites:s.sites||[],status:s.status||"ACTIVE",createdFromInvitation:s.createdFromInvitation,createdAt:s.createdAt?.toDate(),acceptedAt:s.acceptedAt?.toDate()})}else u("ไม่พบข้อมูลผู้ใช้ในระบบ"),c(null)}catch(e){console.error("Error fetching user data:",e),u("เกิดข้อผิดพลาดในการโหลดข้อมูลผู้ใช้"),c(null)}},b=async()=>{t&&await g(t)},f=async()=>{try{await (0,n.w7)(i.I),c(null),s(null),u(null)}catch(e){throw console.error("Logout error:",e),e}};return a().createElement(o.Provider,{value:{user:d,firebaseUser:t,loading:x,error:h,refetch:b,logout:f}},e)}function c(){return(0,r.useContext)(o)}},32875:(e,t,s)=>{"use strict";s.d(t,{a1:()=>l});var r=s(10326),a=s(62665),n=s(35047);function l({children:e,requiredRoles:t=[],requiredSiteAccess:s=[],fallback:l,redirectTo:i="/login"}){let{user:o,loading:d,error:c}=(0,a.a)(),x=(0,n.useRouter)();return d?r.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,r.jsxs)("div",{className:"text-center",children:[r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),r.jsx("p",{className:"text-gray-600",children:"กำลังตรวจสอบสิทธิ์..."})]})}):c?r.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:r.jsx("div",{className:"text-center max-w-md mx-auto",children:(0,r.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[r.jsx("h2",{className:"text-lg font-semibold text-red-800 mb-2",children:"เกิดข้อผิดพลาด"}),r.jsx("p",{className:"text-red-600 mb-4",children:c}),r.jsx("button",{onClick:()=>window.location.reload(),className:"bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 transition-colors",children:"ลองใหม่"})]})})}):o?t.length>0&&!t.includes(o.role)?r.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:r.jsx("div",{className:"text-center max-w-md mx-auto",children:(0,r.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-6",children:[r.jsx("h2",{className:"text-lg font-semibold text-yellow-800 mb-2",children:"ไม่มีสิทธิ์เข้าถึง"}),r.jsx("p",{className:"text-yellow-700 mb-2",children:"คุณไม่มีสิทธิ์เข้าถึงหน้านี้"}),(0,r.jsxs)("p",{className:"text-sm text-yellow-600 mb-4",children:["ต้องการสิทธิ์: ",t.join(", ")," | สิทธิ์ปัจจุบัน: ",o.role]}),r.jsx("button",{onClick:()=>x.back(),className:"bg-yellow-600 text-white px-4 py-2 rounded hover:bg-yellow-700 transition-colors",children:"ย้อนกลับ"})]})})}):s.length>0&&"Admin"!==o.role&&!s.some(e=>o.sites?.includes(e))?r.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:r.jsx("div",{className:"text-center max-w-md mx-auto",children:(0,r.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[r.jsx("h2",{className:"text-lg font-semibold text-red-800 mb-2",children:"ไม่มีสิทธิ์เข้าถึงโครงการ"}),r.jsx("p",{className:"text-red-600 mb-4",children:"คุณไม่มีสิทธิ์เข้าถึงโครงการที่ต้องการ"}),r.jsx("button",{onClick:()=>x.back(),className:"bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 transition-colors",children:"ย้อนกลับ"})]})})}):r.jsx(r.Fragment,{children:e}):l?r.jsx(r.Fragment,{children:l}):r.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,r.jsxs)("div",{className:"text-center",children:[r.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-2",children:"กรุณาเข้าสู่ระบบ"}),r.jsx("p",{className:"text-gray-600 mb-4",children:"คุณต้องเข้าสู่ระบบเพื่อเข้าถึงหน้านี้"}),r.jsx("button",{onClick:()=>x.push(i),className:"bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 transition-colors",children:"เข้าสู่ระบบ"})]})})}s(17577)},7619:(e,t,s)=>{"use strict";s.d(t,{NK:()=>i,gf:()=>n,n$:()=>l,oU:()=>a,uc:()=>r});let r=["BIM","ME","SN"],a=["Site Admin","Adminsite2","OE","PE"],n=["CM"],l={PENDING_REVIEW:"PENDING_REVIEW",PENDING_CM_APPROVAL:"PENDING_CM_APPROVAL",REVISION_REQUIRED:"REVISION_REQUIRED",APPROVED:"APPROVED",APPROVED_WITH_COMMENTS:"APPROVED_WITH_COMMENTS",APPROVED_REVISION_REQUIRED:"APPROVED_REVISION_REQUIRED",REJECTED:"REJECTED"},i={[l.PENDING_REVIEW]:"รอตรวจสอบ",[l.PENDING_CM_APPROVAL]:"ส่ง CM",[l.REVISION_REQUIRED]:"แก้ไข",[l.APPROVED]:"อนุมัติ",[l.APPROVED_WITH_COMMENTS]:"อนุมัติตามคอมเมนต์ (ไม่แก้ไข)",[l.APPROVED_REVISION_REQUIRED]:"อนุมัติตามคอมเมนต์ (ต้องแก้ไข)",[l.REJECTED]:"ไม่อนุมัติ"}},67967:(e,t,s)=>{"use strict";s.d(t,{I:()=>i,db:()=>o});var r=s(42585),a=s(5779),n=s(76);let l=(0,r.C6)().length>0?(0,r.C6)()[0]:(0,r.ZF)({apiKey:"AIzaSyAsayb-DEOBE0zi0qh-dPBfihClgXrX1sY",authDomain:"ttsdocumentcontrol.firebaseapp.com",projectId:"ttsdocumentcontrol",storageBucket:"ttsdocumentcontrol.firebasestorage.app",messagingSenderId:"48440915675",appId:"1:48440915675:web:f11611895bfb52d4d27efe"}),i=(0,a.v0)(l),o=(0,n.ad)(l)},94040:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>i,metadata:()=>l});var r=s(19510);s(5023);var a=s(68570);let n=(0,a.createProxy)(String.raw`D:\ttsdoc-v2\src\lib\auth\useAuth.ts#AuthProvider`);(0,a.createProxy)(String.raw`D:\ttsdoc-v2\src\lib\auth\useAuth.ts#useAuth`);let l={title:"ttsdoc v2 - Construction Document Management",description:"Professional construction document management system"};function i({children:e}){return r.jsx("html",{lang:"th",children:r.jsx("body",{children:r.jsx(n,{children:e})})})}},73881:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>a});var r=s(66621);let a=e=>[{type:"image/x-icon",sizes:"16x16",url:(0,r.fillMetadataSegment)(".",e.params,"favicon.ico")+""}]},5023:()=>{}};