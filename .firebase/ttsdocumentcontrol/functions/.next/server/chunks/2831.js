"use strict";exports.id=2831,exports.ids=[2831],exports.modules={32933:(e,s,t)=>{t.d(s,{Z:()=>a});const a=(0,t(62881).Z)("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]])},56418:(e,s,t)=>{t.d(s,{Z:()=>a});const a=(0,t(62881).Z)("paperclip",[["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 2.829 2.829l8.414-8.586a4 4 0 1 0-5.657-5.657l-8.379 8.551a6 6 0 1 0 8.485 8.485l8.379-8.551",key:"1miecu"}]])},63685:(e,s,t)=>{t.d(s,{Z:()=>a});const a=(0,t(62881).Z)("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]])},12831:(e,s,t)=>{t.d(s,{Z:()=>I});var a=t(10326),r=t(17577),l=t(24616),i=t(48238),n=t(62881);const c=(0,n.Z)("boxes",[["path",{d:"M2.97 12.92A2 2 0 0 0 2 14.63v3.24a2 2 0 0 0 .97 1.71l3 1.8a2 2 0 0 0 2.06 0L12 19v-5.5l-5-3-4.03 2.42Z",key:"lc1i9w"}],["path",{d:"m7 16.5-4.74-2.85",key:"1o9zyk"}],["path",{d:"m7 16.5 5-3",key:"va8pkn"}],["path",{d:"M7 16.5v5.17",key:"jnp8gn"}],["path",{d:"M12 13.5V19l3.97 2.38a2 2 0 0 0 2.06 0l3-1.8a2 2 0 0 0 .97-1.71v-3.24a2 2 0 0 0-.97-1.71L17 10.5l-5 3Z",key:"8zsnat"}],["path",{d:"m17 16.5-5-3",key:"8arw3v"}],["path",{d:"m17 16.5 4.74-2.85",key:"8rfmw"}],["path",{d:"M17 16.5v5.17",key:"k6z78m"}],["path",{d:"M7.97 4.42A2 2 0 0 0 7 6.13v4.37l5 3 5-3V6.13a2 2 0 0 0-.97-1.71l-3-1.8a2 2 0 0 0-2.06 0l-3 1.8Z",key:"1xygjf"}],["path",{d:"M12 8 7.26 5.15",key:"1vbdud"}],["path",{d:"m12 8 4.74-2.85",key:"3rx089"}],["path",{d:"M12 13.5V8",key:"1io7kd"}]]);var o=t(94019);const d=(0,n.Z)("info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);var m=t(77506),x=t(32933),u=t(56418),h=t(63685),p=t(36283),g=t(50949),y=t(26107);const b=()=>{const[e,s]=(0,r.useState)(!1),[t,a]=(0,r.useState)(null),{firebaseUser:l}=(0,y.a)(),i=(0,r.useCallback)((async(e,s)=>{if(!l)throw new Error("User not authenticated");const t=await l.getIdToken(),a=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(s)}),r=await a.json();if(!r.success)throw new Error(r.error||"Request failed");return r.data}),[l]);return{loading:e,error:t,getProjects:(0,r.useCallback)((async e=>{s(!0),a(null);try{return(await i("/api/google-sheets/projects",e)).projects}catch(t){throw a(t.message),t}finally{s(!1)}}),[i]),getCategories:(0,r.useCallback)((async(e,t,r)=>{s(!0),a(null);try{return(await i("/api/google-sheets/categories",{...e,projectName:t,rfaType:r})).categories}catch(l){throw a(l.message),l}finally{s(!1)}}),[i]),getTasks:(0,r.useCallback)((async(e,t,r)=>{s(!0),a(null);try{return(await i("/api/google-sheets/tasks",{...e,projectName:t,category:r})).tasks}catch(l){throw a(l.message),l}finally{s(!1)}}),[i]),clearError:()=>a(null)}};var f=t(79821),j=t(7619),N=t(31469),v=t(67967),w=t(76);const k={rfaType:"",categoryId:"",documentNumber:"",title:"",description:"",revisionNumber:"00",uploadedFiles:[],selectedProject:"",selectedCategory:"",selectedTask:null},T={"RFA-SHOP":{title:"RFA-SHOP",subtitle:"Shop Drawing Approval",icon:a.jsx(l.Z,{size:40,className:"text-blue-600"}),description:"\u0e2a\u0e33\u0e2b\u0e23\u0e31\u0e1a\u0e01\u0e32\u0e23\u0e02\u0e2d\u0e2d\u0e19\u0e38\u0e21\u0e31\u0e15\u0e34 Shop Drawing",workflow:"\u0e1c\u0e39\u0e49\u0e2a\u0e23\u0e49\u0e32\u0e07 \u2192 Site Admin \u2192 CM",allowedRoles:[j.K$.BIM,j.K$.ME,j.K$.SN,j.K$.SITE_ADMIN,j.K$.ADMIN],color:"blue"},"RFA-GEN":{title:"RFA-GEN",subtitle:"General Submission",icon:a.jsx(i.Z,{size:40,className:"text-green-600"}),description:"\u0e2a\u0e33\u0e2b\u0e23\u0e31\u0e1a\u0e01\u0e32\u0e23\u0e2a\u0e48\u0e07\u0e40\u0e2d\u0e01\u0e2a\u0e32\u0e23\u0e17\u0e31\u0e48\u0e27\u0e44\u0e1b",workflow:"\u0e1c\u0e39\u0e49\u0e2a\u0e23\u0e49\u0e32\u0e07 \u2192 CM",allowedRoles:[j.K$.BIM,j.K$.SITE_ADMIN,j.K$.ADMIN,j.K$.ME,j.K$.SN],color:"green"},"RFA-MAT":{title:"RFA-MAT",subtitle:"Material Approval",icon:a.jsx(c,{size:40,className:"text-orange-600"}),description:"\u0e2a\u0e33\u0e2b\u0e23\u0e31\u0e1a\u0e01\u0e32\u0e23\u0e02\u0e2d\u0e2d\u0e19\u0e38\u0e21\u0e31\u0e15\u0e34\u0e27\u0e31\u0e2a\u0e14\u0e38",workflow:"Site Admin \u2192 CM",allowedRoles:[j.K$.SITE_ADMIN,j.K$.ADMIN],color:"orange"}},C="w-full h-11 px-3 border rounded-lg bg-white text-gray-900 font-medium focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all";function I({onClose:e,isModal:s=!1,userProp:t,presetRfaType:l}){const[i,n]=(0,r.useState)({...k,rfaType:l||""}),[c,I]=(0,r.useState)(!1),[M,F]=(0,r.useState)(!1),[S,A]=(0,r.useState)({}),[Z,$]=(0,r.useState)(!1),[R,E]=(0,r.useState)([]),[D,z]=(0,r.useState)([]),[K,P]=(0,r.useState)([]),[O,B]=(0,r.useState)(""),[L,G]=(0,r.useState)(!1),[H,U]=(0,r.useState)(null),[J,V]=(0,r.useState)(""),{firebaseUser:_,user:q}=(0,y.a)(),{showNotification:X}=(0,N.l)(),{loading:Q,error:W,getCategories:Y,getTasks:ee}=b(),[se,te]=(0,r.useState)(""),[ae,re]=(0,r.useState)([]),le=(0,r.useMemo)((()=>!t||("RFA-MAT"===i.rfaType||"RFA-GEN"===i.rfaType||("RFA-SHOP"!==i.rfaType||t.role!==j.K$.BIM))),[t,i.rfaType]),ie=e=>{n((s=>({...s,...e})));const s={...S};Object.keys(e).forEach((e=>delete s[e])),A(s)},ne=()=>{const e={};if(!l)if(i.rfaType){const s=T[i.rfaType];t&&!s.allowedRoles.includes(t.role)&&(e.rfaType=`\u0e04\u0e38\u0e13\u0e44\u0e21\u0e48\u0e21\u0e35\u0e2a\u0e34\u0e17\u0e18\u0e34\u0e4c\u0e2a\u0e23\u0e49\u0e32\u0e07 ${i.rfaType}`)}else e.rfaType="\u0e01\u0e23\u0e38\u0e13\u0e32\u0e40\u0e25\u0e37\u0e2d\u0e01\u0e1b\u0e23\u0e30\u0e40\u0e20\u0e17 RFA";return i.title.trim()||(e.title="\u0e01\u0e23\u0e38\u0e13\u0e32\u0e43\u0e2a\u0e48\u0e2b\u0e31\u0e27\u0e02\u0e49\u0e2d\u0e40\u0e2d\u0e01\u0e2a\u0e32\u0e23"),i.revisionNumber.trim()||(e.revisionNumber="\u0e01\u0e23\u0e38\u0e13\u0e32\u0e43\u0e2a\u0e48 Rev. No."),O||(e.site="\u0e01\u0e23\u0e38\u0e13\u0e32\u0e40\u0e25\u0e37\u0e2d\u0e01\u0e42\u0e04\u0e23\u0e07\u0e01\u0e32\u0e23"),i.documentNumber.trim()?!1===H&&(e.documentNumber="\u0e40\u0e25\u0e02\u0e17\u0e35\u0e48\u0e40\u0e2d\u0e01\u0e2a\u0e32\u0e23\u0e19\u0e35\u0e49\u0e16\u0e39\u0e01\u0e43\u0e0a\u0e49\u0e44\u0e1b\u0e41\u0e25\u0e49\u0e27"):e.documentNumber="\u0e01\u0e23\u0e38\u0e13\u0e32\u0e43\u0e2a\u0e48\u0e40\u0e25\u0e02\u0e17\u0e35\u0e48\u0e40\u0e2d\u0e01\u0e2a\u0e32\u0e23",le?i.categoryId.trim()||(e.categoryId="\u0e01\u0e23\u0e38\u0e13\u0e32\u0e01\u0e23\u0e2d\u0e01\u0e2b\u0e21\u0e27\u0e14\u0e07\u0e32\u0e19"):i.selectedTask||(e.task="\u0e01\u0e23\u0e38\u0e13\u0e32\u0e40\u0e25\u0e37\u0e2d\u0e01\u0e07\u0e32\u0e19\u0e08\u0e32\u0e01 BIM Tracking"),0===i.uploadedFiles.filter((e=>"success"===e.status)).length&&(e.files="\u0e01\u0e23\u0e38\u0e13\u0e32\u0e2d\u0e31\u0e1b\u0e42\u0e2b\u0e25\u0e14\u0e44\u0e1f\u0e25\u0e4c\u0e2d\u0e22\u0e48\u0e32\u0e07\u0e19\u0e49\u0e2d\u0e22 1 \u0e44\u0e1f\u0e25\u0e4c"),A(e),0===Object.keys(e).length},ce=async e=>{try{if(!_)throw new Error("\u0e01\u0e23\u0e38\u0e13\u0e32\u0e25\u0e47\u0e2d\u0e01\u0e2d\u0e34\u0e19\u0e01\u0e48\u0e2d\u0e19\u0e2d\u0e31\u0e1b\u0e42\u0e2b\u0e25\u0e14\u0e44\u0e1f\u0e25\u0e4c");const s=await _.getIdToken(),t=new FormData;t.append("file",e);const a=await fetch("/api/rfa/upload-temp-file",{method:"POST",headers:{Authorization:`Bearer ${s}`},body:t}),r=await a.json();if(r.success)return{status:"success",progress:100,uploadedData:r.fileData};throw new Error(r.error||"\u0e2d\u0e31\u0e1b\u0e42\u0e2b\u0e25\u0e14\u0e25\u0e49\u0e21\u0e40\u0e2b\u0e25\u0e27")}catch(s){return{status:"error",error:s instanceof Error?s.message:"\u0e40\u0e01\u0e34\u0e14\u0e02\u0e49\u0e2d\u0e1c\u0e34\u0e14\u0e1e\u0e25\u0e32\u0e14"}}},oe=(0,r.useMemo)((()=>se?K.filter((e=>e.taskName.toLowerCase().includes(se.toLowerCase()))):K.slice(0,20)),[K,se]);return(0,a.jsxs)("div",{className:(s?"max-w-4xl w-full mx-auto":"")+" bg-white rounded-lg shadow-xl flex flex-col h-full max-h-[95vh]",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-6 border-b bg-gray-50 rounded-t-lg",children:[a.jsx("div",{children:(0,a.jsxs)("h2",{className:"text-2xl font-bold text-gray-900",children:["\u0e2a\u0e23\u0e49\u0e32\u0e07 RFA Document",i.rfaType&&T[i.rfaType]&&(0,a.jsxs)("span",{className:"font-medium text-gray-600",children:[" - ",T[i.rfaType].subtitle]})]})}),e&&a.jsx("button",{onClick:e,className:"text-gray-400 hover:text-gray-600",children:a.jsx(o.Z,{})})]}),(0,a.jsxs)("div",{className:"flex-1 p-4 sm:p-6 overflow-y-auto bg-slate-50 space-y-6",children:[!l&&(0,a.jsxs)("section",{className:"bg-white p-6 rounded-lg border border-gray-200",children:[(0,a.jsxs)("h3",{className:"flex items-center text-lg font-semibold text-gray-900 border-b pb-4 mb-6",children:[a.jsx("span",{className:"w-8 h-8 rounded-full bg-blue-600 text-white flex items-center justify-center mr-3 font-bold text-base",children:"1"}),"\u0e40\u0e25\u0e37\u0e2d\u0e01\u0e1b\u0e23\u0e30\u0e40\u0e20\u0e17\u0e40\u0e2d\u0e01\u0e2a\u0e32\u0e23"]}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:Object.entries(T).map((([e,s])=>{const r=!!t&&s.allowedRoles.includes(t.role);return(0,a.jsxs)("div",{onClick:()=>r&&ie({rfaType:e}),className:"p-6 border-2 rounded-lg text-center cursor-pointer transition-all duration-200 ...",children:[a.jsx("div",{className:"mb-3 flex justify-center",children:s.icon}),a.jsx("h4",{className:"font-semibold text-gray-800",children:s.title}),a.jsx("p",{className:"text-sm text-gray-500 mt-1",children:s.description})]},e)}))}),S.rfaType&&a.jsx("p",{className:"text-red-600 text-sm mt-2",children:S.rfaType})]}),(0,a.jsxs)("section",{className:"bg-white p-6 rounded-lg border border-gray-200 "+(i.rfaType||l?"":"opacity-40 pointer-events-none"),children:[(0,a.jsxs)("h3",{className:"flex items-center text-lg font-semibold text-gray-900 border-b pb-4 mb-6",children:[a.jsx(d,{size:20,className:"mr-3 text-blue-600"}),"\u0e02\u0e49\u0e2d\u0e21\u0e39\u0e25\u0e40\u0e2d\u0e01\u0e2a\u0e32\u0e23"]}),(0,a.jsxs)("div",{className:"space-y-6 max-w-3xl",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-800 mb-2",children:["\u0e42\u0e04\u0e23\u0e07\u0e01\u0e32\u0e23 ",a.jsx("span",{className:"text-red-500",children:"*"})]}),(0,a.jsxs)("select",{value:O,onChange:e=>(async s=>{if(B(s),ie({categoryId:"",selectedCategory:"",selectedTask:null}),re([]),z([]),P([]),te(""),!s)return;const t=R.find((e=>e.id===s));if(t)if(F(!0),le)try{const e=(0,w.IO)((0,w.hJ)(v.db,`sites/${s}/categories`),(0,w.Xo)("categoryCode")),t=(await(0,w.PL)(e)).docs.map((e=>({id:e.id,categoryCode:e.data().categoryCode,categoryName:e.data().categoryName})));re(t)}catch(e){console.error("Failed to fetch site categories:",e),A((e=>({...e,site:"\u0e44\u0e21\u0e48\u0e2a\u0e32\u0e21\u0e32\u0e23\u0e16\u0e42\u0e2b\u0e25\u0e14\u0e2b\u0e21\u0e27\u0e14\u0e07\u0e32\u0e19\u0e44\u0e14\u0e49"})))}finally{F(!1)}else{ie({selectedProject:t.name});try{const e=await Y({sheetId:t.sheetId||""},t.name,i.rfaType);z(e)}catch(e){console.error("Failed to fetch categories from BIM-Tracking:",e),A((e=>({...e,site:"\u0e44\u0e21\u0e48\u0e2a\u0e32\u0e21\u0e32\u0e23\u0e16\u0e42\u0e2b\u0e25\u0e14\u0e2b\u0e21\u0e27\u0e14\u0e07\u0e32\u0e19\u0e08\u0e32\u0e01 BIM-Tracking \u0e44\u0e14\u0e49"})))}finally{F(!1)}}})(e.target.value),className:C,children:[a.jsx("option",{value:"",children:"-- \u0e40\u0e25\u0e37\u0e2d\u0e01\u0e42\u0e04\u0e23\u0e07\u0e01\u0e32\u0e23 --"}),R.map((e=>a.jsx("option",{value:e.id,children:e.name},e.id)))]}),S.site&&a.jsx("p",{className:"text-red-600 text-sm mt-1",children:S.site})]}),le?(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{htmlFor:"category-manual-input",className:"block text-sm font-medium text-gray-800 mb-2",children:["\u0e2b\u0e21\u0e27\u0e14\u0e07\u0e32\u0e19 ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx("input",{id:"category-manual-input",type:"text",list:"category-list",value:i.categoryId,onChange:e=>ie({categoryId:e.target.value}),placeholder:"\u0e1e\u0e34\u0e21\u0e1e\u0e4c\u0e2b\u0e23\u0e37\u0e2d\u0e40\u0e25\u0e37\u0e2d\u0e01\u0e2b\u0e21\u0e27\u0e14\u0e07\u0e32\u0e19",className:C,disabled:!O}),a.jsx("datalist",{id:"category-list",children:ae.map((e=>a.jsx("option",{value:e.categoryCode},e.id)))}),S.categoryId&&a.jsx("p",{className:"text-red-600 text-sm mt-1",children:S.categoryId})]}):(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-800 mb-2 flex items-center",children:["\u0e2b\u0e21\u0e27\u0e14\u0e07\u0e32\u0e19 ",Q&&a.jsx(f.Z,{className:"w-4 h-4 ml-2"})," ",a.jsx("span",{className:"text-red-500",children:"*"})]}),(0,a.jsxs)("select",{value:i.selectedCategory,onChange:e=>(async s=>{ie({selectedCategory:s,selectedTask:null}),P([]);const t=R.find((e=>e.id===O));if(t&&i.selectedProject)try{const e=await ee({sheetId:t.sheetId||""},i.selectedProject,s);P(e)}catch(e){console.error(e)}})(e.target.value),className:C,disabled:!O||Q,children:[a.jsx("option",{value:"",children:Q?"\u0e01\u0e33\u0e25\u0e31\u0e07\u0e42\u0e2b\u0e25\u0e14...":"-- \u0e40\u0e25\u0e37\u0e2d\u0e01\u0e2b\u0e21\u0e27\u0e14\u0e07\u0e32\u0e19 --"}),D.map((e=>a.jsx("option",{value:e,children:e},e)))]}),W&&(0,a.jsxs)("p",{className:"text-red-600 text-sm mt-1",children:["Error: ",W]})]})]}),!le&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-800 mb-2",children:["\u0e04\u0e49\u0e19\u0e2b\u0e32\u0e07\u0e32\u0e19 ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx("input",{type:"text",placeholder:"\u0e04\u0e49\u0e19\u0e2b\u0e32\u0e0a\u0e37\u0e48\u0e2d\u0e07\u0e32\u0e19\u0e08\u0e32\u0e01 BIM Tracking...",value:se,onChange:e=>te(e.target.value),className:C,disabled:!i.selectedCategory||Q}),a.jsx("div",{className:"mt-2 max-h-48 overflow-y-auto border rounded-lg bg-white",children:oe.map((e=>a.jsx("div",{onClick:()=>(e=>{ie({selectedTask:e,title:`${e.taskName} - RFA`}),te(e.taskName)})(e),className:"p-3 text-sm cursor-pointer hover:bg-gray-100 "+(i.selectedTask?.taskName===e.taskName?"bg-blue-50 font-semibold":""),children:e.taskName},e.taskUid||e.taskName)))}),S.task&&a.jsx("p",{className:"text-red-600 text-sm mt-1",children:S.task})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{className:"sm:col-span-2",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-800 mb-2",children:"\u0e40\u0e25\u0e02\u0e17\u0e35\u0e48\u0e40\u0e2d\u0e01\u0e2a\u0e32\u0e23"}),(0,a.jsxs)("div",{className:"relative",children:[a.jsx("input",{type:"text",value:i.documentNumber,onChange:e=>{ie({documentNumber:e.target.value}),U(null)},className:`${C} pr-10 ${!1===H?"border-red-500":""}`}),(0,a.jsxs)("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:[L&&a.jsx(m.Z,{className:"h-5 w-5 text-gray-400 animate-spin"}),!L&&!0===H&&a.jsx(x.Z,{className:"h-5 w-5 text-green-500"}),!L&&!1===H&&a.jsx(o.Z,{className:"h-5 w-5 text-red-500"})]})]}),S.documentNumber&&a.jsx("p",{className:"text-red-600 text-sm mt-1",children:S.documentNumber}),!L&&!1===H&&!S.documentNumber&&a.jsx("p",{className:"text-red-600 text-sm mt-1",children:"\u0e40\u0e25\u0e02\u0e17\u0e35\u0e48\u0e40\u0e2d\u0e01\u0e2a\u0e32\u0e23\u0e19\u0e35\u0e49\u0e16\u0e39\u0e01\u0e43\u0e0a\u0e49\u0e44\u0e1b\u0e41\u0e25\u0e49\u0e27"})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-800 mb-2",children:"Rev. No."}),a.jsx("input",{type:"text",value:i.revisionNumber,onChange:e=>ie({revisionNumber:e.target.value}),className:C}),S.revisionNumber&&a.jsx("p",{className:"text-red-600 text-sm mt-1",children:S.revisionNumber})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-800 mb-2",children:["\u0e2b\u0e31\u0e27\u0e02\u0e49\u0e2d\u0e40\u0e2d\u0e01\u0e2a\u0e32\u0e23 ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx("input",{type:"text",value:i.title,onChange:e=>ie({title:e.target.value}),className:C}),S.title&&a.jsx("p",{className:"text-red-600 text-sm mt-1",children:S.title})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-800 mb-2",children:"\u0e23\u0e32\u0e22\u0e25\u0e30\u0e40\u0e2d\u0e35\u0e22\u0e14"}),a.jsx("textarea",{value:i.description,onChange:e=>ie({description:e.target.value}),rows:3,className:"w-full p-3 border rounded-lg bg-white text-gray-900"})]})]})]}),(0,a.jsxs)("section",{className:"bg-white p-6 rounded-lg border border-gray-200 "+(i.rfaType||l?"":"opacity-40 pointer-events-none"),children:[(0,a.jsxs)("h3",{className:"flex items-center text-lg font-semibold text-gray-900 border-b pb-4 mb-6",children:[a.jsx(u.Z,{size:20,className:"mr-3 text-blue-600"}),"\u0e41\u0e19\u0e1a\u0e44\u0e1f\u0e25\u0e4c ",a.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),(0,a.jsxs)("div",{className:"space-y-6 max-w-3xl",children:[(0,a.jsxs)("label",{htmlFor:"file-upload",className:"flex flex-col items-center justify-center w-full h-48 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-slate-50 hover:bg-slate-100 transition-colors",children:[(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center pt-5 pb-6 text-center",children:[a.jsx(h.Z,{className:"w-10 h-10 mb-4 text-gray-400"}),(0,a.jsxs)("p",{className:"mb-2 text-sm text-gray-500",children:[a.jsx("span",{className:"font-semibold",children:"\u0e04\u0e25\u0e34\u0e01\u0e40\u0e1e\u0e37\u0e48\u0e2d\u0e40\u0e25\u0e37\u0e2d\u0e01\u0e44\u0e1f\u0e25\u0e4c"})," \u0e2b\u0e23\u0e37\u0e2d\u0e25\u0e32\u0e01\u0e21\u0e32\u0e27\u0e32\u0e07"]}),a.jsx("p",{className:"text-xs text-gray-500",children:"\u0e2a\u0e32\u0e21\u0e32\u0e23\u0e16\u0e40\u0e25\u0e37\u0e2d\u0e01\u0e44\u0e14\u0e49\u0e2b\u0e25\u0e32\u0e22\u0e44\u0e1f\u0e25\u0e4c\u0e1e\u0e23\u0e49\u0e2d\u0e21\u0e01\u0e31\u0e19"})]}),a.jsx("input",{id:"file-upload",type:"file",multiple:!0,onChange:async e=>{const s=Array.from(e.target.files||[]);if(!s.length)return;const t=s.map((e=>({id:`${e.name}-${Date.now()}`,file:e,status:"pending",progress:0,retryCount:0})));n((e=>({...e,uploadedFiles:[...e.uploadedFiles,...t]})));for(const a of t){n((e=>({...e,uploadedFiles:e.uploadedFiles.map((e=>e.id===a.id?{...e,status:"uploading"}:e))})));const e=await ce(a.file);n((s=>({...s,uploadedFiles:s.uploadedFiles.map((s=>s.id===a.id?{...s,...e}:s))})))}e.target.value=""},className:"hidden"})]}),i.uploadedFiles.length>0&&a.jsx("div",{children:a.jsx("div",{className:"space-y-2",children:i.uploadedFiles.map(((e,s)=>(0,a.jsxs)("div",{className:"flex items-center text-sm p-3 bg-gray-100 rounded-lg",children:[a.jsx(p.Z,{className:"w-5 h-5 mr-3 text-gray-500 flex-shrink-0"}),a.jsx("span",{className:"flex-1 truncate",title:e.file.name,children:e.file.name}),(0,a.jsxs)("div",{className:"flex items-center ml-3",children:["uploading"===e.status&&a.jsx(f.Z,{className:"w-4 h-4"}),"success"===e.status&&a.jsx(x.Z,{className:"w-5 h-5 text-green-500"}),"error"===e.status&&a.jsx("span",{title:e.error,children:a.jsx(g.Z,{className:"w-5 h-5 text-red-500"})}),a.jsx("button",{type:"button",onClick:()=>{return e=s,i.uploadedFiles[e].uploadedData,void ie({uploadedFiles:i.uploadedFiles.filter(((s,t)=>t!==e))});var e},className:"ml-4 text-gray-500 hover:text-red-600",children:a.jsx(o.Z,{size:18})})]})]},e.id)))})}),S.files&&a.jsx("p",{className:"text-red-600 text-sm mt-1",children:S.files})]})]}),S.general&&a.jsx("p",{className:"text-red-600 text-sm mt-4 text-center",children:S.general})]}),(0,a.jsxs)("div",{className:"flex justify-end items-center p-6 border-t bg-gray-100 rounded-b-lg",children:[e&&a.jsx("button",{onClick:e,disabled:Z,className:"px-6 py-2 rounded-lg bg-white border border-gray-300 text-gray-800 hover:bg-gray-100 disabled:opacity-50 mr-4",children:"\u0e22\u0e01\u0e40\u0e25\u0e34\u0e01"}),a.jsx("button",{onClick:()=>{ne()?I(!0):alert("\u0e01\u0e23\u0e38\u0e13\u0e32\u0e01\u0e23\u0e2d\u0e01\u0e02\u0e49\u0e2d\u0e21\u0e39\u0e25\u0e43\u0e2b\u0e49\u0e04\u0e23\u0e1a\u0e16\u0e49\u0e27\u0e19")},disabled:Z||!i.rfaType&&!l,className:"px-8 py-2 rounded-lg bg-blue-600 text-white font-semibold hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed",children:Z?a.jsx(f.Z,{className:"w-5 h-5"}):"\u0e2a\u0e23\u0e49\u0e32\u0e07\u0e40\u0e2d\u0e01\u0e2a\u0e32\u0e23"})]}),c&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 z-50 flex items-center justify-center p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-3xl max-h-[90vh] flex flex-col",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center p-4 border-b",children:[a.jsx("h3",{className:"text-xl font-bold text-gray-800",children:"\u0e22\u0e37\u0e19\u0e22\u0e31\u0e19\u0e02\u0e49\u0e2d\u0e21\u0e39\u0e25"}),(0,a.jsxs)("button",{onClick:()=>I(!1),className:"text-gray-400 hover:text-gray-600",children:[" ",a.jsx(o.Z,{size:24})," "]})]}),(0,a.jsxs)("div",{className:"p-6 overflow-y-auto space-y-4 text-sm",children:[a.jsx("h4",{className:"text-base font-semibold text-gray-800",children:"\u0e01\u0e23\u0e38\u0e13\u0e32\u0e15\u0e23\u0e27\u0e08\u0e2a\u0e2d\u0e1a\u0e02\u0e49\u0e2d\u0e21\u0e39\u0e25\u0e01\u0e48\u0e2d\u0e19\u0e2a\u0e23\u0e49\u0e32\u0e07\u0e40\u0e2d\u0e01\u0e2a\u0e32\u0e23"}),(0,a.jsxs)("div",{className:"p-4 bg-gray-50 rounded-lg border space-y-2",children:[(0,a.jsxs)("p",{children:[a.jsx("strong",{className:"font-medium text-gray-700 w-28 inline-block",children:"\u0e1b\u0e23\u0e30\u0e40\u0e20\u0e17:"})," ",i.rfaType]}),(0,a.jsxs)("p",{children:[a.jsx("strong",{className:"font-medium text-gray-700 w-28 inline-block",children:"\u0e42\u0e04\u0e23\u0e07\u0e01\u0e32\u0e23:"})," ",R.find((e=>e.id===O))?.name]}),(0,a.jsxs)("p",{children:[a.jsx("strong",{className:"font-medium text-gray-700 w-28 inline-block",children:"\u0e2b\u0e21\u0e27\u0e14\u0e07\u0e32\u0e19:"})," ",le?i.categoryId:i.selectedTask?.taskCategory]}),(0,a.jsxs)("p",{children:[a.jsx("strong",{className:"font-medium text-gray-700 w-28 inline-block",children:"\u0e40\u0e25\u0e02\u0e17\u0e35\u0e48\u0e40\u0e2d\u0e01\u0e2a\u0e32\u0e23:"})," ",i.documentNumber||"(\u0e44\u0e21\u0e48\u0e44\u0e14\u0e49\u0e23\u0e30\u0e1a\u0e38)"]}),(0,a.jsxs)("p",{children:[a.jsx("strong",{className:"font-medium text-gray-700 w-28 inline-block",children:"Rev.:"})," ",i.revisionNumber]}),(0,a.jsxs)("p",{className:"border-t pt-2 mt-2",children:[a.jsx("strong",{className:"font-medium text-gray-700 block",children:"\u0e2b\u0e31\u0e27\u0e02\u0e49\u0e2d:"})," ",i.title]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("h4",{className:"font-medium text-gray-700",children:["\u0e44\u0e1f\u0e25\u0e4c\u0e41\u0e19\u0e1a (",i.uploadedFiles.filter((e=>"success"===e.status)).length," \u0e44\u0e1f\u0e25\u0e4c):"]}),(0,a.jsxs)("ul",{className:"list-disc list-inside mt-1 space-y-1 text-gray-900",children:[" ",i.uploadedFiles.filter((e=>"success"===e.status)).map((e=>a.jsx("li",{className:"truncate",children:e.file.name},e.id)))]})]})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-4 p-4 border-t bg-gray-50",children:[a.jsx("button",{onClick:()=>I(!1),className:"px-6 py-2 rounded-lg bg-gray-200 text-gray-800 hover:bg-gray-300",children:" \u0e01\u0e25\u0e31\u0e1a\u0e44\u0e1b\u0e41\u0e01\u0e49\u0e44\u0e02 "}),a.jsx("button",{onClick:async()=>{if(ne()){$(!0);try{if(!_)throw new Error("\u0e01\u0e23\u0e38\u0e13\u0e32\u0e25\u0e47\u0e2d\u0e01\u0e2d\u0e34\u0e19\u0e01\u0e48\u0e2d\u0e19");const s=await _.getIdToken(),t=i.uploadedFiles.filter((e=>"success"===e.status&&e.uploadedData)),a=le?i.categoryId:i.selectedTask?.taskCategory,r=le?null:i.selectedTask;if(!a)throw new Error("\u0e44\u0e21\u0e48\u0e2a\u0e32\u0e21\u0e32\u0e23\u0e16\u0e23\u0e30\u0e1a\u0e38 Category ID \u0e44\u0e14\u0e49");const l={rfaType:i.rfaType,title:i.title,description:i.description,siteId:O,documentNumber:i.documentNumber,revisionNumber:parseInt(i.revisionNumber,10)||0,uploadedFiles:t.map((e=>e.uploadedData)),categoryId:a,taskData:r},n=await fetch("/api/rfa/create",{method:"POST",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"},body:JSON.stringify({payload:l})}),c=await n.json();if(!n.ok)throw new Error(c.error||"\u0e40\u0e01\u0e34\u0e14\u0e02\u0e49\u0e2d\u0e1c\u0e34\u0e14\u0e1e\u0e25\u0e32\u0e14\u0e43\u0e19\u0e01\u0e32\u0e23\u0e2a\u0e23\u0e49\u0e32\u0e07\u0e40\u0e2d\u0e01\u0e2a\u0e32\u0e23");if(!c.success)throw new Error(c.error);X("success","\u0e2a\u0e23\u0e49\u0e32\u0e07 RFA \u0e2a\u0e33\u0e40\u0e23\u0e47\u0e08!",`\u0e2b\u0e21\u0e32\u0e22\u0e40\u0e25\u0e02\u0e40\u0e2d\u0e01\u0e2a\u0e32\u0e23: ${c.runningNumber}`),e&&e()}catch(s){const e=s instanceof Error?s.message:"An unknown error occurred.";X("error","\u0e40\u0e01\u0e34\u0e14\u0e02\u0e49\u0e2d\u0e1c\u0e34\u0e14\u0e1e\u0e25\u0e32\u0e14",e)}finally{$(!1)}}else X("warning","\u0e02\u0e49\u0e2d\u0e21\u0e39\u0e25\u0e44\u0e21\u0e48\u0e04\u0e23\u0e1a\u0e16\u0e49\u0e27\u0e19","\u0e01\u0e23\u0e38\u0e13\u0e32\u0e01\u0e23\u0e2d\u0e01\u0e02\u0e49\u0e2d\u0e21\u0e39\u0e25\u0e43\u0e19\u0e0a\u0e48\u0e2d\u0e07\u0e17\u0e35\u0e48\u0e21\u0e35\u0e40\u0e04\u0e23\u0e37\u0e48\u0e2d\u0e07\u0e2b\u0e21\u0e32\u0e22 * \u0e43\u0e2b\u0e49\u0e04\u0e23\u0e1a")},className:"px-6 py-2 rounded-lg bg-green-600 text-white hover:bg-green-700",children:" \u0e22\u0e37\u0e19\u0e22\u0e31\u0e19\u0e41\u0e25\u0e30\u0e2a\u0e23\u0e49\u0e32\u0e07\u0e40\u0e2d\u0e01\u0e2a\u0e32\u0e23 "})]})]})})]})}}};