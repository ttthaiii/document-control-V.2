"use strict";exports.id=191,exports.ids=[191],exports.modules={32933:(e,t,s)=>{s.d(t,{Z:()=>a});const a=(0,s(62881).Z)("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]])},69436:(e,t,s)=>{s.d(t,{Z:()=>a});const a=(0,s(62881).Z)("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]])},63685:(e,t,s)=>{s.d(t,{Z:()=>a});const a=(0,s(62881).Z)("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]])},80191:(e,t,s)=>{s.d(t,{Z:()=>g});var a=s(10326),r=s(17577),l=s(26107),n=s(79821),o=s(50949),i=s(63685),d=s(36283),c=s(32933),m=s(94019),u=s(69436),x=s(7619),h=s(31469);const p="w-full h-11 px-3 border rounded-lg bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all";function g({onClose:e,userProp:t}){const{firebaseUser:s}=(0,l.a)(),{showNotification:g}=(0,h.l)(),[b,j]=(0,r.useState)([]),[f,y]=(0,r.useState)(""),[N,w]=(0,r.useState)(""),[v,k]=(0,r.useState)(""),[Z,D]=(0,r.useState)([]),[S,C]=(0,r.useState)(""),[E,O]=(0,r.useState)(!0),[z,P]=(0,r.useState)(!1),[T,$]=(0,r.useState)({}),q=t&&x.c9.includes(t.role),A=async e=>{try{if(!s)throw new Error("\u0e01\u0e23\u0e38\u0e13\u0e32\u0e25\u0e47\u0e2d\u0e01\u0e2d\u0e34\u0e19\u0e01\u0e48\u0e2d\u0e19\u0e2d\u0e31\u0e1b\u0e42\u0e2b\u0e25\u0e14\u0e44\u0e1f\u0e25\u0e4c");const t=await s.getIdToken(),a=new FormData;a.append("file",e);const r=await fetch("/api/rfa/upload-temp-file",{method:"POST",headers:{Authorization:`Bearer ${t}`},body:a}),l=await r.json();if(l.success)return{status:"success",progress:100,uploadedData:l.fileData};throw new Error(l.error||"\u0e2d\u0e31\u0e1b\u0e42\u0e2b\u0e25\u0e14\u0e25\u0e49\u0e21\u0e40\u0e2b\u0e25\u0e27")}catch(t){return{status:"error",error:t instanceof Error?t.message:"\u0e40\u0e01\u0e34\u0e14\u0e02\u0e49\u0e2d\u0e1c\u0e34\u0e14\u0e1e\u0e25\u0e32\u0e14"}}};return q?(0,a.jsxs)("form",{onSubmit:async t=>{if(t.preventDefault(),(()=>{const e={};return f||(e.site="\u0e01\u0e23\u0e38\u0e13\u0e32\u0e40\u0e25\u0e37\u0e2d\u0e01\u0e42\u0e04\u0e23\u0e07\u0e01\u0e32\u0e23"),N.trim()||(e.taskName="\u0e01\u0e23\u0e38\u0e13\u0e32\u0e43\u0e2a\u0e48\u0e2b\u0e31\u0e27\u0e02\u0e49\u0e2d\u0e07\u0e32\u0e19"),S||(e.dueDate="\u0e01\u0e23\u0e38\u0e13\u0e32\u0e40\u0e25\u0e37\u0e2d\u0e01\u0e27\u0e31\u0e19\u0e17\u0e35\u0e48\u0e01\u0e33\u0e2b\u0e19\u0e14\u0e2a\u0e48\u0e07"),$(e),0===Object.keys(e).length})()){P(!0);try{if(!s)throw new Error("\u0e01\u0e23\u0e38\u0e13\u0e32\u0e25\u0e47\u0e2d\u0e01\u0e2d\u0e34\u0e19\u0e01\u0e48\u0e2d\u0e19");const t=await s.getIdToken(),a={siteId:f,taskName:N,description:v,dueDate:S,files:Z.filter((e=>"success"===e.status)).map((e=>e.uploadedData))},r=await fetch("/api/work-request/create",{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify(a)}),l=await r.json();if(!r.ok)throw new Error(l.error||"\u0e40\u0e01\u0e34\u0e14\u0e02\u0e49\u0e2d\u0e1c\u0e34\u0e14\u0e1e\u0e25\u0e32\u0e14");g("success","\u0e2a\u0e23\u0e49\u0e32\u0e07 Work Request \u0e2a\u0e33\u0e40\u0e23\u0e47\u0e08!",`\u0e40\u0e25\u0e02\u0e17\u0e35\u0e48\u0e40\u0e2d\u0e01\u0e2a\u0e32\u0e23: ${l.documentNumber}`),e()}catch(a){g("error","\u0e40\u0e01\u0e34\u0e14\u0e02\u0e49\u0e2d\u0e1c\u0e34\u0e14\u0e1e\u0e25\u0e32\u0e14",a instanceof Error?a.message:"Unknown error")}finally{P(!1)}}},className:"space-y-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["\u0e42\u0e04\u0e23\u0e07\u0e01\u0e32\u0e23 ",a.jsx("span",{className:"text-red-500",children:"*"})]}),(0,a.jsxs)("select",{value:f,onChange:e=>y(e.target.value),className:p,disabled:E,children:[a.jsx("option",{value:"",children:E?"\u0e01\u0e33\u0e25\u0e31\u0e07\u0e42\u0e2b\u0e25\u0e14...":"-- \u0e40\u0e25\u0e37\u0e2d\u0e01\u0e42\u0e04\u0e23\u0e07\u0e01\u0e32\u0e23 --"}),b.map((e=>a.jsx("option",{value:e.id,children:e.name},e.id)))]}),T.site&&a.jsx("p",{className:"text-red-600 text-sm mt-1",children:T.site})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["\u0e27\u0e31\u0e19\u0e17\u0e35\u0e48\u0e01\u0e33\u0e2b\u0e19\u0e14\u0e2a\u0e48\u0e07 (Due Date) ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx("input",{type:"date",value:S,onChange:e=>C(e.target.value),className:p}),T.dueDate&&a.jsx("p",{className:"text-red-600 text-sm mt-1",children:T.dueDate})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["\u0e2b\u0e31\u0e27\u0e02\u0e49\u0e2d\u0e07\u0e32\u0e19 ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx("input",{type:"text",value:N,onChange:e=>w(e.target.value),placeholder:"\u0e40\u0e0a\u0e48\u0e19 \u0e02\u0e2d\u0e41\u0e01\u0e49\u0e44\u0e02\u0e42\u0e21\u0e40\u0e14\u0e25\u0e42\u0e04\u0e23\u0e07\u0e2a\u0e23\u0e49\u0e32\u0e07\u0e2d\u0e32\u0e04\u0e32\u0e23 A",className:p}),T.taskName&&a.jsx("p",{className:"text-red-600 text-sm mt-1",children:T.taskName})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["\u0e23\u0e32\u0e22\u0e25\u0e30\u0e40\u0e2d\u0e35\u0e22\u0e14 ",a.jsx("span",{className:"text-gray-400 font-normal",children:"(Optional)"})]}),a.jsx("textarea",{value:v,onChange:e=>k(e.target.value),rows:4,placeholder:"\u0e2d\u0e18\u0e34\u0e1a\u0e32\u0e22\u0e23\u0e32\u0e22\u0e25\u0e30\u0e40\u0e2d\u0e35\u0e22\u0e14\u0e40\u0e1e\u0e34\u0e48\u0e21\u0e40\u0e15\u0e34\u0e21 (\u0e16\u0e49\u0e32\u0e21\u0e35)...",className:"w-full p-3 border rounded-lg bg-white text-gray-900"})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u0e41\u0e19\u0e1a\u0e44\u0e1f\u0e25\u0e4c (\u0e16\u0e49\u0e32\u0e21\u0e35)"}),(0,a.jsxs)("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-blue-500 transition-colors",children:[a.jsx("input",{type:"file",multiple:!0,onChange:async e=>{const t=Array.from(e.target.files||[]);if(!t.length)return;const s=t.map((e=>({id:`${e.name}-${Date.now()}`,file:e,status:"pending",progress:0})));D((e=>[...e,...s]));for(const a of s){D((e=>e.map((e=>e.id===a.id?{...e,status:"uploading"}:e))));const e=await A(a.file);D((t=>t.map((t=>t.id===a.id?{...t,...e}:t))))}e.target.value=""},id:"file-upload",className:"hidden"}),(0,a.jsxs)("label",{htmlFor:"file-upload",className:"cursor-pointer text-blue-600 hover:text-blue-800 font-medium flex items-center justify-center",children:[a.jsx(i.Z,{size:18,className:"mr-2"}),"\u0e04\u0e25\u0e34\u0e01\u0e40\u0e1e\u0e37\u0e48\u0e2d\u0e40\u0e25\u0e37\u0e2d\u0e01\u0e44\u0e1f\u0e25\u0e4c"]})]}),Z.length>0&&a.jsx("div",{className:"mt-4 space-y-2",children:Z.map(((e,t)=>(0,a.jsxs)("div",{className:"flex items-center text-sm p-2 bg-gray-100 rounded",children:[a.jsx(d.Z,{className:"w-4 h-4 mr-3 text-gray-500"}),a.jsx("span",{className:"flex-1 truncate",children:e.file.name}),(0,a.jsxs)("div",{className:"flex items-center ml-3",children:["uploading"===e.status&&a.jsx(n.Z,{className:"w-4 h-4"}),"success"===e.status&&a.jsx(c.Z,{className:"w-4 h-4 text-green-500"}),"error"===e.status&&a.jsx("span",{title:e.error,children:a.jsx(o.Z,{className:"w-4 h-4 text-red-500"})}),a.jsx("button",{type:"button",onClick:()=>{return Z[e=t].uploadedData,void D((t=>t.filter(((t,s)=>s!==e))));var e},className:"ml-3 text-gray-500 hover:text-red-600",children:a.jsx(m.Z,{size:16})})]})]},e.id)))})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-4 pt-4 border-t",children:[a.jsx("button",{type:"button",onClick:e,className:"px-6 py-2 text-sm text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200",children:"\u0e22\u0e01\u0e40\u0e25\u0e34\u0e01"}),(0,a.jsxs)("button",{type:"submit",disabled:z,className:"flex items-center px-6 py-2 text-sm text-white bg-blue-600 rounded-lg hover:bg-blue-700 disabled:bg-blue-300",children:[z?a.jsx(n.Z,{className:"w-5 h-5 mr-2"}):a.jsx(u.Z,{className:"w-5 h-5 mr-2"}),z?"\u0e01\u0e33\u0e25\u0e31\u0e07\u0e2a\u0e48\u0e07...":"\u0e2a\u0e48\u0e07\u0e04\u0e33\u0e02\u0e2d"]})]})]}):(0,a.jsxs)("div",{className:"text-center p-8 bg-yellow-50 rounded-lg border border-yellow-300",children:[a.jsx(o.Z,{className:"mx-auto w-12 h-12 text-yellow-500 mb-4"}),a.jsx("h3",{className:"text-lg font-bold text-yellow-800",children:"\u0e44\u0e21\u0e48\u0e21\u0e35\u0e2a\u0e34\u0e17\u0e18\u0e34\u0e4c\u0e2a\u0e23\u0e49\u0e32\u0e07 Work Request"}),a.jsx("p",{className:"text-yellow-700 mt-2",children:"\u0e40\u0e09\u0e1e\u0e32\u0e30 Project Engineer (PE) \u0e2b\u0e23\u0e37\u0e2d Owner Engineer (OE) \u0e40\u0e17\u0e48\u0e32\u0e19\u0e31\u0e49\u0e19\u0e17\u0e35\u0e48\u0e2a\u0e32\u0e21\u0e32\u0e23\u0e16\u0e2a\u0e23\u0e49\u0e32\u0e07\u0e04\u0e33\u0e23\u0e49\u0e2d\u0e07\u0e02\u0e2d\u0e44\u0e14\u0e49"}),a.jsx("button",{type:"button",onClick:e,className:"mt-6 px-6 py-2 text-sm text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300",children:"\u0e1b\u0e34\u0e14"})]})}}};