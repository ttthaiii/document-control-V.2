"use strict";exports.id=8077,exports.ids=[8077],exports.modules={28882:(e,s,r)=>{r.d(s,{Z:()=>P});var a=r(10326),t=r(17577),l=r(26107),i=r(90434),n=r(35047),d=r(4055),c=r(94019),o=r(26754),x=r(36283),E=r(941),m=r(39183),h=r(67048),N=r(24061),g=r(8798),R=r(71810);r(67967),r(76);var A=r(10842);function u({isOpen:e,onToggle:s}){let r=(0,n.usePathname)(),u=(0,n.useRouter)(),b=(0,n.useSearchParams)(),{user:I,logout:p}=(0,l.a)(),{showLoader:j}=(0,d.r)(),[P,_]=(0,t.useState)(!1),[D,M]=(0,t.useState)([]),v=e=>{if(!I)return!1;let[s,r]=e.split("."),a=(A.yB[e]||[]).includes(I.role);return!!D.some(e=>e.userOverrides?.[I.id]?.[s]?.[r]===!0)||!!a},{canViewShop:y,canViewGen:f,canViewMat:$,hasRfaAccess:S,hasWorkRequestAccess:O,isAdminAccess:C}=(0,t.useMemo)(()=>{if(!I)return{canViewShop:!1,canViewGen:!1,canViewMat:!1,hasRfaAccess:!1,hasWorkRequestAccess:!1,isAdminAccess:!1};let e=v(`RFA.${A.S4.RFA.VIEW_SHOP}`),s=v(`RFA.${A.S4.RFA.VIEW_GEN}`),r=v(`RFA.${A.S4.RFA.VIEW_MAT}`);return{canViewShop:e,canViewGen:s,canViewMat:r,hasRfaAccess:e||s||r,hasWorkRequestAccess:v(`WR.${A.S4.WORK_REQUEST.VIEW}`),isAdminAccess:"Admin"===I.role}},[I,D]),T=(0,t.useMemo)(()=>I?.sites&&0!==D.length?D.filter(e=>I.sites.includes(e.id)):[],[I?.sites,D]),[F,K]=(0,t.useState)(!1),w=async()=>{try{K(!0),await p(),u.push("/")}catch(e){console.error("Logout error:",e)}finally{K(!1)}},V=e=>r===e||r.startsWith(e+"/");return I?(0,a.jsxs)(a.Fragment,{children:[e&&a.jsx("div",{className:"lg:hidden fixed inset-0 bg-black bg-opacity-50 z-30",onClick:s}),(0,a.jsxs)("div",{className:`fixed inset-y-0 left-0 z-40 w-64 bg-gradient-to-b from-amber-50 to-orange-50 border-r border-orange-200 transform transition-transform duration-300 ease-in-out ${e?"translate-x-0":"-translate-x-full"} flex flex-col h-screen pt-16`,children:[(0,a.jsxs)("div",{className:"bg-gradient-to-r from-orange-600 to-orange-700 text-white p-4 lg:p-6",children:[a.jsx("div",{className:"lg:hidden flex justify-end mb-2",children:a.jsx("button",{onClick:s,className:"p-1 rounded-md hover:bg-white hover:bg-opacity-20",children:a.jsx(c.Z,{size:20})})}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)("h3",{className:"font-semibold text-lg truncate",children:["Welcome ",I.email?.split("@")[0]]}),(0,a.jsxs)("p",{className:"text-orange-100 text-sm",children:["Role: ",I.role]}),T.length>0&&(0,a.jsxs)("div",{children:[a.jsx("p",{className:"text-orange-100 text-xs",children:"Site:"}),a.jsx("div",{className:"pl-2",children:T.map(e=>(0,a.jsxs)("p",{className:"text-orange-100 text-xs truncate",title:e.name,children:["- ",e.name]},e.id))})]})]})]}),(0,a.jsxs)("nav",{className:"flex-1 p-4 space-y-2 overflow-y-auto",children:[(0,a.jsxs)(i.default,{href:"/dashboard",onClick:j,className:`flex items-center px-3 py-2 rounded-lg transition-colors ${V("/dashboard")&&"/dashboard"===r?"bg-blue-100 text-blue-700":"text-gray-700 hover:bg-gray-100"}`,children:[a.jsx(o.Z,{className:"w-5 h-5 mr-3"})," Dashboard"]}),S&&(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)("button",{onClick:()=>_(!P),className:`w-full flex items-center justify-between gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition-colors duration-200 ${r.startsWith("/dashboard/rfa")||r.startsWith("/rfa/")?"bg-orange-200 text-orange-900":"text-gray-700 hover:bg-orange-100 hover:text-orange-800"}`,children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[a.jsx(x.Z,{size:18}),a.jsx("span",{children:"RFA Documents"})]}),P?a.jsx(E.Z,{size:16}):a.jsx(m.Z,{size:16})]}),P&&(0,a.jsxs)("div",{className:"ml-6 space-y-1 border-l-2 border-orange-200 pl-4",children:[y&&(0,a.jsxs)(i.default,{href:"/dashboard/rfa?type=RFA-SHOP",onClick:j,className:`flex items-center gap-3 px-3 py-2 rounded-md text-sm transition-colors duration-200 ${"/dashboard/rfa"===r&&"RFA-SHOP"===b.get("type")?"bg-blue-100 text-blue-900 font-medium":"text-gray-600 hover:bg-gray-100 hover:text-gray-800"}`,children:[a.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),a.jsx("span",{children:"\uD83C\uDFD7️ Shop Drawing"})]}),f&&(0,a.jsxs)(i.default,{href:"/dashboard/rfa?type=RFA-GEN",onClick:j,className:`flex items-center gap-3 px-3 py-2 rounded-md text-sm transition-colors duration-200 ${"/dashboard/rfa"===r&&"RFA-GEN"===b.get("type")?"bg-green-100 text-green-900 font-medium":"text-gray-600 hover:bg-gray-100 hover:text-gray-800"}`,children:[a.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),a.jsx("span",{children:"\uD83D\uDCCB General"})]}),$&&(0,a.jsxs)(i.default,{href:"/dashboard/rfa?type=RFA-MAT",onClick:j,className:`flex items-center gap-3 px-3 py-2 rounded-md text-sm transition-colors duration-200 ${"/dashboard/rfa"===r&&"RFA-MAT"===b.get("type")?"bg-orange-100 text-orange-900 font-medium":"text-gray-600 hover:bg-gray-100 hover:text-gray-800"}`,children:[a.jsx("div",{className:"w-2 h-2 bg-orange-500 rounded-full"}),a.jsx("span",{children:"\uD83E\uDDF1 Material"})]})]})]}),O&&(0,a.jsxs)(i.default,{href:"/dashboard/work-request",onClick:j,className:`flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition-colors duration-200 ${V("/dashboard/work-request")?"bg-orange-200 text-orange-900":"text-gray-700 hover:bg-orange-100 hover:text-orange-800"}`,children:[a.jsx(h.Z,{size:18}),a.jsx("span",{children:"Work Request"})]})]}),C&&(0,a.jsxs)("div",{className:"px-4 py-2",children:[a.jsx("div",{className:"border-t border-orange-200"}),(0,a.jsxs)("div",{className:"mt-2 space-y-1",children:[a.jsx("p",{className:"px-3 text-xs font-semibold uppercase text-gray-500 tracking-wider pt-2",children:"Admin"}),(0,a.jsxs)(i.default,{href:"/admin",onClick:j,className:`flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition-colors duration-200 ${"/admin"===r?"bg-red-100 text-red-800":"text-gray-700 hover:bg-red-50 hover:text-red-700"}`,children:[a.jsx(N.Z,{size:18}),a.jsx("span",{children:"Invite Users"})]}),(0,a.jsxs)(i.default,{href:"/admin/users",onClick:j,className:`flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition-colors duration-200 ${V("/admin/users")?"bg-red-100 text-red-800":"text-gray-700 hover:bg-red-50 hover:text-red-700"}`,children:[a.jsx(g.Z,{size:18}),a.jsx("span",{children:"Manage Users"})]})]})]}),a.jsx("div",{className:"p-4 border-t border-orange-200",children:(0,a.jsxs)("button",{onClick:w,disabled:F,className:`w-full flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg text-sm font-medium ${F?"bg-red-400 cursor-not-allowed":"bg-red-500 hover:bg-red-600"} text-white transition-colors duration-200`,children:[a.jsx(R.Z,{size:16}),a.jsx("span",{children:F?"กำลังออก...":"ออกจากระบบ"})]})})]})]}):null}let b=e=>a.jsx(t.Suspense,{fallback:a.jsx("div",{className:"w-64 bg-gray-100 h-screen"}),children:a.jsx(u,{...e})});var I=r(90748),p=r(6507),j=r(59734);let P=({children:e})=>{let[s,r]=(0,t.useState)(!0),{user:i,requestNotificationPermission:n}=(0,l.a)(),{isLoading:c}=(0,d.r)(),o=()=>{r(!s)};return(0,a.jsxs)("div",{className:"min-h-screen bg-gray-100",children:[a.jsx("header",{className:"fixed top-0 left-0 right-0 h-16 bg-white border-b border-gray-200 z-50",children:(0,a.jsxs)("div",{className:"flex items-center justify-between h-full px-4",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[a.jsx("button",{onClick:o,className:"p-2 rounded-md text-gray-600 hover:bg-gray-100 hover:text-gray-900 transition-colors",children:a.jsx(I.Z,{size:20})}),a.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:"\uD83C\uDFD7️ ttsdoc v2"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[a.jsx("button",{onClick:()=>n(),className:"p-2 rounded-md text-gray-600 hover:bg-gray-100 hover:text-blue-600 transition-colors relative",title:"เปิดการแจ้งเตือน",children:a.jsx(p.Z,{size:18})}),i&&(0,a.jsxs)("span",{className:"hidden sm:block text-sm text-gray-600",children:["\uD83D\uDC4B สวัสดี, ",i.email.split("@")[0]]}),(0,a.jsxs)("div",{className:"hidden md:flex items-center space-x-2 text-gray-600",children:[a.jsx(j.Z,{size:18}),a.jsx("span",{className:"text-sm font-medium",children:"T.T.S. Engineering"})]})]})]})}),(0,a.jsxs)("div",{className:"flex",children:[a.jsx(b,{isOpen:s,onToggle:o}),(0,a.jsxs)("main",{className:`
              relative flex-1 transition-all duration-300 ease-in-out
              ${s?"lg:ml-64":"lg:ml-0"}
              overflow-x-hidden
            `,children:[c&&a.jsx(d.Y,{}),a.jsx("div",{className:"h-full overflow-y-auto",children:a.jsx("div",{className:"pt-16",children:a.jsx("div",{className:"p-4 sm:p-6 lg:p-8",children:e})})})]})]})]})}},32875:(e,s,r)=>{r.d(s,{AuthGuard:()=>n});var a=r(10326),t=r(26107),l=r(35047);r(17577),r(7619);let i=()=>a.jsx("div",{className:"min-h-screen bg-gray-50",children:(0,a.jsxs)("div",{className:"animate-pulse",children:[a.jsx("div",{className:"bg-white shadow",children:a.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,a.jsxs)("div",{className:"flex justify-between items-center py-6",children:[a.jsx("div",{className:"h-8 bg-gray-200 rounded w-32"}),a.jsx("div",{className:"h-8 bg-gray-200 rounded w-24"})]})})}),(0,a.jsxs)("div",{className:"flex",children:[a.jsx("div",{className:"w-64 bg-white border-r border-gray-200 min-h-screen",children:a.jsx("div",{className:"p-4 space-y-3",children:[...Array(6)].map((e,s)=>a.jsx("div",{className:"h-10 bg-gray-100 rounded"},s))})}),a.jsx("div",{className:"flex-1 p-8",children:(0,a.jsxs)("div",{className:"space-y-6",children:[a.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3"}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[void 0,void 0,void 0].map((e,s)=>(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow",children:[a.jsx("div",{className:"h-4 bg-gray-200 rounded mb-2"}),a.jsx("div",{className:"h-8 bg-gray-200 rounded mb-4"}),a.jsx("div",{className:"h-4 bg-gray-200 rounded w-2/3"})]},s))})]})})]})]})});function n({children:e,requiredRoles:s=[],requiredSiteAccess:r=[],fallback:n,redirectTo:d="/login"}){let{user:c,loading:o,error:x}=(0,t.a)(),E=(0,l.useRouter)();return o?a.jsx(i,{}):x?a.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:a.jsx("div",{className:"text-center max-w-md mx-auto",children:(0,a.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[a.jsx("h2",{className:"text-lg font-semibold text-red-800 mb-2",children:"เกิดข้อผิดพลาด"}),a.jsx("p",{className:"text-red-600 mb-4",children:x}),a.jsx("button",{onClick:()=>window.location.reload(),className:"bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 transition-colors",children:"ลองใหม่"})]})})}):c?s.length>0&&!s.includes(c.role)?a.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:a.jsx("div",{className:"text-center max-w-md mx-auto",children:(0,a.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-6",children:[a.jsx("h2",{className:"text-lg font-semibold text-yellow-800 mb-2",children:"ไม่มีสิทธิ์เข้าถึง"}),a.jsx("p",{className:"text-yellow-700 mb-2",children:"คุณไม่มีสิทธิ์เข้าถึงหน้านี้"}),(0,a.jsxs)("p",{className:"text-sm text-yellow-600 mb-4",children:["ต้องการสิทธิ์: ",s.join(", ")," | สิทธิ์ปัจจุบัน: ",c.role]}),a.jsx("button",{onClick:()=>E.back(),className:"bg-yellow-600 text-white px-4 py-2 rounded hover:bg-yellow-700 transition-colors",children:"ย้อนกลับ"})]})})}):r.length>0&&"Admin"!==c.role&&!r.some(e=>c.sites?.includes(e))?a.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:a.jsx("div",{className:"text-center max-w-md mx-auto",children:(0,a.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[a.jsx("h2",{className:"text-lg font-semibold text-red-800 mb-2",children:"ไม่มีสิทธิ์เข้าถึงโครงการ"}),a.jsx("p",{className:"text-red-600 mb-4",children:"คุณไม่มีสิทธิ์เข้าถึงโครงการที่ต้องการ"}),a.jsx("button",{onClick:()=>E.back(),className:"bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 transition-colors",children:"ย้อนกลับ"})]})})}):a.jsx(a.Fragment,{children:e}):n?a.jsx(a.Fragment,{children:n}):a.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,a.jsxs)("div",{className:"text-center",children:[a.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-2",children:"กรุณาเข้าสู่ระบบ"}),a.jsx("p",{className:"text-gray-600 mb-4",children:"คุณต้องเข้าสู่ระบบเพื่อเข้าถึงหน้านี้"}),a.jsx("button",{onClick:()=>E.push(d),className:"bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 transition-colors",children:"เข้าสู่ระบบ"})]})})}},10842:(e,s,r)=>{r.d(s,{S4:()=>t,l8:()=>n,yB:()=>i});var a=r(7619);let t={RFA:{VIEW_SHOP:"view_shop",CREATE_SHOP:"create_shop",VIEW_GEN:"view_gen",CREATE_GEN:"create_gen",VIEW_MAT:"view_mat",CREATE_MAT:"create_mat",APPROVE:"can_approve"},WORK_REQUEST:{VIEW:"view_wr",CREATE:"create_wr",APPROVE:"approve_wr",VERIFY:"verify_wr"}};a.K$.ADMIN,a.K$.PD,a.K$.PM,a.K$.SE,a.K$.FM,a.K$.BIM,a.K$.SITE_ADMIN,a.K$.CM,a.K$.ME,a.K$.SN,a.K$.OE,a.K$.PE;let l=[a.K$.ADMIN,a.K$.PD,a.K$.PM,a.K$.BIM,a.K$.SITE_ADMIN,a.K$.CM,a.K$.ME,a.K$.SN,a.K$.OE,a.K$.PE],i={[`RFA.${t.RFA.VIEW_SHOP}`]:l,[`RFA.${t.RFA.CREATE_SHOP}`]:[a.K$.BIM,a.K$.ME,a.K$.SN,a.K$.SITE_ADMIN,a.K$.ADMIN,a.K$.PM,a.K$.PE,a.K$.OE],[`RFA.${t.RFA.VIEW_GEN}`]:l,[`RFA.${t.RFA.CREATE_GEN}`]:[a.K$.BIM,a.K$.ME,a.K$.SN,a.K$.SITE_ADMIN,a.K$.ADMIN,a.K$.PM,a.K$.PE,a.K$.OE],[`RFA.${t.RFA.VIEW_MAT}`]:l,[`RFA.${t.RFA.CREATE_MAT}`]:[a.K$.SITE_ADMIN,a.K$.ADMIN,a.K$.PM,a.K$.PE,a.K$.OE],[`RFA.${t.RFA.APPROVE}`]:[a.K$.CM,a.K$.ADMIN,a.K$.SITE_ADMIN,a.K$.PM,a.K$.PE,a.K$.OE],[`WR.${t.WORK_REQUEST.VIEW}`]:l,[`WR.${t.WORK_REQUEST.CREATE}`]:[a.K$.PE,a.K$.OE,a.K$.ADMIN],[`WR.${t.WORK_REQUEST.APPROVE}`]:[a.K$.PM,a.K$.ADMIN],[`WR.${t.WORK_REQUEST.VERIFY}`]:[a.K$.SITE_ADMIN,a.K$.ADMIN,a.K$.BIM]},n=[{title:"RFA - Shop Drawing",permissions:[{key:`RFA.${t.RFA.VIEW_SHOP}`,label:"เข้าดู (View)"},{key:`RFA.${t.RFA.CREATE_SHOP}`,label:"สร้าง (Create)"}]},{title:"RFA - General",permissions:[{key:`RFA.${t.RFA.VIEW_GEN}`,label:"เข้าดู (View)"},{key:`RFA.${t.RFA.CREATE_GEN}`,label:"สร้าง (Create)"}]},{title:"RFA - Material",permissions:[{key:`RFA.${t.RFA.VIEW_MAT}`,label:"เข้าดู (View)"},{key:`RFA.${t.RFA.CREATE_MAT}`,label:"สร้าง (Create)"}]},{title:"RFA - Approval",permissions:[{key:`RFA.${t.RFA.APPROVE}`,label:"อนุมัติเอกสาร (Approve)"}]},{title:"Work Request",permissions:[{key:`WR.${t.WORK_REQUEST.VIEW}`,label:"เข้าดู (View)"},{key:`WR.${t.WORK_REQUEST.CREATE}`,label:"สร้างใบคำขอ (Create)"},{key:`WR.${t.WORK_REQUEST.APPROVE}`,label:"อนุมัติใบคำขอ (PM)"},{key:`WR.${t.WORK_REQUEST.VERIFY}`,label:"ตรวจรับงาน (Site)"}]}]},7619:(e,s,r)=>{r.d(s,{$p:()=>n,Ge:()=>c,K$:()=>a,NK:()=>o,c9:()=>i,gf:()=>l,n$:()=>d,oU:()=>t,yh:()=>x});let a={ADMIN:"Admin",BIM:"BIM",SITE_ADMIN:"Site Admin",CM:"CM",ME:"ME",SN:"SN",OE:"OE",PE:"PE",PM:"PM",PD:"PD",SE:"SE",FM:"FM",ADMIN_SITE_2:"Adminsite2"};a.BIM,a.ME,a.SN,a.SITE_ADMIN,a.ADMIN,a.PM,a.PE,a.OE;let t=[a.SITE_ADMIN,a.ADMIN_SITE_2,a.OE,a.PE,a.ADMIN],l=[a.CM,a.ADMIN,a.SITE_ADMIN,a.PM,a.PE,a.OE];a.PM,a.ADMIN,a.SE,a.FM;let i=[a.PE,a.OE,a.ADMIN],n=[a.PM,a.ADMIN];a.PD,a.SE,a.FM;let d={PENDING_REVIEW:"PENDING_REVIEW",PENDING_CM_APPROVAL:"PENDING_CM_APPROVAL",REVISION_REQUIRED:"REVISION_REQUIRED",APPROVED:"APPROVED",APPROVED_WITH_COMMENTS:"APPROVED_WITH_COMMENTS",APPROVED_REVISION_REQUIRED:"APPROVED_REVISION_REQUIRED",REJECTED:"REJECTED",PENDING_FINAL_APPROVAL:"PENDING_FINAL_APPROVAL"},c={DRAFT:"DRAFT",REJECTED_BY_PM:"REJECTED_BY_PM",PENDING_BIM:"PENDING_BIM",IN_PROGRESS:"IN_PROGRESS",PENDING_ACCEPTANCE:"PENDING_ACCEPTANCE",REVISION_REQUESTED:"REVISION_REQUESTED",COMPLETED:"COMPLETED"},o={[d.PENDING_REVIEW]:"รอตรวจสอบ",[d.PENDING_CM_APPROVAL]:"รออนุมัติ (CM/Approver)",[d.REVISION_REQUIRED]:"แก้ไข",[d.APPROVED]:"อนุมัติ",[d.APPROVED_WITH_COMMENTS]:"อนุมัติตามคอมเมนต์ (ไม่แก้ไข)",[d.APPROVED_REVISION_REQUIRED]:"อนุมัติตามคอมเมนต์ (ต้องแก้ไข)",[d.REJECTED]:"ไม่อนุมัติ",[d.PENDING_FINAL_APPROVAL]:"รอ SITE อนุมัติขั้นสุดท้าย",[c.DRAFT]:"รออนุมัติ (PM)",[c.REJECTED_BY_PM]:"ไม่อนุมัติ (PM)",[c.PENDING_BIM]:"รอ BIM รับงาน",[c.IN_PROGRESS]:"BIM กำลังดำเนินการ",[c.PENDING_ACCEPTANCE]:"รอตรวจรับ (Site)",[c.REVISION_REQUESTED]:"ขอแก้ไข (WR)",[c.COMPLETED]:"เสร็จสิ้น"},x={[d.PENDING_REVIEW]:"#0088FE",[d.PENDING_CM_APPROVAL]:"#00C49F",[d.REVISION_REQUIRED]:"#FFBB28",[d.APPROVED]:"#28A745",[d.REJECTED]:"#DC3545",[d.APPROVED_WITH_COMMENTS]:"#2f3e3aff",[d.APPROVED_REVISION_REQUIRED]:"#FD7E14",[c.DRAFT]:"#6c757d",[c.REJECTED_BY_PM]:"#DC3545",[c.PENDING_BIM]:"#0088FE",[c.IN_PROGRESS]:"#FFBB28",[c.PENDING_ACCEPTANCE]:"#AF19FF",[c.REVISION_REQUESTED]:"#FD7E14",[c.COMPLETED]:"#28A745"}}};