exports.id=6599,exports.ids=[6599],exports.modules={31635:(e,t,s)=>{Promise.resolve().then(s.t.bind(s,12994,23)),Promise.resolve().then(s.t.bind(s,96114,23)),Promise.resolve().then(s.t.bind(s,9727,23)),Promise.resolve().then(s.t.bind(s,79671,23)),Promise.resolve().then(s.t.bind(s,41868,23)),Promise.resolve().then(s.t.bind(s,84759,23))},95744:(e,t,s)=>{Promise.resolve().then(s.bind(s,26107)),Promise.resolve().then(s.bind(s,4055)),Promise.resolve().then(s.bind(s,31469))},79821:(e,t,s)=>{"use strict";s.d(t,{Z:()=>i});var r=s(10326);s(17577);let i=({className:e})=>{let t=`
    inline-block h-8 w-8 animate-spin rounded-full 
    border-4 border-solid border-current border-e-transparent 
    align-[-0.125em] text-gray-400 motion-reduce:animate-[spin_1.5s_linear_infinite]
    ${e||""}
  `;return r.jsx("div",{className:t.trim(),role:"status",children:r.jsx("span",{className:"!absolute !-m-px !h-px !w-px !overflow-hidden !whitespace-nowrap !border-0 !p-0 ![clip:rect(0,0,0,0)]",children:"Loading..."})})}},26107:(e,t,s)=>{"use strict";s.d(t,{AuthProvider:()=>x,a:()=>E});var r=s(10326),i=s(17577),a=s(5779),n=s(76),l=s(60937),o=s(67967);let d=(0,i.createContext)({user:null,firebaseUser:null,loading:!0,error:null,logout:async()=>{},requestNotificationPermission:async()=>{}}),c=()=>!1;function x({children:e}){let[t,s]=(0,i.useState)(null),[x,E]=(0,i.useState)(null),[m,N]=(0,i.useState)(!0),[u,h]=(0,i.useState)(null),P=async(e,t)=>{if(o.Fw){if(!c()&&"SAVE"===t){console.log("\uD83D\uDCBB Desktop detected: Notifications are disabled for desktop devices.");return}try{if("SAVE"===t){let t=await Notification.requestPermission();if("granted"===t){let t=await (0,l.LP)(o.Fw,{vapidKey:"BJ13x_HEhi6a7lCuv73CZw78pcmHWQoLdNNZag8EZPcJSD-VNyb2ENgAt_KGnf30p6AzVrE89HckdU4wn4wq9wA"});t&&(await (0,n.r7)((0,n.JU)(o.db,"users",e),{fcmTokens:[t],lastLogin:new Date}),console.log("\uD83D\uDCF1 Mobile Notification Token Updated"))}}else"REMOVE"===t&&await (0,l.pQ)(o.Fw)}catch(e){console.error("FCM Token Error:",e)}}},g=async()=>{try{x?.id&&await P(x.id,"REMOVE"),await (0,a.w7)(o.I8),E(null)}catch(e){throw console.error("Logout error:",e),e}},b=async()=>{if(!c()){alert("ระบบแจ้งเตือนรองรับเฉพาะการใช้งานบนโทรศัพท์มือถือเท่านั้น");return}x?.id&&(await P(x.id,"SAVE"),alert("เปิดรับการแจ้งเตือนเรียบร้อยแล้ว"))};return r.jsx(d.Provider,{value:{user:x,firebaseUser:t,loading:m,error:u,logout:g,requestNotificationPermission:b},children:e})}function E(){return(0,i.useContext)(d)}},32875:(e,t,s)=>{"use strict";s.d(t,{AuthGuard:()=>l});var r=s(10326),i=s(26107),a=s(35047);s(17577),s(7619);let n=()=>r.jsx("div",{className:"min-h-screen bg-gray-50",children:(0,r.jsxs)("div",{className:"animate-pulse",children:[r.jsx("div",{className:"bg-white shadow",children:r.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,r.jsxs)("div",{className:"flex justify-between items-center py-6",children:[r.jsx("div",{className:"h-8 bg-gray-200 rounded w-32"}),r.jsx("div",{className:"h-8 bg-gray-200 rounded w-24"})]})})}),(0,r.jsxs)("div",{className:"flex",children:[r.jsx("div",{className:"w-64 bg-white border-r border-gray-200 min-h-screen",children:r.jsx("div",{className:"p-4 space-y-3",children:[...Array(6)].map((e,t)=>r.jsx("div",{className:"h-10 bg-gray-100 rounded"},t))})}),r.jsx("div",{className:"flex-1 p-8",children:(0,r.jsxs)("div",{className:"space-y-6",children:[r.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3"}),r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[void 0,void 0,void 0].map((e,t)=>(0,r.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow",children:[r.jsx("div",{className:"h-4 bg-gray-200 rounded mb-2"}),r.jsx("div",{className:"h-8 bg-gray-200 rounded mb-4"}),r.jsx("div",{className:"h-4 bg-gray-200 rounded w-2/3"})]},t))})]})})]})]})});function l({children:e,requiredRoles:t=[],requiredSiteAccess:s=[],fallback:l,redirectTo:o="/login"}){let{user:d,loading:c,error:x}=(0,i.a)(),E=(0,a.useRouter)();return c?r.jsx(n,{}):x?r.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:r.jsx("div",{className:"text-center max-w-md mx-auto",children:(0,r.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[r.jsx("h2",{className:"text-lg font-semibold text-red-800 mb-2",children:"เกิดข้อผิดพลาด"}),r.jsx("p",{className:"text-red-600 mb-4",children:x}),r.jsx("button",{onClick:()=>window.location.reload(),className:"bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 transition-colors",children:"ลองใหม่"})]})})}):d?t.length>0&&!t.includes(d.role)?r.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:r.jsx("div",{className:"text-center max-w-md mx-auto",children:(0,r.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-6",children:[r.jsx("h2",{className:"text-lg font-semibold text-yellow-800 mb-2",children:"ไม่มีสิทธิ์เข้าถึง"}),r.jsx("p",{className:"text-yellow-700 mb-2",children:"คุณไม่มีสิทธิ์เข้าถึงหน้านี้"}),(0,r.jsxs)("p",{className:"text-sm text-yellow-600 mb-4",children:["ต้องการสิทธิ์: ",t.join(", ")," | สิทธิ์ปัจจุบัน: ",d.role]}),r.jsx("button",{onClick:()=>E.back(),className:"bg-yellow-600 text-white px-4 py-2 rounded hover:bg-yellow-700 transition-colors",children:"ย้อนกลับ"})]})})}):s.length>0&&"Admin"!==d.role&&!s.some(e=>d.sites?.includes(e))?r.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:r.jsx("div",{className:"text-center max-w-md mx-auto",children:(0,r.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[r.jsx("h2",{className:"text-lg font-semibold text-red-800 mb-2",children:"ไม่มีสิทธิ์เข้าถึงโครงการ"}),r.jsx("p",{className:"text-red-600 mb-4",children:"คุณไม่มีสิทธิ์เข้าถึงโครงการที่ต้องการ"}),r.jsx("button",{onClick:()=>E.back(),className:"bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 transition-colors",children:"ย้อนกลับ"})]})})}):r.jsx(r.Fragment,{children:e}):l?r.jsx(r.Fragment,{children:l}):r.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,r.jsxs)("div",{className:"text-center",children:[r.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-2",children:"กรุณาเข้าสู่ระบบ"}),r.jsx("p",{className:"text-gray-600 mb-4",children:"คุณต้องเข้าสู่ระบบเพื่อเข้าถึงหน้านี้"}),r.jsx("button",{onClick:()=>E.push(o),className:"bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 transition-colors",children:"เข้าสู่ระบบ"})]})})}},7619:(e,t,s)=>{"use strict";s.d(t,{$p:()=>o,Ge:()=>c,K$:()=>r,NK:()=>x,c9:()=>l,gf:()=>n,n$:()=>d,oU:()=>a,uc:()=>i,yh:()=>E});let r={ADMIN:"Admin",BIM:"BIM",SITE_ADMIN:"Site Admin",CM:"CM",ME:"ME",SN:"SN",OE:"OE",PE:"PE",PM:"PM",PD:"PD",SE:"SE",FM:"FM",ADMIN_SITE_2:"Adminsite2"},i=[r.BIM,r.ME,r.SN,r.ADMIN],a=[r.SITE_ADMIN,r.ADMIN_SITE_2,r.OE,r.PE,r.ADMIN],n=[r.CM,r.PD,r.ADMIN];r.PM,r.ADMIN,r.SE,r.FM;let l=[r.PE,r.OE,r.ADMIN],o=[r.PD,r.PM,r.ADMIN],d={PENDING_REVIEW:"PENDING_REVIEW",PENDING_CM_APPROVAL:"PENDING_CM_APPROVAL",REVISION_REQUIRED:"REVISION_REQUIRED",APPROVED:"APPROVED",APPROVED_WITH_COMMENTS:"APPROVED_WITH_COMMENTS",APPROVED_REVISION_REQUIRED:"APPROVED_REVISION_REQUIRED",REJECTED:"REJECTED",PENDING_FINAL_APPROVAL:"PENDING_FINAL_APPROVAL"},c={DRAFT:"DRAFT",REJECTED_BY_PM:"REJECTED_BY_PM",PENDING_BIM:"PENDING_BIM",IN_PROGRESS:"IN_PROGRESS",PENDING_ACCEPTANCE:"PENDING_ACCEPTANCE",REVISION_REQUESTED:"REVISION_REQUESTED",COMPLETED:"COMPLETED"},x={[d.PENDING_REVIEW]:"รอตรวจสอบ",[d.PENDING_CM_APPROVAL]:"ส่ง CM",[d.REVISION_REQUIRED]:"แก้ไข",[d.APPROVED]:"อนุมัติ",[d.APPROVED_WITH_COMMENTS]:"อนุมัติตามคอมเมนต์ (ไม่แก้ไข)",[d.APPROVED_REVISION_REQUIRED]:"อนุมัติตามคอมเมนต์ (ต้องแก้ไข)",[d.REJECTED]:"ไม่อนุมัติ",[d.PENDING_FINAL_APPROVAL]:"รอ SITE อนุมัติขั้นสุดท้าย",[c.DRAFT]:"รออนุมัติ (PM)",[c.REJECTED_BY_PM]:"ไม่อนุมัติ (PM)",[c.PENDING_BIM]:"รอ BIM รับงาน",[c.IN_PROGRESS]:"BIM กำลังดำเนินการ",[c.PENDING_ACCEPTANCE]:"รอตรวจรับ (Site)",[c.REVISION_REQUESTED]:"ขอแก้ไข (WR)",[c.COMPLETED]:"เสร็จสิ้น"},E={[d.PENDING_REVIEW]:"#0088FE",[d.PENDING_CM_APPROVAL]:"#00C49F",[d.REVISION_REQUIRED]:"#FFBB28",[d.APPROVED]:"#28A745",[d.REJECTED]:"#DC3545",[d.APPROVED_WITH_COMMENTS]:"#2f3e3aff",[d.APPROVED_REVISION_REQUIRED]:"#FD7E14",[c.DRAFT]:"#6c757d",[c.REJECTED_BY_PM]:"#DC3545",[c.PENDING_BIM]:"#0088FE",[c.IN_PROGRESS]:"#FFBB28",[c.PENDING_ACCEPTANCE]:"#AF19FF",[c.REVISION_REQUESTED]:"#FD7E14",[c.COMPLETED]:"#28A745"}},4055:(e,t,s)=>{"use strict";s.d(t,{LoadingProvider:()=>d,Y:()=>o,r:()=>c});var r=s(10326),i=s(17577),a=s(79821),n=s(35047);let l=(0,i.createContext)(void 0),o=()=>r.jsx("div",{className:"absolute inset-0 bg-gray-100 z-30 flex items-center justify-center",children:r.jsx(a.Z,{className:"w-12 h-12 text-gray-500"})}),d=({children:e})=>{let[t,s]=(0,i.useState)(!1),a=(0,n.usePathname)(),o=(0,n.useSearchParams)();return(0,i.useEffect)(()=>{s(!1)},[a,o]),r.jsx(l.Provider,{value:{isLoading:t,showLoader:()=>s(!0),hideLoader:()=>s(!1)},children:e})},c=()=>{let e=(0,i.useContext)(l);if(void 0===e)throw Error("useLoading must be used within a LoadingProvider");return e}},31469:(e,t,s)=>{"use strict";s.d(t,{NotificationProvider:()=>E,l:()=>m});var r=s(10326),i=s(17577),a=s(30361),n=s(69669),l=s(50949);let o={success:r.jsx(a.Z,{className:"h-12 w-12 text-green-500"}),error:r.jsx(n.Z,{className:"h-12 w-12 text-red-500"}),warning:r.jsx(l.Z,{className:"h-12 w-12 text-yellow-500"})},d={success:"bg-green-600 hover:bg-green-700",error:"bg-red-600 hover:bg-red-700",warning:"bg-yellow-600 hover:bg-yellow-700"},c=({isOpen:e,type:t,title:s,message:i,onClose:a})=>e?r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 z-[100] flex items-center justify-center p-4",children:(0,r.jsxs)("div",{className:"relative bg-white rounded-lg shadow-xl w-full max-w-sm mx-auto p-6 text-center",children:[r.jsx("div",{className:"flex justify-center mb-4",children:o[t]}),r.jsx("h3",{className:"text-xl font-semibold text-gray-800 mb-2",children:s}),i&&r.jsx("p",{className:"text-gray-600 text-sm mb-6 whitespace-pre-wrap",children:i}),r.jsx("button",{onClick:a,className:`w-full px-4 py-2 text-white font-semibold rounded-lg transition-colors ${d[t]}`,children:"ตกลง"})]})}):null,x=(0,i.createContext)(void 0),E=({children:e})=>{let[t,s]=(0,i.useState)({isOpen:!1,type:"success",title:"",message:null}),a=(0,i.useCallback)((e,t,r="")=>{s({isOpen:!0,type:e,title:t,message:r})},[]);return(0,r.jsxs)(x.Provider,{value:{showNotification:a},children:[e,r.jsx(c,{isOpen:t.isOpen,type:t.type,title:t.title,message:t.message,onClose:()=>{s(e=>({...e,isOpen:!1}))}})]})},m=()=>{let e=(0,i.useContext)(x);if(void 0===e)throw Error("useNotification must be used within a NotificationProvider");return e}},67967:(e,t,s)=>{"use strict";s.d(t,{Fw:()=>d,I8:()=>l,db:()=>o});var r=s(42585),i=s(5779),a=s(76);s(60937);let n=(0,r.C6)().length>0?(0,r.Mq)():(0,r.ZF)({apiKey:"AIzaSyAsayb-DEOBE0zi0qh-dPBfihClgXrX1sY",authDomain:"ttsdocumentcontrol.firebaseapp.com",projectId:"ttsdocumentcontrol",storageBucket:"ttsdocumentcontrol.firebasestorage.app",messagingSenderId:"48440915675",appId:"1:48440915675:web:f11611895bfb52d4d27efe"}),l=(0,i.v0)(n),o=(0,a.ad)(n),d=null},96868:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>E,metadata:()=>c,viewport:()=>x});var r=s(19510),i=s(25384),a=s.n(i);s(5023);var n=s(68570);let l=(0,n.createProxy)(String.raw`D:\ttsdoc-v2\src\lib\auth\useAuth.tsx#AuthProvider`);(0,n.createProxy)(String.raw`D:\ttsdoc-v2\src\lib\auth\useAuth.tsx#useAuth`),(0,n.createProxy)(String.raw`D:\ttsdoc-v2\src\lib\context\LoadingContext.tsx#GlobalSpinner`);let o=(0,n.createProxy)(String.raw`D:\ttsdoc-v2\src\lib\context\LoadingContext.tsx#LoadingProvider`);(0,n.createProxy)(String.raw`D:\ttsdoc-v2\src\lib\context\LoadingContext.tsx#useLoading`);let d=(0,n.createProxy)(String.raw`D:\ttsdoc-v2\src\lib\context\NotificationContext.tsx#NotificationProvider`);(0,n.createProxy)(String.raw`D:\ttsdoc-v2\src\lib\context\NotificationContext.tsx#useNotification`);let c={title:"ttsdoc v2 - Construction Document Management",description:"Professional construction document management system",manifest:"/manifest.json",icons:{icon:"/favicon.ico",apple:"/icons/icon-192x192.png"}},x={themeColor:"#f97316",width:"device-width",initialScale:1,maximumScale:1};function E({children:e}){return r.jsx("html",{lang:"th",children:r.jsx("body",{className:a().className,children:r.jsx(l,{children:r.jsx(o,{children:r.jsx(d,{children:e})})})})})}},5023:()=>{}};